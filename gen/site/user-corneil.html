<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Solutions by corneil</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body id="top" class="article toc2 toc-right">
<div id="header">
<h1>Solutions by corneil</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#sol-0">Hello World!</a></li>
<li><a href="#sol-1">Calorie Counting</a>
<ul class="sectlevel2">
<li><a href="#_parsing">Parsing</a></li>
<li><a href="#_part_1">Part 1</a></li>
<li><a href="#_part_2">Part 2</a></li>
</ul>
</li>
<li><a href="#sol-2">Rock Paper Scissors</a></li>
<li><a href="#sol-3">Rucksack Reorganization</a>
<ul class="sectlevel2">
<li><a href="#_calculating_the_priority">Calculating the priority</a></li>
<li><a href="#_part1">Part1</a></li>
<li><a href="#_part_2_2">Part 2</a></li>
<li><a href="#_takeaways">Takeaways</a></li>
<li><a href="#_full_source">Full source</a></li>
</ul>
</li>
<li><a href="#sol-4">Camp Cleanup</a>
<ul class="sectlevel2">
<li><a href="#_part_1_2">Part 1</a></li>
<li><a href="#_part_2_3">Part 2</a></li>
<li><a href="#_takeaways_2">Takeaways</a></li>
<li><a href="#_full_source_2">Full source</a></li>
</ul>
</li>
<li><a href="#sol-5">Supply Stacks</a>
<ul class="sectlevel2">
<li><a href="#_data_structures">Data Structures</a></li>
<li><a href="#_parsing_2">Parsing</a></li>
<li><a href="#_part_1_3">Part 1</a></li>
<li><a href="#_part_2_4">Part 2</a></li>
<li><a href="#_takeaways_3">Takeaways</a></li>
<li><a href="#_full_source_3">Full source</a></li>
</ul>
</li>
<li><a href="#sol-6">Tuning Trouble</a>
<ul class="sectlevel2">
<li><a href="#_solution">Solution</a></li>
<li><a href="#_full_source_4">Full source</a></li>
</ul>
</li>
<li><a href="#sol-7">No Space Left On Device</a>
<ul class="sectlevel2">
<li><a href="#_data_model">Data Model</a></li>
<li><a href="#_parsing_3">Parsing</a></li>
<li><a href="#_solutions">Solutions</a></li>
<li><a href="#_full_source_5">Full source</a></li>
</ul>
</li>
<li><a href="#sol-8">Treetop Tree House</a>
<ul class="sectlevel2">
<li><a href="#_model">Model</a></li>
<li><a href="#_parsing_4">Parsing</a></li>
<li><a href="#_part_1_5">Part 1</a></li>
<li><a href="#_part_2_6">Part 2</a></li>
<li><a href="#_full_source_6">Full source</a></li>
</ul>
</li>
<li><a href="#sol-9">Rope Bridge</a>
<ul class="sectlevel2">
<li><a href="#_model_2">Model</a></li>
<li><a href="#_parsing_5">Parsing</a></li>
<li><a href="#_simulating_the_rope">Simulating the rope</a></li>
<li><a href="#_full_source_7">Full source</a></li>
</ul>
</li>
<li><a href="#sol-10">Cathode-Ray Tube</a>
<ul class="sectlevel2">
<li><a href="#_input_model">Input Model</a></li>
<li><a href="#_parsing_6">Parsing</a></li>
<li><a href="#_processor_model">Processor Model</a></li>
<li><a href="#_part_1_6">Part 1</a></li>
<li><a href="#_part_2_7">Part 2</a></li>
<li><a href="#_full_source_8">Full source</a></li>
</ul>
</li>
<li><a href="#sol-11">Monkey in the Middle</a>
<ul class="sectlevel2">
<li><a href="#_model_3">Model</a></li>
<li><a href="#_parsing_7">Parsing</a></li>
<li><a href="#_processing">Processing</a></li>
<li><a href="#_part_1_7">Part 1</a></li>
<li><a href="#_part_2_8">Part 2</a></li>
<li><a href="#_full_source_9">Full source</a></li>
</ul>
</li>
<li><a href="#sol-12">Hill Climbing Algorithm</a>
<ul class="sectlevel2">
<li><a href="#_model_4">Model</a></li>
<li><a href="#_parsing_8">Parsing</a></li>
<li><a href="#_processing_2">Processing</a></li>
<li><a href="#_part_1_8">Part 1</a></li>
<li><a href="#_part_2_9">Part 2</a></li>
<li><a href="#_full_source_10">Full source</a></li>
</ul>
</li>
<li><a href="#sol-13">Distress Signal</a>
<ul class="sectlevel2">
<li><a href="#_sample_input">Sample Input</a></li>
<li><a href="#_model_5">Model</a></li>
<li><a href="#_parsing_9">Parsing</a></li>
<li><a href="#_processing_3">Processing</a></li>
<li><a href="#_part_1_9">Part 1</a></li>
<li><a href="#_part_2_10">Part 2</a></li>
<li><a href="#_full_source_11">Full source</a></li>
</ul>
</li>
<li><a href="#sol-14">Regolith Reservoir</a>
<ul class="sectlevel2">
<li><a href="#_sample_input_2">Sample Input</a></li>
<li><a href="#_model_6">Model</a></li>
<li><a href="#_parsing_10">Parsing</a></li>
<li><a href="#_processing_4">Processing</a></li>
<li><a href="#_part_1_10">Part 1</a></li>
<li><a href="#_part_2_11">Part 2</a></li>
<li><a href="#_full_source_12">Full source</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="index.html">Overview</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-0">Hello World!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a simple Hello World program in <a href="https://kotlinlang.org">Kotlin</a>, if you want to experiment with Kotlin use the <a href="https://play.kotlinlang.org">Kotlin Playground</a></p>
</div>
<div class="paragraph">
<p>My aim with <a href="https://adventofcode.com/2021">Advent of Code</a> is to write code solving the puzzles in a way that is understandable to a wide audience.
Feel free to reach out with comments at the links above.</p>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-1">Calorie Counting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to follow these solutions you will need to login to <a href="https://adventofcode.com/2022">Advent of Code</a> and complete each day.</p>
</div>
<div class="paragraph">
<p>The day was lines representing the calories of food items carried by elves and separated by blank lines.
Kotlin File has a readLines function that makes it easy to parse the input, calculate the calories for each elf and add to a list.</p>
</div>
<div class="sect2">
<h3 id="_parsing">Parsing</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin">  <span class="k">fun</span> <span class="nf">findCalories</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">elves</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;()</span>
    <span class="kd">var</span> <span class="py">calories</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">line</span> <span class="k">in</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="nf">isBlank</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">elves</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">calories</span><span class="p">)</span>
        <span class="n">calories</span> <span class="p">=</span> <span class="mi">0</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">calories</span> <span class="p">+=</span> <span class="n">line</span><span class="p">.</span><span class="nf">toInt</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">elves</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">calories</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">elves</span>
  <span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_1">Part 1</h3>
<div class="paragraph">
<p>For part one the max value it the answer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin">  <span class="k">fun</span> <span class="nf">findMaxCalories</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">calories</span> <span class="p">=</span> <span class="nf">findCalories</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">calories</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span>
  <span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_2">Part 2</h3>
<div class="paragraph">
<p>For part two the result is the sum of the first three when sorted in descending order. Kotlin has the <code>take</code> method on collections which is very useful in this case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin">  <span class="k">fun</span> <span class="nf">topThree</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">calories</span> <span class="p">=</span> <span class="nf">findCalories</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">calories</span><span class="p">.</span><span class="nf">sortedDescending</span><span class="p">().</span><span class="nf">take</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nf">sum</span><span class="p">()</span>
  <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-2">Rock Paper Scissors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Part 1 meant we needed to parse input representing an opponent hand when playing RPS, and we had to assume the 2nd input was an answer we needed to provide while "cheating".</p>
</div>
<div class="paragraph">
<p>Part 2 came with a curveball in that the 2nd input should be treated as an outcome. This means we needed to find the correct hand for the outcome.
The score calculation was a function of the outcome and the hand we selected.</p>
</div>
<div class="paragraph">
<p>Below is the final code and there are loaders for creating the rounds for part 1 and part 2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">enum</span> <span class="kd">class</span> <span class="nc">Rps</span><span class="p">(</span><span class="kd">val</span> <span class="py">identifiers</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">shapeScore</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>
  <span class="nc">ROCK</span><span class="p">(</span><span class="s">"AX"</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
  <span class="nc">PAPER</span><span class="p">(</span><span class="s">"BY"</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
  <span class="nc">SCISSORS</span><span class="p">(</span><span class="s">"CZ"</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="kd">class</span> <span class="nc">Outcome</span><span class="p">(</span><span class="kd">val</span> <span class="py">identifier</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">score</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>
  <span class="nc">LOSE</span><span class="p">(</span><span class="s">"X"</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
  <span class="nc">DRAW</span><span class="p">(</span><span class="s">"Y"</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
  <span class="nc">WIN</span><span class="p">(</span><span class="s">"Z"</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">data class</span> <span class="nc">Hand</span><span class="p">(</span><span class="kd">val</span> <span class="py">them</span><span class="p">:</span> <span class="nc">Rps</span><span class="p">,</span> <span class="kd">val</span> <span class="py">me</span><span class="p">:</span> <span class="nc">Rps</span><span class="p">)</span>

<span class="kd">object</span> <span class="nc">Rules</span> <span class="p">{</span>

  <span class="kd">data class</span> <span class="nc">Rule</span><span class="p">(</span><span class="kd">val</span> <span class="py">loser</span><span class="p">:</span> <span class="nc">Rps</span><span class="p">,</span> <span class="kd">val</span> <span class="py">winner</span><span class="p">:</span> <span class="nc">Rps</span><span class="p">)</span>

  <span class="k">private</span> <span class="kd">val</span> <span class="py">beats</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
    <span class="nc">Rps</span><span class="p">.</span><span class="nc">ROCK</span> <span class="n">to</span> <span class="nc">Rule</span><span class="p">(</span><span class="nc">Rps</span><span class="p">.</span><span class="nc">SCISSORS</span><span class="p">,</span> <span class="nc">Rps</span><span class="p">.</span><span class="nc">PAPER</span><span class="p">),</span>
    <span class="nc">Rps</span><span class="p">.</span><span class="nc">PAPER</span> <span class="n">to</span> <span class="nc">Rule</span><span class="p">(</span><span class="nc">Rps</span><span class="p">.</span><span class="nc">ROCK</span><span class="p">,</span> <span class="nc">Rps</span><span class="p">.</span><span class="nc">SCISSORS</span><span class="p">),</span>
    <span class="nc">Rps</span><span class="p">.</span><span class="nc">SCISSORS</span> <span class="n">to</span> <span class="nc">Rule</span><span class="p">(</span><span class="nc">Rps</span><span class="p">.</span><span class="nc">PAPER</span><span class="p">,</span> <span class="nc">Rps</span><span class="p">.</span><span class="nc">ROCK</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="k">fun</span> <span class="nf">winner</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="nc">Rps</span><span class="p">):</span> <span class="nc">Rps</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">winner</span> <span class="p">=</span> <span class="n">beats</span><span class="p">[</span><span class="n">shape</span><span class="p">]</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find $shape"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">winner</span><span class="p">.</span><span class="n">winner</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">loser</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="nc">Rps</span><span class="p">):</span> <span class="nc">Rps</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">loser</span> <span class="p">=</span> <span class="n">beats</span><span class="p">[</span><span class="n">shape</span><span class="p">]</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find $shape"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loser</span><span class="p">.</span><span class="n">loser</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">didIWin</span><span class="p">(</span><span class="n">round</span><span class="p">:</span> <span class="nc">Hand</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">shape</span> <span class="p">=</span> <span class="nf">loser</span><span class="p">(</span><span class="n">round</span><span class="p">.</span><span class="n">me</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">shape</span> <span class="p">==</span> <span class="n">round</span><span class="p">.</span><span class="n">them</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">fun</span> <span class="nf">toRps</span><span class="p">(</span><span class="n">hint</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Rps</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">Rps</span><span class="p">.</span><span class="nf">values</span><span class="p">().</span><span class="nf">find</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">identifiers</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span> <span class="p">}</span> 
              <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Invalid RPS $hint"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">toOutcome</span><span class="p">(</span><span class="n">outcome</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Outcome</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">Outcome</span><span class="p">.</span><span class="nf">values</span><span class="p">().</span><span class="nf">find</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">identifier</span> <span class="p">==</span> <span class="n">outcome</span> <span class="p">}</span> 
              <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Invalid Outcome:$outcome"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">readRounds</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Hand</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">hints</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
      <span class="nc">Hand</span><span class="p">(</span><span class="nf">toRps</span><span class="p">(</span><span class="n">hints</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nf">toRps</span><span class="p">(</span><span class="n">hints</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// choose a shape to match the outcome</span>
  <span class="k">fun</span> <span class="nf">chooseShape</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="nc">Rps</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="nc">Outcome</span><span class="p">):</span> <span class="nc">Rps</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="p">{</span>
      <span class="nc">Outcome</span><span class="p">.</span><span class="nc">DRAW</span> <span class="p">-&gt;</span> <span class="n">shape</span>
      <span class="nc">Outcome</span><span class="p">.</span><span class="nc">WIN</span> <span class="p">-&gt;</span> <span class="nc">Rules</span><span class="p">.</span><span class="nf">winner</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
      <span class="nc">Outcome</span><span class="p">.</span><span class="nc">LOSE</span> <span class="p">-&gt;</span> <span class="nc">Rules</span><span class="p">.</span><span class="nf">loser</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// convert 2nd to outcome and then find a shape to match outcome given 1st</span>
  <span class="k">fun</span> <span class="nf">readRounds2</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Hand</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">hints</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
      <span class="nc">Pair</span><span class="p">(</span><span class="nf">toRps</span><span class="p">(</span><span class="n">hints</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nf">toOutcome</span><span class="p">(</span><span class="n">hints</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="p">}.</span><span class="nf">map</span> <span class="p">{</span>
      <span class="nc">Hand</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="nf">chooseShape</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcRound</span><span class="p">(</span><span class="n">round</span><span class="p">:</span> <span class="nc">Hand</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">when</span> <span class="p">{</span>
      <span class="n">round</span><span class="p">.</span><span class="n">them</span> <span class="p">==</span> <span class="n">round</span><span class="p">.</span><span class="n">me</span> <span class="p">-&gt;</span> <span class="nc">Outcome</span><span class="p">.</span><span class="nc">DRAW</span><span class="p">.</span><span class="n">score</span>
      <span class="nc">Rules</span><span class="p">.</span><span class="nf">didIWin</span><span class="p">(</span><span class="n">round</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">Outcome</span><span class="p">.</span><span class="nc">WIN</span><span class="p">.</span><span class="n">score</span>
      <span class="k">else</span> <span class="p">-&gt;</span> <span class="nc">Outcome</span><span class="p">.</span><span class="nc">LOSE</span><span class="p">.</span><span class="n">score</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcScore</span><span class="p">(</span><span class="n">round</span><span class="p">:</span> <span class="nc">Hand</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">round</span><span class="p">.</span><span class="n">me</span><span class="p">.</span><span class="n">shapeScore</span> <span class="p">+</span> <span class="nf">calcRound</span><span class="p">(</span><span class="n">round</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcTotal</span><span class="p">(</span><span class="n">rounds</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Hand</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">rounds</span><span class="p">.</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="nf">calcScore</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">val</span> <span class="py">testScore</span> <span class="p">=</span> <span class="nf">calcTotal</span><span class="p">(</span><span class="nf">readRounds</span><span class="p">(</span><span class="nf">readInput</span><span class="p">(</span><span class="s">"day02_test"</span><span class="p">)))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Test Total = $testScore"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testScore</span> <span class="p">==</span> <span class="mi">15</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">total</span> <span class="p">=</span> <span class="nf">calcTotal</span><span class="p">(</span><span class="nf">readRounds</span><span class="p">(</span><span class="nf">readInput</span><span class="p">(</span><span class="s">"day02"</span><span class="p">)))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Total = $total"</span><span class="p">)</span>

  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">val</span> <span class="py">testScore2</span> <span class="p">=</span> <span class="nf">calcTotal</span><span class="p">(</span><span class="nf">readRounds2</span><span class="p">(</span><span class="nf">readInput</span><span class="p">(</span><span class="s">"day02_test"</span><span class="p">)))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Test Total 2 = $testScore2"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testScore2</span> <span class="p">==</span> <span class="mi">12</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">total2</span> <span class="p">=</span> <span class="nf">calcTotal</span><span class="p">(</span><span class="nf">readRounds2</span><span class="p">(</span><span class="nf">readInput</span><span class="p">(</span><span class="s">"day02"</span><span class="p">)))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Total 2 = $total2"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-3">Rucksack Reorganization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Today puzzle was about manipulating strings and calculating the values of characters according rules.</p>
</div>
<div class="sect2">
<h3 id="_calculating_the_priority">Calculating the priority</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcPriority</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">Char</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">in</span> <span class="sc">'a'</span><span class="o">..</span><span class="sc">'z'</span> <span class="p">-&gt;</span> <span class="n">value</span> <span class="p">-</span> <span class="sc">'a'</span> <span class="p">+</span> <span class="mi">1</span>
  <span class="k">in</span> <span class="sc">'A'</span><span class="o">..</span><span class="sc">'Z'</span> <span class="p">-&gt;</span> <span class="n">value</span> <span class="p">-</span> <span class="sc">'A'</span> <span class="p">+</span> <span class="mi">27</span>
  <span class="k">else</span> <span class="p">-&gt;</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Invalid input $value"</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part1">Part1</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcRucksacks</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">=</span>
  <span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span>
      <span class="nc">Pair</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">0</span> <span class="n">until</span> <span class="n">it</span><span class="p">.</span><span class="n">length</span> <span class="p">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">it</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">length</span> <span class="p">/</span> <span class="mi">2</span><span class="p">))</span> // <b class="conum">(1)</b>
    <span class="p">}</span>
    <span class="p">.</span><span class="nf">map</span> <span class="p">{</span>
      <span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="nf">toSet</span><span class="p">().</span><span class="nf">intersect</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="nf">toSet</span><span class="p">()).</span><span class="nf">first</span><span class="p">()</span> // <b class="conum">(2)</b>
    <span class="p">}</span>
    <span class="p">.</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="nf">calcPriority</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span> // <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Split string into equal parts to represent compartments</p>
</li>
<li>
<p>Determine common character by converting to set of characters and finding union</p>
</li>
<li>
<p>Calculate the sum of the priorities</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_2">Part 2</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcBadges</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">=</span>
  <span class="n">input</span><span class="p">.</span><span class="nf">mapIndexed</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">s</span> <span class="p">-&gt;</span> <span class="n">index</span> <span class="p">/</span> <span class="mi">3</span> <span class="n">to</span> <span class="n">s</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">({</span> <span class="n">it</span><span class="p">.</span><span class="n">first</span> <span class="p">},</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">second</span> <span class="p">})</span>           // <b class="conum">(1)</b>
    <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">e</span> <span class="p">-&gt;</span>
      <span class="n">e</span><span class="p">.</span><span class="n">value</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toSet</span><span class="p">()</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">reduce</span> <span class="p">{</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">-&gt;</span> <span class="n">a</span><span class="p">.</span><span class="nf">intersect</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">first</span><span class="p">()</span>                                    // <b class="conum">(2)</b>
    <span class="p">}</span>
    <span class="p">.</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="nf">calcPriority</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>                     // <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Group strings by 3.</p>
</li>
<li>
<p>Determine common character from all 3 strings.</p>
</li>
<li>
<p>Calculate the sum of the priorities</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_takeaways">Takeaways</h3>
<div class="ulist">
<ul>
<li>
<p><code>String.toSet</code> gives to a <code>Set</code> of <code>Char</code></p>
</li>
<li>
<p><code>reduce</code> is a great way to determine the intersection on multiple sets.</p>
</li>
<li>
<p><code>groupBy</code> can take two parameters and with the second parameter you can determine the type of the value.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_full_source">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">fun</span> <span class="nf">calcPriority</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">Char</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">in</span> <span class="sc">'a'</span><span class="o">..</span><span class="sc">'z'</span> <span class="p">-&gt;</span> <span class="n">value</span> <span class="p">-</span> <span class="sc">'a'</span> <span class="p">+</span> <span class="mi">1</span>
    <span class="k">in</span> <span class="sc">'A'</span><span class="o">..</span><span class="sc">'Z'</span> <span class="p">-&gt;</span> <span class="n">value</span> <span class="p">-</span> <span class="sc">'A'</span> <span class="p">+</span> <span class="mi">27</span>
    <span class="k">else</span> <span class="p">-&gt;</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Invalid input $value"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcRucksacks</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">=</span>
    <span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> 
        <span class="nc">Pair</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">0</span> <span class="n">until</span> <span class="n">it</span><span class="p">.</span><span class="n">length</span> <span class="p">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">it</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">length</span> <span class="p">/</span> <span class="mi">2</span><span class="p">))</span>
      <span class="p">}</span>
      <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="nf">toSet</span><span class="p">().</span><span class="nf">intersect</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="nf">toSet</span><span class="p">()).</span><span class="nf">first</span><span class="p">()</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="nf">calcPriority</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcBadges</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">=</span>
    <span class="n">input</span><span class="p">.</span><span class="nf">mapIndexed</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">s</span> <span class="p">-&gt;</span> <span class="n">index</span> <span class="p">/</span> <span class="mi">3</span> <span class="n">to</span> <span class="n">s</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">groupBy</span><span class="p">({</span> <span class="n">it</span><span class="p">.</span><span class="n">first</span> <span class="p">},</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">second</span> <span class="p">})</span>
      <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">e</span> <span class="p">-&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toSet</span><span class="p">()</span> <span class="p">}</span>
          <span class="p">.</span><span class="nf">reduce</span> <span class="p">{</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">-&gt;</span> <span class="n">a</span><span class="p">.</span><span class="nf">intersect</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span>
          <span class="p">.</span><span class="nf">first</span><span class="p">()</span> 
      <span class="p">}</span>
      <span class="p">.</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="nf">calcPriority</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testPriorities</span> <span class="p">=</span> <span class="nf">calcRucksacks</span><span class="p">(</span><span class="nf">readInput</span><span class="p">(</span><span class="s">"day03_test"</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Test Priorities = $testPriorities"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testPriorities</span> <span class="p">==</span> <span class="mi">157</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">priorities</span> <span class="p">=</span> <span class="nf">calcRucksacks</span><span class="p">(</span><span class="nf">readInput</span><span class="p">(</span><span class="s">"day03"</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Priorities = $priorities"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">priorities</span> <span class="p">==</span> <span class="mi">8123</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testPriorities</span> <span class="p">=</span> <span class="nf">calcBadges</span><span class="p">(</span><span class="nf">readInput</span><span class="p">(</span><span class="s">"day03_test"</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Test Priorities = $testPriorities"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testPriorities</span> <span class="p">==</span> <span class="mi">70</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">priorities</span> <span class="p">=</span> <span class="nf">calcBadges</span><span class="p">(</span><span class="nf">readInput</span><span class="p">(</span><span class="s">"day03"</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Priorities = $priorities"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">priorities</span> <span class="p">==</span> <span class="mi">2620</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-4">Camp Cleanup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I wasted some time today because I misunderstood the <strong>fully contains</strong> applying to a pair of assignments. I was trying to check across assignments. Re-reading when I got the wrong answer meant some <em>facepalms</em>.</p>
</div>
<div class="paragraph">
<p>We needed to convert the input depicting 2 ranges into sets of sections representing by numbers. So that meant converting <code>2-4,6-8</code> to a <code>Pair</code> of <code>IntRange</code> and then to a <code>Pair</code> of <code>Set&lt;Int&gt;</code> which it as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">convertRange</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">IntRange</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">values</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">"-"</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">toInt</span><span class="p">()</span><span class="o">..</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">convertRanges</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;,</span> <span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;&gt;&gt;</span> <span class="p">=</span>
  <span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="nc">Pair</span><span class="p">(</span><span class="nf">convertRange</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nf">toSet</span><span class="p">(),</span> <span class="nf">convertRange</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="nf">toSet</span><span class="p">())</span> <span class="p">}</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_part_1_2">Part 1</h3>
<div class="paragraph">
<p>Determining <strong>fully contains</strong> for part 1 was as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcContains</span><span class="p">(</span><span class="n">ranges</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;,</span> <span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;&gt;&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">ranges</span><span class="p">.</span><span class="nf">count</span> <span class="p">{</span>
    <span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="nf">containsAll</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="p">||</span> <span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="nf">containsAll</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_3">Part 2</h3>
<div class="paragraph">
<p>And determining an <strong>overlap</strong> for part1 was as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcOverlap</span><span class="p">(</span><span class="n">ranges</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;,</span> <span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;&gt;&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">ranges</span><span class="p">.</span><span class="nf">count</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="nf">intersect</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">).</span><span class="nf">isNotEmpty</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_takeaways_2">Takeaways</h3>
<div class="paragraph">
<p>Re-read the problem because a lot of effort was made to explain with a complete example.</p>
</div>
<div class="paragraph">
<p><strong>If you first answer is incorrect you may have misunderstood something.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_2">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">fun</span> <span class="nf">convertRange</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">IntRange</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">values</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">"-"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">toInt</span><span class="p">()</span><span class="o">..</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">convertRanges</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;,</span> <span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;&gt;&gt;</span> <span class="p">=</span>
    <span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="nc">Pair</span><span class="p">(</span><span class="nf">convertRange</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="nf">toSet</span><span class="p">(),</span> <span class="nf">convertRange</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="nf">toSet</span><span class="p">())</span> <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcContains</span><span class="p">(</span><span class="n">ranges</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;,</span> <span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;&gt;&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">ranges</span><span class="p">.</span><span class="nf">count</span> <span class="p">{</span>
      <span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="nf">containsAll</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="p">||</span> <span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="nf">containsAll</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcOverlap</span><span class="p">(</span><span class="n">ranges</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;,</span> <span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;&gt;&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">ranges</span><span class="p">.</span><span class="nf">count</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="nf">intersect</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">second</span><span class="p">).</span><span class="nf">isNotEmpty</span><span class="p">()</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testInput</span> <span class="p">=</span> <span class="nf">readInput</span><span class="p">(</span><span class="s">"day04_test"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">testCount</span> <span class="p">=</span> <span class="nf">calcContains</span><span class="p">(</span><span class="nf">convertRanges</span><span class="p">(</span><span class="n">testInput</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Test Count = $testCount"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testCount</span> <span class="p">==</span> <span class="mi">2</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readInput</span><span class="p">(</span><span class="s">"day04"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">count</span> <span class="p">=</span> <span class="nf">calcContains</span><span class="p">(</span><span class="nf">convertRanges</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Count = $count"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">count</span> <span class="p">==</span> <span class="mi">524</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testInput</span> <span class="p">=</span> <span class="nf">readInput</span><span class="p">(</span><span class="s">"day04_test"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">testCount</span> <span class="p">=</span> <span class="nf">calcOverlap</span><span class="p">(</span><span class="nf">convertRanges</span><span class="p">(</span><span class="n">testInput</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Test Count = $testCount"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testCount</span> <span class="p">==</span> <span class="mi">4</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readInput</span><span class="p">(</span><span class="s">"day04"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">count</span> <span class="p">=</span> <span class="nf">calcOverlap</span><span class="p">(</span><span class="nf">convertRanges</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Count = $count"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">count</span> <span class="p">==</span> <span class="mi">798</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-5">Supply Stacks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Today we had to implement a parser to read the state of stacks of containers and instructions for moving the containers. The result was a list of the top container labels.
I decided to create a data structure for the instructions and a simple Stack.</p>
</div>
<div class="sect2">
<h3 id="_data_structures">Data Structures</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">data class</span> <span class="nc">Instruction</span><span class="p">(</span><span class="kd">val</span> <span class="py">count</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">from</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">to</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>

<span class="kd">class</span> <span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">elements</span><span class="p">:</span> <span class="nc">MutableList</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;())</span> <span class="p">{</span>
  <span class="k">fun</span> <span class="nf">empty</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">elements</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">()</span>
  <span class="k">fun</span> <span class="nf">peek</span><span class="p">():</span> <span class="nc">T</span> <span class="p">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">elements</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">]</span>
  <span class="k">fun</span> <span class="nf">pop</span><span class="p">():</span> <span class="nc">T</span> <span class="p">=</span> <span class="n">elements</span><span class="p">.</span><span class="nf">removeAt</span><span class="p">(</span><span class="n">elements</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">push</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">elements</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">items</span><span class="p">()</span> <span class="p">=</span> <span class="n">elements</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
  <span class="k">fun</span> <span class="nf">size</span><span class="p">()</span> <span class="p">=</span> <span class="n">elements</span><span class="p">.</span><span class="n">size</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsing_2">Parsing</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">readStack</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">stack</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;()</span>
  <span class="kd">val</span> <span class="py">offset</span> <span class="p">=</span> <span class="n">stack</span> <span class="p">*</span> <span class="mi">4</span> <span class="p">+</span> <span class="mi">1</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">line</span> <span class="k">in</span> <span class="n">lines</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">length</span> <span class="p">&gt;</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">crate</span> <span class="p">=</span> <span class="n">line</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">crate</span> <span class="k">in</span> <span class="sc">'A'</span><span class="o">..</span><span class="sc">'Z'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">result</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">crate</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">result</span><span class="p">.</span><span class="nf">reverse</span><span class="p">()</span>
  <span class="nf">println</span><span class="p">(</span><span class="s">"Stack[${stack + 1}]=${result.joinToString("")}"</span><span class="p">)</span>
  <span class="k">return</span> <span class="nc">Stack</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">loadStacks</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">lines</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">toMutableList</span><span class="p">()</span>
  <span class="kd">val</span> <span class="py">numbers</span> <span class="p">=</span> <span class="n">lines</span><span class="p">.</span><span class="nf">last</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">isNotEmpty</span><span class="p">()</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toInt</span><span class="p">()</span> <span class="p">}</span>
  <span class="n">lines</span><span class="p">.</span><span class="nf">removeAt</span><span class="p">(</span><span class="n">lines</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">stacks</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;()</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">stack</span> <span class="k">in</span> <span class="n">numbers</span><span class="p">.</span><span class="n">indices</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">stacks</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nf">readStack</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">stack</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">stacks</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">loadInstructions</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Instruction</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">regex</span> <span class="p">=</span> <span class="s">"""move (\d+) from (\d+) to (\d+)"""</span><span class="p">.</span><span class="nf">toRegex</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">input</span><span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">line</span> <span class="p">-&gt;</span>
    <span class="n">regex</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="p">(</span><span class="py">count</span><span class="p">,</span> <span class="py">from</span><span class="p">,</span> <span class="py">to</span><span class="p">)</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">destructured</span>
      <span class="nc">Instruction</span><span class="p">(</span><span class="n">count</span><span class="p">.</span><span class="nf">toInt</span><span class="p">(),</span> <span class="n">from</span><span class="p">.</span><span class="nf">toInt</span><span class="p">(),</span> <span class="n">to</span><span class="p">.</span><span class="nf">toInt</span><span class="p">())</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_1_3">Part 1</h3>
<div class="paragraph">
<p>Perform all the instructions and provide the list of top level crates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">perform</span><span class="p">(</span><span class="n">stacks</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;,</span> <span class="n">instruction</span><span class="p">:</span> <span class="nc">Instruction</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">instruction</span><span class="p">.</span><span class="n">count</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">crate</span> <span class="p">=</span> <span class="n">stacks</span><span class="p">[</span><span class="n">instruction</span><span class="p">.</span><span class="n">from</span> <span class="p">-</span> <span class="mi">1</span><span class="p">].</span><span class="nf">pop</span><span class="p">()</span>
    <span class="n">stacks</span><span class="p">[</span><span class="n">instruction</span><span class="p">.</span><span class="n">to</span> <span class="p">-</span> <span class="mi">1</span><span class="p">].</span><span class="nf">push</span><span class="p">(</span><span class="n">crate</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">fun</span> <span class="nf">performAndFindTops</span><span class="p">(</span>
  <span class="n">stacks</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;,</span>
  <span class="n">instructions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Instruction</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">String</span> <span class="p">{</span>
  <span class="n">instructions</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span>
    <span class="nf">perform</span><span class="p">(</span><span class="n">stacks</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">stacks</span><span class="p">.</span><span class="nf">joinToString</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">peek</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_4">Part 2</h3>
<div class="paragraph">
<p>The crane can now move multiple containers at the same time retaining their order.
I decided to use a local stack to pop all the container and then push them again which will retain the order. The alternative would have been to adjust the Stack to remove multiple items at once.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">perform9001</span><span class="p">(</span><span class="n">stacks</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;,</span> <span class="n">instruction</span><span class="p">:</span> <span class="nc">Instruction</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">println</span><span class="p">(</span><span class="n">instruction</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">tmp</span> <span class="p">=</span> <span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;()</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">instruction</span><span class="p">.</span><span class="n">count</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">crate</span> <span class="p">=</span> <span class="n">stacks</span><span class="p">[</span><span class="n">instruction</span><span class="p">.</span><span class="n">from</span> <span class="p">-</span> <span class="mi">1</span><span class="p">].</span><span class="nf">pop</span><span class="p">()</span>
    <span class="n">tmp</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">crate</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">while</span> <span class="p">(!</span><span class="n">tmp</span><span class="p">.</span><span class="nf">empty</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">stacks</span><span class="p">[</span><span class="n">instruction</span><span class="p">.</span><span class="n">to</span> <span class="p">-</span> <span class="mi">1</span><span class="p">].</span><span class="nf">push</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="nf">pop</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">fun</span> <span class="nf">performAndFindTops9001</span><span class="p">(</span>
    <span class="n">stacks</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;,</span>
    <span class="n">instructions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Instruction</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">String</span> <span class="p">{</span>
  <span class="n">instructions</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span>
    <span class="nf">perform9001</span><span class="p">(</span><span class="n">stacks</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">stacks</span><span class="p">.</span><span class="nf">joinToString</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">peek</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span> <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_takeaways_3">Takeaways</h3>
<div class="paragraph">
<p>Sometimes a requirement change can impact your data structures in huge ways. Using a stack to represent the piles of crates was fine until we needed to move multiple crates at a time. In a real system the performance differences of moving multiple crates at the same time will be huge if it is a core part of the system.</p>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_3">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">data class</span> <span class="nc">Instruction</span><span class="p">(</span><span class="kd">val</span> <span class="py">count</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">from</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">to</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">elements</span><span class="p">:</span> <span class="nc">MutableList</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;())</span> <span class="p">{</span>
  <span class="k">fun</span> <span class="nf">empty</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">elements</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">()</span>
  <span class="k">fun</span> <span class="nf">peek</span><span class="p">():</span> <span class="nc">T</span> <span class="p">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">elements</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">]</span>
  <span class="k">fun</span> <span class="nf">pop</span><span class="p">():</span> <span class="nc">T</span> <span class="p">=</span> <span class="n">elements</span><span class="p">.</span><span class="nf">removeAt</span><span class="p">(</span><span class="n">elements</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">push</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">elements</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">items</span><span class="p">()</span> <span class="p">=</span> <span class="n">elements</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
  <span class="k">fun</span> <span class="nf">size</span><span class="p">()</span> <span class="p">=</span> <span class="n">elements</span><span class="p">.</span><span class="n">size</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">fun</span> <span class="nf">readStack</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">stack</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;()</span>
    <span class="kd">val</span> <span class="py">offset</span> <span class="p">=</span> <span class="n">stack</span> <span class="p">*</span> <span class="mi">4</span> <span class="p">+</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">line</span> <span class="k">in</span> <span class="n">lines</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">length</span> <span class="p">&gt;</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">crate</span> <span class="p">=</span> <span class="n">line</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">crate</span> <span class="k">in</span> <span class="sc">'A'</span><span class="o">..</span><span class="sc">'Z'</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">result</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">crate</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">reverse</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Stack[${stack + 1}]=${result.joinToString("")}"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nc">Stack</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">loadStacks</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">lines</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">toMutableList</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">numbers</span> <span class="p">=</span> <span class="n">lines</span><span class="p">.</span><span class="nf">last</span><span class="p">().</span><span class="nf">split</span><span class="p">(</span><span class="s">" "</span><span class="p">).</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="k">if</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">isNotBlank</span><span class="p">())</span> <span class="n">it</span><span class="p">.</span><span class="nf">toInt</span><span class="p">()</span> <span class="k">else</span> <span class="k">null</span> <span class="p">}</span>
    <span class="n">lines</span><span class="p">.</span><span class="nf">removeAt</span><span class="p">(</span><span class="n">lines</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">stacks</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">stack</span> <span class="k">in</span> <span class="n">numbers</span><span class="p">.</span><span class="n">indices</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">stacks</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nf">readStack</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">stack</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">stacks</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">loadInstructions</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Instruction</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">regex</span> <span class="p">=</span> <span class="s">"""move (\d+) from (\d+) to (\d+)"""</span><span class="p">.</span><span class="nf">toRegex</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">input</span><span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">line</span> <span class="p">-&gt;</span>
      <span class="n">regex</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="p">(</span><span class="py">count</span><span class="p">,</span> <span class="py">from</span><span class="p">,</span> <span class="py">to</span><span class="p">)</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">destructured</span>
        <span class="nc">Instruction</span><span class="p">(</span><span class="n">count</span><span class="p">.</span><span class="nf">toInt</span><span class="p">(),</span> <span class="n">from</span><span class="p">.</span><span class="nf">toInt</span><span class="p">(),</span> <span class="n">to</span><span class="p">.</span><span class="nf">toInt</span><span class="p">())</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">perform</span><span class="p">(</span><span class="n">stacks</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;,</span> <span class="n">instruction</span><span class="p">:</span> <span class="nc">Instruction</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">instruction</span><span class="p">.</span><span class="n">count</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">crate</span> <span class="p">=</span> <span class="n">stacks</span><span class="p">[</span><span class="n">instruction</span><span class="p">.</span><span class="n">from</span> <span class="p">-</span> <span class="mi">1</span><span class="p">].</span><span class="nf">pop</span><span class="p">()</span>
      <span class="n">stacks</span><span class="p">[</span><span class="n">instruction</span><span class="p">.</span><span class="n">to</span> <span class="p">-</span> <span class="mi">1</span><span class="p">].</span><span class="nf">push</span><span class="p">(</span><span class="n">crate</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">perform9001</span><span class="p">(</span><span class="n">stacks</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;,</span> <span class="n">instruction</span><span class="p">:</span> <span class="nc">Instruction</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">tmp</span> <span class="p">=</span> <span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">instruction</span><span class="p">.</span><span class="n">count</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">crate</span> <span class="p">=</span> <span class="n">stacks</span><span class="p">[</span><span class="n">instruction</span><span class="p">.</span><span class="n">from</span> <span class="p">-</span> <span class="mi">1</span><span class="p">].</span><span class="nf">pop</span><span class="p">()</span>
      <span class="n">tmp</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">crate</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(!</span><span class="n">tmp</span><span class="p">.</span><span class="nf">empty</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">stacks</span><span class="p">[</span><span class="n">instruction</span><span class="p">.</span><span class="n">to</span> <span class="p">-</span> <span class="mi">1</span><span class="p">].</span><span class="nf">push</span><span class="p">(</span><span class="n">tmp</span><span class="p">.</span><span class="nf">pop</span><span class="p">())</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">performAndFindTops</span><span class="p">(</span><span class="n">stacks</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;,</span> <span class="n">instructions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Instruction</span><span class="p">&gt;):</span> <span class="nc">String</span> <span class="p">{</span>
    <span class="n">instructions</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span>
      <span class="nf">perform</span><span class="p">(</span><span class="n">stacks</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">stacks</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">stack</span> <span class="p">-&gt;</span> <span class="nf">println</span><span class="p">(</span><span class="s">"[${stack.items().joinToString("")}]"</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">stacks</span><span class="p">.</span><span class="nf">joinToString</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">peek</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">performAndFindTops9001</span><span class="p">(</span><span class="n">stacks</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;&gt;,</span> <span class="n">instructions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Instruction</span><span class="p">&gt;):</span> <span class="nc">String</span> <span class="p">{</span>
    <span class="n">instructions</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span>
      <span class="nf">perform9001</span><span class="p">(</span><span class="n">stacks</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">stacks</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">stack</span> <span class="p">-&gt;</span> <span class="nf">println</span><span class="p">(</span><span class="s">"[${stack.items().joinToString("")}]"</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">stacks</span><span class="p">.</span><span class="nf">joinToString</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">peek</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">val</span> <span class="py">test</span> <span class="p">=</span> <span class="s">"""    [D]
[N] [C]
[Z] [M] [P]
 1   2   3

move 1 from 2 to 1
move 3 from 1 to 3
move 2 from 2 to 1
move 1 from 1 to 2
"""</span>

  <span class="kd">val</span> <span class="py">testInputs</span> <span class="p">=</span> <span class="n">test</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">"\n\n"</span><span class="p">).</span><span class="nf">map</span> <span class="p">{</span> <span class="nf">readText</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
  <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readFileGroup</span><span class="p">(</span><span class="s">"day05"</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testTops</span> <span class="p">=</span> <span class="nf">performAndFindTops</span><span class="p">(</span><span class="nf">loadStacks</span><span class="p">(</span><span class="n">testInputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nf">loadInstructions</span><span class="p">(</span><span class="n">testInputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Test Tops = $testTops"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testTops</span> <span class="p">==</span> <span class="s">"CMZ"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">tops</span> <span class="p">=</span> <span class="nf">performAndFindTops</span><span class="p">(</span><span class="nf">loadStacks</span><span class="p">(</span><span class="n">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nf">loadInstructions</span><span class="p">(</span><span class="n">input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Tops = $tops"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">tops</span> <span class="p">==</span> <span class="s">"PTWLTDSJV"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testTops</span> <span class="p">=</span> <span class="nf">performAndFindTops9001</span><span class="p">(</span><span class="nf">loadStacks</span><span class="p">(</span><span class="n">testInputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nf">loadInstructions</span><span class="p">(</span><span class="n">testInputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Test Tops = $testTops"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testTops</span> <span class="p">==</span> <span class="s">"MCD"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">tops</span> <span class="p">=</span> <span class="nf">performAndFindTops9001</span><span class="p">(</span><span class="nf">loadStacks</span><span class="p">(</span><span class="n">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nf">loadInstructions</span><span class="p">(</span><span class="n">input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Tops = $tops"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">tops</span> <span class="p">==</span> <span class="s">"WZMFVGGZP"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>

<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-6">Tuning Trouble</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Today was probably the easiest one so far from my perspective. We had to write a simple parser to find the first unique sequence of characters with a given length and report the number of characters read.</p>
</div>
<div class="paragraph">
<p>The Kotlin collections method <code>windowed</code> provides a way to create a window over an <code>Iterable</code> and provides a simple way to solve this. Checking that the content of the window as a unique set is the same size as the window.</p>
</div>
<div class="sect2">
<h3 id="_solution">Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">findUniquePacketEnd</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">packetSize</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">input</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">windowed</span><span class="p">(</span><span class="n">packetSize</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">indexOfFirst</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toSet</span><span class="p">().</span><span class="n">size</span> <span class="p">==</span> <span class="n">packetSize</span> <span class="p">}</span> <span class="p">+</span> <span class="n">packetSize</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_4">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">fun</span> <span class="nf">findUniquePacketEnd</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">packetSize</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">input</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
      <span class="p">.</span><span class="nf">windowed</span><span class="p">(</span><span class="n">packetSize</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">indexOfFirst</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toSet</span><span class="p">().</span><span class="n">size</span> <span class="p">==</span> <span class="n">packetSize</span> <span class="p">}</span> <span class="p">+</span> <span class="n">packetSize</span>
  <span class="p">}</span>

  <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readFileToString</span><span class="p">(</span><span class="s">"day06"</span><span class="p">)</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testStart</span> <span class="p">=</span> <span class="nf">findUniquePacketEnd</span><span class="p">(</span><span class="s">"nznrnfrfntjfmvfwmzdfjlvtqnbhcprsg"</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part1 Test Start = $testStart"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testStart</span> <span class="p">==</span> <span class="mi">10</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">start</span> <span class="p">=</span> <span class="nf">findUniquePacketEnd</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part1 Start = $start"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">start</span> <span class="p">==</span> <span class="mi">1965</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testStart</span> <span class="p">=</span> <span class="nf">findUniquePacketEnd</span><span class="p">(</span><span class="s">"nznrnfrfntjfmvfwmzdfjlvtqnbhcprsg"</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Test Message = $testStart"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testStart</span> <span class="p">==</span> <span class="mi">29</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">start</span> <span class="p">=</span> <span class="nf">findUniquePacketEnd</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Start = $start"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">start</span> <span class="p">==</span> <span class="mi">2773</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-7">No Space Left On Device</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We had to parse a series of commands and output representing changing to and listing directories as in the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nv">$ </span><span class="nb">cd</span> /
<span class="nv">$ </span><span class="nb">ls
dir </span>a
14848514 b.txt
8504156 c.dat
<span class="nb">dir </span>d
<span class="nv">$ </span><span class="nb">cd </span>a
<span class="nv">$ </span><span class="nb">ls
dir </span>e
29116 f
2557 g
62596 h.lst
<span class="nv">$ </span><span class="nb">cd </span>e
<span class="nv">$ </span><span class="nb">ls
</span>584 i
<span class="nv">$ </span><span class="nb">cd</span> ..
<span class="nv">$ </span><span class="nb">cd</span> ..
<span class="nv">$ </span><span class="nb">cd </span>d
<span class="nv">$ </span><span class="nb">ls
</span>4060174 j
8033020 d.log
5626152 d.ext
7214296 k</code></pre>
</div>
</div>
<div class="paragraph">
<p>The aim was to determine directory sizes.
In the first case the challenge was to find directories with a total size including children of below a threshold and the second problem was to find the smallest directory above a certain size.</p>
</div>
<div class="sect2">
<h3 id="_data_model">Data Model</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin">  <span class="kd">data class</span> <span class="nc">FileInfo</span><span class="p">(</span><span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">size</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>

  <span class="kd">class</span> <span class="nc">Directory</span><span class="p">(</span><span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">files</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">FileInfo</span><span class="p">&gt;()</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">directories</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Directory</span><span class="p">&gt;()</span>
    <span class="k">fun</span> <span class="nf">listDirectories</span><span class="p">()</span> <span class="p">=</span> <span class="n">directories</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
    <span class="k">fun</span> <span class="nf">hasDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">directories</span><span class="p">.</span><span class="nf">containsKey</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">getDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">=</span> <span class="n">directories</span><span class="p">[</span><span class="n">dirname</span><span class="p">]</span>
    <span class="k">fun</span> <span class="nf">addDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Directory</span> <span class="p">=</span> <span class="n">directories</span><span class="p">.</span><span class="nf">getOrPut</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Directory</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">addFile</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">FileInfo</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">file</span> <span class="p">=</span> <span class="nc">FileInfo</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
      <span class="n">files</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="p">=</span> <span class="n">file</span>
      <span class="k">return</span> <span class="n">file</span>
    <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">listFiles</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">FileInfo</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">files</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
    <span class="k">fun</span> <span class="nf">fileSizes</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">=</span> <span class="n">files</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">size</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">totalSize</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">=</span> <span class="nf">fileSizes</span><span class="p">()</span> <span class="p">+</span> <span class="n">directories</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">totalSize</span><span class="p">()</span> <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s">"Directory(name='$name',"</span> <span class="p">+</span>
                <span class="s">"directories=${directories.values.map { it.name }.toList()},"</span> <span class="p">+</span>
                <span class="s">"files=${files.values.map { "</span><span class="err">$</span><span class="p">{</span><span class="n">it</span><span class="p">.</span><span class="n">name</span><span class="p">}:</span><span class="err">$</span><span class="p">{</span><span class="n">it</span><span class="p">.</span><span class="n">size</span><span class="p">}</span><span class="s">" }}"</span> <span class="p">+</span>
              <span class="s">")"</span>
    <span class="p">}</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">equals</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nc">Any</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="p">===</span> <span class="n">other</span><span class="p">)</span> <span class="k">return</span> <span class="k">true</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">javaClass</span> <span class="p">!=</span> <span class="n">other</span><span class="o">?.</span><span class="n">javaClass</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>

      <span class="n">other</span> <span class="k">as</span> <span class="nc">Directory</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="p">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>

      <span class="k">return</span> <span class="k">true</span>
    <span class="p">}</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hashCode</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">name</span><span class="p">.</span><span class="nf">hashCode</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsing_3">Parsing</h3>
<div class="paragraph">
<p>The parsing meant keeping track of the directory tree and the current directory.
I used the <code>Stack</code> from Day 05 to maintain the parent directories.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">parseCommandsAndOutput</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Directory</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">root</span> <span class="p">=</span> <span class="nc">Directory</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">dirs</span> <span class="p">=</span> <span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Directory</span><span class="p">&gt;()</span>
  <span class="n">dirs</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="kd">var</span> <span class="py">current</span> <span class="p">=</span> <span class="n">root</span>
  <span class="k">for</span><span class="p">(</span><span class="n">line</span> <span class="k">in</span> <span class="n">lines</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">data</span> <span class="p">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
    <span class="k">when</span> <span class="p">{</span>
      <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"$"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">==</span> <span class="s">"cd"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">==</span> <span class="s">"/"</span> <span class="p">-&gt;</span> <span class="p">{</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">clear</span><span class="p">();</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="p">}</span>
      <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"$"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">==</span> <span class="s">"cd"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">==</span> <span class="s">".."</span> <span class="p">-&gt;</span> <span class="p">{</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">pop</span><span class="p">();</span> <span class="n">current</span> <span class="p">=</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">peek</span><span class="p">()}</span>
      <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"$"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">==</span> <span class="s">"cd"</span> <span class="p">-&gt;</span> <span class="p">{</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">current</span><span class="p">.</span><span class="nf">addDir</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span> <span class="n">current</span> <span class="p">=</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">peek</span><span class="p">()</span> <span class="p">}</span>
      <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"$"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">==</span> <span class="s">"ls"</span> <span class="p">-&gt;</span> <span class="nf">println</span><span class="p">(</span><span class="s">"listing ${dirs.items().joinToString("</span><span class="p">/</span><span class="s">") { it.name }}"</span><span class="p">)</span>
      <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"dir"</span> <span class="p">-&gt;</span> <span class="n">current</span><span class="p">.</span><span class="nf">addDir</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">file</span> <span class="p">=</span> <span class="n">current</span><span class="p">.</span><span class="nf">addFile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">toInt</span><span class="p">())</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"file=dir:${current.name} + ${file.name}:${file.size}"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">root</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solutions">Solutions</h3>
<div class="paragraph">
<p>Both solutions need to obtain a list of all directories.</p>
</div>
<div class="sect3">
<h4 id="_shared">Shared</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">listAllDirectories</span><span class="p">(</span><span class="n">directories</span><span class="p">:</span> <span class="nc">Directory</span><span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Directory</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Directory</span><span class="p">&gt;()</span>
  <span class="n">directories</span><span class="p">.</span><span class="nf">listDirectories</span><span class="p">().</span><span class="nf">forEach</span> <span class="p">{</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
    <span class="n">result</span><span class="p">.</span><span class="nf">addAll</span><span class="p">(</span><span class="nf">listAllDirectories</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_part_1_4">Part 1</h4>
<div class="paragraph">
<p>Find the directory sizes at most 100000 and calculate the total.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcDirectoriesBelow</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">maxValue</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">root</span> <span class="p">=</span> <span class="nf">parseCommandsAndOutput</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">directories</span> <span class="p">=</span> <span class="nf">listAllDirectories</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">directories</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">totalSize</span><span class="p">()</span> <span class="p">}.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span> <span class="p">&lt;=</span> <span class="n">maxValue</span> <span class="p">}.</span><span class="nf">sum</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_part_2_5">Part 2</h4>
<div class="paragraph">
<p>Find the small of the directories large enough to delete in order to free up enough space so that at least 30000000 of 70000000 is unused.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcDirectoriesToFree</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">diskSize</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">freeSpace</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">root</span> <span class="p">=</span> <span class="nf">parseCommandsAndOutput</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">directories</span> <span class="p">=</span> <span class="nf">listAllDirectories</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">unused</span> <span class="p">=</span> <span class="n">diskSize</span> <span class="p">-</span> <span class="n">root</span><span class="p">.</span><span class="nf">totalSize</span><span class="p">()</span>
  <span class="kd">val</span> <span class="py">requiredDelete</span> <span class="p">=</span> <span class="n">freeSpace</span> <span class="p">-</span> <span class="n">unused</span>
  <span class="k">return</span> <span class="n">directories</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">totalSize</span><span class="p">()</span> <span class="p">}.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span> <span class="p">&gt;</span> <span class="n">requiredDelete</span> <span class="p">}.</span><span class="nf">min</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_5">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">test</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day07_test"</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day07"</span><span class="p">)</span>

  <span class="kd">data class</span> <span class="nc">FileInfo</span><span class="p">(</span><span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">size</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>
  <span class="kd">class</span> <span class="nc">Directory</span><span class="p">(</span><span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">files</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">FileInfo</span><span class="p">&gt;()</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">directories</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Directory</span><span class="p">&gt;()</span>
    <span class="k">fun</span> <span class="nf">listDirectories</span><span class="p">()</span> <span class="p">=</span> <span class="n">directories</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>

    <span class="k">fun</span> <span class="nf">hasDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> 
            <span class="n">directories</span><span class="p">.</span><span class="nf">containsKey</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">getDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">=</span> <span class="n">directories</span><span class="p">[</span><span class="n">dirname</span><span class="p">]</span>
    <span class="k">fun</span> <span class="nf">addDir</span><span class="p">(</span><span class="n">dirname</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Directory</span> <span class="p">=</span> 
            <span class="n">directories</span><span class="p">.</span><span class="nf">getOrPut</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Directory</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">addFile</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">FileInfo</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">file</span> <span class="p">=</span> <span class="nc">FileInfo</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
      <span class="n">files</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="p">=</span> <span class="n">file</span>
      <span class="k">return</span> <span class="n">file</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">listFiles</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">FileInfo</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">files</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
    <span class="k">fun</span> <span class="nf">fileSizes</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">=</span> <span class="n">files</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">size</span> <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">totalSize</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">=</span> 
            <span class="nf">fileSizes</span><span class="p">()</span> <span class="p">+</span> <span class="n">directories</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">totalSize</span><span class="p">()</span> <span class="p">}</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s">"Directory(name='$name',directories=${
</span>        <span class="n">directories</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">name</span> <span class="p">}.</span><span class="nf">toList</span><span class="p">()</span>
      <span class="p">},</span><span class="n">files</span><span class="p">=</span><span class="err">$</span><span class="p">{</span><span class="n">files</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="s">"${it.name}:${it.size}"</span> <span class="p">}})</span><span class="s">"
</span>    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">equals</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nc">Any</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="p">===</span> <span class="n">other</span><span class="p">)</span> <span class="k">return</span> <span class="k">true</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">javaClass</span> <span class="p">!=</span> <span class="n">other</span><span class="o">?.</span><span class="n">javaClass</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>

      <span class="n">other</span> <span class="k">as</span> <span class="nc">Directory</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="p">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>

      <span class="k">return</span> <span class="k">true</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hashCode</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">name</span><span class="p">.</span><span class="nf">hashCode</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">printTree</span><span class="p">(</span><span class="n">dir</span><span class="p">:</span> <span class="nc">Directory</span><span class="p">,</span> <span class="n">depth</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">println</span><span class="p">(</span><span class="s">"- ${dir.name} (dir)"</span><span class="p">)</span>
      <span class="kd">val</span> <span class="py">prefix</span> <span class="p">=</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">depth</span>
      <span class="n">dir</span><span class="p">.</span><span class="nf">listDirectories</span><span class="p">().</span><span class="nf">forEach</span> <span class="p">{</span>
        <span class="n">prefix</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">_</span> <span class="p">-&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="sc">' '</span><span class="p">)</span> <span class="p">}</span>
        <span class="nf">printTree</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">depth</span> <span class="p">+</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="n">dir</span><span class="p">.</span><span class="nf">listFiles</span><span class="p">().</span><span class="nf">forEach</span> <span class="p">{</span>
        <span class="n">prefix</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">_</span> <span class="p">-&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="sc">' '</span><span class="p">)</span> <span class="p">}</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"- ${it.name} (file, size = ${it.size})"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">printTree</span><span class="p">()</span> <span class="p">=</span> <span class="nf">printTree</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">listAllDirectories</span><span class="p">(</span><span class="n">directories</span><span class="p">:</span> <span class="nc">Directory</span><span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Directory</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Directory</span><span class="p">&gt;()</span>
    <span class="n">directories</span><span class="p">.</span><span class="nf">listDirectories</span><span class="p">().</span><span class="nf">forEach</span> <span class="p">{</span>
      <span class="n">result</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
      <span class="n">result</span><span class="p">.</span><span class="nf">addAll</span><span class="p">(</span><span class="nf">listAllDirectories</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">parseCommandsAndOutput</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Directory</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">root</span> <span class="p">=</span> <span class="nc">Directory</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">dirs</span> <span class="p">=</span> <span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">Directory</span><span class="p">&gt;()</span>
    <span class="n">dirs</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="kd">var</span> <span class="py">current</span> <span class="p">=</span> <span class="n">root</span>
    <span class="n">input</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">line</span> <span class="p">-&gt;</span>
      <span class="kd">val</span> <span class="py">data</span> <span class="p">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
      <span class="k">when</span> <span class="p">{</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"$"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">==</span> <span class="s">"cd"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">==</span> <span class="s">"/"</span> <span class="p">-&gt;</span> <span class="p">{</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">clear</span><span class="p">();</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"$"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">==</span> <span class="s">"cd"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">==</span> <span class="s">".."</span> <span class="p">-&gt;</span> <span class="p">{</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">pop</span><span class="p">();</span> <span class="n">current</span> <span class="p">=</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">peek</span><span class="p">()}</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"$"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">==</span> <span class="s">"cd"</span> <span class="p">-&gt;</span> <span class="p">{</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">current</span><span class="p">.</span><span class="nf">addDir</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span> <span class="n">current</span> <span class="p">=</span> <span class="n">dirs</span><span class="p">.</span><span class="nf">peek</span><span class="p">()</span> <span class="p">}</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"$"</span> <span class="p">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">==</span> <span class="s">"ls"</span> <span class="p">-&gt;</span> <span class="nf">println</span><span class="p">(</span><span class="s">"listing ${dirs.items().joinToString("</span><span class="p">/</span><span class="s">") { it.name }}"</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"dir"</span> <span class="p">-&gt;</span> <span class="n">current</span><span class="p">.</span><span class="nf">addDir</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
          <span class="kd">val</span> <span class="py">file</span> <span class="p">=</span> <span class="n">current</span><span class="p">.</span><span class="nf">addFile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">toInt</span><span class="p">())</span>
          <span class="nf">println</span><span class="p">(</span><span class="s">"file=dir:${current.name} + ${file.name}:${file.size}"</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">root</span>
  <span class="p">}</span>


  <span class="k">fun</span> <span class="nf">calcDirectoriesBelow</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">maxValue</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">root</span> <span class="p">=</span> <span class="nf">parseCommandsAndOutput</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="n">root</span><span class="p">.</span><span class="nf">printTree</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">directories</span> <span class="p">=</span> <span class="nf">listAllDirectories</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">directories</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">totalSize</span><span class="p">()</span> <span class="p">}.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span> <span class="p">&lt;=</span> <span class="n">maxValue</span> <span class="p">}.</span><span class="nf">sum</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcDirectoriesToFree</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">diskSize</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">freeSpace</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">root</span> <span class="p">=</span> <span class="nf">parseCommandsAndOutput</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">directories</span> <span class="p">=</span> <span class="nf">listAllDirectories</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">unused</span> <span class="p">=</span> <span class="n">diskSize</span> <span class="p">-</span> <span class="n">root</span><span class="p">.</span><span class="nf">totalSize</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">requiredDelete</span> <span class="p">=</span> <span class="n">freeSpace</span> <span class="p">-</span> <span class="n">unused</span>
    <span class="k">return</span> <span class="n">directories</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">totalSize</span><span class="p">()</span> <span class="p">}.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span> <span class="p">&gt;</span> <span class="n">requiredDelete</span> <span class="p">}.</span><span class="nf">min</span><span class="p">()</span>
  <span class="p">}</span>


  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcDirectoriesBelow</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">95437</span><span class="p">)</span>
    <span class="nf">separator</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcDirectoriesBelow</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">1792222</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $result"</span><span class="p">)</span>
    <span class="nf">separator</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcDirectoriesToFree</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">70000000</span><span class="p">,</span> <span class="mi">30000000</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">24933642</span><span class="p">)</span>
    <span class="nf">separator</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcDirectoriesToFree</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="mi">70000000</span><span class="p">,</span> <span class="mi">30000000</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">1112963</span><span class="p">)</span>
    <span class="nf">separator</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="nf">println</span><span class="p">(</span><span class="s">"Day - 07"</span><span class="p">)</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-8">Treetop Tree House</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Today&#8217;s puzzle was all about creating a grid and determining the state of coordinates given certain conditions.</p>
</div>
<div class="sect2">
<h3 id="_model">Model</h3>
<div class="paragraph">
<p>I decided to create a class to represent the grid as an array of int array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">class</span> <span class="nc">Grid</span><span class="p">(</span><span class="kd">val</span> <span class="py">lines</span><span class="p">:</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">IntArray</span><span class="p">&gt;)</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">width</span><span class="p">()</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span>
    <span class="k">fun</span> <span class="nf">height</span><span class="p">()</span> <span class="p">=</span> <span class="n">lines</span><span class="p">.</span><span class="n">size</span>
    <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsing_4">Parsing</h3>
<div class="paragraph">
<p>The data was presents as lines of digits, each digits represented a tree and the value was the height of the tree.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">30373
25512
65332
33549
35390</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parsing meant converting each line to an array of int by converting each character to it&#8217;s integer representation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">parseGrid</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Grid</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nc">Grid</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">line</span> <span class="p">-&gt;</span>
            <span class="n">line</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
              <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">-</span> <span class="sc">'0'</span> <span class="p">}</span>
              <span class="p">.</span><span class="nf">toIntArray</span><span class="p">()</span>
          <span class="p">}.</span><span class="nf">toTypedArray</span><span class="p">())</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_1_5">Part 1</h3>
<div class="paragraph">
<p>We had to determine how many trees are visible considering it is invisible it there is a tree of similar or greater height above or below, to the left or right.</p>
</div>
<div class="paragraph">
<p>I added a visible method to Grid</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">visible</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">treeHeight</span> <span class="p">=</span> <span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="kd">var</span> <span class="py">bottom</span> <span class="p">=</span> <span class="k">true</span>
  <span class="kd">var</span> <span class="py">top</span> <span class="p">=</span> <span class="k">true</span>
  <span class="kd">var</span> <span class="py">left</span> <span class="p">=</span> <span class="k">true</span>
  <span class="kd">var</span> <span class="py">right</span> <span class="p">=</span> <span class="k">true</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">tree</span> <span class="p">=</span> <span class="k">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tree</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">top</span> <span class="p">=</span> <span class="k">false</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">x</span> <span class="p">+</span> <span class="mi">1</span> <span class="n">until</span> <span class="nf">height</span><span class="p">())</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">bottom</span> <span class="p">=</span> <span class="k">false</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">}</span>
 <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">y</span> <span class="p">+</span> <span class="mi">1</span> <span class="n">until</span> <span class="nf">width</span><span class="p">())</span> <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">right</span> <span class="p">=</span> <span class="k">false</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">left</span> <span class="p">=</span> <span class="k">false</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">top</span> <span class="p">||</span> <span class="n">bottom</span> <span class="p">||</span> <span class="n">left</span> <span class="p">||</span> <span class="n">right</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">calcVisible</span><span class="p">(</span><span class="n">grid</span><span class="p">:</span> <span class="nc">Grid</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">height</span> <span class="p">=</span> <span class="n">grid</span><span class="p">.</span><span class="nf">height</span><span class="p">()</span>
  <span class="kd">val</span> <span class="py">width</span> <span class="p">=</span> <span class="n">grid</span><span class="p">.</span><span class="nf">width</span><span class="p">()</span>
  <span class="kd">var</span> <span class="py">result</span> <span class="p">=</span> <span class="p">(</span><span class="n">height</span> <span class="p">*</span> <span class="mi">2</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">width</span> <span class="p">*</span> <span class="mi">2</span><span class="p">)</span> <span class="p">-</span> <span class="mi">4</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">height</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">width</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">grid</span><span class="p">.</span><span class="nf">visible</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">result</span> <span class="p">+=</span> <span class="mi">1</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_6">Part 2</h3>
<div class="paragraph">
<p>We had to calculate a scenic value for each tree and determine the answer was maximum scenic.
The scenic value was determined by how many trees were visible from a given tree.</p>
</div>
<div class="paragraph">
<p>I added a scenic method to Grid.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">scenic</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">treeHeight</span> <span class="p">=</span> <span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="kd">var</span> <span class="py">bottom</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="kd">var</span> <span class="py">top</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="kd">var</span> <span class="py">left</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="kd">var</span> <span class="py">right</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">x</span> <span class="p">+</span> <span class="mi">1</span> <span class="n">until</span> <span class="nf">height</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">bottom</span> <span class="p">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">x</span> <span class="p">-</span> <span class="mi">1</span> <span class="n">downTo</span>  <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">top</span> <span class="p">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">y</span> <span class="p">+</span> <span class="mi">1</span> <span class="n">until</span> <span class="nf">width</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">right</span> <span class="p">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">y</span> <span class="p">-</span> <span class="mi">1</span> <span class="n">downTo</span>  <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">left</span> <span class="p">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">bottom</span> <span class="p">*</span> <span class="n">left</span> <span class="p">*</span> <span class="n">right</span> <span class="p">*</span> <span class="n">top</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">calcMaxScenic</span><span class="p">(</span><span class="n">grid</span><span class="p">:</span> <span class="nc">Grid</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">height</span> <span class="p">=</span> <span class="n">grid</span><span class="p">.</span><span class="nf">height</span><span class="p">()</span>
  <span class="kd">val</span> <span class="py">width</span> <span class="p">=</span> <span class="n">grid</span><span class="p">.</span><span class="nf">width</span><span class="p">()</span>
  <span class="kd">var</span> <span class="py">result</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">height</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">width</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">result</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="nf">scenic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_6">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">import</span> <span class="nn">kotlin.math.max</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">test</span> <span class="p">=</span> <span class="nf">readLines</span><span class="p">(</span>
    <span class="s">"""30373
25512
65332
33549
35390"""</span>
  <span class="p">)</span>
  <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day08"</span><span class="p">)</span>

  <span class="kd">class</span> <span class="nc">Grid</span><span class="p">(</span><span class="kd">val</span> <span class="py">lines</span><span class="p">:</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">IntArray</span><span class="p">&gt;)</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">width</span><span class="p">()</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span>
    <span class="k">fun</span> <span class="nf">height</span><span class="p">()</span> <span class="p">=</span> <span class="n">lines</span><span class="p">.</span><span class="n">size</span>
    <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span>
    <span class="k">fun</span> <span class="nf">visible</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">treeHeight</span> <span class="p">=</span> <span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
      <span class="kd">var</span> <span class="py">bottom</span> <span class="p">=</span> <span class="k">true</span>
      <span class="kd">var</span> <span class="py">top</span> <span class="p">=</span> <span class="k">true</span>
      <span class="kd">var</span> <span class="py">left</span> <span class="p">=</span> <span class="k">true</span>
      <span class="kd">var</span> <span class="py">right</span> <span class="p">=</span> <span class="k">true</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">tree</span> <span class="p">=</span> <span class="k">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tree</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">top</span> <span class="p">=</span> <span class="k">false</span>
          <span class="k">break</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">x</span> <span class="p">+</span> <span class="mi">1</span> <span class="n">until</span> <span class="nf">height</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">bottom</span> <span class="p">=</span> <span class="k">false</span>
          <span class="k">break</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">y</span> <span class="p">+</span> <span class="mi">1</span> <span class="n">until</span> <span class="nf">width</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">right</span> <span class="p">=</span> <span class="k">false</span>
          <span class="k">break</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">left</span> <span class="p">=</span> <span class="k">false</span>
          <span class="k">break</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">top</span> <span class="p">||</span> <span class="n">bottom</span> <span class="p">||</span> <span class="n">left</span> <span class="p">||</span> <span class="n">right</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">scenic</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">treeHeight</span> <span class="p">=</span> <span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
      <span class="kd">var</span> <span class="py">bottom</span> <span class="p">=</span> <span class="mi">0</span>
      <span class="kd">var</span> <span class="py">top</span> <span class="p">=</span> <span class="mi">0</span>
      <span class="kd">var</span> <span class="py">left</span> <span class="p">=</span> <span class="mi">0</span>
      <span class="kd">var</span> <span class="py">right</span> <span class="p">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">x</span> <span class="p">+</span> <span class="mi">1</span> <span class="n">until</span> <span class="nf">height</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">bottom</span> <span class="p">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">break</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">x</span> <span class="p">-</span> <span class="mi">1</span> <span class="n">downTo</span>  <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">top</span> <span class="p">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">break</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">y</span> <span class="p">+</span> <span class="mi">1</span> <span class="n">until</span> <span class="nf">width</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">right</span> <span class="p">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">break</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">y</span> <span class="p">-</span> <span class="mi">1</span> <span class="n">downTo</span>  <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">left</span> <span class="p">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">&gt;=</span> <span class="n">treeHeight</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">break</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">bottom</span> <span class="p">*</span> <span class="n">left</span> <span class="p">*</span> <span class="n">right</span> <span class="p">*</span> <span class="n">top</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">parseGrid</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Grid</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">Grid</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">line</span> <span class="p">-&gt;</span> 
                 <span class="n">line</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
                   <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">-</span> <span class="sc">'0'</span> <span class="p">}</span>
                   <span class="p">.</span><span class="nf">toIntArray</span><span class="p">()</span> 
             <span class="p">}.</span><span class="nf">toTypedArray</span><span class="p">()</span>
     <span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcVisible</span><span class="p">(</span><span class="n">grid</span><span class="p">:</span> <span class="nc">Grid</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">height</span> <span class="p">=</span> <span class="n">grid</span><span class="p">.</span><span class="nf">height</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">width</span> <span class="p">=</span> <span class="n">grid</span><span class="p">.</span><span class="nf">width</span><span class="p">()</span>
    <span class="kd">var</span> <span class="py">result</span> <span class="p">=</span> <span class="p">(</span><span class="n">height</span> <span class="p">*</span> <span class="mi">2</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">width</span> <span class="p">*</span> <span class="mi">2</span><span class="p">)</span> <span class="p">-</span> <span class="mi">4</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">height</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">width</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">grid</span><span class="p">.</span><span class="nf">visible</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">result</span> <span class="p">+=</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcMaxScenic</span><span class="p">(</span><span class="n">grid</span><span class="p">:</span> <span class="nc">Grid</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">height</span> <span class="p">=</span> <span class="n">grid</span><span class="p">.</span><span class="nf">height</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">width</span> <span class="p">=</span> <span class="n">grid</span><span class="p">.</span><span class="nf">width</span><span class="p">()</span>
    <span class="kd">var</span> <span class="py">result</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">height</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">width</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">result</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">grid</span><span class="p">.</span><span class="nf">scenic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcVisible</span><span class="p">(</span><span class="nf">parseGrid</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">21</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcVisible</span><span class="p">(</span><span class="nf">parseGrid</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">1851</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcMaxScenic</span><span class="p">(</span><span class="nf">parseGrid</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">8</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcMaxScenic</span><span class="p">(</span><span class="nf">parseGrid</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">574080</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nf">println</span><span class="p">(</span><span class="s">"Day - 08"</span><span class="p">)</span>
  <span class="nf">separator</span><span class="p">()</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">separator</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-9">Rope Bridge</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Today&#8217;s puzzle was about simulating the movement of a rope or chain. The knots / links follow each other when the head is pulled in a direction. The simulation had to implement rules for the movement and record the movement of the tail and reporting the number of unique positions visited by the tail.</p>
</div>
<div class="paragraph">
<p>In part 1 the rope has 2 knots and in part 2 the rope had 10 knots.</p>
</div>
<div class="sect2">
<h3 id="_model_2">Model</h3>
<div class="paragraph">
<p>I decided to model the <code>Rope</code> as an array of <code>Position</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">data class</span> <span class="nc">Position</span><span class="p">(</span><span class="kd">val</span> <span class="py">row</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">col</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">fun</span> <span class="nf">left</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">right</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="p">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">above</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span> <span class="p">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">below</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span> <span class="p">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">distance</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Position</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">row</span><span class="p">),</span> <span class="nf">abs</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">col</span><span class="p">))</span>
  <span class="k">operator</span> <span class="k">fun</span> <span class="nf">minus</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Position</span><span class="p">)</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span> <span class="p">-</span> <span class="n">pos</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="p">-</span> <span class="n">pos</span><span class="p">.</span><span class="n">col</span><span class="p">)</span>
  <span class="k">operator</span> <span class="k">fun</span> <span class="nf">plus</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Position</span><span class="p">)</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span> <span class="p">+</span> <span class="n">pos</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="p">+</span> <span class="n">pos</span><span class="p">.</span><span class="n">col</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">sign</span><span class="p">():</span> <span class="nc">Position</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="n">sign</span><span class="p">,</span><span class="n">col</span><span class="p">.</span><span class="n">sign</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">move</span><span class="p">(</span><span class="n">direction</span><span class="p">:</span> <span class="nc">Char</span><span class="p">):</span> <span class="nc">Position</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">direction</span><span class="p">)</span> <span class="p">{</span>
      <span class="sc">'U'</span> <span class="p">-&gt;</span> <span class="nf">above</span><span class="p">()</span>
      <span class="sc">'D'</span> <span class="p">-&gt;</span> <span class="nf">below</span><span class="p">()</span>
      <span class="sc">'L'</span> <span class="p">-&gt;</span> <span class="nf">left</span><span class="p">()</span>
      <span class="sc">'R'</span> <span class="p">-&gt;</span> <span class="nf">right</span><span class="p">()</span>
      <span class="k">else</span> <span class="p">-&gt;</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Expected one of U,D,L,R not ${direction}"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"(col=$col, row=$row)"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Rope</span><span class="p">(</span><span class="kd">val</span> <span class="py">knots</span><span class="p">:</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">Position</span><span class="p">&gt;)</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">head</span><span class="p">:</span> <span class="nc">Position</span>
    <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">knots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="kd">val</span> <span class="py">tail</span><span class="p">:</span> <span class="nc">Position</span>
    <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">knots</span><span class="p">[</span><span class="n">knots</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">]</span>

  <span class="k">operator</span> <span class="k">fun</span> <span class="nf">set</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nc">Position</span><span class="p">)</span> <span class="p">{</span> <span class="n">knots</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="n">pos</span> <span class="p">}</span>

  <span class="k">operator</span> <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">=</span> <span class="n">knots</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
  <span class="k">fun</span> <span class="nf">indexOf</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Position</span><span class="p">)</span> <span class="p">=</span> <span class="n">knots</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">=</span> <span class="n">knots</span><span class="p">.</span><span class="nf">contentToString</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsing_5">Parsing</h3>
<div class="paragraph">
<p>The input was a list of steps with the direction as one of <code>U</code>,<code>D</code>,<code>L</code>,<code>R</code> and a number for the distance moved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">data class</span> <span class="nc">Step</span><span class="p">(</span><span class="kd">val</span> <span class="py">direction</span><span class="p">:</span> <span class="nc">Char</span><span class="p">,</span> <span class="kd">val</span> <span class="py">distance</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>

<span class="k">fun</span> <span class="nf">parseSteps</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Step</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">words</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
    <span class="nc">Step</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">())</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_simulating_the_rope">Simulating the rope</h3>
<div class="paragraph">
<p>After when I got to part 2 I had a situation where my answer to the provided data was correct but AOC report my answer with the input as low. I tried to find a case where I wasn&#8217;t handling the tail correctly. All this back and forth lead me to simplifying the calculation to the point where I calculated the difference between the knots and the movement was then a step in the direction of the first knot and it could be diagonally if the difference had values in both axis.</p>
</div>
<div class="paragraph">
<p>This worked and was a lot simpler. When I looked at some other submissions in the Kotlin community I discovered <code>Int.sign()</code> which returns <code>0</code>,<code>1</code> or <code>-1</code> depending in the value. I added operators to <code>Position</code> for <code>-</code> and <code>+</code> and a <code>sign</code> method. This reduced the final expression to a very simple one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">knots</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">prev</span> <span class="p">=</span> <span class="n">rope</span><span class="p">[</span><span class="n">index</span> <span class="p">-</span> <span class="mi">1</span><span class="p">]</span>                      // <b class="conum">(1)</b>
  <span class="kd">val</span> <span class="py">next</span> <span class="p">=</span> <span class="n">rope</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>                          // <b class="conum">(2)</b>
  <span class="k">if</span> <span class="p">(</span><span class="n">prev</span> <span class="p">!=</span> <span class="n">next</span> <span class="p">&amp;&amp;</span> <span class="n">prev</span><span class="p">.</span><span class="nf">distance</span><span class="p">(</span><span class="n">next</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>  // <b class="conum">(3)</b>
    <span class="kd">val</span> <span class="py">diff</span> <span class="p">=</span> <span class="n">prev</span> <span class="p">-</span> <span class="n">next</span>                        // <b class="conum">(4)</b>
    <span class="n">rope</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="n">next</span> <span class="p">+</span> <span class="n">diff</span><span class="p">.</span><span class="nf">sign</span><span class="p">()</span>              // <b class="conum">(5)</b>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The previous knot</p>
</li>
<li>
<p>The knot we want to move</p>
</li>
<li>
<p>If they aren&#8217;t in same location and the <a href="https://en.wikipedia.org/wiki/Chebyshev_distance">Chebyshev</a> distance is more than 1.</p>
</li>
<li>
<p>Determine the difference between the positions</p>
</li>
<li>
<p>Add the sign of the difference to the knot we want to move</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcVisits</span><span class="p">(</span><span class="n">steps</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Step</span><span class="p">&gt;,</span> <span class="n">knots</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">printStep</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">rope</span> <span class="p">=</span> <span class="nc">Rope</span><span class="p">(</span><span class="nc">Array</span><span class="p">(</span><span class="n">knots</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Position</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">})</span>
  <span class="kd">val</span> <span class="py">start</span> <span class="p">=</span> <span class="n">rope</span><span class="p">.</span><span class="n">head</span>
  <span class="kd">val</span> <span class="py">visited</span> <span class="p">=</span> <span class="n">mutableSetOf</span><span class="p">&lt;</span><span class="nc">Position</span><span class="p">&gt;()</span>
  <span class="n">visited</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">rope</span><span class="p">.</span><span class="n">tail</span><span class="p">)</span>
  <span class="n">steps</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">step</span> <span class="p">-&gt;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">step</span><span class="p">.</span><span class="n">distance</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">rope</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">rope</span><span class="p">.</span><span class="n">head</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="n">step</span><span class="p">.</span><span class="n">direction</span><span class="p">)</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">knots</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">prev</span> <span class="p">=</span> <span class="n">rope</span><span class="p">[</span><span class="n">index</span> <span class="p">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="kd">val</span> <span class="py">next</span> <span class="p">=</span> <span class="n">rope</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">prev</span> <span class="p">!=</span> <span class="n">next</span> <span class="p">&amp;&amp;</span> <span class="n">prev</span><span class="p">.</span><span class="nf">distance</span><span class="p">(</span><span class="n">next</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">val</span> <span class="py">diff</span> <span class="p">=</span> <span class="n">prev</span> <span class="p">-</span> <span class="n">next</span>
          <span class="n">rope</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="n">next</span> <span class="p">+</span> <span class="n">diff</span><span class="p">.</span><span class="nf">sign</span><span class="p">()</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">visited</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">rope</span><span class="p">.</span><span class="n">tail</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">printStep</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">rope</span><span class="p">,</span> <span class="n">knots</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nf">println</span><span class="p">()</span>
  <span class="nf">print</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">rope</span><span class="p">,</span> <span class="n">knots</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">visited</span><span class="p">.</span><span class="n">size</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_7">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">import</span> <span class="nn">kotlin.math.abs</span>
<span class="k">import</span> <span class="nn">kotlin.math.max</span>
<span class="k">import</span> <span class="nn">kotlin.math.min</span>
<span class="k">import</span> <span class="nn">kotlin.math.sign</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">val</span> <span class="py">test</span> <span class="p">=</span> <span class="s">"""R 4
U 4
L 3
D 1
R 4
D 1
L 5
R 2"""</span>
  <span class="kd">val</span> <span class="py">test2</span> <span class="p">=</span> <span class="s">"""R 5
U 8
L 8
D 3
R 17
D 10
L 25
U 20"""</span>
  <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day09"</span><span class="p">)</span>

  <span class="kd">data class</span> <span class="nc">Step</span><span class="p">(</span><span class="kd">val</span> <span class="py">direction</span><span class="p">:</span> <span class="nc">Char</span><span class="p">,</span> <span class="kd">val</span> <span class="py">distance</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>
  <span class="kd">data class</span> <span class="nc">Position</span><span class="p">(</span><span class="kd">val</span> <span class="py">row</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">col</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">left</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">right</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="p">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">above</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span> <span class="p">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">below</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span> <span class="p">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">distance</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Position</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">row</span><span class="p">),</span> <span class="nf">abs</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">col</span><span class="p">))</span>
    <span class="k">operator</span> <span class="k">fun</span> <span class="nf">minus</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Position</span><span class="p">)</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span> <span class="p">-</span> <span class="n">pos</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="p">-</span> <span class="n">pos</span><span class="p">.</span><span class="n">col</span><span class="p">)</span>
    <span class="k">operator</span> <span class="k">fun</span> <span class="nf">plus</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Position</span><span class="p">)</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span> <span class="p">+</span> <span class="n">pos</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="p">+</span> <span class="n">pos</span><span class="p">.</span><span class="n">col</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">sign</span><span class="p">():</span> <span class="nc">Position</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="n">sign</span><span class="p">,</span><span class="n">col</span><span class="p">.</span><span class="n">sign</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">move</span><span class="p">(</span><span class="n">direction</span><span class="p">:</span> <span class="nc">Char</span><span class="p">):</span> <span class="nc">Position</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">direction</span><span class="p">)</span> <span class="p">{</span>
        <span class="sc">'U'</span> <span class="p">-&gt;</span> <span class="nf">above</span><span class="p">()</span>
        <span class="sc">'D'</span> <span class="p">-&gt;</span> <span class="nf">below</span><span class="p">()</span>
        <span class="sc">'L'</span> <span class="p">-&gt;</span> <span class="nf">left</span><span class="p">()</span>
        <span class="sc">'R'</span> <span class="p">-&gt;</span> <span class="nf">right</span><span class="p">()</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Expected one of U,D,L,R not ${direction}"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s">"(col=$col, row=$row)"</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">parseSteps</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Step</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">words</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
      <span class="nc">Step</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">())</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">class</span> <span class="nc">Rope</span><span class="p">(</span><span class="kd">val</span> <span class="py">knots</span><span class="p">:</span> <span class="nc">Array</span><span class="p">&lt;</span><span class="nc">Position</span><span class="p">&gt;)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">head</span><span class="p">:</span> <span class="nc">Position</span>
      <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">knots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="kd">val</span> <span class="py">tail</span><span class="p">:</span> <span class="nc">Position</span>
      <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">knots</span><span class="p">[</span><span class="n">knots</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">]</span>
    <span class="k">operator</span> <span class="k">fun</span> <span class="nf">set</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="nc">Position</span><span class="p">)</span> <span class="p">{</span> <span class="n">knots</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="n">pos</span> <span class="p">}</span>
    <span class="k">operator</span> <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">=</span> <span class="n">knots</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">fun</span> <span class="nf">indexOf</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Position</span><span class="p">)</span> <span class="p">=</span> <span class="n">knots</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">=</span> <span class="n">knots</span><span class="p">.</span><span class="nf">contentToString</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">print</span><span class="p">(</span>
    <span class="n">steps</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Step</span><span class="p">&gt;,</span>
    <span class="n">visited</span><span class="p">:</span> <span class="nc">Set</span><span class="p">&lt;</span><span class="nc">Position</span><span class="p">&gt;,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nc">Position</span><span class="p">,</span>
    <span class="n">rope</span><span class="p">:</span> <span class="nc">Rope</span><span class="p">,</span>
    <span class="n">knots</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="n">visitsOnly</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="py">maxRow</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="kd">var</span> <span class="py">minRow</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="kd">var</span> <span class="py">maxCol</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="kd">var</span> <span class="py">minCol</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="kd">var</span> <span class="py">dummy</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">steps</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">step</span> <span class="p">-&gt;</span>
      <span class="nf">repeat</span><span class="p">(</span><span class="n">step</span><span class="p">.</span><span class="n">distance</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dummy</span> <span class="p">=</span> <span class="n">dummy</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="n">step</span><span class="p">.</span><span class="n">direction</span><span class="p">)</span>
        <span class="n">maxRow</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">maxRow</span><span class="p">,</span> <span class="n">dummy</span><span class="p">.</span><span class="n">row</span><span class="p">)</span>
        <span class="n">maxCol</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">maxCol</span><span class="p">,</span> <span class="n">dummy</span><span class="p">.</span><span class="n">col</span><span class="p">)</span>
        <span class="n">minRow</span> <span class="p">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">minRow</span><span class="p">,</span> <span class="n">dummy</span><span class="p">.</span><span class="n">row</span><span class="p">)</span>
        <span class="n">minCol</span> <span class="p">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">minCol</span><span class="p">,</span> <span class="n">dummy</span><span class="p">.</span><span class="n">col</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">row</span> <span class="k">in</span> <span class="n">minRow</span><span class="o">..</span><span class="n">maxRow</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">covered</span> <span class="p">=</span> <span class="n">mutableSetOf</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;()</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">col</span> <span class="k">in</span> <span class="n">minCol</span><span class="o">..</span><span class="n">maxCol</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">pos</span> <span class="p">=</span> <span class="nc">Position</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">visitsOnly</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="p">==</span> <span class="n">start</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="sc">'s'</span><span class="p">)</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="n">visited</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="sc">'#'</span> <span class="k">else</span> <span class="sc">'.'</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kd">val</span> <span class="py">index</span> <span class="p">=</span> <span class="n">rope</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
          <span class="k">when</span> <span class="p">{</span>
            <span class="n">index</span> <span class="p">==</span> <span class="mi">0</span> <span class="p">-&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="sc">'H'</span><span class="p">)</span>
            <span class="n">index</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">-&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="n">knots</span> <span class="p">==</span> <span class="mi">2</span><span class="p">)</span> <span class="sc">'T'</span> <span class="k">else</span> <span class="n">index</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
            <span class="n">pos</span> <span class="p">==</span> <span class="n">start</span> <span class="p">-&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="sc">'s'</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="n">visited</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="sc">'#'</span> <span class="k">else</span> <span class="sc">'.'</span><span class="p">)</span>
          <span class="p">}</span>
          <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="p">&gt;=</span> <span class="mi">0</span> <span class="p">&amp;&amp;</span> <span class="n">covered</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">pos</span> <span class="p">==</span> <span class="n">start</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">covered</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">rope</span><span class="p">.</span><span class="n">knots</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="c1">// indicate 's'</span>
            <span class="p">}</span>
            <span class="n">covered</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">index</span><span class="o">..</span><span class="n">rope</span><span class="p">.</span><span class="n">knots</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="p">==</span> <span class="n">rope</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">covered</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
              <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">covered</span><span class="p">.</span><span class="n">size</span> <span class="p">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">covered</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="n">covered</span><span class="p">.</span><span class="n">size</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"  ("</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">coveredKnots</span> <span class="p">=</span> <span class="n">covered</span><span class="p">.</span><span class="nf">sorted</span><span class="p">()</span>
        <span class="n">coveredKnots</span><span class="p">.</span><span class="nf">forEachIndexed</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">knot</span> <span class="p">-&gt;</span>
          <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">" covers "</span><span class="p">)</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">" ,"</span><span class="p">)</span>
          <span class="p">}</span>
          <span class="k">when</span><span class="p">(</span><span class="n">knot</span><span class="p">)</span> <span class="p">{</span>
            <span class="mi">0</span> <span class="p">-&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="sc">'H'</span><span class="p">)</span>
            <span class="n">rope</span><span class="p">.</span><span class="n">knots</span><span class="p">.</span><span class="n">lastIndex</span> <span class="p">-&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="sc">'T'</span><span class="p">)</span>
            <span class="n">rope</span><span class="p">.</span><span class="n">knots</span><span class="p">.</span><span class="n">size</span> <span class="p">-&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="sc">'s'</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="nf">print</span><span class="p">(</span><span class="s">"$knot"</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="nf">println</span><span class="p">(</span><span class="sc">')'</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="nf">println</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcVisits</span><span class="p">(</span><span class="n">steps</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Step</span><span class="p">&gt;,</span> <span class="n">knots</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">printStep</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">rope</span> <span class="p">=</span> <span class="nc">Rope</span><span class="p">(</span><span class="nc">Array</span><span class="p">(</span><span class="n">knots</span><span class="p">)</span> <span class="p">{</span> <span class="nc">Position</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">})</span>
    <span class="kd">val</span> <span class="py">start</span> <span class="p">=</span> <span class="n">rope</span><span class="p">.</span><span class="n">head</span>
    <span class="kd">val</span> <span class="py">visited</span> <span class="p">=</span> <span class="n">mutableSetOf</span><span class="p">&lt;</span><span class="nc">Position</span><span class="p">&gt;()</span>
    <span class="n">visited</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">rope</span><span class="p">.</span><span class="n">tail</span><span class="p">)</span>
    <span class="n">steps</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">step</span> <span class="p">-&gt;</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">step</span><span class="p">.</span><span class="n">distance</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">rope</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">rope</span><span class="p">.</span><span class="n">head</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="n">step</span><span class="p">.</span><span class="n">direction</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">knots</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">val</span> <span class="py">prev</span> <span class="p">=</span> <span class="n">rope</span><span class="p">[</span><span class="n">index</span> <span class="p">-</span> <span class="mi">1</span><span class="p">]</span>
          <span class="kd">val</span> <span class="py">next</span> <span class="p">=</span> <span class="n">rope</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

          <span class="k">if</span> <span class="p">(</span><span class="n">prev</span> <span class="p">!=</span> <span class="n">next</span> <span class="p">&amp;&amp;</span> <span class="n">prev</span><span class="p">.</span><span class="nf">distance</span><span class="p">(</span><span class="n">next</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">diff</span> <span class="p">=</span> <span class="n">prev</span> <span class="p">-</span> <span class="n">next</span>
            <span class="n">rope</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="n">next</span> <span class="p">+</span> <span class="n">diff</span><span class="p">.</span><span class="nf">sign</span><span class="p">()</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">visited</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">rope</span><span class="p">.</span><span class="n">tail</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">printStep</span><span class="p">)</span> <span class="p">{</span>
          <span class="nf">println</span><span class="p">()</span>
          <span class="nf">print</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">rope</span><span class="p">,</span> <span class="n">knots</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nf">println</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">visited</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">rope</span><span class="p">,</span> <span class="n">knots</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">visited</span><span class="p">.</span><span class="n">size</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcVisits</span><span class="p">(</span><span class="nf">parseSteps</span><span class="p">(</span><span class="nf">readLines</span><span class="p">(</span><span class="n">test</span><span class="p">)),</span> <span class="mi">2</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">13</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcVisits</span><span class="p">(</span><span class="nf">parseSteps</span><span class="p">(</span><span class="n">input</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">6503</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">check</span><span class="p">(</span><span class="nf">calcVisits</span><span class="p">(</span><span class="nf">parseSteps</span><span class="p">(</span><span class="nf">readLines</span><span class="p">(</span><span class="n">test</span><span class="p">)),</span> <span class="mi">10</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="p">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcVisits</span><span class="p">(</span><span class="nf">parseSteps</span><span class="p">(</span><span class="nf">readLines</span><span class="p">(</span><span class="n">test2</span><span class="p">)),</span> <span class="mi">10</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">36</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcVisits</span><span class="p">(</span><span class="nf">parseSteps</span><span class="p">(</span><span class="n">input</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">2724</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nf">println</span><span class="p">(</span><span class="s">"Day - 09"</span><span class="p">)</span>
  <span class="nf">separator</span><span class="p">()</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">separator</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-10">Cathode-Ray Tube</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Today&#8217;s puzzle was about simulating a computer and the cathode ray tube.
So far we have only 2 instructions to simulate: <code>noop</code> and <code>addx</code>. It very important to carefully read the instructions describing the clock cycles. In this case <code>noop</code> has one cycle and <code>addx</code> has two cycle.</p>
</div>
<div class="sect2">
<h3 id="_input_model">Input Model</h3>
<div class="paragraph">
<p>I decided to model a instructions as a sealed class and the processor as a class to maintain the clock and register value with a lambda to be called on each tick.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">sealed</span> <span class="kd">class</span> <span class="nc">OpCode</span><span class="p">(</span><span class="kd">val</span> <span class="py">prefix</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">object</span> <span class="nc">NOOP</span><span class="p">:</span> <span class="nc">OpCode</span><span class="p">(</span><span class="s">"noop"</span><span class="p">)</span>
  <span class="kd">data class</span> <span class="nc">ADDX</span><span class="p">(</span><span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">OpCode</span><span class="p">(</span><span class="s">"addx"</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsing_6">Parsing</h3>
<div class="paragraph">
<p>Parsing will create the instances of the various inner classes of the sealed class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">parseInstructions</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">OpCode</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">lines</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">ins</span> <span class="p">-&gt;</span>
    <span class="kd">val</span> <span class="py">words</span> <span class="p">=</span> <span class="n">ins</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
    <span class="k">when</span> <span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
      <span class="s">"noop"</span> <span class="p">-&gt;</span> <span class="nc">OpCode</span><span class="p">.</span><span class="nc">NOOP</span>
      <span class="s">"addx"</span> <span class="p">-&gt;</span> <span class="nc">OpCode</span><span class="p">.</span><span class="nc">ADDX</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">())</span>
      <span class="k">else</span> <span class="p">-&gt;</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Unknown instruction: $ins"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processor_model">Processor Model</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">class</span> <span class="nc">Processor</span><span class="p">(</span><span class="kd">val</span> <span class="py">processing</span><span class="p">:</span> <span class="nc">Processor</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="py">clock</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="k">private</span> <span class="k">set</span>
  <span class="kd">var</span> <span class="py">regX</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="mi">1</span>
    <span class="k">private</span> <span class="k">set</span>

  <span class="k">fun</span> <span class="nf">tick</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">clock</span> <span class="p">+=</span> <span class="mi">1</span>
    <span class="nf">processing</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> // <b class="conum">(1)</b>
  <span class="p">}</span>
  <span class="k">fun</span> <span class="nf">execute</span><span class="p">(</span><span class="n">instructions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">OpCode</span><span class="p">&gt;)</span> <span class="p">{</span>
    <span class="n">instructions</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">ins</span> <span class="p">-&gt;</span>
      <span class="k">when</span> <span class="p">(</span><span class="n">ins</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">OpCode</span><span class="p">.</span><span class="nc">NOOP</span> <span class="p">-&gt;</span> <span class="nf">tick</span><span class="p">()</span>
        <span class="k">is</span> <span class="nc">OpCode</span><span class="p">.</span><span class="nc">ADDX</span> <span class="p">-&gt;</span> <span class="nf">addX</span><span class="p">(</span><span class="n">ins</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">fun</span> <span class="nf">addX</span><span class="p">(</span><span class="n">ins</span><span class="p">:</span> <span class="nc">OpCode</span><span class="p">.</span><span class="nc">ADDX</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">tick</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">value</span> <span class="p">=</span> <span class="n">ins</span><span class="p">.</span><span class="n">value</span>
    <span class="nf">tick</span><span class="p">()</span>
    <span class="n">regX</span> <span class="p">+=</span> <span class="n">value</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>processing lambda is called after each clock tick.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_part_1_6">Part 1</h3>
<div class="paragraph">
<p>The first part had to calculate signal string based on the value of <code>regX</code> and on the 20th tick and each 40th tick thereafter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcSignalStrength</span><span class="p">(</span><span class="n">instructions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">OpCode</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="py">signalValue</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="kd">val</span> <span class="py">cpu</span> <span class="p">=</span> <span class="nc">Processor</span> <span class="p">{</span>               // <b class="conum">(1)</b>
    <span class="k">if</span> <span class="p">(</span><span class="n">clock</span> <span class="p">%</span> <span class="mi">40</span> <span class="p">==</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">signalValue</span> <span class="p">+=</span> <span class="n">regX</span> <span class="p">*</span> <span class="n">clock</span>     // <b class="conum">(2)</b>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">cpu</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">signalValue</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The lambda declaration after the Processor will be invoked on each tick</p>
</li>
<li>
<p>The lambda cannot modify <code>clock</code> or <code>regX</code></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_7">Part 2</h3>
<div class="paragraph">
<p>The second part had to render the CRT of 40 characters wide. The CRT prints from left to right on each clock tick and will print a <code>#</code> if the 3 character sprite overlaps with the <code>cursor</code> position, otherwise it prints <code>.</code>.
I had to print spaces instead of dots before I could read the character spelled out by part 2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">renderCrt</span><span class="p">(</span><span class="n">instructions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">OpCode</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">pixels</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;()</span>
  <span class="kd">val</span> <span class="py">crt</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;()</span>
  <span class="kd">val</span> <span class="py">cpu</span> <span class="p">=</span> <span class="nc">Processor</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">sprite</span> <span class="p">=</span> <span class="n">regX</span> <span class="p">-</span> <span class="mi">1</span>
    <span class="kd">val</span> <span class="py">cursor</span> <span class="p">=</span> <span class="p">(</span><span class="n">clock</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">%</span> <span class="mi">40</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cursor</span> <span class="p">&gt;=</span> <span class="n">sprite</span> <span class="p">&amp;&amp;</span> <span class="n">cursor</span> <span class="p">&lt;=</span> <span class="n">sprite</span> <span class="p">+</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pixels</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sc">'#'</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">pixels</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sc">'.'</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cursor</span> <span class="p">==</span> <span class="mi">39</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">crt</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">pixels</span><span class="p">.</span><span class="nf">joinToString</span><span class="p">(</span><span class="s">""</span><span class="p">))</span>
      <span class="n">pixels</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">cpu</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">crt</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_8">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">import</span> <span class="nn">utils.*</span>

<span class="k">sealed</span> <span class="kd">class</span> <span class="nc">OpCode</span><span class="p">(</span><span class="kd">val</span> <span class="py">prefix</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">object</span> <span class="nc">NOOP</span><span class="p">:</span> <span class="nc">OpCode</span><span class="p">(</span><span class="s">"noop"</span><span class="p">)</span>
  <span class="kd">data class</span> <span class="nc">ADDX</span><span class="p">(</span><span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">OpCode</span><span class="p">(</span><span class="s">"addx"</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">test</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day10_test"</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day10"</span><span class="p">)</span>

  <span class="k">fun</span> <span class="nf">parseInstructions</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">OpCode</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lines</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">ins</span> <span class="p">-&gt;</span>
      <span class="kd">val</span> <span class="py">words</span> <span class="p">=</span> <span class="n">ins</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
      <span class="k">when</span> <span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
        <span class="s">"noop"</span> <span class="p">-&gt;</span> <span class="nc">OpCode</span><span class="p">.</span><span class="nc">NOOP</span>
        <span class="s">"addx"</span> <span class="p">-&gt;</span> <span class="nc">OpCode</span><span class="p">.</span><span class="nc">ADDX</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">())</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Unknown instruction: $ins"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">class</span> <span class="nc">Processor</span><span class="p">(</span><span class="kd">val</span> <span class="py">processing</span><span class="p">:</span> <span class="nc">Processor</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="py">clock</span> <span class="p">=</span> <span class="mi">0</span>
      <span class="k">private</span> <span class="k">set</span>

    <span class="k">fun</span> <span class="nf">tick</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">clock</span> <span class="p">+=</span> <span class="mi">1</span>
      <span class="nf">processing</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="py">regX</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="mi">1</span>
      <span class="k">private</span> <span class="k">set</span>

    <span class="k">fun</span> <span class="nf">execute</span><span class="p">(</span><span class="n">instructions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">OpCode</span><span class="p">&gt;)</span> <span class="p">{</span>
      <span class="n">instructions</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">ins</span> <span class="p">-&gt;</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">ins</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">is</span> <span class="nc">OpCode</span><span class="p">.</span><span class="nc">NOOP</span> <span class="p">-&gt;</span> <span class="nf">tick</span><span class="p">()</span>
          <span class="k">is</span> <span class="nc">OpCode</span><span class="p">.</span><span class="nc">ADDX</span> <span class="p">-&gt;</span> <span class="nf">addX</span><span class="p">(</span><span class="n">ins</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">addX</span><span class="p">(</span><span class="n">ins</span><span class="p">:</span> <span class="nc">OpCode</span><span class="p">.</span><span class="nc">ADDX</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">tick</span><span class="p">()</span>
      <span class="kd">val</span> <span class="py">value</span> <span class="p">=</span> <span class="n">ins</span><span class="p">.</span><span class="n">value</span>
      <span class="nf">tick</span><span class="p">()</span>
      <span class="n">regX</span> <span class="p">+=</span> <span class="n">value</span>
    <span class="p">}</span>
  <span class="p">}</span>


  <span class="k">fun</span> <span class="nf">calcSignalStrength</span><span class="p">(</span><span class="n">instructions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">OpCode</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="py">signalValue</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="kd">val</span> <span class="py">cpu</span> <span class="p">=</span> <span class="nc">Processor</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">clock</span> <span class="p">%</span> <span class="mi">40</span> <span class="p">==</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">signalValue</span> <span class="p">+=</span> <span class="n">regX</span> <span class="p">*</span> <span class="n">clock</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">cpu</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">signalValue</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">renderCrt</span><span class="p">(</span><span class="n">instructions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">OpCode</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">pixels</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Char</span><span class="p">&gt;()</span>
    <span class="kd">val</span> <span class="py">crt</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;()</span>
    <span class="kd">val</span> <span class="py">cpu</span> <span class="p">=</span> <span class="nc">Processor</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">sprite</span> <span class="p">=</span> <span class="n">regX</span> <span class="p">-</span> <span class="mi">1</span>
      <span class="kd">val</span> <span class="py">cursor</span> <span class="p">=</span> <span class="p">(</span><span class="n">clock</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">%</span> <span class="mi">40</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cursor</span> <span class="p">&gt;=</span> <span class="n">sprite</span> <span class="p">&amp;&amp;</span> <span class="n">cursor</span> <span class="p">&lt;=</span> <span class="n">sprite</span> <span class="p">+</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pixels</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sc">'#'</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">pixels</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="sc">'.'</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cursor</span> <span class="p">==</span> <span class="mi">39</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">crt</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">pixels</span><span class="p">.</span><span class="nf">joinToString</span><span class="p">(</span><span class="s">""</span><span class="p">))</span>
        <span class="n">pixels</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">cpu</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">crt</span><span class="p">.</span><span class="nf">toList</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcSignalStrength</span><span class="p">(</span><span class="nf">parseInstructions</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">13140</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcSignalStrength</span><span class="p">(</span><span class="nf">parseInstructions</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $result"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">val</span> <span class="py">expectedTestCrt</span> <span class="p">=</span> <span class="nf">readLines</span><span class="p">(</span>
    <span class="s">"""##..##..##..##..##..##..##..##..##..##..
###...###...###...###...###...###...###.
####....####....####....####....####....
#####.....#####.....#####.....#####.....
######......######......######......####
#######.......#######.......#######....."""</span>
  <span class="p">)</span>
  <span class="kd">val</span> <span class="py">expectedCrt</span> <span class="p">=</span> <span class="nf">readLines</span><span class="p">(</span>
    <span class="s">"""####..##....##..##..###....##.###..####.
#....#..#....#.#..#.#..#....#.#..#.#....
###..#.......#.#..#.#..#....#.#..#.###..
#....#.......#.####.###.....#.###..#....
#....#..#.#..#.#..#.#....#..#.#.#..#....
#.....##...##..#..#.#.....##..#..#.####."""</span>
  <span class="p">)</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testCrt</span> <span class="p">=</span> <span class="nf">renderCrt</span><span class="p">(</span><span class="nf">parseInstructions</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Test"</span><span class="p">)</span>
    <span class="n">testCrt</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testCrt</span> <span class="p">==</span> <span class="n">expectedTestCrt</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">crt</span> <span class="p">=</span> <span class="nf">renderCrt</span><span class="p">(</span><span class="nf">parseInstructions</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2"</span><span class="p">)</span>
    <span class="n">crt</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sc">'.'</span><span class="p">,</span><span class="sc">' '</span><span class="p">))</span> <span class="p">}</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">crt</span> <span class="p">==</span> <span class="n">expectedCrt</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nf">println</span><span class="p">(</span><span class="s">"Day - 10"</span><span class="p">)</span>
  <span class="nf">separator</span><span class="p">()</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">separator</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-11">Monkey in the Middle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Today&#8217;s puzzle require the parsing of rules describing monkeys that have some of your items.
Each monkey will toss the item to another monkey based on the worried factor perceived by the monkey.</p>
</div>
<div class="sect2">
<h3 id="_model_3">Model</h3>
<div class="paragraph">
<p>The model represents all the rules as well as tracking the number of inspections performed by the monkey.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">data class</span> <span class="nc">Monkey</span><span class="p">(</span>
  <span class="kd">val</span> <span class="py">number</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
  <span class="kd">val</span> <span class="py">worriedLevel</span><span class="p">:</span> <span class="nc">Long</span><span class="p">,</span>
  <span class="kd">val</span> <span class="py">items</span><span class="p">:</span> <span class="nc">MutableList</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;,</span>
  <span class="kd">val</span> <span class="py">boredTarget</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
  <span class="kd">val</span> <span class="py">worriedTarget</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
  <span class="kd">val</span> <span class="py">expression</span><span class="p">:</span> <span class="p">(</span><span class="nc">Long</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">Long</span><span class="p">,</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="py">inspected</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="k">private</span> <span class="k">set</span>
  <span class="k">fun</span> <span class="nf">inspect</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">inspected</span> <span class="p">+=</span> <span class="n">value</span>
  <span class="p">}</span>
  <span class="k">fun</span> <span class="nf">findTarget</span><span class="p">(</span><span class="n">boredLevel</span><span class="p">:</span> <span class="nc">Long</span><span class="p">)</span> <span class="p">=</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">boredLevel</span> <span class="p">%</span> <span class="n">worriedLevel</span> <span class="p">!=</span> <span class="mi">0L</span><span class="p">)</span> <span class="n">worriedTarget</span> <span class="k">else</span> <span class="n">boredTarget</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"Monkey(number=$number, "</span> <span class="p">+</span>
        <span class="s">"inspected=$inspected, "</span> <span class="p">+</span>
        <span class="s">"worriedLevel=$worriedLevel, "</span> <span class="p">+</span>
        <span class="s">"boredTarget=$boredTarget, "</span> <span class="p">+</span>
        <span class="s">"worriedTarget=$worriedTarget, "</span><span class="p">+</span>
        <span class="s">"items=$items)"</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsing_7">Parsing</h3>
<div class="paragraph">
<p>I decided to parse each monkey rules using a regular expression for each line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">val</span> <span class="py">regexMonkey</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
    <span class="s">"Monkey (\\d+):$"</span><span class="p">,</span>
    <span class="s">"  Starting items:\\s*((\\S+(,\\s)*)*)\$"</span><span class="p">,</span>
    <span class="s">"  Operation: new =\\s(\\S+)\\s(\\+|\\*)\\s(\\S+)\$"</span><span class="p">,</span>
    <span class="s">"  Test: divisible by (\\d+)$"</span><span class="p">,</span>
    <span class="s">"    If true: throw to monkey (\\d+)$"</span><span class="p">,</span>
    <span class="s">"    If false: throw to monkey (\\d+)$"</span>
<span class="p">).</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toRegex</span><span class="p">()</span> <span class="p">}</span>
<span class="k">fun</span> <span class="nf">parseMonkey</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Monkey</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="n">regexMonkey</span><span class="p">.</span><span class="nf">mapIndexed</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">regex</span> <span class="p">-&gt;</span>
          <span class="n">regex</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Regex error for ${lines[index]}"</span><span class="p">)</span>
      <span class="p">}.</span><span class="nf">toTypedArray</span><span class="p">()</span>

  <span class="kd">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">groupValues</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">trim</span><span class="p">().</span><span class="nf">toLong</span><span class="p">()</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">toMutableList</span><span class="p">()</span>

  <span class="kd">val</span> <span class="py">words</span> <span class="p">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">groupValues</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="nf">check</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"old"</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">isAdd</span> <span class="p">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">==</span> <span class="s">"+"</span>
  <span class="kd">val</span> <span class="py">constant</span> <span class="p">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">toLongOrNull</span><span class="p">()</span>
  <span class="kd">val</span> <span class="py">lambda</span><span class="p">:</span> <span class="p">(</span><span class="nc">Long</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">Long</span> <span class="p">=</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">isAdd</span><span class="p">)</span>
            <span class="p">{</span> <span class="n">old</span> <span class="p">-&gt;</span> <span class="nc">Math</span><span class="p">.</span><span class="nf">addExact</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">constant</span> <span class="o">?:</span> <span class="n">old</span><span class="p">)</span> <span class="p">}</span>
          <span class="k">else</span>
            <span class="p">{</span> <span class="n">old</span> <span class="p">-&gt;</span> <span class="nc">Math</span><span class="p">.</span><span class="nf">multiplyExact</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">constant</span> <span class="o">?:</span> <span class="n">old</span><span class="p">)</span> <span class="p">}</span> // <b class="conum">(1)</b>

  <span class="k">return</span> <span class="nc">Monkey</span><span class="p">(</span>
      <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">groupValues</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">(),</span>
      <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">groupValues</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toLong</span><span class="p">(),</span>
      <span class="n">items</span><span class="p">,</span>
      <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">groupValues</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">(),</span>
      <span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">groupValues</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">(),</span>
      <span class="n">lambda</span>
  <span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>Math.addExact</code> and <code>Math.multiplyExact</code> will result in an exception if there is an overflow</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_processing">Processing</h3>
<div class="paragraph">
<p>Each monkey must process their items in the sequence of the assigned number.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">processItems</span><span class="p">(</span>
    <span class="n">monkeys</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">,</span> <span class="nc">Monkey</span><span class="p">&gt;,</span>
    <span class="n">rounds</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="n">divisor</span><span class="p">:</span> <span class="nc">Long</span> <span class="p">=</span> <span class="mi">3L</span>
<span class="p">):</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">,</span> <span class="nc">Monkey</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">divisors</span> <span class="p">=</span> <span class="n">monkeys</span><span class="p">.</span><span class="n">values</span>
      <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">monkey</span> <span class="p">-&gt;</span> <span class="n">monkey</span><span class="p">.</span><span class="n">worriedLevel</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">reduce</span> <span class="p">{</span> <span class="n">acc</span><span class="p">,</span> <span class="n">l</span> <span class="p">-&gt;</span> <span class="n">acc</span> <span class="p">*</span> <span class="n">l</span> <span class="p">*</span> <span class="n">divisor</span> <span class="p">}</span> // <b class="conum">(1)</b>
  <span class="kd">val</span> <span class="py">sorted</span> <span class="p">=</span> <span class="n">monkeys</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">number</span> <span class="p">}</span>
  <span class="nf">repeat</span><span class="p">(</span><span class="n">rounds</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sorted</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">monkey</span> <span class="p">-&gt;</span>
      <span class="n">monkey</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">level</span> <span class="p">=</span> <span class="n">monkey</span><span class="p">.</span><span class="nf">expression</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">bored</span> <span class="p">=</span> <span class="n">level</span> <span class="p">/</span> <span class="n">divisor</span>
        <span class="kd">val</span> <span class="py">targetNumber</span> <span class="p">=</span> <span class="n">monkey</span><span class="p">.</span><span class="nf">findTarget</span><span class="p">(</span><span class="n">bored</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">targetMonkey</span> <span class="p">=</span> <span class="n">monkeys</span><span class="p">[</span><span class="n">targetNumber</span><span class="p">]</span>
            <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find target Monkey:$targetNumber"</span><span class="p">)</span>
        <span class="n">targetMonkey</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">bored</span> <span class="p">%</span> <span class="n">divisors</span><span class="p">)</span> // <b class="conum">(2)</b>
      <span class="p">}</span>
      <span class="n">monkey</span><span class="p">.</span><span class="nf">inspect</span><span class="p">(</span><span class="n">monkey</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
      <span class="n">monkey</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">monkeys</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>multiplying all <code>worriedLevel</code> with each other and the required <code>divisor</code> provides a <a href="#lcd">least common divisor</a>.</p>
</li>
<li>
<p>mod with <a href="#lcd">least common divisor</a> to ensure the smallest valid value.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_part_1_7">Part 1</h3>
<div class="paragraph">
<p>Initially using <code>Int</code> values caused an overflow and I changed the worriedLevel and items to Long.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcShenanigans1</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">monkeys</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">chunked</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
          <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="nf">parseMonkey</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
          <span class="p">.</span><span class="nf">associateBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">number</span> <span class="p">}</span>
  <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">processItems</span><span class="p">(</span><span class="n">monkeys</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">values</span>
          <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">inspected</span> <span class="p">}</span>
          <span class="p">.</span><span class="nf">sortedDescending</span><span class="p">()</span>
          <span class="p">.</span><span class="nf">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
          <span class="p">.</span><span class="nf">reduce</span> <span class="p">{</span> <span class="n">acc</span><span class="p">,</span> <span class="n">i</span> <span class="p">-&gt;</span> <span class="n">acc</span> <span class="p">*</span> <span class="n">i</span> <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_8">Part 2</h3>
<div class="paragraph">
<p>When we had to increase the number of rounds to 10000 the worriedLevel overflowed. Using BigInteger doesn&#8217;t solve the problem because the calculations for BigInteger take too long as the multiplication ofr BigInteger takes exponentially longer as the numbers increase.</p>
</div>
<div id="lcd" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Using a smallest common divisor all the modulus and <code>/</code> operations will ensure that the overflow is prevented until the number of Monkeys become very large.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcShenanigans2</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Long</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">monkeys</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">chunked</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
          <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="nf">parseMonkey</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
          <span class="p">.</span><span class="nf">associateBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">number</span> <span class="p">}</span>
  <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">processItems</span><span class="p">(</span><span class="n">monkeys</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">values</span>
          <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">inspected</span><span class="p">.</span><span class="nf">toLong</span><span class="p">()</span> <span class="p">}</span>
          <span class="p">.</span><span class="nf">sortedDescending</span><span class="p">()</span>
          <span class="p">.</span><span class="nf">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
          <span class="p">.</span><span class="nf">reduce</span> <span class="p">{</span> <span class="n">acc</span><span class="p">,</span> <span class="n">i</span> <span class="p">-&gt;</span> <span class="n">acc</span> <span class="p">*</span> <span class="n">i</span> <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_9">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">import</span> <span class="nn">utils.readFile</span>
<span class="k">import</span> <span class="nn">utils.separator</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">val</span> <span class="py">test</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day11_test"</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day11"</span><span class="p">)</span>

  <span class="kd">data class</span> <span class="nc">Monkey</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">number</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">worriedLevel</span><span class="p">:</span> <span class="nc">Long</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">items</span><span class="p">:</span> <span class="nc">MutableList</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;,</span>
    <span class="kd">val</span> <span class="py">boredTarget</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">worriedTarget</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">expression</span><span class="p">:</span> <span class="p">(</span><span class="nc">Long</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">Long</span><span class="p">,</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="py">inspected</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="mi">0</span>
      <span class="k">private</span> <span class="k">set</span>
    <span class="k">fun</span> <span class="nf">inspect</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">inspected</span> <span class="p">+=</span> <span class="n">value</span>
    <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">findTarget</span><span class="p">(</span><span class="n">boredLevel</span><span class="p">:</span> <span class="nc">Long</span><span class="p">)</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">boredLevel</span> <span class="p">%</span> <span class="n">worriedLevel</span> <span class="p">!=</span> <span class="mi">0L</span><span class="p">)</span> <span class="n">worriedTarget</span> <span class="k">else</span> <span class="n">boredTarget</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s">"Monkey(number=$number, inspected=$inspected, worriedLevel=$worriedLevel, boredTarget=$boredTarget, worriedTarget=$worriedTarget, items=$items)"</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">val</span> <span class="py">regexMonkey</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
    <span class="s">"Monkey (\\d+):$"</span><span class="p">,</span>
    <span class="s">"  Starting items:\\s*((\\S+(,\\s)*)*)\$"</span><span class="p">,</span>
    <span class="s">"  Operation: new =\\s(\\S+)\\s(\\+|\\*)\\s(\\S+)\$"</span><span class="p">,</span>
    <span class="s">"  Test: divisible by (\\d+)$"</span><span class="p">,</span>
    <span class="s">"    If true: throw to monkey (\\d+)$"</span><span class="p">,</span>
    <span class="s">"    If false: throw to monkey (\\d+)$"</span>
  <span class="p">).</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toRegex</span><span class="p">()</span> <span class="p">}</span>
  <span class="k">fun</span> <span class="nf">parseMonkey</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Monkey</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="n">regexMonkey</span><span class="p">.</span><span class="nf">mapIndexed</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">regex</span> <span class="p">-&gt;</span> 
              <span class="n">regex</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Regex error for ${lines[index]}"</span><span class="p">)</span> 
        <span class="p">}.</span><span class="nf">toTypedArray</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">groupValues</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">trim</span><span class="p">().</span><span class="nf">toLong</span><span class="p">()</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">toMutableList</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">words</span> <span class="p">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">groupValues</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">==</span> <span class="s">"old"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">isAdd</span> <span class="p">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">==</span> <span class="s">"+"</span>
    <span class="kd">val</span> <span class="py">constant</span> <span class="p">=</span> <span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nf">toLongOrNull</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">lambda</span><span class="p">:</span> <span class="p">(</span><span class="nc">Long</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">Long</span> <span class="p">=</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">isAdd</span><span class="p">)</span> 
          <span class="p">{</span> <span class="n">old</span> <span class="p">-&gt;</span> <span class="n">old</span> <span class="p">+</span> <span class="p">(</span><span class="n">constant</span> <span class="o">?:</span> <span class="n">old</span><span class="p">)</span> <span class="p">}</span> 
        <span class="k">else</span> 
          <span class="p">{</span> <span class="n">old</span> <span class="p">-&gt;</span> <span class="n">old</span> <span class="p">*</span> <span class="p">(</span><span class="n">constant</span> <span class="o">?:</span> <span class="n">old</span><span class="p">)</span> <span class="p">}</span>

    <span class="k">return</span> <span class="nc">Monkey</span><span class="p">(</span>
      <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">groupValues</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">(),</span>
      <span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">groupValues</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toLong</span><span class="p">(),</span>
      <span class="n">items</span><span class="p">,</span>
      <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">groupValues</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">(),</span>
      <span class="n">result</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">groupValues</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toInt</span><span class="p">(),</span>
      <span class="n">lambda</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">processItems</span><span class="p">(</span>
    <span class="n">monkeys</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">,</span> <span class="nc">Monkey</span><span class="p">&gt;,</span> 
    <span class="n">rounds</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> 
    <span class="n">divisor</span><span class="p">:</span> <span class="nc">Long</span> <span class="p">=</span> <span class="mi">3L</span>
  <span class="p">):</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">,</span> <span class="nc">Monkey</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="c1">// The mod of the total of worriedLevels overcomes the Long overflow</span>
    <span class="c1">// using all divisors ensure that it is the smallest value that will</span>
    <span class="c1">// still satisfy all the requirements when using a large number of rounds</span>
    <span class="kd">val</span> <span class="py">divisors</span> <span class="p">=</span> <span class="n">monkeys</span><span class="p">.</span><span class="n">values</span>
          <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">monkey</span> <span class="p">-&gt;</span> <span class="n">monkey</span><span class="p">.</span><span class="n">worriedLevel</span> <span class="p">}</span>
          <span class="p">.</span><span class="nf">reduce</span> <span class="p">{</span> <span class="n">acc</span><span class="p">,</span> <span class="n">l</span> <span class="p">-&gt;</span> <span class="n">acc</span> <span class="p">*</span> <span class="n">l</span> <span class="p">*</span> <span class="n">divisor</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">sorted</span> <span class="p">=</span> <span class="n">monkeys</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">number</span> <span class="p">}</span>
    <span class="nf">repeat</span><span class="p">(</span><span class="n">rounds</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">sorted</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">monkey</span> <span class="p">-&gt;</span>
        <span class="n">monkey</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
          <span class="kd">val</span> <span class="py">level</span> <span class="p">=</span> <span class="n">monkey</span><span class="p">.</span><span class="nf">expression</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
          <span class="kd">val</span> <span class="py">bored</span> <span class="p">=</span> <span class="n">level</span> <span class="p">/</span> <span class="n">divisor</span>
          <span class="kd">val</span> <span class="py">targetNumber</span> <span class="p">=</span> <span class="n">monkey</span><span class="p">.</span><span class="nf">findTarget</span><span class="p">(</span><span class="n">bored</span><span class="p">)</span>
          <span class="kd">val</span> <span class="py">targetMonkey</span> <span class="p">=</span> <span class="n">monkeys</span><span class="p">[</span><span class="n">targetNumber</span><span class="p">]</span> 
                  <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find target Monkey:$targetNumber"</span><span class="p">)</span>
          <span class="n">targetMonkey</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">bored</span> <span class="p">%</span> <span class="n">divisors</span><span class="p">)</span> <span class="c1">// mod to ensure smallest valid value</span>
        <span class="p">}</span>
        <span class="n">monkey</span><span class="p">.</span><span class="nf">inspect</span><span class="p">(</span><span class="n">monkey</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">monkey</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">monkeys</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcShenanigans1</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">monkeys</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">chunked</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="nf">parseMonkey</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">.</span><span class="nf">associateBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">number</span> <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Before: ===="</span><span class="p">)</span>
    <span class="n">monkeys</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">processItems</span><span class="p">(</span><span class="n">monkeys</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"After: ===="</span><span class="p">)</span>
    <span class="n">result</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">values</span>
            <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">inspected</span> <span class="p">}</span>
            <span class="p">.</span><span class="nf">sortedDescending</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">reduce</span> <span class="p">{</span> <span class="n">acc</span><span class="p">,</span> <span class="n">i</span> <span class="p">-&gt;</span> <span class="n">acc</span> <span class="p">*</span> <span class="n">i</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcShenanigans2</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Long</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">monkeys</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">chunked</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="nf">parseMonkey</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">.</span><span class="nf">associateBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">number</span> <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Before: ===="</span><span class="p">)</span>
    <span class="n">monkeys</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">processItems</span><span class="p">(</span><span class="n">monkeys</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"After: ===="</span><span class="p">)</span>
    <span class="n">result</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">values</span>
            <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">inspected</span><span class="p">.</span><span class="nf">toLong</span><span class="p">()</span> <span class="p">}</span>
            <span class="p">.</span><span class="nf">sortedDescending</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">reduce</span> <span class="p">{</span> <span class="n">acc</span><span class="p">,</span> <span class="n">i</span> <span class="p">-&gt;</span> <span class="n">acc</span> <span class="p">*</span> <span class="n">i</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcShenanigans1</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">10605</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcShenanigans1</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">151312</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcShenanigans2</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">2713310158L</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcShenanigans2</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">51382025916L</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nf">println</span><span class="p">(</span><span class="s">"Day - 11"</span><span class="p">)</span>
  <span class="nf">separator</span><span class="p">()</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">separator</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-12">Hill Climbing Algorithm</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Today&#8217;s puzzle required graph traversal. I decided to use <a href="https://github.com/corneil/aoc-2022-in-kotlin/tree/main/src/main/kotlin/utils">utilities</a> I created during the 2019 edition of Aoc.</p>
</div>
<div class="paragraph">
<p>The problem used a grid of letter to describe a map. Each letter describes an elevation starting at <code>a</code> as the lowest and <code>z</code> the highest.
The user may only navigate horizontally or vertically and only to one step higher, the same level, or lower by any amount. (You may jump off a cliff!)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">Sabqponm
abcryxxl
accszExk
acctuvwj
abdefghi</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_model_4">Model</h3>
<div class="paragraph">
<p>The Graph requires a list of Edges. Each of the edges must contain two Comparable items that are linked with a distance.
In our case the distance is always one and since you can go from low to only one step higher but jump off a cliff the graph will be directed and the distance between cells will always be 1.</p>
</div>
<div class="paragraph">
<p>The Graph uses the Dijkstra algorithm to find the shortest path between nodes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="graph.png" alt="Class Diagram">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">data class</span> <span class="nc">Cell</span><span class="p">(</span>
  <span class="kd">val</span> <span class="py">c</span><span class="p">:</span> <span class="nc">Char</span><span class="p">,</span>
  <span class="kd">val</span> <span class="py">pos</span><span class="p">:</span> <span class="nc">Coord</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">Comparable</span><span class="p">&lt;</span><span class="nc">Cell</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nc">Cell</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="py">result</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">result</span> <span class="p">=</span> <span class="n">pos</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="p">}</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">equals</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nc">Any</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="p">===</span> <span class="n">other</span><span class="p">)</span> <span class="k">return</span> <span class="k">true</span>
    <span class="n">other</span> <span class="k">as</span> <span class="nc">Cell</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="p">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">c</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="p">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
    <span class="k">return</span> <span class="k">true</span>
  <span class="p">}</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">hashCode</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">pos</span><span class="p">.</span><span class="nf">hashCode</span><span class="p">()</span> <span class="p">*</span> <span class="n">c</span><span class="p">.</span><span class="nf">hashCode</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="k">fun</span> <span class="nf">actual</span><span class="p">():</span> <span class="nc">Char</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="sc">'S'</span> <span class="p">-&gt;</span> <span class="sc">'a'</span>
    <span class="sc">'E'</span> <span class="p">-&gt;</span> <span class="sc">'z'</span>
    <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">c</span>
  <span class="p">}</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s">"Cell($c, $pos)"</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsing_8">Parsing</h3>
<div class="paragraph">
<p>The parsing of the grid and creating of Cells and Edges will be in one function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">createGrid</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Edge</span><span class="p">&lt;</span><span class="nc">Cell</span><span class="p">&gt;&gt;</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">edges</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Edge</span><span class="p">&lt;</span><span class="nc">Cell</span><span class="p">&gt;&gt;()</span>
  <span class="kd">val</span> <span class="py">cells</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">mapIndexed</span> <span class="p">{</span> <span class="n">y</span><span class="p">,</span> <span class="n">line</span> <span class="p">-&gt;</span>
    <span class="n">line</span><span class="p">.</span><span class="nf">mapIndexed</span> <span class="p">{</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="p">-&gt;</span>
      <span class="nc">Cell</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">input</span><span class="p">.</span><span class="n">lastIndex</span> <span class="p">-</span> <span class="n">y</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="p">}.</span><span class="nf">flatMap</span> <span class="p">{</span> <span class="n">row</span> <span class="p">-&gt;</span> <span class="n">row</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">}</span> <span class="p">}.</span><span class="nf">associateBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">pos</span> <span class="p">}</span>
  <span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">cell</span> <span class="p">-&gt;</span>
    <span class="n">cell</span><span class="p">.</span><span class="n">pos</span><span class="p">.</span><span class="nf">surrounds</span><span class="p">().</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">coord</span> <span class="p">-&gt;</span>
      <span class="kd">val</span> <span class="py">neighbour</span> <span class="p">=</span> <span class="n">cells</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">neighbour</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>  // <b class="conum">(1)</b>
        <span class="kd">val</span> <span class="py">height</span> <span class="p">=</span> <span class="n">neighbour</span><span class="p">.</span><span class="nf">actual</span><span class="p">()</span> <span class="p">-</span> <span class="n">cell</span><span class="p">.</span><span class="nf">actual</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">height</span> <span class="p">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> // <b class="conum">(2)</b>
          <span class="n">edges</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Edge</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">neighbour</span><span class="p">))</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">edges</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>If there is no neighbour at the surrounding coordinates it will be skipped. This will happen for the cells on the edges of the grid.</p>
</li>
<li>
<p>We are interested in cells that are 1 step higher or lower.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_processing_2">Processing</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calculateSteps</span><span class="p">(</span>
  <span class="n">edges</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Edge</span><span class="p">&lt;</span><span class="nc">Cell</span><span class="p">&gt;&gt;,</span>
  <span class="n">start</span><span class="p">:</span> <span class="nc">Cell</span><span class="p">,</span>
  <span class="n">end</span><span class="p">:</span> <span class="nc">Cell</span>
<span class="p">):</span> <span class="nc">Int</span><span class="p">?</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">graph</span> <span class="p">=</span> <span class="nc">Graph</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">graph</span><span class="p">.</span><span class="nf">findPath</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
  <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="k">null</span> <span class="k">else</span> <span class="n">path</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span> <span class="mi">1</span> // <b class="conum">(1)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The path includes the start and end node and we will subtract 1 from the path length to obtain the number of steps. Null is returned for an empty path.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_part_1_8">Part 1</h3>
<div class="paragraph">
<p>In part 1 we had to find the shortest path between <code>S</code> (which is the same as <code>a</code>) and <code>E</code> (which is the same elevation as <code>z</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcSolution1</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">edges</span> <span class="p">=</span> <span class="nf">createGrid</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">end</span> <span class="p">=</span> <span class="n">edges</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">edge</span> <span class="p">-&gt;</span> <span class="n">edge</span><span class="p">.</span><span class="n">c2</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">find</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">c</span> <span class="p">==</span> <span class="sc">'E'</span> <span class="p">}</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find E"</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">start</span> <span class="p">=</span> <span class="n">edges</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">edge</span> <span class="p">-&gt;</span> <span class="n">edge</span><span class="p">.</span><span class="n">c1</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">find</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">c</span> <span class="p">==</span> <span class="sc">'S'</span> <span class="p">}</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find S"</span><span class="p">)</span>
  <span class="k">return</span> <span class="nf">calculateSteps</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find solution from $start to $end"</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_9">Part 2</h3>
<div class="paragraph">
<p>In part 2 we had to find the shortest paths for all cells labelled <code>a</code> and report the shortest of those.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcSolution2</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">edges</span> <span class="p">=</span> <span class="nf">createGrid</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">end</span> <span class="p">=</span> <span class="n">edges</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">edge</span> <span class="p">-&gt;</span> <span class="n">edge</span><span class="p">.</span><span class="n">c2</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">find</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">c</span> <span class="p">==</span> <span class="sc">'E'</span> <span class="p">}</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find E"</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">edges</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">edge</span> <span class="p">-&gt;</span> <span class="n">edge</span><span class="p">.</span><span class="n">c1</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">actual</span><span class="p">()</span> <span class="p">==</span> <span class="sc">'a'</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">start</span> <span class="p">-&gt;</span> <span class="nf">calculateSteps</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">min</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_10">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">day12</span>

<span class="k">import</span> <span class="nn">main.utils.Edge</span>
<span class="k">import</span> <span class="nn">main.utils.Graph</span>
<span class="k">import</span> <span class="nn">main.utils.measureAndPrint</span>
<span class="k">import</span> <span class="nn">utils.Coord</span>
<span class="k">import</span> <span class="nn">utils.readFile</span>
<span class="k">import</span> <span class="nn">utils.readLines</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">val</span> <span class="py">test</span> <span class="p">=</span> <span class="nf">readLines</span><span class="p">(</span>
    <span class="s">"""Sabqponm
abcryxxl
accszExk
acctuvwj
abdefghi"""</span>
  <span class="p">)</span>
  <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day12"</span><span class="p">)</span>

  <span class="kd">data class</span> <span class="nc">Cell</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">c</span><span class="p">:</span> <span class="nc">Char</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">pos</span><span class="p">:</span> <span class="nc">Coord</span>
  <span class="p">)</span> <span class="p">:</span> <span class="nc">Comparable</span><span class="p">&lt;</span><span class="nc">Cell</span><span class="p">&gt;</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nc">Cell</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="py">result</span> <span class="p">=</span> <span class="n">c</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">c</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">result</span> <span class="p">=</span> <span class="n">pos</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">equals</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nc">Any</span><span class="p">?):</span> <span class="nc">Boolean</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="p">===</span> <span class="n">other</span><span class="p">)</span> <span class="k">return</span> <span class="k">true</span>
      <span class="n">other</span> <span class="k">as</span> <span class="nc">Cell</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="p">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">c</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="p">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">pos</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>


      <span class="k">return</span> <span class="k">true</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">hashCode</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">pos</span><span class="p">.</span><span class="nf">hashCode</span><span class="p">()</span> <span class="p">*</span> <span class="n">c</span><span class="p">.</span><span class="nf">hashCode</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">actual</span><span class="p">():</span> <span class="nc">Char</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="sc">'S'</span> <span class="p">-&gt;</span> <span class="sc">'a'</span>
      <span class="sc">'E'</span> <span class="p">-&gt;</span> <span class="sc">'z'</span>
      <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">c</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s">"Cell($c, $pos)"</span>
    <span class="p">}</span>

  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">createGrid</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Edge</span><span class="p">&lt;</span><span class="nc">Cell</span><span class="p">&gt;&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">edges</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">Edge</span><span class="p">&lt;</span><span class="nc">Cell</span><span class="p">&gt;&gt;()</span>
    <span class="kd">val</span> <span class="py">cells</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">mapIndexed</span> <span class="p">{</span> <span class="n">y</span><span class="p">,</span> <span class="n">line</span> <span class="p">-&gt;</span>
      <span class="n">line</span><span class="p">.</span><span class="nf">mapIndexed</span> <span class="p">{</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="p">-&gt;</span>
        <span class="nc">Cell</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">input</span><span class="p">.</span><span class="n">lastIndex</span> <span class="p">-</span> <span class="n">y</span><span class="p">))</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="nf">flatMap</span> <span class="p">{</span> <span class="n">row</span> <span class="p">-&gt;</span> <span class="n">row</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">}</span> <span class="p">}.</span><span class="nf">associateBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">pos</span> <span class="p">}</span>
    <span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">cell</span> <span class="p">-&gt;</span>
      <span class="n">cell</span><span class="p">.</span><span class="n">pos</span><span class="p">.</span><span class="nf">surrounds</span><span class="p">().</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">coord</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">neighbour</span> <span class="p">=</span> <span class="n">cells</span><span class="p">[</span><span class="n">coord</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">neighbour</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">val</span> <span class="py">height</span> <span class="p">=</span> <span class="n">neighbour</span><span class="p">.</span><span class="nf">actual</span><span class="p">()</span> <span class="p">-</span> <span class="n">cell</span><span class="p">.</span><span class="nf">actual</span><span class="p">()</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">height</span> <span class="p">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">edges</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Edge</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">neighbour</span><span class="p">))</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">edges</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calculateSteps</span><span class="p">(</span>
    <span class="n">edges</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Edge</span><span class="p">&lt;</span><span class="nc">Cell</span><span class="p">&gt;&gt;,</span>
    <span class="n">start</span><span class="p">:</span> <span class="nc">Cell</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="nc">Cell</span>
  <span class="p">):</span> <span class="nc">Int</span><span class="p">?</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">graph</span> <span class="p">=</span> <span class="nc">Graph</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">graph</span><span class="p">.</span><span class="nf">findPath</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="k">null</span> <span class="k">else</span> <span class="n">path</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span> <span class="mi">1</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcSolution1</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">edges</span> <span class="p">=</span> <span class="nf">createGrid</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">end</span> <span class="p">=</span> <span class="n">edges</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">edge</span> <span class="p">-&gt;</span> <span class="n">edge</span><span class="p">.</span><span class="n">c2</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">find</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">c</span> <span class="p">==</span> <span class="sc">'E'</span> <span class="p">}</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find E"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">start</span> <span class="p">=</span> <span class="n">edges</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">edge</span> <span class="p">-&gt;</span> <span class="n">edge</span><span class="p">.</span><span class="n">c1</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">find</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">c</span> <span class="p">==</span> <span class="sc">'S'</span> <span class="p">}</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find S"</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">calculateSteps</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
      <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find solution from $start to $end"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcSolution2</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">edges</span> <span class="p">=</span> <span class="nf">createGrid</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">end</span> <span class="p">=</span> <span class="n">edges</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">edge</span> <span class="p">-&gt;</span> <span class="n">edge</span><span class="p">.</span><span class="n">c2</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">find</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">c</span> <span class="p">==</span> <span class="sc">'E'</span> <span class="p">}</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Cannot find E"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">edges</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">edge</span> <span class="p">-&gt;</span> <span class="n">edge</span><span class="p">.</span><span class="n">c1</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">actual</span><span class="p">()</span> <span class="p">==</span> <span class="sc">'a'</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">start</span> <span class="p">-&gt;</span> <span class="nf">calculateSteps</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">min</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">measureAndPrint</span><span class="p">(</span><span class="s">"Part 1 Test Time: "</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">calcSolution1</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">31</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">measureAndPrint</span><span class="p">(</span><span class="s">"Part 1 Time: "</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">calcSolution1</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">339</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">measureAndPrint</span><span class="p">(</span><span class="s">"Part 2 Test Time: "</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">calcSolution2</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">29</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">measureAndPrint</span><span class="p">(</span><span class="s">"Part 2 Time: "</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">calcSolution2</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">332</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nf">println</span><span class="p">(</span><span class="s">"Day - 12"</span><span class="p">)</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-13">Distress Signal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Today&#8217;s puzzle required parsing a data structure with nested elements. My brain fell apart initially.</p>
</div>
<div class="paragraph">
<p>I decided to try a List&lt;Object&gt; where the entry can be an Int or List&lt;Object&gt;
Once this worked I refactored to use an abstract class to represent any packet item, packet value and packet list.</p>
</div>
<div class="paragraph">
<p>Implementing the determination of the order provided some problems until I understood that the packet order is determined once two items aren&#8217;t equal.</p>
</div>
<div class="sect2">
<h3 id="_sample_input">Sample Input</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">[1,1,3,1,1]
[1,1,5,1,1]

[[1],[2,3,4]]
[[1],4]

[9]
[[8,7,6]]

[[4,4],4,4]
[[4,4],4,4,4]

[7,7,7,7]
[7,7,7]

[]
[3]

[[[]]]
[[]]

[1,[2,[3,[4,[5,6,7]]]],8,9]
[1,[2,[3,[4,[5,6,0]]]],8,9]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_model_5">Model</h3>
<div class="paragraph">
<p>The model for Item, Value and Packet below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Item</span>
<span class="kd">data class</span> <span class="nc">Value</span><span class="p">(</span><span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Item</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">fun</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">:</span> <span class="nc">Value</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">value</span><span class="p">.</span><span class="nf">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">data class</span> <span class="nc">Packet</span><span class="p">(</span><span class="kd">val</span> <span class="py">items</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;)</span> <span class="p">:</span> <span class="nc">Item</span><span class="p">(),</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;</span> <span class="k">by</span> <span class="nf">items</span> <span class="p">{</span>
  <span class="k">constructor</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">Item</span><span class="p">)</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="nf">listOf</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="p">{</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsing_9">Parsing</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">parsePacket</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Packet</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">value</span> <span class="p">=</span> <span class="nc">StringBuilder</span><span class="p">()</span>
  <span class="kd">var</span> <span class="py">list</span><span class="p">:</span> <span class="nc">MutableList</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mutableListOf</span><span class="p">()</span>

  <span class="k">fun</span> <span class="nf">checkAdd</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">isNotBlank</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">list</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Value</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">toString</span><span class="p">().</span><span class="nf">toInt</span><span class="p">()))</span>
    <span class="p">}</span>
    <span class="n">value</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
  <span class="p">}</span>
  <span class="kd">val</span> <span class="py">lists</span> <span class="p">=</span> <span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;&gt;()</span>
  <span class="kd">var</span> <span class="py">index</span> <span class="p">=</span> <span class="mi">1</span> <span class="c1">// skip first [</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">index</span> <span class="p">&lt;</span> <span class="n">input</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(</span><span class="kd">val</span> <span class="py">c</span> <span class="p">=</span> <span class="n">input</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="p">{</span>
      <span class="sc">','</span><span class="p">,</span> <span class="sc">' '</span> <span class="p">-&gt;</span> <span class="nf">checkAdd</span><span class="p">()</span>
      <span class="sc">'['</span> <span class="p">-&gt;</span> <span class="p">{</span>
        <span class="n">lists</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
        <span class="n">list</span> <span class="p">=</span> <span class="nf">mutableListOf</span><span class="p">()</span>
      <span class="p">}</span>
      <span class="sc">']'</span> <span class="p">-&gt;</span> <span class="p">{</span>
        <span class="nf">checkAdd</span><span class="p">()</span>
        <span class="kd">val</span> <span class="py">v</span> <span class="p">=</span> <span class="n">list</span>
        <span class="n">list</span> <span class="p">=</span> <span class="n">lists</span><span class="p">.</span><span class="nf">pop</span><span class="p">().</span><span class="nf">toMutableList</span><span class="p">()</span>
        <span class="n">list</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Packet</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
      <span class="p">}</span>
      <span class="sc">'-'</span> <span class="p">-&gt;</span> <span class="n">value</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sc">'-'</span><span class="p">)</span>
      <span class="sc">'+'</span> <span class="p">-&gt;</span> <span class="n">value</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sc">'+'</span><span class="p">)</span>
      <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="nf">isDigit</span><span class="p">())</span> <span class="p">{</span>
          <span class="n">value</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nf">error</span><span class="p">(</span><span class="s">"Unexpected $c"</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">index</span> <span class="p">+=</span> <span class="mi">1</span>
  <span class="p">}</span>
  <span class="nf">checkAdd</span><span class="p">()</span>
  <span class="k">return</span> <span class="nc">Packet</span><span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="nf">toList</span><span class="p">())</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processing_3">Processing</h3>
<div class="paragraph">
<p>We needed comparison functions for the Packet and one for generic Item.
The <code>isOrdered</code> function couldn&#8217;t be part of Item because it references Packet and Value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nc">Packet</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">:</span> <span class="nc">Packet</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="py">result</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="k">in</span> <span class="n">indices</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">item</span> <span class="p">=</span> <span class="k">this</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="kd">val</span> <span class="py">rightItem</span> <span class="p">=</span> <span class="n">right</span><span class="p">.</span><span class="nf">getOrNull</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">result</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
      <span class="n">rightItem</span> <span class="p">==</span> <span class="k">null</span> <span class="p">-&gt;</span> <span class="mi">1</span>
      <span class="n">item</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">&amp;&amp;</span> <span class="n">rightItem</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">rightItem</span><span class="p">)</span>
      <span class="n">item</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">&amp;&amp;</span> <span class="n">rightItem</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="nc">Packet</span><span class="p">(</span><span class="n">rightItem</span><span class="p">))</span>
      <span class="n">item</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">&amp;&amp;</span> <span class="n">rightItem</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">rightItem</span><span class="p">)</span>
      <span class="n">item</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">&amp;&amp;</span> <span class="n">rightItem</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">-&gt;</span> <span class="nc">Packet</span><span class="p">(</span><span class="n">item</span><span class="p">).</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">rightItem</span><span class="p">)</span>
      <span class="k">else</span> <span class="p">-&gt;</span> <span class="mi">1</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">0</span> <span class="p">&amp;&amp;</span> <span class="n">size</span> <span class="p">&lt;</span> <span class="n">right</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">result</span> <span class="p">=</span> <span class="p">-</span><span class="mi">1</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nc">Item</span><span class="p">.</span><span class="nf">isOrdered</span><span class="p">(</span><span class="n">right</span><span class="p">:</span> <span class="nc">Item</span><span class="p">?):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">when</span> <span class="p">{</span>
    <span class="n">right</span> <span class="p">==</span> <span class="k">null</span> <span class="p">-&gt;</span> <span class="mi">1</span>
    <span class="k">this</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">&amp;&amp;</span> <span class="n">right</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">-&gt;</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="k">this</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">&amp;&amp;</span> <span class="n">right</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">-&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="k">this</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">&amp;&amp;</span> <span class="n">right</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">-&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="nc">Packet</span><span class="p">(</span><span class="n">right</span><span class="p">))</span>
    <span class="k">this</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">&amp;&amp;</span> <span class="n">right</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">-&gt;</span> <span class="nc">Packet</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">-&gt;</span> <span class="mi">1</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">isIndexOrdered</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Boolean</span> <span class="p">{</span>
  <span class="nf">check</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">size</span> <span class="p">==</span> <span class="mi">2</span><span class="p">)</span>
  <span class="kd">val</span> <span class="p">(</span><span class="py">left</span><span class="p">,</span> <span class="py">right</span><span class="p">)</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="nf">parsePacket</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
  <span class="kd">var</span> <span class="py">result</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="k">in</span> <span class="n">left</span><span class="p">.</span><span class="n">indices</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">item</span> <span class="p">=</span> <span class="n">left</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="kd">val</span> <span class="py">rightItem</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">&lt;=</span> <span class="n">right</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">)</span> <span class="n">right</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">else</span> <span class="k">null</span>
    <span class="n">result</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="nf">isOrdered</span><span class="p">(</span><span class="n">rightItem</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span> <span class="p">&lt;=</span> <span class="mi">0</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_1_9">Part 1</h3>
<div class="paragraph">
<p>In part 1 we had check every 2 pairs to determine if they are in the right order and then report the sum of the indexes of those pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcSolution1</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">input</span><span class="p">.</span><span class="nf">mapIndexedNotNull</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">inputs</span> <span class="p">-&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">isIndexOrdered</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">inputs</span><span class="p">))</span> <span class="n">index</span> <span class="p">+</span> <span class="mi">1</span> <span class="k">else</span> <span class="k">null</span>
  <span class="p">}.</span><span class="nf">sum</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_10">Part 2</h3>
<div class="paragraph">
<p>In part 2 we had to treat all the packets as one list and add 2 more with the values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">"[[2]]"
"[[6]]"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we had to sort the packets using the ordering rules from part 1.
We need to find the indexes of the 2 additional packets and print the product.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcSolution2</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">extra1</span> <span class="p">=</span> <span class="s">"[[2]]"</span>
  <span class="kd">val</span> <span class="py">extra2</span> <span class="p">=</span> <span class="s">"[[6]]"</span>
  <span class="kd">val</span> <span class="py">packets</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">isNotBlank</span><span class="p">()</span> <span class="p">}.</span><span class="nf">toMutableList</span><span class="p">()</span>
  <span class="n">packets</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">extra1</span><span class="p">)</span>
  <span class="n">packets</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">extra2</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">sorted</span> <span class="p">=</span> <span class="n">packets</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span> <span class="n">to</span> <span class="nf">parsePacket</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">sortedWith</span> <span class="p">{</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span> <span class="p">-&gt;</span> <span class="n">o1</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">o2</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">first</span> <span class="p">}</span>
  <span class="kd">val</span> <span class="py">index1</span> <span class="p">=</span> <span class="n">sorted</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="n">extra1</span><span class="p">)</span> <span class="p">+</span> <span class="mi">1</span>
  <span class="kd">val</span> <span class="py">index2</span> <span class="p">=</span> <span class="n">sorted</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="n">extra2</span><span class="p">)</span> <span class="p">+</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">index1</span> <span class="p">*</span> <span class="n">index2</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_11">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">day13</span>

<span class="k">import</span> <span class="nn">utils.groupLines</span>
<span class="k">import</span> <span class="nn">utils.readFile</span>
<span class="k">import</span> <span class="nn">utils.readLines</span>
<span class="k">import</span> <span class="nn">utils.separator</span>
<span class="k">import</span> <span class="nn">java.util.*</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">test</span> <span class="p">=</span> <span class="nf">readLines</span><span class="p">(</span>
    <span class="s">"""[1,1,3,1,1]
       [1,1,5,1,1]
      
       [[1],[2,3,4]]
       [[1],4]
      
       [9]
       [[8,7,6]]
      
       [[4,4],4,4]
       [[4,4],4,4,4]
      
       [7,7,7,7]
       [7,7,7]
      
       []
       [3]
      
       [[[]]]
       [[]]
      
       [1,[2,[3,[4,[5,6,7]]]],8,9]
       [1,[2,[3,[4,[5,6,0]]]],8,9]
       """</span><span class="p">.</span><span class="nf">trimIndent</span><span class="p">()</span>
  <span class="p">)</span>
  <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day13"</span><span class="p">)</span>

  <span class="k">abstract</span> <span class="kd">class</span> <span class="nc">Item</span>
  <span class="kd">data class</span> <span class="nc">Value</span><span class="p">(</span><span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Item</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">:</span> <span class="nc">Value</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">value</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">value</span><span class="p">.</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">data class</span> <span class="nc">Packet</span><span class="p">(</span><span class="kd">val</span> <span class="py">items</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;)</span> <span class="p">:</span> <span class="nc">Item</span><span class="p">(),</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;</span> <span class="k">by</span> <span class="nf">items</span> <span class="p">{</span>
    <span class="k">constructor</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">Item</span><span class="p">)</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="nf">listOf</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="p">{}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">parsePacket</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Packet</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">value</span> <span class="p">=</span> <span class="nc">StringBuilder</span><span class="p">()</span>
    <span class="kd">var</span> <span class="py">list</span><span class="p">:</span> <span class="nc">MutableList</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mutableListOf</span><span class="p">()</span>

    <span class="k">fun</span> <span class="nf">checkAdd</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">isNotBlank</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">list</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Value</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">toString</span><span class="p">().</span><span class="nf">toInt</span><span class="p">()))</span>
      <span class="p">}</span>
      <span class="n">value</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">lists</span> <span class="p">=</span> <span class="nc">Stack</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">Item</span><span class="p">&gt;&gt;()</span>
    <span class="kd">var</span> <span class="py">index</span> <span class="p">=</span> <span class="mi">1</span> <span class="c1">// skip first [</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">index</span> <span class="p">&lt;</span> <span class="n">input</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">when</span> <span class="p">(</span><span class="kd">val</span> <span class="py">c</span> <span class="p">=</span> <span class="n">input</span><span class="p">[</span><span class="n">index</span><span class="p">])</span> <span class="p">{</span>
        <span class="sc">','</span><span class="p">,</span> <span class="sc">' '</span> <span class="p">-&gt;</span> <span class="nf">checkAdd</span><span class="p">()</span>
        <span class="sc">'['</span> <span class="p">-&gt;</span> <span class="p">{</span>
          <span class="n">lists</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
          <span class="n">list</span> <span class="p">=</span> <span class="nf">mutableListOf</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="sc">']'</span> <span class="p">-&gt;</span> <span class="p">{</span>
          <span class="nf">checkAdd</span><span class="p">()</span>
          <span class="kd">val</span> <span class="py">v</span> <span class="p">=</span> <span class="n">list</span>
          <span class="n">list</span> <span class="p">=</span> <span class="n">lists</span><span class="p">.</span><span class="nf">pop</span><span class="p">().</span><span class="nf">toMutableList</span><span class="p">()</span>
          <span class="n">list</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="nc">Packet</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="sc">'-'</span> <span class="p">-&gt;</span> <span class="n">value</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sc">'-'</span><span class="p">)</span>
        <span class="sc">'+'</span> <span class="p">-&gt;</span> <span class="n">value</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sc">'+'</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="nf">isDigit</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">value</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">error</span><span class="p">(</span><span class="s">"Unexpected $c"</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="n">index</span> <span class="p">+=</span> <span class="mi">1</span>
    <span class="p">}</span>
    <span class="nf">checkAdd</span><span class="p">()</span>
    <span class="k">return</span> <span class="nc">Packet</span><span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="nf">toList</span><span class="p">())</span>
  <span class="p">}</span>


  <span class="k">fun</span> <span class="nc">Packet</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">:</span> <span class="nc">Packet</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="py">result</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="k">in</span> <span class="n">indices</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">item</span> <span class="p">=</span> <span class="k">this</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
      <span class="kd">val</span> <span class="py">rightItem</span> <span class="p">=</span> <span class="n">right</span><span class="p">.</span><span class="nf">getOrNull</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
      <span class="n">result</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
        <span class="n">rightItem</span> <span class="p">==</span> <span class="k">null</span> <span class="p">-&gt;</span> <span class="mi">1</span>
        <span class="n">item</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">&amp;&amp;</span> <span class="n">rightItem</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">rightItem</span><span class="p">)</span>
        <span class="n">item</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">&amp;&amp;</span> <span class="n">rightItem</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="nc">Packet</span><span class="p">(</span><span class="n">rightItem</span><span class="p">))</span>
        <span class="n">item</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">&amp;&amp;</span> <span class="n">rightItem</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">rightItem</span><span class="p">)</span>
        <span class="n">item</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">&amp;&amp;</span> <span class="n">rightItem</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">-&gt;</span> <span class="nc">Packet</span><span class="p">(</span><span class="n">item</span><span class="p">).</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">rightItem</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="mi">1</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">0</span> <span class="p">&amp;&amp;</span> <span class="n">size</span> <span class="p">&lt;</span> <span class="n">right</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">result</span> <span class="p">=</span> <span class="p">-</span><span class="mi">1</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nc">Item</span><span class="p">.</span><span class="nf">isOrdered</span><span class="p">(</span><span class="n">right</span><span class="p">:</span> <span class="nc">Item</span><span class="p">?):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">when</span> <span class="p">{</span>
      <span class="n">right</span> <span class="p">==</span> <span class="k">null</span> <span class="p">-&gt;</span> <span class="mi">1</span>
      <span class="k">this</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">&amp;&amp;</span> <span class="n">right</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">-&gt;</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
      <span class="k">this</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">&amp;&amp;</span> <span class="n">right</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">-&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
      <span class="k">this</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">&amp;&amp;</span> <span class="n">right</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">-&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="nc">Packet</span><span class="p">(</span><span class="n">right</span><span class="p">))</span>
      <span class="k">this</span> <span class="k">is</span> <span class="nc">Value</span> <span class="p">&amp;&amp;</span> <span class="n">right</span> <span class="k">is</span> <span class="nc">Packet</span> <span class="p">-&gt;</span> <span class="nc">Packet</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
      <span class="k">else</span> <span class="p">-&gt;</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">isIndexOrdered</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span> <span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="n">size</span> <span class="p">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="kd">val</span> <span class="p">(</span><span class="py">left</span><span class="p">,</span> <span class="py">right</span><span class="p">)</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="nf">parsePacket</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
    <span class="kd">var</span> <span class="py">result</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="k">in</span> <span class="n">left</span><span class="p">.</span><span class="n">indices</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">item</span> <span class="p">=</span> <span class="n">left</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
      <span class="kd">val</span> <span class="py">rightItem</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">&lt;=</span> <span class="n">right</span><span class="p">.</span><span class="n">lastIndex</span><span class="p">)</span>
        <span class="n">right</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">else</span> <span class="k">null</span>
      <span class="n">result</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="nf">isOrdered</span><span class="p">(</span><span class="n">rightItem</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">val</span> <span class="py">ordered</span> <span class="p">=</span> <span class="n">result</span> <span class="p">&lt;=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">println</span><span class="p">(</span><span class="s">"Pair $index: was the same"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="p">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">println</span><span class="p">(</span><span class="s">"Pair $index: left was lower"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ordered</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcSolution1</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">input</span><span class="p">.</span><span class="nf">mapIndexedNotNull</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">inputs</span> <span class="p">-&gt;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nf">isIndexOrdered</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">inputs</span><span class="p">))</span> <span class="n">index</span> <span class="p">+</span> <span class="mi">1</span> <span class="k">else</span> <span class="k">null</span>
    <span class="p">}.</span><span class="nf">sum</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcSolution2</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">extra1</span> <span class="p">=</span> <span class="s">"[[2]]"</span>
    <span class="kd">val</span> <span class="py">extra2</span> <span class="p">=</span> <span class="s">"[[6]]"</span>
    <span class="kd">val</span> <span class="py">packets</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">isNotBlank</span><span class="p">()</span> <span class="p">}.</span><span class="nf">toMutableList</span><span class="p">()</span>
    <span class="n">packets</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">extra1</span><span class="p">)</span>
    <span class="n">packets</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">extra2</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">sorted</span> <span class="p">=</span> <span class="n">packets</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span> <span class="n">to</span> <span class="nf">parsePacket</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">sortedWith</span> <span class="p">{</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span> <span class="p">-&gt;</span> <span class="n">o1</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">o2</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="p">}</span>
      <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">first</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">index1</span> <span class="p">=</span> <span class="n">sorted</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="n">extra1</span><span class="p">)</span> <span class="p">+</span> <span class="mi">1</span>
    <span class="kd">val</span> <span class="py">index2</span> <span class="p">=</span> <span class="n">sorted</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="n">extra2</span><span class="p">)</span> <span class="p">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">index1</span> <span class="p">*</span> <span class="n">index2</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcSolution1</span><span class="p">(</span><span class="nf">groupLines</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Test Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">13</span><span class="p">)</span>
    <span class="nf">separator</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcSolution1</span><span class="p">(</span><span class="nf">groupLines</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">4643</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcSolution2</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Test Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">140</span><span class="p">)</span>
    <span class="nf">separator</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">calcSolution2</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">21614</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nf">println</span><span class="p">(</span><span class="s">"Day - 13"</span><span class="p">)</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">separator</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-14">Regolith Reservoir</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Today we had to use the input data to represent a cave system and model sand falling into the cave.</p>
</div>
<div class="paragraph">
<p>In the first part there is a point where the sand falls over the edge and it means all the sand falls down that abyss. So you needed to detect and out of boundary condition.</p>
</div>
<div class="sect2">
<h3 id="_sample_input_2">Sample Input</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">498,4 -&gt; 498,6 -&gt; 496,6
503,4 -&gt; 502,4 -&gt; 502,9 -&gt; 494,9</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_model_6">Model</h3>
<div class="paragraph">
<p>The model of the cave is a grid with a map of coordinates and the substance found their, like rock, sand or air.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">open</span> <span class="kd">class</span> <span class="nc">Grid</span><span class="p">(</span>
<span class="kd">val</span> <span class="py">cells</span><span class="p">:</span> <span class="nc">MutableMap</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mutableMapOf</span><span class="p">()</span>
<span class="p">):</span> <span class="nc">MutableMap</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">&gt;</span> <span class="k">by</span> <span class="nf">cells</span> <span class="p">{</span>
  <span class="k">open</span> <span class="kd">val</span> <span class="py">maxX</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">cells</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="nf">maxOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">x</span> <span class="p">}</span>
  <span class="k">open</span> <span class="kd">val</span> <span class="py">minX</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">cells</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="nf">minOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">x</span> <span class="p">}</span>
  <span class="k">open</span> <span class="kd">val</span> <span class="py">maxY</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">cells</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="nf">maxOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">y</span> <span class="p">}</span>
  <span class="k">open</span> <span class="kd">val</span> <span class="py">minY</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="k">fun</span> <span class="nf">countSand</span><span class="p">()</span> <span class="p">=</span> <span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">count</span> <span class="p">{</span> <span class="n">it</span> <span class="p">==</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">SAND</span> <span class="p">}</span>
  <span class="k">open</span> <span class="k">fun</span> <span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="k">in</span> <span class="n">minX</span><span class="o">..</span><span class="n">maxX</span>
        <span class="p">&amp;&amp;</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="k">in</span> <span class="n">minY</span><span class="o">..</span><span class="n">maxY</span>

  <span class="k">fun</span> <span class="nf">getSubStance</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">)</span> <span class="p">=</span> <span class="nf">getOrDefault</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">AIR</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">isAir</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">)</span> <span class="p">=</span> <span class="nf">getSubStance</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="p">==</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">AIR</span>
  <span class="k">fun</span> <span class="nf">isTarget</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">)</span> <span class="p">=</span> <span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="nf">isAir</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
  <span class="k">fun</span> <span class="nf">canDrop</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">):</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Direction</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">left</span><span class="p">())</span> <span class="p">||</span> <span class="p">!</span><span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">right</span><span class="p">()))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">ABYSS</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">()))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nf">isTarget</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">()))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">canDrop</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">())</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">isTarget</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">().</span><span class="nf">left</span><span class="p">()))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nf">canDrop</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">().</span><span class="nf">left</span><span class="p">())</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nf">isTarget</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">().</span><span class="nf">right</span><span class="p">()))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nf">canDrop</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">().</span><span class="nf">right</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">isTarget</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">DOWN</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">STOP</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parsing_10">Parsing</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">loadStructure</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Grid</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">grid</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">&gt;()</span>
  <span class="n">lines</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span>
    <span class="n">it</span><span class="p">.</span><span class="nf">scanInts</span><span class="p">()</span>
      <span class="p">.</span><span class="nf">windowed</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">line</span> <span class="p">-&gt;</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">}</span>
  <span class="p">}.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">scan</span> <span class="p">-&gt;</span>
    <span class="n">scan</span><span class="p">.</span><span class="nf">windowed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">pair</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">prev</span> <span class="p">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="kd">val</span> <span class="py">curr</span> <span class="p">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="kd">val</span> <span class="py">diff</span> <span class="p">=</span> <span class="n">curr</span> <span class="p">-</span> <span class="n">prev</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">diff</span><span class="p">.</span><span class="n">y</span> <span class="p">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="nf">min</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">prev</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">..</span><span class="nf">max</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">prev</span><span class="p">.</span><span class="n">x</span><span class="p">))</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">pos</span> <span class="p">=</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">curr</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">grid</span><span class="p">.</span><span class="nf">containsKey</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="p">{</span>
              <span class="n">grid</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="p">=</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">ROCK</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="k">in</span> <span class="nf">min</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">..</span><span class="nf">max</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">.</span><span class="n">y</span><span class="p">))</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">pos</span> <span class="p">=</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">grid</span><span class="p">.</span><span class="nf">containsKey</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="p">{</span>
              <span class="n">grid</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="p">=</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">ROCK</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nc">Grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processing_4">Processing</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">isStop</span><span class="p">(</span><span class="n">direction</span><span class="p">:</span> <span class="nc">Direction</span><span class="p">)</span> <span class="p">=</span> <span class="n">direction</span> <span class="p">==</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">STOP</span>
    <span class="p">||</span> <span class="n">direction</span> <span class="p">==</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">NONE</span>
    <span class="p">||</span> <span class="n">direction</span> <span class="p">==</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">ABYSS</span>
<span class="k">fun</span> <span class="nf">dropSand</span><span class="p">(</span><span class="n">grid</span><span class="p">:</span> <span class="nc">Grid</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">):</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Boolean</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">drop</span> <span class="p">=</span> <span class="n">grid</span><span class="p">.</span><span class="nf">canDrop</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">drop</span><span class="p">.</span><span class="n">second</span> <span class="p">==</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">ABYSS</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">drop</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">drop</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="p">!</span><span class="nf">isStop</span><span class="p">(</span><span class="n">drop</span><span class="p">.</span><span class="n">second</span><span class="p">))</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">simulateSand</span><span class="p">(</span><span class="n">grid</span><span class="p">:</span> <span class="nc">Grid</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">,</span> <span class="n">print</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">dropSand</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">grid</span><span class="p">[</span><span class="n">result</span><span class="p">.</span><span class="n">first</span><span class="p">]</span> <span class="p">=</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">SAND</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">second</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">grid</span><span class="p">.</span><span class="nf">countSand</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_1_10">Part 1</h3>
<div class="paragraph">
<p>Part 1 involved simulating the sand while determining the boundary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">fun</span> <span class="nf">calcSand</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">print</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">grid</span> <span class="p">=</span> <span class="nf">loadStructure</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">entry</span> <span class="p">=</span> <span class="nc">Coord</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="nf">simulateSand</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">print</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">grid</span><span class="p">.</span><span class="nf">countSand</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_11">Part 2</h3>
<div class="paragraph">
<p>Part 2 provided for an infinite floor and I overloaded the grid to provide for a different boundary condition and the floor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">class</span> <span class="nc">InfiniteGird</span><span class="p">(</span>
<span class="n">cells</span><span class="p">:</span> <span class="nc">MutableMap</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">&gt;,</span>
<span class="kd">val</span> <span class="py">level</span><span class="p">:</span> <span class="nc">Int</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">Grid</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">override</span> <span class="kd">val</span> <span class="py">maxY</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">level</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">):</span> <span class="nc">Substance</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">y</span> <span class="p">==</span> <span class="n">level</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">ROCK</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">getOrDefault</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">:</span> <span class="nc">Substance</span><span class="p">):</span> <span class="nc">Substance</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">y</span> <span class="p">==</span> <span class="n">level</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">ROCK</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="nf">getOrDefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">override</span> <span class="k">fun</span> <span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="p">&lt;=</span> <span class="n">level</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">calcInfiniteSand</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">print</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">grid</span> <span class="p">=</span> <span class="nf">loadStructure</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">entry</span> <span class="p">=</span> <span class="nc">Coord</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="kd">val</span> <span class="py">infiniteGrid</span> <span class="p">=</span> <span class="nc">InfiniteGird</span><span class="p">(</span><span class="n">grid</span><span class="p">.</span><span class="nf">toMutableMap</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">maxY</span> <span class="p">+</span> <span class="mi">2</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">print</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">grid</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">infiniteGrid</span><span class="p">.</span><span class="nf">stretch</span><span class="p">()</span>
  <span class="kd">val</span> <span class="py">sand</span> <span class="p">=</span> <span class="nf">simulateSand</span><span class="p">(</span><span class="n">infiniteGrid</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">print</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">print</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">infiniteGrid</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">sand</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_full_source_12">Full source</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">package</span> <span class="nn">day14</span>

<span class="k">import</span> <span class="nn">main.utils.measureAndPrint</span>
<span class="k">import</span> <span class="nn">main.utils.scanInts</span>
<span class="k">import</span> <span class="nn">utils.Coord</span>
<span class="k">import</span> <span class="nn">utils.readFile</span>
<span class="k">import</span> <span class="nn">utils.readLines</span>
<span class="k">import</span> <span class="nn">utils.separator</span>
<span class="k">import</span> <span class="nn">kotlin.math.max</span>
<span class="k">import</span> <span class="nn">kotlin.math.min</span>

<span class="k">enum</span> <span class="kd">class</span> <span class="nc">Substance</span><span class="p">(</span><span class="kd">val</span> <span class="py">c</span><span class="p">:</span> <span class="nc">Char</span><span class="p">)</span> <span class="p">{</span>
  <span class="nc">AIR</span><span class="p">(</span><span class="sc">'.'</span><span class="p">),</span>
  <span class="nc">ROCK</span><span class="p">(</span><span class="sc">'#'</span><span class="p">),</span>
  <span class="nc">SAND</span><span class="p">(</span><span class="sc">'o'</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="kd">class</span> <span class="nc">Direction</span> <span class="p">{</span>
  <span class="nc">STOP</span><span class="p">,</span>
  <span class="nc">NONE</span><span class="p">,</span>
  <span class="nc">DOWN</span><span class="p">,</span>
  <span class="nc">LEFT</span><span class="p">,</span>
  <span class="nc">RIGHT</span><span class="p">,</span>
  <span class="nc">ABYSS</span>
<span class="p">}</span>

<span class="kd">object</span> <span class="nc">Depth</span> <span class="p">{</span>
  <span class="k">private</span> <span class="kd">val</span> <span class="py">depth</span> <span class="p">=</span> <span class="nc">ThreadLocal</span><span class="p">.</span><span class="nf">withInitial</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">}</span>
  <span class="kd">var</span> <span class="py">maxDepth</span> <span class="p">=</span> <span class="mi">0</span>
  <span class="k">fun</span> <span class="nf">enter</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">depth</span><span class="p">.</span><span class="k">set</span><span class="p">(</span><span class="n">depth</span><span class="p">.</span><span class="k">get</span><span class="p">()</span> <span class="p">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">maxDepth</span> <span class="p">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">maxDepth</span><span class="p">,</span> <span class="n">depth</span><span class="p">.</span><span class="k">get</span><span class="p">())</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">exit</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">depth</span><span class="p">.</span><span class="k">set</span><span class="p">(</span><span class="n">depth</span><span class="p">.</span><span class="k">get</span><span class="p">()</span> <span class="p">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">val</span> <span class="py">test</span> <span class="p">=</span> <span class="nf">readLines</span><span class="p">(</span>
    <span class="s">"""498,4 -&gt; 498,6 -&gt; 496,6
503,4 -&gt; 502,4 -&gt; 502,9 -&gt; 494,9"""</span>
  <span class="p">)</span>
  <span class="kd">val</span> <span class="py">input</span> <span class="p">=</span> <span class="nf">readFile</span><span class="p">(</span><span class="s">"day14"</span><span class="p">)</span>

  <span class="k">open</span> <span class="kd">class</span> <span class="nc">Grid</span><span class="p">(</span><span class="kd">val</span> <span class="py">cells</span><span class="p">:</span> <span class="nc">MutableMap</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mutableMapOf</span><span class="p">())</span> <span class="p">:</span> <span class="nc">MutableMap</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">&gt;</span> <span class="k">by</span> <span class="nf">cells</span> <span class="p">{</span>
    <span class="k">open</span> <span class="kd">val</span> <span class="py">maxX</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">cells</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="nf">maxOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">x</span> <span class="p">}</span>
    <span class="k">open</span> <span class="kd">val</span> <span class="py">minX</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">cells</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="nf">minOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">x</span> <span class="p">}</span>
    <span class="k">open</span> <span class="kd">val</span> <span class="py">maxY</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">cells</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="nf">maxOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">y</span> <span class="p">}</span>
    <span class="k">open</span> <span class="kd">val</span> <span class="py">minY</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="k">open</span> <span class="k">fun</span> <span class="nf">stretch</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">fun</span> <span class="nf">countSand</span><span class="p">()</span> <span class="p">=</span> <span class="n">cells</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">count</span> <span class="p">{</span> <span class="n">it</span> <span class="p">==</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">SAND</span> <span class="p">}</span>
    <span class="k">open</span> <span class="k">fun</span> <span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="k">in</span> <span class="n">minX</span><span class="o">..</span><span class="n">maxX</span>
        <span class="p">&amp;&amp;</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="k">in</span> <span class="n">minY</span><span class="o">..</span><span class="n">maxY</span>

    <span class="k">fun</span> <span class="nf">getSubStance</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">)</span> <span class="p">=</span> <span class="nf">getOrDefault</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">AIR</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">isAir</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">)</span> <span class="p">=</span> <span class="nf">getSubStance</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="p">==</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">AIR</span>
    <span class="k">fun</span> <span class="nf">isTarget</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">)</span> <span class="p">=</span> <span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="nf">isAir</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">canDrop</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">):</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Direction</span><span class="p">&gt;</span> <span class="p">{</span>
      <span class="nc">Depth</span><span class="p">.</span><span class="nf">enter</span><span class="p">()</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">left</span><span class="p">())</span> <span class="p">||</span> <span class="p">!</span><span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">right</span><span class="p">()))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">ABYSS</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">()))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nf">isTarget</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">()))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">canDrop</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">())</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nf">isTarget</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">().</span><span class="nf">left</span><span class="p">()))</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nf">canDrop</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">().</span><span class="nf">left</span><span class="p">())</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nf">isTarget</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">().</span><span class="nf">right</span><span class="p">()))</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nf">canDrop</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">bottom</span><span class="p">().</span><span class="nf">right</span><span class="p">())</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nf">isTarget</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">DOWN</span><span class="p">)</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">STOP</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
        <span class="nc">Depth</span><span class="p">.</span><span class="nf">exit</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">print</span><span class="p">(</span><span class="n">entry</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">?)</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">zX</span> <span class="p">=</span> <span class="n">maxX</span>
      <span class="kd">val</span> <span class="py">aX</span> <span class="p">=</span> <span class="n">minX</span>
      <span class="kd">val</span> <span class="py">zY</span> <span class="p">=</span> <span class="n">maxY</span>
      <span class="kd">val</span> <span class="py">aY</span> <span class="p">=</span> <span class="n">minY</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="k">in</span> <span class="n">aY</span><span class="o">..</span><span class="n">zY</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="n">aX</span><span class="o">..</span><span class="n">zX</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">val</span> <span class="py">pos</span> <span class="p">=</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">entry</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">pos</span> <span class="p">==</span> <span class="n">entry</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="sc">'+'</span><span class="p">)</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="nf">getOrDefault</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">AIR</span><span class="p">).</span><span class="n">c</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="nf">println</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">class</span> <span class="nc">InfiniteGird</span><span class="p">(</span><span class="n">cells</span><span class="p">:</span> <span class="nc">MutableMap</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">&gt;,</span> <span class="kd">val</span> <span class="py">level</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Grid</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">val</span> <span class="py">maxY</span><span class="p">:</span> <span class="nc">Int</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">level</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">get</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">):</span> <span class="nc">Substance</span><span class="p">?</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">y</span> <span class="p">==</span> <span class="n">level</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">ROCK</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">getOrDefault</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">:</span> <span class="nc">Substance</span><span class="p">):</span> <span class="nc">Substance</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">y</span> <span class="p">==</span> <span class="n">level</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">ROCK</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="nf">getOrDefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">defaultValue</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">isInGrid</span><span class="p">(</span><span class="n">pos</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="p">&lt;=</span> <span class="n">level</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">stretch</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">zX</span> <span class="p">=</span> <span class="p">(</span><span class="n">cells</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">y</span> <span class="p">&lt;</span> <span class="n">level</span> <span class="p">}.</span><span class="nf">maxOfOrNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">x</span> <span class="p">}</span> <span class="o">?:</span> <span class="n">maxX</span><span class="p">)</span> <span class="p">+</span> <span class="mi">1</span>
      <span class="kd">val</span> <span class="py">aX</span> <span class="p">=</span> <span class="p">(</span><span class="n">cells</span><span class="p">.</span><span class="n">keys</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">y</span> <span class="p">&lt;</span> <span class="n">level</span> <span class="p">}.</span><span class="nf">minOfOrNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">x</span> <span class="p">}</span> <span class="o">?:</span> <span class="n">minX</span><span class="p">)</span> <span class="p">-</span> <span class="mi">1</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="n">aX</span><span class="o">..</span><span class="n">zX</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">pos</span> <span class="p">=</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(!</span><span class="nf">containsKey</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">cells</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="p">=</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">ROCK</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">loadStructure</span><span class="p">(</span><span class="n">lines</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Grid</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">grid</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Substance</span><span class="p">&gt;()</span>
    <span class="kd">val</span> <span class="py">scans</span> <span class="p">=</span> <span class="n">lines</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span>
      <span class="n">it</span><span class="p">.</span><span class="nf">scanInts</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">windowed</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">line</span> <span class="p">-&gt;</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">scans</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">scan</span> <span class="p">-&gt;</span>
      <span class="n">scan</span><span class="p">.</span><span class="nf">windowed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">pair</span> <span class="p">-&gt;</span>
          <span class="nf">check</span><span class="p">(</span><span class="n">pair</span><span class="p">.</span><span class="n">size</span> <span class="p">==</span> <span class="mi">2</span><span class="p">)</span>
          <span class="kd">val</span> <span class="py">prev</span> <span class="p">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="kd">val</span> <span class="py">curr</span> <span class="p">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="kd">val</span> <span class="py">diff</span> <span class="p">=</span> <span class="n">curr</span> <span class="p">-</span> <span class="n">prev</span>
          <span class="nf">check</span><span class="p">((</span><span class="n">diff</span><span class="p">.</span><span class="n">x</span> <span class="p">==</span> <span class="mi">0</span> <span class="p">&amp;&amp;</span> <span class="n">diff</span><span class="p">.</span><span class="n">y</span> <span class="p">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="n">diff</span><span class="p">.</span><span class="n">x</span> <span class="p">!=</span> <span class="mi">0</span> <span class="p">&amp;&amp;</span> <span class="n">diff</span><span class="p">.</span><span class="n">y</span> <span class="p">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span> <span class="s">"Expected one 0 in $diff"</span> <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">diff</span><span class="p">.</span><span class="n">y</span> <span class="p">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="k">in</span> <span class="nf">min</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">prev</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="o">..</span><span class="nf">max</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">prev</span><span class="p">.</span><span class="n">x</span><span class="p">))</span> <span class="p">{</span>
              <span class="kd">val</span> <span class="py">pos</span> <span class="p">=</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">curr</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
              <span class="k">if</span> <span class="p">(!</span><span class="n">grid</span><span class="p">.</span><span class="nf">containsKey</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="p">=</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">ROCK</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="k">in</span> <span class="nf">min</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="o">..</span><span class="nf">max</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">prev</span><span class="p">.</span><span class="n">y</span><span class="p">))</span> <span class="p">{</span>
              <span class="kd">val</span> <span class="py">pos</span> <span class="p">=</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">curr</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
              <span class="k">if</span> <span class="p">(!</span><span class="n">grid</span><span class="p">.</span><span class="nf">containsKey</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="p">=</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">ROCK</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nc">Grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">isStop</span><span class="p">(</span><span class="n">direction</span><span class="p">:</span> <span class="nc">Direction</span><span class="p">)</span> <span class="p">=</span> <span class="n">direction</span> <span class="p">==</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">STOP</span>
      <span class="p">||</span> <span class="n">direction</span> <span class="p">==</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">NONE</span>
      <span class="p">||</span> <span class="n">direction</span> <span class="p">==</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">ABYSS</span>

  <span class="k">fun</span> <span class="nf">dropSand</span><span class="p">(</span><span class="n">grid</span><span class="p">:</span> <span class="nc">Grid</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">):</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Coord</span><span class="p">,</span> <span class="nc">Boolean</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">drop</span> <span class="p">=</span> <span class="n">grid</span><span class="p">.</span><span class="nf">canDrop</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">drop</span><span class="p">.</span><span class="n">second</span> <span class="p">==</span> <span class="nc">Direction</span><span class="p">.</span><span class="nc">ABYSS</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">drop</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nc">Pair</span><span class="p">(</span><span class="n">drop</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="p">!</span><span class="nf">isStop</span><span class="p">(</span><span class="n">drop</span><span class="p">.</span><span class="n">second</span><span class="p">))</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">simulateSand</span><span class="p">(</span><span class="n">grid</span><span class="p">:</span> <span class="nc">Grid</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nc">Coord</span><span class="p">,</span> <span class="n">print</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="k">do</span> <span class="p">{</span>
      <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">dropSand</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">grid</span><span class="p">[</span><span class="n">result</span><span class="p">.</span><span class="n">first</span><span class="p">]</span> <span class="p">=</span> <span class="nc">Substance</span><span class="p">.</span><span class="nc">SAND</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">second</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grid</span><span class="p">.</span><span class="nf">countSand</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcSand</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">print</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">grid</span> <span class="p">=</span> <span class="nf">loadStructure</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">entry</span> <span class="p">=</span> <span class="nc">Coord</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">print</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">grid</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">simulateSand</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">print</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">print</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">grid</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">grid</span><span class="p">.</span><span class="nf">countSand</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">calcInfiniteSand</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span> <span class="n">print</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">grid</span> <span class="p">=</span> <span class="nf">loadStructure</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">entry</span> <span class="p">=</span> <span class="nc">Coord</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">infiniteGrid</span> <span class="p">=</span> <span class="nc">InfiniteGird</span><span class="p">(</span><span class="n">grid</span><span class="p">.</span><span class="nf">toMutableMap</span><span class="p">(),</span> <span class="n">grid</span><span class="p">.</span><span class="n">maxY</span> <span class="p">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">print</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">grid</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">infiniteGrid</span><span class="p">.</span><span class="nf">stretch</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">sand</span> <span class="p">=</span> <span class="nf">simulateSand</span><span class="p">(</span><span class="n">infiniteGrid</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">print</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">print</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">infiniteGrid</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">sand</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part1</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcSand</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Test Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">24</span><span class="p">)</span> <span class="p">{</span> <span class="s">"Expected 24 not $testResult"</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">measureAndPrint</span><span class="p">(</span><span class="s">"Test 1 Time: "</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">calcSand</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 1 Answer = $result"</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">fun</span> <span class="nf">part2</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">testResult</span> <span class="p">=</span> <span class="nf">calcInfiniteSand</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Test Answer = $testResult"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">testResult</span> <span class="p">==</span> <span class="mi">93</span><span class="p">)</span> <span class="p">{</span> <span class="s">"Expected 93 not $testResult"</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nf">measureAndPrint</span><span class="p">(</span><span class="s">"Test 2 Time: "</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">calcInfiniteSand</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Part 2 Answer = $result"</span><span class="p">)</span>
    <span class="nf">check</span><span class="p">(</span><span class="n">result</span> <span class="p">==</span> <span class="mi">22499</span><span class="p">)</span> <span class="p">{</span> <span class="s">"Expected 22499 not $result"</span> <span class="p">}</span>
  <span class="p">}</span>
  <span class="nf">println</span><span class="p">(</span><span class="s">"Day - 14"</span><span class="p">)</span>
  <span class="nf">part1</span><span class="p">()</span>
  <span class="nf">part2</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-11-17 23:12:30 UTC
</div>
</div>
</body>
</html>