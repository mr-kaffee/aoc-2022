<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Solutions by mr-kaffee</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body id="top" class="article toc2 toc-right">
<div id="header">
<h1>Solutions by mr-kaffee</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#sol-0">Day 00: Hello World!</a>
<ul class="sectlevel2">
<li><a href="#_general_structure">General structure</a></li>
</ul>
</li>
<li><a href="#sol-1">Day 1: Calorie Counting</a>
<ul class="sectlevel2">
<li><a href="#_input">Input</a></li>
<li><a href="#_star_1">Star 1</a></li>
<li><a href="#_star_2">Star 2</a></li>
<li><a href="#_tests_2">Tests</a></li>
<li><a href="#_today_i_learned">Today I learned</a></li>
</ul>
</li>
<li><a href="#sol-2">Day 2: Rock Paper Scissors</a>
<ul class="sectlevel2">
<li><a href="#_input_2">Input</a></li>
<li><a href="#_star_1_2">Star 1</a></li>
<li><a href="#_star_2_2">Star 2</a></li>
<li><a href="#_tests_3">Tests</a></li>
<li><a href="#_today_i_learned_2">Today I learned</a></li>
<li><a href="#_alternative_based_on_direct_calculations">Alternative based on direct calculations</a></li>
</ul>
</li>
<li><a href="#sol-3">Day 3: Rucksack Reorganization</a>
<ul class="sectlevel2">
<li><a href="#_input_3">Input</a></li>
<li><a href="#_star_1_3">Star 1</a></li>
<li><a href="#_star_2_3">Star 2</a></li>
<li><a href="#_tests_4">Tests</a></li>
<li><a href="#_today_i_learned_3">Today I learned</a></li>
</ul>
</li>
<li><a href="#sol-4">Day 4: Camp Cleanup</a>
<ul class="sectlevel2">
<li><a href="#_input_4">Input</a></li>
<li><a href="#_star_1_4">Star 1</a></li>
<li><a href="#_star_2_4">Star 2</a></li>
<li><a href="#_tests_5">Tests</a></li>
<li><a href="#_today_i_learned_4">Today I learned</a></li>
</ul>
</li>
<li><a href="#sol-5">Day 5: Supply Stacks</a>
<ul class="sectlevel2">
<li><a href="#_input_5">Input</a></li>
<li><a href="#_star_1_5">Star 1</a></li>
<li><a href="#_star_2_5">Star 2</a></li>
<li><a href="#_tests_6">Tests</a></li>
<li><a href="#_today_i_learned_5">Today I learned</a></li>
</ul>
</li>
<li><a href="#sol-6">Day 6: Tuning Trouble</a>
<ul class="sectlevel2">
<li><a href="#_input_6">Input</a></li>
<li><a href="#_star_1_6">Star 1</a></li>
<li><a href="#_star_2_6">Star 2</a></li>
<li><a href="#_alternative">Alternative</a></li>
<li><a href="#_tests_7">Tests</a></li>
<li><a href="#_today_i_learned_6">Today I learned</a></li>
</ul>
</li>
<li><a href="#sol-7">Day 7: No Space Left On Device</a>
<ul class="sectlevel2">
<li><a href="#_input_7">Input</a></li>
<li><a href="#_star_1_7">Star 1</a></li>
<li><a href="#_star_2_7">Star 2</a></li>
<li><a href="#_tests_8">Tests</a></li>
</ul>
</li>
<li><a href="#sol-8">Day 8: Treetop Tree House</a>
<ul class="sectlevel2">
<li><a href="#_input_8">Input</a></li>
<li><a href="#_star_1_8">Star 1</a></li>
<li><a href="#_star_2_8">Star 2</a></li>
<li><a href="#_tests_9">Tests</a></li>
</ul>
</li>
<li><a href="#sol-9">Day 9: Rope Bridge</a>
<ul class="sectlevel2">
<li><a href="#_input_9">Input</a></li>
<li><a href="#_solution">Solution</a></li>
<li><a href="#_tests_10">Tests</a></li>
<li><a href="#_today_i_learned_7">Today I learned</a></li>
</ul>
</li>
<li><a href="#sol-10">Day 10: Cathode-Ray Tube</a>
<ul class="sectlevel2">
<li><a href="#_input_10">Input</a></li>
<li><a href="#_star_1_9">Star 1</a></li>
<li><a href="#_star_2_9">Star 2</a></li>
<li><a href="#_tests_11">Tests</a></li>
</ul>
</li>
<li><a href="#sol-11">Day 11: Monkey in the Middle</a>
<ul class="sectlevel2">
<li><a href="#_input_11">Input</a></li>
<li><a href="#_solution_2">Solution</a></li>
<li><a href="#_tests_12">Tests</a></li>
</ul>
</li>
<li><a href="#sol-12">Day 12: Hill Climbing Algorithm</a>
<ul class="sectlevel2">
<li><a href="#_input_12">Input</a></li>
<li><a href="#_star_1_10">Star 1</a></li>
<li><a href="#_star_2_10">Star 2</a></li>
<li><a href="#_tests_13">Tests</a></li>
</ul>
</li>
<li><a href="#sol-13">Day 13: Distress Signal</a>
<ul class="sectlevel2">
<li><a href="#_input_13">Input</a></li>
<li><a href="#_solution_3">Solution</a></li>
<li><a href="#_star_1_11">Star 1</a></li>
<li><a href="#_star_2_11">Star 2</a></li>
<li><a href="#_tests_14">Tests</a></li>
<li><a href="#_alternative_without_using_heap">Alternative without using heap</a></li>
</ul>
</li>
<li><a href="#sol-14">Day 14: Regolith Reservoir</a>
<ul class="sectlevel2">
<li><a href="#_input_14">Input</a></li>
<li><a href="#_star_1_12">Star 1</a></li>
<li><a href="#_star_2_12">Star 2</a></li>
<li><a href="#_tests_15">Tests</a></li>
</ul>
</li>
<li><a href="#sol-15">Day 15: Beacon Exclusion Zone</a>
<ul class="sectlevel2">
<li><a href="#_input_15">Input</a></li>
<li><a href="#_star_1_13">Star 1</a></li>
<li><a href="#_star_2_13">Star 2</a></li>
<li><a href="#_star_2scan_lines">Star 2&#8201;&#8212;&#8201;Scan Lines</a></li>
<li><a href="#_tests_16">Tests</a></li>
</ul>
</li>
<li><a href="#sol-16">Day 16: Proboscidea Volcanium</a>
<ul class="sectlevel2">
<li><a href="#_input_16">Input</a></li>
<li><a href="#_star_1_14">Star 1</a></li>
<li><a href="#_star_2_14">Star 2</a></li>
<li><a href="#_tests_17">Tests</a></li>
</ul>
</li>
<li><a href="#sol-17">Day 17: Pyroclastic Flow</a>
<ul class="sectlevel2">
<li><a href="#_input_17">Input</a></li>
<li><a href="#_general_solution">General solution</a></li>
<li><a href="#_star_1_15">Star 1</a></li>
<li><a href="#_star_2_15">Star 2</a></li>
<li><a href="#_tests_18">Tests</a></li>
<li><a href="#_animation">Animation</a></li>
</ul>
</li>
<li><a href="#sol-18">Day 18: Boiling Boulders</a>
<ul class="sectlevel2">
<li><a href="#_input_18">Input</a></li>
<li><a href="#_star_1_16">Star 1</a></li>
<li><a href="#_star_2_16">Star 2</a></li>
<li><a href="#_star_1_variant">Star 1 variant</a></li>
<li><a href="#_tests_19">Tests</a></li>
</ul>
</li>
<li><a href="#sol-19">Day 19: Not Enough Minerals</a>
<ul class="sectlevel2">
<li><a href="#_input_19">Input</a></li>
<li><a href="#_star_1_17">Star 1</a></li>
<li><a href="#_star_2_17">Star 2</a></li>
<li><a href="#_tests_20">Tests</a></li>
<li><a href="#_today_i_learned_8">Today I learned</a></li>
</ul>
</li>
<li><a href="#sol-20">Day 20: Grove Positioning System</a>
<ul class="sectlevel2">
<li><a href="#_input_20">Input</a></li>
<li><a href="#_general_solution_2">General Solution</a></li>
<li><a href="#_star_1_18">Star 1</a></li>
<li><a href="#_star_2_18">Star 2</a></li>
<li><a href="#_tests_21">Tests</a></li>
</ul>
</li>
<li><a href="#sol-21">Day 21: <em>TODO</em></a>
<ul class="sectlevel2">
<li><a href="#_input_21">Input</a></li>
<li><a href="#_star_1_19">Star 1</a></li>
<li><a href="#_star_2_19">Star 2</a></li>
<li><a href="#_tests_22">Tests</a></li>
</ul>
</li>
<li><a href="#sol-22">Day 22: Monkey Map</a>
<ul class="sectlevel2">
<li><a href="#_input_22">Input</a></li>
<li><a href="#_star_1_20">Star 1</a></li>
<li><a href="#_star_2_20">Star 2</a></li>
<li><a href="#_tests_23">Tests</a></li>
</ul>
</li>
<li><a href="#sol-23">Day 23: Unstable Diffusion</a>
<ul class="sectlevel2">
<li><a href="#_input_23">Input</a></li>
<li><a href="#_star_1_21">Star 1</a></li>
<li><a href="#_star_2_21">Star 2</a></li>
<li><a href="#_tests_24">Tests</a></li>
</ul>
</li>
<li><a href="#sol-24">Day 24: Blizzard Basin</a>
<ul class="sectlevel2">
<li><a href="#_input_24">Input</a></li>
<li><a href="#_star_1_22">Star 1</a></li>
<li><a href="#_star_2_22">Star 2</a></li>
<li><a href="#_tests_25">Tests</a></li>
</ul>
</li>
<li><a href="#sol-25">Day 25: Full of Hot Air</a>
<ul class="sectlevel2">
<li><a href="#_star_1_23">Star 1</a></li>
<li><a href="#_tests_26">Tests</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="index.html">Overview</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-0">Day 00: Hello World!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;ll be the 3rd year of <a href="https://www.rust-lang.org/">Rust</a> solutions for the 2022 edition of
<a href="https://adventofcode.com/2021">Advent of Code</a></p>
</div>
<div class="paragraph">
<p>I created a little solution infrastructure (which resides in the <code>aoc</code> subfolder of <code>day00/rust/mr-kaffee</code>), that I want to use in my solutions.</p>
</div>
<div class="paragraph">
<p>My day00 solution can be used to run all or some of the solutions (<code>cargo run --release -- run -y 2022 -d 1..=25</code> or <code>cargo run --release -- run -y 2022 -d 1,3,7</code> or simply <code>cargo run --release</code> to run everything)</p>
</div>
<div class="paragraph">
<p>Other than that, my challenges are again to create solutions that perform well and that do not use external dependencies. The day00 solution is an exception to the latter rule. It uses <code>itertools</code>, <code>clap</code>, <code>regex</code>, and <code>lazy_static</code>.</p>
</div>
<div class="sect2">
<h3 id="_general_structure">General structure</h3>
<div class="paragraph">
<p>My solutions will be implemented in a <code>src/lib.rs</code> file and generally have the structure detailed below. This is most probably a bit of an overhead, but fun to write and a learning opportunity for me.</p>
</div>
<div class="sect3">
<h4 id="_the_puzzle_definition">The Puzzle definition</h4>
<div class="paragraph">
<p>This is a function returning a <code>mr_kaffee_aoc::Puzzle</code> struct which defines metadata, input data, references to solver functions and expected solutions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">puzzle</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Puzzle</span><span class="o">&lt;</span><span class="k">'static</span><span class="p">,</span> <span class="n">PuzzleData</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">Puzzle</span> <span class="p">{</span>
        <span class="n">year</span><span class="p">:</span> <span class="mi">2022</span><span class="p">,</span>
        <span class="n">day</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">input</span><span class="p">:</span> <span class="nd">include_str!</span><span class="p">(</span><span class="s">"../input.txt"</span><span class="p">),</span>
        <span class="n">star1</span><span class="p">:</span> <span class="nf">Some</span><span class="p">(</span><span class="n">Star</span> <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="s">"Hello World example"</span><span class="p">,</span>
            <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">star_1</span><span class="p">,</span>
            <span class="n">exp</span><span class="p">:</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">}),</span>
        <span class="n">star2</span><span class="p">:</span> <span class="nb">None</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_data_structures">Data Structures</h4>
<div class="paragraph">
<p>This includes the code to parse the input data</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
    <span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">Self</span> <span class="p">{</span> <span class="n">input</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_solver_functions">The solver functions</h4>
<div class="paragraph">
<p>The main solver functions plus potentially helper functions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">data</span><span class="py">.input</span><span class="p">);</span>
    <span class="mi">0</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tests">Tests</h4>
<div class="paragraph">
<p>Tests, in particular code to execute the test cases typically defined in the puzzles</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
    <span class="k">use</span> <span class="nn">mr_kaffee_aoc</span><span class="p">::</span><span class="n">GenericPuzzle</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_something</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">puzzle</span> <span class="o">=</span> <span class="nf">puzzle</span><span class="p">();</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="n">puzzle</span><span class="nf">.solve_handle_err</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-1">Day 1: Calorie Counting</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/1">AoC|2022|1</a>.</p>
</div>
<div class="paragraph">
<p>Nothing very interesting today.</p>
</div>
<div class="sect2">
<h3 id="_input">Input</h3>
<div class="paragraph">
<p>Parse everything in a vec of sums (initially I used a vec of vecs; since individual elements are never needed sums are enough)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">num</span><span class="p">::</span><span class="n">ParseIntError</span><span class="p">;</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">calories</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">TryFrom</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">ParseIntError</span><span class="p">;</span>

        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="n">s</span><span class="nf">.split</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">elf</span><span class="p">|</span> <span class="n">elf</span><span class="nf">.lines</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="n">l</span><span class="py">.parse</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">())</span><span class="nf">.sum</span><span class="p">())</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">calories</span><span class="p">|</span> <span class="k">Self</span> <span class="p">{</span> <span class="n">calories</span> <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1">Star 1</h3>
<div class="paragraph">
<p>Just find the biggest sum (I use <code>fold</code> instead of <code>max</code> to not handle the <code>Option::None</code> case)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">data</span><span class="py">.calories</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.fold</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">|</span><span class="n">mx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cal</span><span class="p">|</span> <span class="n">mx</span><span class="nf">.max</span><span class="p">(</span><span class="n">cal</span><span class="p">))</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2">Star 2</h3>
<div class="paragraph">
<p>Sum the three biggest sums. First solution used <code>Vec::sort</code>. New solution does not use any sorting and should be <code>O(n)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">data</span><span class="py">.calories</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.fold</span><span class="p">([</span><span class="mi">0</span><span class="p">;</span> <span class="mi">3</span><span class="p">],</span> <span class="p">|</span><span class="k">mut</span> <span class="n">mx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cal</span><span class="p">|</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">cal</span> <span class="o">&gt;</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">{</span>
                <span class="n">mx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                <span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">cal</span> <span class="o">&gt;</span> <span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">{</span>
                <span class="n">mx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                <span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">cal</span> <span class="o">&gt;</span> <span class="n">mx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">{</span>
                <span class="n">mx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cal</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">mx</span>
        <span class="p">})</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.sum</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_2">Tests</h3>
<div class="paragraph">
<p>No tests today. It was too simple.</p>
</div>
</div>
<div class="sect2">
<h3 id="_today_i_learned">Today I learned</h3>
<div class="paragraph">
<p>Not so much. My template works.</p>
</div>
<div class="paragraph">
<p>Iterating/refactoring the solution, I learned that <code>std::iter::Sum</code> has an implementation <code>impl&lt;T, U, E&gt; Sum&lt;Result&lt;U, E&gt;&gt; for Result&lt;T, E&gt;</code>.</p>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-2">Day 2: Rock Paper Scissors</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/2">AoC|2022|2</a>.</p>
</div>
<div class="sect2">
<h3 id="_input_2">Input</h3>
<div class="paragraph">
<p>I have two enums to parse the first column (A, B, C to <code>RockPaperScissors</code>) and the second column (X, Y, Z to <code>XYZ</code>).</p>
</div>
<div class="paragraph">
<p>It would have been much simpler to parse both into 0, 1, 2 and than use some simple formulas later on (which I did as an alternative, see below), but my solution fails gracefully if something unexpected comes in the input ;)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>

    <span class="nd">#[derive(Debug,</span> <span class="nd">Clone,</span> <span class="nd">Copy,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq)]</span>
    <span class="k">pub</span> <span class="k">enum</span> <span class="n">RockPaperScissors</span> <span class="p">{</span>
        <span class="n">Rock</span><span class="p">,</span>
        <span class="n">Paper</span><span class="p">,</span>
        <span class="n">Scissors</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">#[derive(Debug,</span> <span class="nd">Clone,</span> <span class="nd">Copy,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq)]</span>
    <span class="k">pub</span> <span class="k">enum</span> <span class="n">XYZ</span> <span class="p">{</span>
        <span class="n">X</span><span class="p">,</span>
        <span class="n">Y</span><span class="p">,</span>
        <span class="n">Z</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">strategy</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="n">RockPaperScissors</span><span class="p">,</span> <span class="n">XYZ</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">TryFrom</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="nb">String</span><span class="p">;</span>

        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="n">s</span><span class="nf">.lines</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="p">{</span>
                    <span class="n">l</span><span class="nf">.split_once</span><span class="p">(</span><span class="sc">' '</span><span class="p">)</span>
                        <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"Could not parse line '{l}'"</span><span class="p">))</span>
                        <span class="nf">.and_then</span><span class="p">(|(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)|</span> <span class="p">{</span>
                            <span class="k">match</span> <span class="n">a</span> <span class="p">{</span>
                                <span class="s">"A"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">),</span>
                                <span class="s">"B"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">),</span>
                                <span class="s">"C"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">),</span>
                                <span class="n">_</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Expected one of A, B, C, found '{a}'"</span><span class="p">)),</span>
                            <span class="p">}</span>
                            <span class="nf">.and_then</span><span class="p">(|</span><span class="n">a</span><span class="p">|</span> <span class="k">match</span> <span class="n">b</span> <span class="p">{</span>
                                <span class="s">"X"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="nn">XYZ</span><span class="p">::</span><span class="n">X</span><span class="p">)),</span>
                                <span class="s">"Y"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="nn">XYZ</span><span class="p">::</span><span class="n">Y</span><span class="p">)),</span>
                                <span class="s">"Z"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="nn">XYZ</span><span class="p">::</span><span class="n">Z</span><span class="p">)),</span>
                                <span class="n">_</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Expected one of X, Y, Z, found '{b}'"</span><span class="p">)),</span>
                            <span class="p">})</span>
                        <span class="p">})</span>
                <span class="p">})</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">strategy</span><span class="p">|</span> <span class="k">Self</span> <span class="p">{</span> <span class="n">strategy</span> <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_2">Star 1</h3>
<div class="paragraph">
<p>For star 1 I directly convert `XYZ`s to `RockPaperScissors&#8217; using</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre>    <span class="k">fn</span> <span class="nf">to_rock_paper_scissors</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">RockPaperScissors</span> <span class="p">{</span>
        <span class="k">match</span> <span class="k">self</span> <span class="p">{</span>
            <span class="nn">XYZ</span><span class="p">::</span><span class="n">X</span> <span class="k">=&gt;</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">,</span>
            <span class="nn">XYZ</span><span class="p">::</span><span class="n">Y</span> <span class="k">=&gt;</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">,</span>
            <span class="nn">XYZ</span><span class="p">::</span><span class="n">Z</span> <span class="k">=&gt;</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The scores are calculated with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre>    <span class="k">fn</span> <span class="nf">result</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
        <span class="k">match</span> <span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the solution is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">data</span><span class="py">.strategy</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)|</span> <span class="n">b</span><span class="nf">.to_rock_paper_scissors</span><span class="p">()</span><span class="nf">.result</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="nf">.sum</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_2">Star 2</h3>
<div class="paragraph">
<p>I was expecting an optimization for the second part of the kind, "Figure out what X, Y, Z need to be so you end up with the highest score possible" or "&#8230;&#8203; so that you end up with the lowest score possible that with more than 50% wins". Maybe that would have been too much for day 2.</p>
</div>
<div class="paragraph">
<p>The scores are still calculated in the same way but the conversion is now done using</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre>    <span class="k">fn</span> <span class="nf">for_result</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">opponent</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">RockPaperScissors</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">RockPaperScissors</span> <span class="p">{</span>
        <span class="k">match</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">opponent</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">(</span><span class="nn">XYZ</span><span class="p">::</span><span class="n">X</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">XYZ</span><span class="p">::</span><span class="n">X</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">XYZ</span><span class="p">::</span><span class="n">X</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">XYZ</span><span class="p">::</span><span class="n">Y</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="o">*</span><span class="n">opponent</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">XYZ</span><span class="p">::</span><span class="n">Z</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">XYZ</span><span class="p">::</span><span class="n">Z</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Paper</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">,</span>
            <span class="p">(</span><span class="nn">XYZ</span><span class="p">::</span><span class="n">Z</span><span class="p">,</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Scissors</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">RockPaperScissors</span><span class="p">::</span><span class="n">Rock</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The solution is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">data</span><span class="py">.strategy</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)|</span> <span class="n">b</span><span class="nf">.for_result</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="nf">.result</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
        <span class="nf">.sum</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_3">Tests</h3>
<div class="paragraph">
<p>I made a mistake in my scoring function in the first place. So I wrote tests this time to debug this&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"A Y
B X
C Z"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_today_i_learned_2">Today I learned</h3>
<div class="paragraph">
<p>I think it was the first time I used <code>Result::and_then</code> in a (maybe) meaningful way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_alternative_based_on_direct_calculations">Alternative based on direct calculations</h3>
<div class="paragraph">
<p>I could not stop myself from implementing an alternative solution using direct calculations. Run the alternative solution with <code>cargo run --release --features modulo</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre>    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
        <span class="c1">// 0 rock</span>
        <span class="c1">// 1 paper</span>
        <span class="c1">// 2 scissor</span>
        <span class="c1">// (rock - paper + 1) % 3 = 0</span>
        <span class="c1">// (rock - rock + 1) % 3 = 1</span>
        <span class="c1">// (rock - scissor + 1) % 3 = 2</span>
        <span class="n">data</span><span class="py">.strategy</span>
            <span class="nf">.iter</span><span class="p">()</span>
            <span class="nf">.map</span><span class="p">(|(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)|</span> <span class="p">((</span><span class="n">b</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="nf">.sum</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
        <span class="c1">// 0 rock, 1 paper, 2 scissor</span>
        <span class="c1">// 0 loose, 1 draw, 2 win</span>
        <span class="c1">// to loose, subtract 1 (% 3), to win add 1 (% 3)</span>
        <span class="c1">// play (a + b - 1) % 3 -&gt; add this in formula for first star</span>
        <span class="n">data</span><span class="py">.strategy</span>
            <span class="nf">.iter</span><span class="p">()</span>
            <span class="nf">.map</span><span class="p">(|(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)|</span> <span class="n">b</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nf">.sum</span><span class="p">()</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>I also implemented a parse function which does not check any inputs and will probably result in panics if something unexpected is in the input (to parse without error handling run <code>cargo run --release --features unchecked_parse</code>; this will automatically use the direct calculation variant)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="code"><pre>    <span class="k">impl</span> <span class="nb">TryFrom</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="nb">String</span><span class="p">;</span>

        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="nd">cfg!</span><span class="p">(</span><span class="n">feature</span> <span class="o">=</span> <span class="s">"unchecked_parse"</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">Ok</span><span class="p">(</span><span class="k">Self</span> <span class="p">{</span>
                    <span class="n">strategy</span><span class="p">:</span> <span class="n">s</span>
                        <span class="nf">.lines</span><span class="p">()</span>
                        <span class="nf">.map</span><span class="p">(</span><span class="nn">str</span><span class="p">::</span><span class="n">as_bytes</span><span class="p">)</span>
                        <span class="nf">.map</span><span class="p">(|</span><span class="n">bytes</span><span class="p">|</span> <span class="p">((</span><span class="n">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="sc">b'A'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">,</span> <span class="p">(</span><span class="n">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="sc">b'X'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">))</span>
                        <span class="nf">.collect</span><span class="p">(),</span>
                <span class="p">})</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">s</span><span class="nf">.lines</span><span class="p">()</span>
                    <span class="nf">.map</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="p">{</span>
                        <span class="n">l</span><span class="nf">.split_once</span><span class="p">(</span><span class="sc">' '</span><span class="p">)</span>
                            <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"Could not parse line '{l}'"</span><span class="p">))</span>
                            <span class="nf">.and_then</span><span class="p">(|(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)|</span> <span class="p">{</span>
                                <span class="k">match</span> <span class="n">a</span> <span class="p">{</span>
                                    <span class="s">"A"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                                    <span class="s">"B"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                                    <span class="s">"C"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                                    <span class="n">_</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Expected one of A, B, C, found '{a}'"</span><span class="p">)),</span>
                                <span class="p">}</span>
                                <span class="nf">.and_then</span><span class="p">(|</span><span class="n">a</span><span class="p">|</span> <span class="k">match</span> <span class="n">b</span> <span class="p">{</span>
                                    <span class="s">"X"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                                    <span class="s">"Y"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                                    <span class="s">"Z"</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                                    <span class="n">_</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Expected one of X, Y, Z, found '{b}'"</span><span class="p">)),</span>
                                <span class="p">})</span>
                            <span class="p">})</span>
                    <span class="p">})</span>
                    <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
                    <span class="nf">.map</span><span class="p">(|</span><span class="n">strategy</span><span class="p">|</span> <span class="k">Self</span> <span class="p">{</span> <span class="n">strategy</span> <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Interestingly, not doing any error handling in parsing the input does not lead to any measurable speed-up. Maybe this is because the overall solution time is so small, that the differences are not distinguishable from noise?</p>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-3">Day 3: Rucksack Reorganization</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/3">AoC|2022|3</a>.</p>
</div>
<div class="sect2">
<h3 id="_input_3">Input</h3>
<div class="paragraph">
<p>I parse the input directly into a vec of vecs of bytes, each representing the priority of the items contained in the rucksacks.</p>
</div>
<div class="paragraph">
<p>I was tempted to think about using sets for quicker <code>contains</code> operations, but given the size of the problem, this is most likely not worth it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">rucksacks</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">u8</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">TryFrom</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">;</span>

        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="n">s</span><span class="nf">.lines</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="p">{</span>
                    <span class="n">l</span><span class="nf">.as_bytes</span><span class="p">()</span>
                        <span class="nf">.iter</span><span class="p">()</span>
                        <span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="k">match</span> <span class="n">b</span> <span class="p">{</span>
                            <span class="sc">b'a'</span><span class="o">..=</span><span class="sc">b'z'</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="sc">b'a'</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="sc">b'A'</span><span class="o">..=</span><span class="sc">b'Z'</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="sc">b'A'</span> <span class="o">+</span> <span class="mi">27</span><span class="p">),</span>
                            <span class="n">_</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="s">"Unexpected bytes in input"</span><span class="p">),</span>
                        <span class="p">})</span>
                        <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
                <span class="p">})</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">rucksacks</span><span class="p">|</span> <span class="k">Self</span> <span class="p">{</span> <span class="n">rucksacks</span> <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_3">Star 1</h3>
<div class="paragraph">
<p>Star 1 is about finding the item in the first compartment (first half) of the rucksack, which is also contained in the secod half.</p>
</div>
<div class="paragraph">
<p>Some simplifications work because / if the input is correct.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>I assume that a common item always exists and therefore do not limit the search to the first half (it will stop once an item is found, which will be in the first half)</p>
</li>
<li>
<p>The <code>find</code> function returns an <code>Option</code>. If there were any <code>None</code> values, they would be simply discarded using <code>filter_map</code> (actually, for part 1, there can be no <code>None</code> values, because search is not stopped in the first half, so the first element of the second half would be found, if there is no common element between first and second half. so a simple <code>unwrap</code> would work as well).</p>
</li>
<li>
<p>The <code>chunks_exact</code> function makes sure that every chunk has exactly three elements. If the overall number of rucksacks was not a multiple of three, the remaining rucksacks would simply be discarded.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I use a <code>fold</code> instead of <code>sum</code> to do type conversion on the fly (<code>u8</code> would not be big enough to hold the sum).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">data</span><span class="py">.rucksacks</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.filter_map</span><span class="p">(|</span><span class="n">rucksack</span><span class="p">|</span> <span class="p">{</span>
            <span class="n">rucksack</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.find</span><span class="p">(|</span><span class="n">item</span><span class="p">|</span> <span class="n">rucksack</span><span class="nf">.as_slice</span><span class="p">()[</span><span class="n">rucksack</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="o">..</span><span class="p">]</span><span class="nf">.contains</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="p">})</span>
        <span class="nf">.fold</span><span class="p">(</span><span class="mi">0usize</span><span class="p">,</span> <span class="p">|</span><span class="n">sum</span><span class="p">,</span> <span class="n">item</span><span class="p">|</span> <span class="n">sum</span> <span class="o">+</span> <span class="o">*</span><span class="n">item</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_3">Star 2</h3>
<div class="paragraph">
<p>Star 2 is a simple modification, where we look for items that are common for groups of three consecutive rucksacks</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">data</span><span class="py">.rucksacks</span>
        <span class="nf">.chunks_exact</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="nf">.filter_map</span><span class="p">(|</span><span class="n">group</span><span class="p">|</span> <span class="p">{</span>
            <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.find</span><span class="p">(|</span><span class="n">item</span><span class="p">|</span> <span class="n">group</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="nf">.contains</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">group</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="nf">.contains</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="p">})</span>
        <span class="nf">.fold</span><span class="p">(</span><span class="mi">0usize</span><span class="p">,</span> <span class="p">|</span><span class="n">sum</span><span class="p">,</span> <span class="n">item</span><span class="p">|</span> <span class="n">sum</span> <span class="o">+</span> <span class="o">*</span><span class="n">item</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_4">Tests</h3>
<div class="paragraph">
<p>Tests use the example given in the puzzle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"vJrwpWtwJgWrhcsFMMfFFhFp
jqHRNqRjqzjGDLGLrsFMfFZSrLrFZsSL
PmmdzqPrVvPwwTWBwg
wMqvLMZHhHMvwLHjbvcjnnSBnvTQFn
ttgJtRGJQctTZtZT
CrZsJsPPZsGzwwsLwLmpwMDw"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">157</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_today_i_learned_3">Today I learned</h3>
<div class="paragraph">
<p>... that sometimes it is as simple as it appears at first view.</p>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-4">Day 4: Camp Cleanup</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/4">AoC|2022|4</a>.</p>
</div>
<div class="sect2">
<h3 id="_input_4">Input</h3>
<div class="paragraph">
<p>Today, input parsing was the biggest challenge. Mainly because I decided to not use <code>unwrap</code> but try some proper error handling and to avoid intermediate <code>collect</code> calls. Until I figured out that the code is much simplified if I create a separate function to parse a single line (because <code>?</code> can be used in that function but not in a clojure within an iterator&#8217;s <code>map</code> function), I had to use a lot of <code>and_then</code>, <code>map</code>, <code>map_error</code>, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>So here is my parsing functions (admittedly not how it looked like when I submitted my results)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">mr_kaffee_aoc</span><span class="p">::</span><span class="nn">err</span><span class="p">::</span><span class="n">PuzzleError</span><span class="p">;</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">range_pairs</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">((</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">))</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">parse_pair</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">((</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)),</span> <span class="n">PuzzleError</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">line</span><span class="nf">.split</span><span class="p">(|</span><span class="n">c</span><span class="p">:</span> <span class="nb">char</span><span class="p">|</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">'-'</span> <span class="p">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">','</span><span class="p">);</span>
        <span class="nf">Ok</span><span class="p">((</span>
            <span class="p">(</span>
                <span class="n">iter</span><span class="nf">.next</span><span class="p">()</span>
                    <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"Missing start 1 '{line}'"</span><span class="p">))</span><span class="o">?</span>
                    <span class="nf">.parse</span><span class="p">()</span><span class="o">?</span><span class="p">,</span>
                <span class="n">iter</span><span class="nf">.next</span><span class="p">()</span>
                    <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"Missing end 1 in '{line}'"</span><span class="p">))</span><span class="o">?</span>
                    <span class="nf">.parse</span><span class="p">()</span><span class="o">?</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="n">iter</span><span class="nf">.next</span><span class="p">()</span>
                    <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"Missing start 2 in '{line}'"</span><span class="p">))</span><span class="o">?</span>
                    <span class="nf">.parse</span><span class="p">()</span><span class="o">?</span><span class="p">,</span>
                <span class="n">iter</span><span class="nf">.next</span><span class="p">()</span>
                    <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"Missing end 2 in '{line}'"</span><span class="p">))</span><span class="o">?</span>
                    <span class="nf">.parse</span><span class="p">()</span><span class="o">?</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">))</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">TryFrom</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">PuzzleError</span><span class="p">;</span>

        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="n">s</span><span class="nf">.lines</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(</span><span class="n">parse_pair</span><span class="p">)</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">range_pairs</span><span class="p">|</span> <span class="k">Self</span> <span class="p">{</span> <span class="n">range_pairs</span> <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_4">Star 1</h3>
<div class="paragraph">
<p>The actual solution is simple for part 1 &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="c1">// count how often one range is contained in the other</span>
    <span class="n">data</span><span class="py">.range_pairs</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.filter</span><span class="p">(|((</span><span class="n">start1</span><span class="p">,</span> <span class="n">end1</span><span class="p">),</span> <span class="p">(</span><span class="n">start2</span><span class="p">,</span> <span class="n">end2</span><span class="p">))|</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">start1</span> <span class="o">&lt;=</span> <span class="n">start2</span> <span class="o">&amp;&amp;</span> <span class="n">end2</span> <span class="o">&lt;=</span> <span class="n">end1</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="n">start2</span> <span class="o">&lt;=</span> <span class="n">start1</span> <span class="o">&amp;&amp;</span> <span class="n">end1</span> <span class="o">&lt;=</span> <span class="n">end2</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="nf">.count</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_4">Star 2</h3>
<div class="paragraph">
<p>... as well as for part 2 (I was afraid to be asked to look for overlaps across pairs in part 2 &#8230;&#8203;)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="c1">// count how often ranges overlap, i.e., start of one range is contained in the other range</span>
    <span class="n">data</span><span class="py">.range_pairs</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.filter</span><span class="p">(|((</span><span class="n">start1</span><span class="p">,</span> <span class="n">end1</span><span class="p">),</span> <span class="p">(</span><span class="n">start2</span><span class="p">,</span> <span class="n">end2</span><span class="p">))|</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">start1</span> <span class="o">&lt;=</span> <span class="n">start2</span> <span class="o">&amp;&amp;</span> <span class="n">start2</span> <span class="o">&lt;=</span> <span class="n">end1</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="n">start2</span> <span class="o">&lt;=</span> <span class="n">start1</span> <span class="o">&amp;&amp;</span> <span class="n">start1</span> <span class="o">&lt;=</span> <span class="n">end2</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="nf">.count</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_5">Tests</h3>
<div class="paragraph">
<p>Today I even did test-driven development in the sense that I did not write any functional code before I had a failing test case ;)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
    <span class="k">use</span> <span class="nn">mr_kaffee_aoc</span><span class="p">::</span><span class="nn">err</span><span class="p">::</span><span class="n">PuzzleError</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"2-4,6-8
2-3,4-5
5-7,7-9
2-8,3-7
6-6,4-6
2-6,4-8"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="n">PuzzleError</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
        <span class="nf">Ok</span><span class="p">(())</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="n">PuzzleError</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
        <span class="nf">Ok</span><span class="p">(())</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_today_i_learned_4">Today I learned</h3>
<div class="paragraph">
<p><code>and_then</code> - <code>map</code> - <code>and_then</code> - <code>map</code> - <code>map_err</code> &#8230;&#8203; is all not needed if some parsing functionality for one line is moved to a separate function where the <code>?</code> shortcut operator can be used for error propagation and conversion</p>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-5">Day 5: Supply Stacks</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/5">AoC|2022|5</a>.</p>
</div>
<div class="paragraph">
<p>Today, there where two main challenges for me:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Parsing the input</p>
</li>
<li>
<p>Rust&#8217;s mutability &amp; borrowing concept for part 2</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In addition, it turns out quite complicated to handle possible errors (all kind of invalid moves, empty stacks at end of moves, &#8230;&#8203;). All this effort for code that is never used, because the puzzle inputs are well-formed. I think I will stop this excercise and use plain <code>unwrap</code> again for subsequent days.</p>
</div>
<div class="sect2">
<h3 id="_input_5">Input</h3>
<div class="paragraph">
<p>Today, it was not just "process input line by line", but in the end almost &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>First, I split the input in one part describing the stacks and a second part describing the moves. Parsing the moves in tuples <code>(n, from, to)</code> is easy. I make the <code>from</code> and <code>to</code> parts zero-based on the fly.</p>
</div>
<div class="paragraph">
<p>Parsing the stacks of crates is a bit more tricky. I did not (could not) use a simple iterator / collect scheme but allocated the stacks upfront and than process line by line starting at the last and pushing elements on the stack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">mr_kaffee_aoc</span><span class="p">::</span><span class="nn">err</span><span class="p">::</span><span class="n">PuzzleError</span><span class="p">;</span>

    <span class="nd">#[derive(Debug,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="n">stacks</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;&gt;</span><span class="p">,</span>
        <span class="n">moves</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">parse_move</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">len</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span> <span class="n">PuzzleError</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="nf">.split</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>

        <span class="n">parts</span><span class="nf">.next</span><span class="p">();</span> <span class="c1">// skip "move"</span>
        <span class="k">let</span> <span class="n">n</span> <span class="o">=</span> <span class="n">parts</span>
            <span class="nf">.next</span><span class="p">()</span>
            <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"Missing number in move '{line}'"</span><span class="p">))</span><span class="o">?</span>
            <span class="py">.parse</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
        <span class="n">parts</span><span class="nf">.next</span><span class="p">();</span> <span class="c1">// skip "from"</span>
        <span class="k">let</span> <span class="n">from</span> <span class="o">=</span> <span class="n">parts</span>
            <span class="nf">.next</span><span class="p">()</span>
            <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"Missing from in move '{line}'"</span><span class="p">))</span><span class="o">?</span>
            <span class="py">.parse</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span>
            <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">parts</span><span class="nf">.next</span><span class="p">();</span> <span class="c1">// skip "to"</span>
        <span class="k">let</span> <span class="n">to</span> <span class="o">=</span> <span class="n">parts</span>
            <span class="nf">.next</span><span class="p">()</span>
            <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"Missing to in move '{line}'"</span><span class="p">))</span><span class="o">?</span>
            <span class="py">.parse</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span>
            <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">if</span> <span class="n">from</span> <span class="o">&gt;=</span> <span class="n">len</span> <span class="p">||</span> <span class="n">to</span> <span class="o">&gt;=</span> <span class="n">len</span> <span class="p">{</span>
            <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Invalid move: '{line}', &lt;from&gt;, &lt;to&gt; &lt;= {len} required."</span><span class="p">)</span><span class="nf">.into</span><span class="p">())</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">from</span> <span class="o">==</span> <span class="n">to</span> <span class="p">{</span>
            <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Invalid move: '{line}', &lt;from&gt; != &lt;to&gt; required."</span><span class="p">)</span><span class="nf">.into</span><span class="p">())</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">Ok</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">parse_crate_layer</span><span class="p">(</span><span class="n">stacks</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">in</span> <span class="n">line</span>
            <span class="nf">.chars</span><span class="p">()</span>
            <span class="nf">.skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="nf">.step_by</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="nf">.enumerate</span><span class="p">()</span>
            <span class="nf">.filter</span><span class="p">(|(</span><span class="n">_</span><span class="p">,</span> <span class="n">item</span><span class="p">)|</span> <span class="o">*</span><span class="n">item</span> <span class="o">!=</span> <span class="sc">' '</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">while</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">stacks</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">stacks</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="n">stacks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="nf">.push</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">TryFrom</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">PuzzleError</span><span class="p">;</span>

        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">let</span> <span class="p">(</span><span class="n">stacks_part</span><span class="p">,</span> <span class="n">moves_part</span><span class="p">)</span> <span class="o">=</span> <span class="n">s</span>
                <span class="nf">.split_once</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">)</span>
                <span class="nf">.ok_or</span><span class="p">(</span><span class="s">"Could not separate crates from moves"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">stacks</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[];</span>
            <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">stacks_part</span><span class="nf">.lines</span><span class="p">()</span><span class="nf">.rev</span><span class="p">()</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">parse_crate_layer</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">stacks</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">let</span> <span class="n">moves</span> <span class="o">=</span> <span class="n">moves_part</span>
                <span class="nf">.lines</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">line</span><span class="p">|</span> <span class="nf">parse_move</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">stacks</span><span class="nf">.len</span><span class="p">()))</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>

            <span class="nf">Ok</span><span class="p">(</span><span class="n">PuzzleData</span> <span class="p">{</span> <span class="n">stacks</span><span class="p">,</span> <span class="n">moves</span> <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// get moves</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">moves</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="p">[(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)]</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.moves</span>
        <span class="p">}</span>

        <span class="cd">/// get cloned crates</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">stacks</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
            <span class="k">self</span><span class="py">.stacks</span><span class="nf">.clone</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_5">Star 1</h3>
<div class="paragraph">
<p>This is straight forward. Just process move by move, and pop from one stack / push to the other stack the correct number of times.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="k">fn</span> <span class="nf">msg</span><span class="p">(</span><span class="n">stacks</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">PuzzleError</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">stacks</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">c</span><span class="p">|</span> <span class="p">{</span>
            <span class="n">c</span><span class="nf">.last</span><span class="p">()</span><span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="p">{</span>
                <span class="nn">PuzzleError</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span>
                    <span class="s">"Can't construct message. Empty stack in {stacks:?}"</span>
                <span class="p">))</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">PuzzleError</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">stacks</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.stacks</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span> <span class="k">in</span> <span class="n">data</span><span class="nf">.moves</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..*</span><span class="n">n</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">item</span> <span class="o">=</span> <span class="n">stacks</span><span class="p">[</span><span class="o">*</span><span class="n">from</span><span class="p">]</span>
                <span class="nf">.pop</span><span class="p">()</span>
                <span class="nf">.ok_or_else</span><span class="p">(||</span> <span class="nd">format!</span><span class="p">(</span><span class="s">"Tried to pop from empty stack {from}, stacks: {stacks:?}"</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
            <span class="n">stacks</span><span class="p">[</span><span class="o">*</span><span class="n">to</span><span class="p">]</span><span class="nf">.push</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">msg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stacks</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_5">Star 2</h3>
<div class="paragraph">
<p>This is slightly more tricky. Now we have to pop a complete pack of items and push that on top of another stack preserving the order.</p>
</div>
<div class="paragraph">
<p>The challenging part of it is that Rust does not allow mutable references to two items in a vec at the same time. My first solution used intermediate storage. My current solution uses <code>slice::split_at_mut</code> to circumvent this (speed-up by a factor 3 to 4 for part 2 compared to intermediate storage). The code gets a bit complicated though&#8201;&#8212;&#8201;I extracted the complicated part to a function <code>mut_references</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="code"><pre><span class="k">fn</span> <span class="n">mut_references</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">idx1</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">idx2</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">T</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">idx1</span> <span class="o">&gt;</span> <span class="n">idx2</span> <span class="p">{</span>
        <span class="k">let</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="nf">.split_at_mut</span><span class="p">(</span><span class="n">idx1</span><span class="p">);</span>
        <span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">left</span><span class="p">[</span><span class="n">idx2</span><span class="p">])</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">let</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span> <span class="o">=</span> <span class="n">v</span><span class="nf">.split_at_mut</span><span class="p">(</span><span class="n">idx2</span><span class="p">);</span>
        <span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">left</span><span class="p">[</span><span class="n">idx1</span><span class="p">],</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">PuzzleError</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">stacks</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.stacks</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">from</span><span class="p">,</span> <span class="n">to</span><span class="p">)</span> <span class="k">in</span> <span class="n">data</span><span class="nf">.moves</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// I need a mutable reference to the from and the to part at the same time</span>
        <span class="c1">// to avoid creating intermediate storage</span>
        <span class="k">let</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span> <span class="o">=</span> <span class="nf">mut_references</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">stacks</span><span class="p">,</span> <span class="o">*</span><span class="n">from</span><span class="p">,</span> <span class="o">*</span><span class="n">to</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">len</span> <span class="o">=</span> <span class="n">source</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">if</span> <span class="o">*</span><span class="n">n</span> <span class="o">&gt;</span> <span class="n">len</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Err</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span>
                <span class="s">"Trying to pop {n} elements from stack {from} containing {len}, stacks: {stacks:?}"</span>
            <span class="p">)</span>
            <span class="nf">.into</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">source</span><span class="nf">.drain</span><span class="p">(</span><span class="n">len</span> <span class="o">-</span> <span class="n">n</span><span class="o">..</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">dest</span><span class="nf">.push</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">msg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stacks</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_6">Tests</h3>
<div class="paragraph">
<p>And there are some tests.</p>
</div>
<div class="paragraph">
<p>Since parsing was not totally obvious, I did an additional test for this part &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"    [D]    
[N] [C]    
[Z] [M] [P]
 1   2   3 

move 1 from 2 to 1
move 3 from 1 to 3
move 2 from 2 to 1
move 1 from 1 to 2"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_parse</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="nd">vec!</span><span class="p">[</span><span class="nd">vec!</span><span class="p">[</span><span class="sc">'Z'</span><span class="p">,</span> <span class="sc">'N'</span><span class="p">],</span> <span class="nd">vec!</span><span class="p">[</span><span class="sc">'M'</span><span class="p">,</span> <span class="sc">'C'</span><span class="p">,</span> <span class="sc">'D'</span><span class="p">],</span> <span class="nd">vec!</span><span class="p">[</span><span class="sc">'P'</span><span class="p">]],</span>
            <span class="n">data</span><span class="nf">.stacks</span><span class="p">()</span>
        <span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">data</span><span class="nf">.moves</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="s">"CMZ"</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="s">"MCD"</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_today_i_learned_5">Today I learned</h3>
<div class="paragraph">
<p>How to mutably access two elements of one vec in Rust.</p>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-6">Day 6: Tuning Trouble</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/6">AoC|2022|6</a>.</p>
</div>
<div class="paragraph">
<p>Today I totally screwed up for the second star for no specific reason :(</p>
</div>
<div class="paragraph">
<p>Too little sleep probably.</p>
</div>
<div class="sect2">
<h3 id="_input_6">Input</h3>
<div class="paragraph">
<p>I parse the input directly into a slice of bytes. That should be very cheap&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">convert</span><span class="p">::</span><span class="n">Infallible</span><span class="p">;</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">stream</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">TryFrom</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">Infallible</span><span class="p">;</span>

        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="nf">Ok</span><span class="p">(</span><span class="n">PuzzleData</span> <span class="p">{</span>
                <span class="n">stream</span><span class="p">:</span> <span class="n">s</span><span class="nf">.trim</span><span class="p">()</span><span class="nf">.as_bytes</span><span class="p">(),</span>
            <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_6">Star 1</h3>
<div class="paragraph">
<p>Hand-crafted solution</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span>
        <span class="py">.stream</span>
        <span class="nf">.windows</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="nf">.enumerate</span><span class="p">()</span>
        <span class="nf">.find</span><span class="p">(|(</span><span class="n">_</span><span class="p">,</span> <span class="n">s</span><span class="p">)|</span> <span class="k">match</span> <span class="n">s</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span> <span class="k">=&gt;</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">b</span> <span class="o">&amp;&amp;</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">c</span> <span class="o">&amp;&amp;</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">d</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">c</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">d</span> <span class="o">&amp;&amp;</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">d</span><span class="p">,</span>
            <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(),</span>
        <span class="p">})</span>
        <span class="nf">.unwrap</span><span class="p">();</span>

    <span class="n">k</span> <span class="o">+</span> <span class="mi">4</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_6">Star 2</h3>
<div class="paragraph">
<p>Solution with a bit of iterators.</p>
</div>
<div class="paragraph">
<p>It feels bad to search the same thing again and again. If a duplicate is found in a window, the search could skip everything until the character just after the first occurance of the duplicate. I implemented this as an alternative (see below)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span>
        <span class="py">.stream</span>
        <span class="nf">.windows</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
        <span class="nf">.enumerate</span><span class="p">()</span>
        <span class="nf">.find</span><span class="p">(|(</span><span class="n">_</span><span class="p">,</span> <span class="n">w</span><span class="p">)|</span> <span class="p">{</span>
            <span class="n">w</span><span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.enumerate</span><span class="p">()</span>
                <span class="nf">.skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="nf">.all</span><span class="p">(|(</span><span class="n">p</span><span class="p">,</span> <span class="n">c1</span><span class="p">)|</span> <span class="n">w</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.take</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="nf">.all</span><span class="p">(|</span><span class="n">c2</span><span class="p">|</span> <span class="n">c1</span> <span class="o">!=</span> <span class="n">c2</span><span class="p">))</span>
        <span class="p">})</span>
        <span class="nf">.unwrap</span><span class="p">();</span>
    <span class="n">k</span> <span class="o">+</span> <span class="mi">14</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_alternative">Alternative</h3>
<div class="paragraph">
<p>As an alternative, I implemented a generic solution which skips parts of the search already covered. Interestingly, this solution tends to be slightly slower (the difference is close to measurement noise in my not very professional time measurements)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">find_distinct</span><span class="p">(</span><span class="n">stream</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">u8</span><span class="p">],</span> <span class="n">n</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">stream</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="n">n</span> <span class="p">{</span>
        <span class="k">match</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="o">..</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span><span class="nf">.find</span><span class="p">(|</span><span class="n">p</span><span class="p">|</span> <span class="n">stream</span><span class="p">[</span><span class="o">*</span><span class="n">p</span><span class="o">..</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stream</span><span class="p">[</span><span class="o">*</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nf">Some</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">k</span> <span class="o">=</span> <span class="n">q</span><span class="p">,</span>
            <span class="nb">None</span> <span class="k">=&gt;</span> <span class="k">return</span> <span class="n">k</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">panic!</span><span class="p">(</span><span class="s">"No solution."</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_7">Tests</h3>
<div class="paragraph">
<p>Tests for all variants</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"mjqjpqmgbljsphdztnvjfqwrcgsmlb"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_find_distinct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="nf">find_distinct</span><span class="p">(</span><span class="n">data</span><span class="py">.stream</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="nf">find_distinct</span><span class="p">(</span><span class="n">data</span><span class="py">.stream</span><span class="p">,</span> <span class="mi">14</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_today_i_learned_6">Today I learned</h3>
<div class="paragraph">
<p>Take a second cup of coffee before solving the puzzle, don&#8217;t forget to wear glasses, and</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it is cool to not allocate any intermediate storage but work directly on byte slices.</p>
</li>
<li>
<p>it is possible to destructure slices with <code>match</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-7">Day 7: No Space Left On Device</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/7">AoC|2022|7</a>.</p>
</div>
<div class="paragraph">
<p>When reading the puzzle today, I thought it would get complicated. Finally, it was quite straight-forward.</p>
</div>
<div class="sect2">
<h3 id="_input_7">Input</h3>
<div class="paragraph">
<p>The description asks for recursion / recursive data structures, which I find a pain in Rust. My solution is to create a vec of <code>Directory</code> elements. Each directory contains references to children and the parent directory as index to this vec.</p>
</div>
<div class="paragraph">
<p>The directories are created by processing the input line by line. When an <code>ls</code> command yields a directory, a new <code>Directory</code> element is added, its index is added to the children to of the current directory and its parent is set to the current directorie&#8217;s index.</p>
</div>
<div class="paragraph">
<p>File sizes are directly summed up (initially, child files were stored in a vec, but once part 2 was unveiled, it was clear that the sum is the only thing needed)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">std</span><span class="p">::{</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">,</span> <span class="nn">convert</span><span class="p">::</span><span class="n">Infallible</span><span class="p">};</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">Directory</span> <span class="p">{</span>
        <span class="n">parent</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="n">children</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">usize</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="n">size</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="n">Directory</span> <span class="p">{</span>
        <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">parent</span><span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">parent</span><span class="p">,</span>
                <span class="n">children</span><span class="p">:</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">(),</span>
                <span class="n">size</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">total_size</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">dirs</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">Directory</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
            <span class="k">self</span><span class="py">.size</span>
                <span class="o">+</span> <span class="k">self</span>
                    <span class="py">.children</span>
                    <span class="nf">.values</span><span class="p">()</span>
                    <span class="nf">.map</span><span class="p">(|</span><span class="n">idx</span><span class="p">|</span> <span class="n">dirs</span><span class="p">[</span><span class="o">*</span><span class="n">idx</span><span class="p">]</span><span class="nf">.total_size</span><span class="p">(</span><span class="n">dirs</span><span class="p">))</span>
                    <span class="py">.sum</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="n">dirs</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Directory</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">TryFrom</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">type</span> <span class="n">Error</span> <span class="o">=</span> <span class="n">Infallible</span><span class="p">;</span>

        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">,</span> <span class="k">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">dirs</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="nn">Directory</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="nb">None</span><span class="p">)];</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">line</span> <span class="k">in</span> <span class="n">s</span><span class="nf">.lines</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">match</span> <span class="n">line</span> <span class="p">{</span>
                    <span class="s">"$ cd /"</span> <span class="k">=&gt;</span> <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s">"$ cd .."</span> <span class="k">=&gt;</span> <span class="n">current</span> <span class="o">=</span> <span class="n">dirs</span><span class="p">[</span><span class="n">current</span><span class="p">]</span><span class="py">.parent</span><span class="nf">.unwrap</span><span class="p">(),</span>
                    <span class="s">"$ ls"</span> <span class="k">=&gt;</span> <span class="p">(),</span>
                    <span class="n">_</span> <span class="k">if</span> <span class="n">line</span><span class="nf">.starts_with</span><span class="p">(</span><span class="s">"$ cd "</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">current</span> <span class="o">=</span> <span class="n">dirs</span><span class="p">[</span><span class="n">current</span><span class="p">]</span><span class="py">.children</span><span class="p">[</span><span class="o">&amp;</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="o">..</span><span class="p">]],</span>
                    <span class="n">_</span> <span class="k">if</span> <span class="n">line</span><span class="nf">.starts_with</span><span class="p">(</span><span class="s">"dir "</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                        <span class="k">let</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">dirs</span><span class="nf">.len</span><span class="p">();</span>
                        <span class="n">dirs</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Directory</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="n">current</span><span class="p">)));</span>
                        <span class="n">dirs</span><span class="p">[</span><span class="n">current</span><span class="p">]</span><span class="py">.children</span><span class="nf">.insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="o">..</span><span class="p">],</span> <span class="n">dir</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="n">_</span> <span class="k">=&gt;</span> <span class="p">{</span>
                        <span class="n">dirs</span><span class="p">[</span><span class="n">current</span><span class="p">]</span><span class="py">.size</span> <span class="o">+=</span>
                            <span class="n">line</span><span class="p">[</span><span class="o">..</span><span class="n">line</span><span class="nf">.find</span><span class="p">(</span><span class="sc">' '</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">()]</span><span class="py">.parse</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="nf">Ok</span><span class="p">(</span><span class="k">Self</span> <span class="p">{</span> <span class="n">dirs</span> <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// immutable access to directories as slice</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">dirs</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">Directory</span><span class="p">]</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.dirs</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_7">Star 1</h3>
<div class="paragraph">
<p>Simple iter - filter - fold</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">data</span><span class="nf">.dirs</span><span class="p">()</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">d</span><span class="p">|</span> <span class="n">d</span><span class="nf">.total_size</span><span class="p">(</span><span class="n">data</span><span class="nf">.dirs</span><span class="p">()))</span>
        <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">s</span><span class="p">|</span> <span class="n">s</span> <span class="o">&lt;=</span> <span class="mi">100_000</span><span class="p">)</span>
        <span class="nf">.sum</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_7">Star 2</h3>
<div class="paragraph">
<p>Another simple iter - filter - fold</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">required</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.dirs</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="nf">.total_size</span><span class="p">(</span><span class="n">data</span><span class="nf">.dirs</span><span class="p">())</span> <span class="o">-</span> <span class="mi">40_000_000</span><span class="p">;</span>

    <span class="n">data</span><span class="nf">.dirs</span><span class="p">()</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">d</span><span class="p">|</span> <span class="n">d</span><span class="nf">.total_size</span><span class="p">(</span><span class="n">data</span><span class="nf">.dirs</span><span class="p">()))</span>
        <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">s</span><span class="p">|</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="n">required</span><span class="p">)</span>
        <span class="nf">.fold</span><span class="p">(</span><span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span><span class="p">,</span> <span class="p">|</span><span class="n">mn</span><span class="p">,</span> <span class="n">s</span><span class="p">|</span> <span class="n">mn</span><span class="nf">.min</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_8">Tests</h3>
<div class="paragraph">
<p>The standard tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"$ cd /
$ ls
dir a
14848514 b.txt
8504156 c.dat
dir d
$ cd a
$ ls
dir e
29116 f
2557 g
62596 h.lst
$ cd e
$ ls
584 i
$ cd ..
$ cd ..
$ cd d
$ ls
4060174 j
8033020 d.log
5626152 d.ext
7214296 k"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">95_437</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">try_from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">24_933_642</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-8">Day 8: Treetop Tree House</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/8">AoC|2022|8</a>.</p>
</div>
<div class="paragraph">
<p>I took a moment to put my brain in the condition to think in the 2D grid&#8230;&#8203;</p>
</div>
<div class="sect2">
<h3 id="_input_8">Input</h3>
<div class="paragraph">
<p>I directly use the bytes from the input. I scan for the first occurrence of a line break. Its index is the width of the grid. The <code>PuzzleData</code> struct&#8217;s implementation has an additional field for the <code>height</code> of the grid.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">trees</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
        <span class="k">pub</span> <span class="n">w</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">h</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">trees</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.as_bytes</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">w</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.find</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">h</span> <span class="o">=</span> <span class="n">trees</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">Self</span> <span class="p">{</span> <span class="n">trees</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_8">Star 1</h3>
<div class="paragraph">
<p>The function <code>is_visible</code> verifies in all four directions (left, right, top, bottom), that all trees up to the boundary are smaller. It stops after one such direction is found.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">is_visible</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">h</span> <span class="o">=</span> <span class="k">self</span><span class="py">.trees</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="k">self</span><span class="py">.w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">];</span>

        <span class="k">let</span> <span class="n">fx</span> <span class="o">=</span> <span class="p">|</span><span class="n">x_</span><span class="p">:</span> <span class="nb">usize</span><span class="p">|</span> <span class="k">self</span><span class="py">.trees</span><span class="p">[</span><span class="n">x_</span> <span class="o">+</span> <span class="p">(</span><span class="k">self</span><span class="py">.w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">fy</span> <span class="o">=</span> <span class="p">|</span><span class="n">y_</span><span class="p">:</span> <span class="nb">usize</span><span class="p">|</span> <span class="k">self</span><span class="py">.trees</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="k">self</span><span class="py">.w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span>

        <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">x</span><span class="p">)</span><span class="nf">.all</span><span class="p">(</span><span class="n">fx</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">..</span><span class="k">self</span><span class="py">.w</span><span class="p">)</span><span class="nf">.all</span><span class="p">(</span><span class="n">fx</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">y</span><span class="p">)</span><span class="nf">.all</span><span class="p">(</span><span class="n">fy</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="o">..</span><span class="k">self</span><span class="py">.h</span><span class="p">)</span><span class="nf">.all</span><span class="p">(</span><span class="n">fy</span><span class="p">)</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then I count in the <code>star_1</code> function, how many trees are visible. For a tree on the boundary, <code>is_visible</code> always returns true, so no need to handle the boundary separately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">data</span><span class="py">.w</span><span class="p">)</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">data</span><span class="py">.h</span><span class="p">)</span><span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">y</span><span class="p">|</span> <span class="n">data</span><span class="nf">.is_visible</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span><span class="nf">.count</span><span class="p">())</span>
        <span class="py">.sum</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_8">Star 2</h3>
<div class="paragraph">
<p>Similar to star 1. This time, I use the function <code>scenic_score</code> to calculate the scenic score of each tree and the function <code>star_2</code> to find the maximum.</p>
</div>
<div class="paragraph">
<p>In the scenic score calculations, different to the visibility check, the traversal order matters. For left and top directions, the direction is reversed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre>    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">scenic_score</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">h</span> <span class="o">=</span> <span class="k">self</span><span class="py">.trees</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="k">self</span><span class="py">.w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">];</span>

        <span class="k">let</span> <span class="n">fx</span> <span class="o">=</span> <span class="p">|</span><span class="o">&amp;</span><span class="n">x_</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">usize</span><span class="p">|</span> <span class="k">self</span><span class="py">.trees</span><span class="p">[</span><span class="n">x_</span> <span class="o">+</span> <span class="p">(</span><span class="k">self</span><span class="py">.w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">h</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">fy</span> <span class="o">=</span> <span class="p">|</span><span class="o">&amp;</span><span class="n">y_</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">usize</span><span class="p">|</span> <span class="k">self</span><span class="py">.trees</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="k">self</span><span class="py">.w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">h</span><span class="p">;</span>

        <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">x</span><span class="p">)</span><span class="nf">.rev</span><span class="p">()</span><span class="nf">.find</span><span class="p">(</span><span class="n">fx</span><span class="p">)</span><span class="nf">.unwrap_or</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">..</span><span class="k">self</span><span class="py">.w</span><span class="p">)</span><span class="nf">.find</span><span class="p">(</span><span class="n">fx</span><span class="p">)</span><span class="nf">.unwrap_or</span><span class="p">(</span><span class="k">self</span><span class="py">.w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">y</span><span class="p">)</span><span class="nf">.rev</span><span class="p">()</span><span class="nf">.find</span><span class="p">(</span><span class="n">fy</span><span class="p">)</span><span class="nf">.unwrap_or</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
            <span class="o">*</span> <span class="p">((</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="o">..</span><span class="k">self</span><span class="py">.h</span><span class="p">)</span><span class="nf">.find</span><span class="p">(</span><span class="n">fy</span><span class="p">)</span><span class="nf">.unwrap_or</span><span class="p">(</span><span class="k">self</span><span class="py">.h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">data</span><span class="py">.w</span><span class="p">)</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">x</span><span class="p">|</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">data</span><span class="py">.h</span><span class="p">)</span><span class="nf">.map</span><span class="p">(|</span><span class="n">y</span><span class="p">|</span> <span class="n">data</span><span class="nf">.scenic_score</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span><span class="nf">.max</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">())</span>
        <span class="nf">.max</span><span class="p">()</span>
        <span class="nf">.unwrap</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_9">Tests</h3>
<div class="paragraph">
<p>Tests for <code>star_1</code>, <code>scenic_score</code> and <code>star_2</code> functions based on example defined in puzzle description.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"30373
25512
65332
33549
35390
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_scenic_score</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">data</span><span class="nf">.scenic_score</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-9">Day 9: Rope Bridge</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/9">AoC|2022|9</a>.</p>
</div>
<div class="paragraph">
<p>Knots are moving around, following each other. The difficulty is to figure out where you have your off by one errors or similar. In the end, I had a print function showing current configurations to debug my code (because it actually looks nice, you may want to have a look at the output with <code>cargo test test_star_2 -- --nocapture</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="code"><pre><span class="cd">/// Print knots for debugging purposes</span>
<span class="cd">///</span>
<span class="cd">/// Knots are printed by consecutive letters `a`, `b`, ... starting with the head at `a`</span>
<span class="cd">///</span>
<span class="cd">/// If a knot sits on a spot which is already seen, it is represented by a capital letter `A`, `B`, ...</span>
<span class="cd">///</span>
<span class="cd">/// The start is indicated by `$` if no knot is located at the start</span>
<span class="cd">///</span>
<span class="cd">/// Spots that have been seen and where currently no knot is located are shown as `#`</span>
<span class="cd">///</span>
<span class="cd">/// If several knots sit on top of each other, the first one in the chain is shown.</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">print</span><span class="p">(</span>
    <span class="n">rx</span><span class="p">:</span> <span class="n">RangeInclusive</span><span class="o">&lt;</span><span class="nb">isize</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">ry</span><span class="p">:</span> <span class="n">RangeInclusive</span><span class="o">&lt;</span><span class="nb">isize</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">knots</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)],</span>
    <span class="p">((</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">),</span> <span class="n">s</span><span class="p">):</span> <span class="p">((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="nb">usize</span><span class="p">),</span>
    <span class="n">seen</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">HashSet</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">After moving {s} times by ({dx}, {dy}):"</span><span class="p">);</span>
    <span class="k">for</span> <span class="n">y</span> <span class="k">in</span> <span class="n">ry</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">rx</span><span class="nf">.clone</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">seen</span> <span class="o">=</span> <span class="n">seen</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
            <span class="k">match</span> <span class="n">knots</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.enumerate</span><span class="p">()</span>
                <span class="nf">.find</span><span class="p">(|(</span><span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">xn</span><span class="p">,</span> <span class="n">yn</span><span class="p">))|</span> <span class="o">*</span><span class="n">xn</span> <span class="o">==</span> <span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">yn</span> <span class="o">==</span> <span class="n">y</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">Some</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span> <span class="k">if</span> <span class="n">seen</span> <span class="k">=&gt;</span> <span class="nd">print!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="p">(</span><span class="sc">b'A'</span> <span class="o">+</span> <span class="n">v</span> <span class="k">as</span> <span class="nb">u8</span><span class="p">)</span> <span class="k">as</span> <span class="nb">char</span><span class="p">),</span>
                <span class="nf">Some</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">_</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="nd">print!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="p">(</span><span class="sc">b'a'</span> <span class="o">+</span> <span class="n">v</span> <span class="k">as</span> <span class="nb">u8</span><span class="p">)</span> <span class="k">as</span> <span class="nb">char</span><span class="p">),</span>
                <span class="nb">None</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">=&gt;</span> <span class="nd">print!</span><span class="p">(</span><span class="s">"$"</span><span class="p">),</span>
                <span class="n">_</span> <span class="k">if</span> <span class="n">seen</span> <span class="k">=&gt;</span> <span class="nd">print!</span><span class="p">(</span><span class="s">"#"</span><span class="p">),</span>
                <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\u{00b7}</span><span class="s">"</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nd">println!</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_input_9">Input</h3>
<div class="paragraph">
<p>I parse the input in a vec of tuples <code>((dx, dy), s)</code> where <code>dx</code> and <code>dy</code> are the horizontal / vertical unit step changes and <code>s</code> is the number of steps.</p>
</div>
<div class="paragraph">
<p>Not allocating extra memory for today&#8217;s input parsing is not for me ;)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="n">moves</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="nb">usize</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">moves</span><span class="p">:</span> <span class="n">s</span>
                    <span class="nf">.lines</span><span class="p">()</span>
                    <span class="nf">.map</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="k">match</span> <span class="p">(</span><span class="n">l</span><span class="nf">.as_bytes</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="o">..</span><span class="p">]</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">())</span> <span class="p">{</span>
                        <span class="p">(</span><span class="sc">b'U'</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">s</span><span class="p">),</span>
                        <span class="p">(</span><span class="sc">b'D'</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">s</span><span class="p">),</span>
                        <span class="p">(</span><span class="sc">b'L'</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">s</span><span class="p">),</span>
                        <span class="p">(</span><span class="sc">b'R'</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">s</span><span class="p">),</span>
                        <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"No valid move: {l}"</span><span class="p">),</span>
                    <span class="p">})</span>
                    <span class="nf">.collect</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">moves</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="p">[((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="nb">usize</span><span class="p">)]</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.moves</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution">Solution</h3>
<div class="paragraph">
<p>After a little bit of refactoring, one solution works for both parts today. The solve function is called with the total number of knots (including head) as a parameter.</p>
</div>
<div class="paragraph">
<p>In each step, it updates the head and then all subsequent knots ony by one.</p>
</div>
<div class="paragraph">
<p>The debug function parameter is a clojure that is called after each move for debugging purposes. In the actual solution, an empty function is used. In the test cases, the <code>print</code> function is called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="n">solve</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="n">F</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span>
<span class="k">where</span>
    <span class="n">F</span><span class="p">:</span> <span class="nf">Fn</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)],</span> <span class="p">((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="nb">usize</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">HashSet</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(),</span>
<span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">seen</span><span class="p">:</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]);</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">knots</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">n</span><span class="p">];</span>

    <span class="k">for</span> <span class="p">((</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">),</span> <span class="n">s</span><span class="p">)</span> <span class="k">in</span> <span class="n">data</span><span class="nf">.moves</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..*</span><span class="n">s</span> <span class="p">{</span>
            <span class="n">knots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="na">.0</span> <span class="o">+=</span> <span class="o">*</span><span class="n">dx</span><span class="p">;</span>
            <span class="n">knots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="na">.1</span> <span class="o">+=</span> <span class="o">*</span><span class="n">dy</span><span class="p">;</span>

            <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">n</span> <span class="p">{</span>
                <span class="k">let</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">knots</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.0</span> <span class="o">-</span> <span class="n">knots</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.0</span><span class="p">;</span>
                <span class="k">let</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">knots</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span> <span class="o">-</span> <span class="n">knots</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.1</span><span class="p">;</span>

                <span class="n">knots</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.0</span> <span class="o">+=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">||</span> <span class="p">(</span><span class="n">dx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">dy</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="k">as</span> <span class="nb">isize</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">||</span> <span class="p">(</span><span class="n">dx</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">dy</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="k">as</span> <span class="nb">isize</span><span class="p">;</span>

                <span class="n">knots</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span> <span class="o">+=</span> <span class="p">(</span><span class="n">dy</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">||</span> <span class="p">(</span><span class="n">dy</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">dx</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="k">as</span> <span class="nb">isize</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">dy</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">||</span> <span class="p">(</span><span class="n">dy</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">dx</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="k">as</span> <span class="nb">isize</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">seen</span><span class="nf">.insert</span><span class="p">(</span><span class="n">knots</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="nf">debug</span><span class="p">(</span><span class="o">&amp;</span><span class="n">knots</span><span class="p">,</span> <span class="p">((</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="o">*</span><span class="n">dy</span><span class="p">),</span> <span class="o">*</span><span class="n">s</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">seen</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">seen</span><span class="nf">.len</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_10">Tests</h3>
<div class="paragraph">
<p>The usual tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"R 4
U 4
L 3
D 1
R 4
D 1
L 5
R 2
"#</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT_2</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"R 5
U 8
L 8
D 3
R 17
D 10
L 25
U 20
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_try_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="mi">13</span><span class="p">,</span>
            <span class="nf">solve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">|</span><span class="n">knots</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="n">seen</span><span class="p">|</span> <span class="nf">print</span><span class="p">(</span>
                <span class="mi">0</span><span class="o">..=</span><span class="mi">5</span><span class="p">,</span>
                <span class="o">-</span><span class="mi">5</span><span class="o">..=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">knots</span><span class="p">,</span>
                <span class="n">mv</span><span class="p">,</span>
                <span class="n">seen</span>
            <span class="p">))</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">solve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">|</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="p">()));</span>

        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT_2</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="mi">36</span><span class="p">,</span>
            <span class="nf">solve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">|</span><span class="n">knots</span><span class="p">,</span> <span class="n">mv</span><span class="p">,</span> <span class="n">seen</span><span class="p">|</span> <span class="nf">print</span><span class="p">(</span>
                <span class="o">-</span><span class="mi">11</span><span class="o">..=</span><span class="mi">14</span><span class="p">,</span>
                <span class="o">-</span><span class="mi">15</span><span class="o">..=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">knots</span><span class="p">,</span>
                <span class="n">mv</span><span class="p">,</span>
                <span class="n">seen</span>
            <span class="p">))</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_today_i_learned_7">Today I learned</h3>
<div class="paragraph">
<p>That sometimes it is helpful to write <code>as _</code> to give the rust compiler a hint to perform type coercion. Although in the end, I did not use it in my solution.</p>
</div>
<div class="paragraph">
<p>And, today for the first time, I used my scripted solution to submit results. Not because it is faster (who cares about a few seconds) but because it is fun.</p>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-10">Day 10: Cathode-Ray Tube</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/10">AoC|2022|10</a>.</p>
</div>
<div class="paragraph">
<p>Today is about a simple CPU which is used to control a simple display (a cathode-ray tube)</p>
</div>
<div class="sect2">
<h3 id="_input_10">Input</h3>
<div class="paragraph">
<p>Parsing the input is straight forward. Each line represents either an <code>addx</code> operation or a <code>noop</code> operation</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq,</span> <span class="nd">Clone,</span> <span class="nd">Copy)]</span>
    <span class="k">pub</span> <span class="k">enum</span> <span class="n">Instr</span> <span class="p">{</span>
        <span class="n">NoOp</span><span class="p">,</span>
        <span class="nf">AddX</span><span class="p">(</span><span class="nb">isize</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="n">instructions</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Instr</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">instructions</span><span class="p">:</span> <span class="n">s</span>
                    <span class="nf">.lines</span><span class="p">()</span>
                    <span class="nf">.map</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="k">match</span> <span class="n">l</span> <span class="p">{</span>
                        <span class="s">"noop"</span> <span class="k">=&gt;</span> <span class="nn">Instr</span><span class="p">::</span><span class="n">NoOp</span><span class="p">,</span>
                        <span class="n">_</span> <span class="k">=&gt;</span> <span class="nn">Instr</span><span class="p">::</span><span class="nf">AddX</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">5</span><span class="o">..</span><span class="p">]</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()),</span>
                    <span class="p">})</span>
                    <span class="nf">.collect</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">instructions</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">Instr</span><span class="p">]</span> <span class="p">{</span>
            <span class="o">&amp;&amp;</span><span class="k">self</span><span class="py">.instructions</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_9">Star 1</h3>
<div class="paragraph">
<p>I created a small model of the CPU:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">Cpu</span> <span class="p">{</span>
    <span class="n">instructions</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Instr</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">pointer</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="n">cycle</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="n">timer</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">isize</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Cpu</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">init</span><span class="p">(</span><span class="n">instructions</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">Instr</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">cpu</span> <span class="o">=</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="n">instructions</span><span class="p">:</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">instructions</span><span class="p">),</span>
            <span class="n">pointer</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">cycle</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">timer</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">};</span>

        <span class="c1">// set initial timer if required</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nn">Instr</span><span class="p">::</span><span class="nf">AddX</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">cpu</span><span class="py">.instructions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">{</span>
            <span class="n">cpu</span><span class="py">.timer</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">cpu</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">step</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// should not be called if no more instructions</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="k">self</span><span class="py">.pointer</span> <span class="o">&lt;</span> <span class="k">self</span><span class="py">.instructions</span><span class="nf">.len</span><span class="p">(),</span> <span class="s">"Cpu halted"</span><span class="p">);</span>

        <span class="k">if</span> <span class="k">self</span><span class="py">.timer</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="c1">// only decrement timer</span>
            <span class="k">self</span><span class="py">.timer</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// apply increment</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nn">Instr</span><span class="p">::</span><span class="nf">AddX</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="py">.instructions</span><span class="p">[</span><span class="k">self</span><span class="py">.pointer</span><span class="p">]</span> <span class="p">{</span>
                <span class="k">self</span><span class="py">.x</span> <span class="o">+=</span> <span class="n">inc</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// increment pointer</span>
            <span class="k">self</span><span class="py">.pointer</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

            <span class="c1">// set timer if required</span>
            <span class="k">if</span> <span class="k">self</span><span class="py">.pointer</span> <span class="o">&lt;</span> <span class="k">self</span><span class="py">.instructions</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nn">Instr</span><span class="p">::</span><span class="nf">AddX</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="py">.instructions</span><span class="p">[</span><span class="k">self</span><span class="py">.pointer</span><span class="p">]</span> <span class="p">{</span>
                    <span class="k">self</span><span class="py">.timer</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// increment cycle counter</span>
        <span class="k">self</span><span class="py">.cycle</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most difficult part was to read the puzzle description carefully. Specifically the part were it says to calculate the signal strength <strong>during</strong> and not <strong>after</strong> the 20th, 60th, &#8230;&#8203; cycle.</p>
</div>
<div class="paragraph">
<p>The rest was just applying the instructions giving in the puzzle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">isize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">cpu</span> <span class="o">=</span> <span class="nn">Cpu</span><span class="p">::</span><span class="nf">init</span><span class="p">(</span><span class="n">data</span><span class="nf">.instructions</span><span class="p">());</span>

    <span class="c1">// we first look during 20th cycle, i.e., after 19th cycle</span>
    <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">19</span> <span class="p">{</span>
        <span class="n">cpu</span><span class="nf">.step</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">cpu</span><span class="py">.cycle</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cpu</span><span class="py">.x</span><span class="p">;</span>

    <span class="c1">// 5 blocks of 40 cycles</span>
    <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">5</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">40</span> <span class="p">{</span>
            <span class="n">cpu</span><span class="nf">.step</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">v</span> <span class="o">+=</span> <span class="p">(</span><span class="n">cpu</span><span class="py">.cycle</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cpu</span><span class="py">.x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">v</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_9">Star 2</h3>
<div class="paragraph">
<p>Again, reading carefully is important. I did not get the meaning of</p>
</div>
<div class="listingblock">
<div class="content">
<pre>In this system, there is no such thing as "vertical position"</pre>
</div>
</div>
<div class="paragraph">
<p>After having that fixed, it was again straight forward. It somehow feels incorrect to manually read the "LCD" to produce the result to enter at the website, hence I created a little helper which recognizes the letters. Since there is nothing to recognize for the sample data, I put the recognition in a separate function to still be able to run my code on the examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">solve_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">[</span><span class="nb">u8</span><span class="p">;</span> <span class="mi">240</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">W</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">H</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>

    <span class="c1">// initialize lcd with new lines, W + 1 to keep new lines at the and</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">lcd</span> <span class="o">=</span> <span class="p">[</span><span class="sc">b'.'</span><span class="p">;</span> <span class="n">W</span> <span class="o">*</span> <span class="n">H</span><span class="p">];</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">cpu</span> <span class="o">=</span> <span class="nn">Cpu</span><span class="p">::</span><span class="nf">init</span><span class="p">(</span><span class="n">data</span><span class="nf">.instructions</span><span class="p">());</span>
    <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">H</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">col</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">W</span> <span class="p">{</span>
            <span class="n">lcd</span><span class="p">[</span><span class="n">col</span> <span class="k">as</span> <span class="nb">usize</span> <span class="o">+</span> <span class="n">W</span> <span class="o">*</span> <span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">cpu</span><span class="py">.x</span> <span class="o">-</span> <span class="mi">1</span><span class="o">..=</span><span class="n">cpu</span><span class="py">.x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">col</span> <span class="k">as</span> <span class="n">_</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">LIT</span> <span class="k">as</span> <span class="nb">u8</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">DARK</span> <span class="k">as</span> <span class="nb">u8</span>
            <span class="p">};</span>
            <span class="n">cpu</span><span class="nf">.step</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">lcd</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="nf">solve_2</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="nf">.decode</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_11">Tests</h3>
<div class="paragraph">
<p>A bit of tests, as usual &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_try_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">13_140</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_solve_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="nf">solve_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">with_capacity</span><span class="p">(</span><span class="mi">41</span> <span class="o">*</span> <span class="mi">6</span><span class="p">);</span>
        <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">6</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">col</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">40</span> <span class="p">{</span>
                <span class="n">s</span><span class="nf">.push</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">row</span><span class="p">]</span> <span class="k">as</span> <span class="n">_</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">s</span><span class="nf">.push</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">EXP_2</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_simple</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT_SIMPLE</span><span class="p">);</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">cpu</span> <span class="o">=</span> <span class="nn">Cpu</span><span class="p">::</span><span class="nf">init</span><span class="p">(</span><span class="n">data</span><span class="nf">.instructions</span><span class="p">());</span>
        <span class="k">let</span> <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">5</span><span class="p">)</span>
            <span class="nf">.map</span><span class="p">(|</span><span class="n">_</span><span class="p">|</span> <span class="p">{</span>
                <span class="n">cpu</span><span class="nf">.step</span><span class="p">();</span>
                <span class="n">cpu</span><span class="py">.x</span>
            <span class="p">})</span>
            <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">exp</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">isize</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">];</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="n">CONTENT_SIMPLE</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"noop
addx 3
addx -5"#</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">EXP_2</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r"##..##..##..##..##..##..##..##..##..##..
###...###...###...###...###...###...###.
####....####....####....####....####....
#####.....#####.....#####.....#####.....
######......######......######......####
#######.......#######.......#######.....
"</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"addx 15
addx -11
addx 6
addx -3
addx 5
addx -1
addx -8
addx 13
addx 4
noop
addx -1
addx 5
addx -1
addx 5
addx -1
addx 5
addx -1
addx 5
addx -1
addx -35
addx 1
addx 24
addx -19
addx 1
addx 16
addx -11
noop
noop
addx 21
addx -15
noop
noop
addx -3
addx 9
addx 1
addx -3
addx 8
addx 1
addx 5
noop
noop
noop
noop
noop
addx -36
noop
addx 1
addx 7
noop
noop
noop
addx 2
addx 6
noop
noop
noop
noop
noop
addx 1
noop
noop
addx 7
addx 1
noop
addx -13
addx 13
addx 7
noop
addx 1
addx -33
noop
noop
noop
addx 2
noop
noop
noop
addx 8
noop
addx -1
addx 2
addx 1
noop
addx 17
addx -9
addx 1
addx 1
addx -3
addx 11
noop
noop
addx 1
noop
addx 1
noop
noop
addx -13
addx -19
addx 1
addx 3
addx 26
addx -30
addx 12
addx -1
addx 3
addx 1
noop
noop
noop
addx -9
addx 18
addx 1
addx 2
noop
noop
addx 9
noop
noop
noop
addx -1
addx 2
addx -37
addx 1
addx 3
noop
addx 15
addx -21
addx 22
addx -6
addx 1
noop
addx 2
addx 1
noop
addx -10
noop
noop
addx 20
addx 1
addx 2
addx 2
addx -6
addx -11
noop
noop
noop
"#</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-11">Day 11: Monkey in the Middle</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/11">AoC|2022|11</a>.</p>
</div>
<div class="paragraph">
<p>It was quite tedious today for me to create the solution.</p>
</div>
<div class="paragraph">
<p>I liked the twist in part 2. Since each monkey does a modulo <code>test</code> before passing on the item, we can safely do a modulo with the product of all tests of all monkeys to keep the numbers small. Still took me a while to complete part two because I just replaced the <code>/ 3</code> from the first part with <code>/ mod</code> in the second part which is obviously not the same as <code>% mod</code>. And I have to confess that my first attempt was to use 128bit numbers.</p>
</div>
<div class="sect2">
<h3 id="_input_11">Input</h3>
<div class="paragraph">
<p>Parsing was a pain today. I almost regret my decision to not use external dependencies (and thus not use Regex) &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq,</span> <span class="nd">Clone,</span> <span class="nd">Copy)]</span>
    <span class="k">pub</span> <span class="k">enum</span> <span class="n">Operation</span> <span class="p">{</span>
        <span class="nf">Plus</span><span class="p">(</span><span class="nb">usize</span><span class="p">),</span>
        <span class="nf">Times</span><span class="p">(</span><span class="nb">usize</span><span class="p">),</span>
        <span class="n">Square</span><span class="p">,</span>
        <span class="n">Double</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="n">Operation</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
            <span class="k">match</span> <span class="k">self</span> <span class="p">{</span>
                <span class="nn">Operation</span><span class="p">::</span><span class="nf">Plus</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">item</span> <span class="o">+</span> <span class="n">v</span><span class="p">,</span>
                <span class="nn">Operation</span><span class="p">::</span><span class="nf">Times</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">item</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span>
                <span class="nn">Operation</span><span class="p">::</span><span class="n">Square</span> <span class="k">=&gt;</span> <span class="n">item</span> <span class="o">*</span> <span class="n">item</span><span class="p">,</span>
                <span class="nn">Operation</span><span class="p">::</span><span class="n">Double</span> <span class="k">=&gt;</span> <span class="n">item</span> <span class="o">+</span> <span class="n">item</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">#[derive(Debug,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq,</span> <span class="nd">Clone)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">Monkey</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">worries</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">upd</span><span class="p">:</span> <span class="n">Operation</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">test</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">if_true</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">if_false</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Monkey</span> <span class="p">{</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">monkey</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">words</span> <span class="o">=</span> <span class="n">monkey</span><span class="nf">.split_ascii_whitespace</span><span class="p">();</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// Monkey &lt;id&gt;: Starting items:</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">worries</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">word</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
            <span class="k">while</span> <span class="n">word</span> <span class="o">!=</span> <span class="s">"Operation:"</span> <span class="p">{</span>
                <span class="n">worries</span><span class="nf">.push</span><span class="p">(</span><span class="n">word</span><span class="nf">.trim_end_matches</span><span class="p">(</span><span class="sc">','</span><span class="p">)</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">());</span>
                <span class="n">word</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// new = old</span>

            <span class="k">let</span> <span class="n">upd</span> <span class="o">=</span> <span class="k">match</span> <span class="p">(</span><span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">(),</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">())</span> <span class="p">{</span>
                <span class="p">(</span><span class="s">"*"</span><span class="p">,</span> <span class="s">"old"</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">Operation</span><span class="p">::</span><span class="n">Square</span><span class="p">,</span>
                <span class="p">(</span><span class="s">"+"</span><span class="p">,</span> <span class="s">"old"</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">Operation</span><span class="p">::</span><span class="n">Double</span><span class="p">,</span>
                <span class="p">(</span><span class="s">"*"</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">Operation</span><span class="p">::</span><span class="nf">Times</span><span class="p">(</span><span class="n">v</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()),</span>
                <span class="p">(</span><span class="s">"+"</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">Operation</span><span class="p">::</span><span class="nf">Plus</span><span class="p">(</span><span class="n">v</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()),</span>
                <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(),</span>
            <span class="p">};</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// Test: divisible by</span>

            <span class="k">let</span> <span class="n">test</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// If true: throw to monkey</span>

            <span class="k">let</span> <span class="n">if_true</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// If false: throw to monkey</span>

            <span class="k">let</span> <span class="n">if_false</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">worries</span><span class="p">,</span>
                <span class="n">upd</span><span class="p">,</span>
                <span class="n">test</span><span class="p">,</span>
                <span class="n">if_true</span><span class="p">,</span>
                <span class="n">if_false</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="n">monkeys</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Monkey</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">monkeys</span><span class="p">:</span> <span class="n">s</span><span class="nf">.split</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">)</span><span class="nf">.map</span><span class="p">(</span><span class="nn">Monkey</span><span class="p">::</span><span class="n">from</span><span class="p">)</span><span class="nf">.collect</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">monkeys</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">Monkey</span><span class="p">]</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.monkeys</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_2">Solution</h3>
<div class="paragraph">
<p>Here is my solution for both parts. The <code>solve</code> function is called with <code>div = 3</code> for the first part and <code>div = 1</code> for the second.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">round</span><span class="p">(</span><span class="n">monkeys</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Monkey</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">div</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">id</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">monkeys</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">+=</span> <span class="n">monkeys</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="py">.worries</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">monkeys</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="py">.worries</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">worry</span> <span class="o">=</span> <span class="p">(</span><span class="n">monkeys</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="py">.upd</span><span class="nf">.apply</span><span class="p">(</span><span class="n">monkeys</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="py">.worries</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">/</span> <span class="n">div</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span><span class="p">;</span>
            <span class="k">let</span> <span class="n">target</span> <span class="o">=</span> <span class="k">if</span> <span class="n">worry</span> <span class="o">%</span> <span class="n">monkeys</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="py">.test</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="n">monkeys</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="py">.if_true</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">monkeys</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="py">.if_false</span>
            <span class="p">};</span>
            <span class="n">monkeys</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="py">.worries</span><span class="nf">.push</span><span class="p">(</span><span class="n">worry</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">monkeys</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="py">.worries</span><span class="nf">.clear</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">solve</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">,</span> <span class="n">div</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">rounds</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">monkeys</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">data</span><span class="nf">.monkeys</span><span class="p">());</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">counts</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="n">monkeys</span><span class="nf">.len</span><span class="p">()];</span>
    <span class="k">let</span> <span class="n">m</span> <span class="o">=</span> <span class="n">monkeys</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">monkey</span><span class="p">|</span> <span class="n">monkey</span><span class="py">.test</span><span class="p">)</span><span class="nf">.product</span><span class="p">();</span>

    <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">rounds</span> <span class="p">{</span>
        <span class="nf">round</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">monkeys</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">counts</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">counts</span><span class="nf">.sort_unstable</span><span class="p">();</span>

    <span class="n">counts</span><span class="nf">.pop</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span> <span class="k">as</span> <span class="nb">usize</span> <span class="o">*</span> <span class="n">counts</span><span class="nf">.pop</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span> <span class="k">as</span> <span class="nb">usize</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_12">Tests</h3>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>and the tests</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"Monkey 0:
Starting items: 79, 98
Operation: new = old * 19
Test: divisible by 23
  If true: throw to monkey 2
  If false: throw to monkey 3

Monkey 1:
Starting items: 54, 65, 75, 74
Operation: new = old + 6
Test: divisible by 19
  If true: throw to monkey 2
  If false: throw to monkey 0

Monkey 2:
Starting items: 79, 60, 97
Operation: new = old * old
Test: divisible by 13
  If true: throw to monkey 1
  If false: throw to monkey 3

Monkey 3:
Starting items: 74
Operation: new = old + 3
Test: divisible by 17
  If true: throw to monkey 0
  If false: throw to monkey 1
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_round</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">monkeys</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">data</span><span class="nf">.monkeys</span><span class="p">());</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">counts</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="n">monkeys</span><span class="nf">.len</span><span class="p">()];</span>
        <span class="nf">round</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">monkeys</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">counts</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nd">vec!</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">26</span><span class="p">],</span> <span class="n">monkeys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="py">.worries</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nd">vec!</span><span class="p">[</span><span class="mi">2080</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">401</span><span class="p">,</span> <span class="mi">1046</span><span class="p">],</span> <span class="n">monkeys</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="py">.worries</span><span class="p">);</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="n">monkeys</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="py">.worries</span><span class="nf">.is_empty</span><span class="p">());</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="n">monkeys</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="py">.worries</span><span class="nf">.is_empty</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">10605</span><span class="p">,</span> <span class="nf">solve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> <span class="nf">solve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">99</span> <span class="o">*</span> <span class="mi">103</span><span class="p">,</span> <span class="nf">solve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">));</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">2_713_310_158</span><span class="p">,</span> <span class="nf">solve</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-12">Day 12: Hill Climbing Algorithm</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/12">AoC|2022|12</a>.</p>
</div>
<div class="paragraph">
<p>The first path finding challenge in 2022&#8217;s AoC edition ;)</p>
</div>
<div class="sect2">
<h3 id="_input_12">Input</h3>
<div class="paragraph">
<p>I parse the input into a grid of bytes stored in a vec and additionally determine the starting position, the target position and the width of the grid.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">grid</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">u8</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">width</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">start</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">target</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">width</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.find</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">grid</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">s</span>
                <span class="nf">.as_bytes</span><span class="p">()</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.cloned</span><span class="p">()</span>
                <span class="nf">.filter</span><span class="p">(|</span><span class="n">b</span><span class="p">|</span> <span class="o">*</span><span class="n">b</span> <span class="o">!=</span> <span class="sc">b'\n'</span><span class="p">)</span>
                <span class="nf">.collect</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="n">grid</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'S'</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">target</span> <span class="o">=</span> <span class="n">grid</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'E'</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

            <span class="n">grid</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="sc">b'a'</span><span class="p">;</span>
            <span class="n">grid</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="sc">b'z'</span><span class="p">;</span>

            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">grid</span><span class="p">,</span>
                <span class="n">width</span><span class="p">,</span>
                <span class="n">start</span><span class="p">,</span>
                <span class="n">target</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_10">Star 1</h3>
<div class="paragraph">
<p>The shortest path is found by a breadth first traversal.</p>
</div>
<div class="paragraph">
<p>The function <code>shortest_path</code> returns an option with a <code>None</code> value in case no path is found. My initial version just panicked in that case which turned out to not be good enough for part 2.</p>
</div>
<div class="paragraph">
<p>Today, I made the baddest mistake ever: I put the wrong number in my test (32 instead of 31) and was trying to figure out for quite some while where I inserted an off-by-one error in my code until I figured that my expected value was wrong.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">shortest_path</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">queue</span> <span class="o">=</span> <span class="nn">VecDeque</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="n">queue</span><span class="nf">.push_back</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">start</span><span class="p">));</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">seen</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="kc">false</span><span class="p">;</span> <span class="n">data</span><span class="py">.grid</span><span class="nf">.len</span><span class="p">()];</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="k">let</span> <span class="n">height</span> <span class="o">=</span> <span class="n">data</span><span class="py">.grid</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">data</span><span class="py">.width</span><span class="p">;</span>

    <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">((</span><span class="n">steps</span><span class="p">,</span> <span class="n">pos</span><span class="p">))</span> <span class="o">=</span> <span class="n">queue</span><span class="nf">.pop_front</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">data</span><span class="py">.target</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Some</span><span class="p">(</span><span class="n">steps</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">%</span> <span class="n">data</span><span class="py">.width</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">/</span> <span class="n">data</span><span class="py">.width</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">chk</span><span class="p">,</span> <span class="n">nxt</span><span class="p">)</span> <span class="k">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pos</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">data</span><span class="py">.width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pos</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pos</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">-</span> <span class="n">data</span><span class="py">.width</span> <span class="k">as</span> <span class="nb">isize</span><span class="p">),</span>
            <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pos</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">+</span> <span class="n">data</span><span class="py">.width</span> <span class="k">as</span> <span class="nb">isize</span><span class="p">),</span>
        <span class="p">]</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">chk</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">seen</span><span class="p">[</span><span class="n">nxt</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="py">.grid</span><span class="p">[</span><span class="n">nxt</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">data</span><span class="py">.grid</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="n">queue</span><span class="nf">.push_back</span><span class="p">((</span><span class="n">steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxt</span> <span class="k">as</span> <span class="n">_</span><span class="p">));</span>
                <span class="n">seen</span><span class="p">[</span><span class="n">nxt</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nb">None</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="nf">shortest_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="py">.start</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_10">Star 2</h3>
<div class="paragraph">
<p>Just perform shortest path calculation for all possible starting positions (that was my solution to submit the answer)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2_original</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">data</span><span class="py">.grid</span><span class="nf">.len</span><span class="p">())</span>
        <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">k</span><span class="p">|</span> <span class="n">data</span><span class="py">.grid</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b'a'</span><span class="p">)</span>
        <span class="nf">.filter_map</span><span class="p">(|</span><span class="n">start</span><span class="p">|</span> <span class="nf">shortest_path</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
        <span class="nf">.min</span><span class="p">()</span>
        <span class="nf">.unwrap</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then I realized it is much simpler if I just reverse the search direction and look for the shortest path from the target to any 'a'. So I did that to have another sub 1ms solution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="n">shortest_path_2</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span> <span class="n">G</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">reached</span><span class="p">:</span> <span class="n">F</span><span class="p">,</span> <span class="n">check</span><span class="p">:</span> <span class="n">G</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span>
<span class="k">where</span>
    <span class="n">F</span><span class="p">:</span> <span class="nf">Fn</span><span class="p">(</span><span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">G</span><span class="p">:</span> <span class="nf">Fn</span><span class="p">(</span><span class="nb">u8</span><span class="p">,</span> <span class="nb">u8</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">queue</span> <span class="o">=</span> <span class="nn">VecDeque</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="n">queue</span><span class="nf">.push_back</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">start</span><span class="p">));</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">seen</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="kc">false</span><span class="p">;</span> <span class="n">data</span><span class="py">.grid</span><span class="nf">.len</span><span class="p">()];</span>
    <span class="n">seen</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="k">let</span> <span class="n">height</span> <span class="o">=</span> <span class="n">data</span><span class="py">.grid</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">data</span><span class="py">.width</span><span class="p">;</span>

    <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">((</span><span class="n">steps</span><span class="p">,</span> <span class="n">pos</span><span class="p">))</span> <span class="o">=</span> <span class="n">queue</span><span class="nf">.pop_front</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nf">reached</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Some</span><span class="p">(</span><span class="n">steps</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">%</span> <span class="n">data</span><span class="py">.width</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">/</span> <span class="n">data</span><span class="py">.width</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">chk</span><span class="p">,</span> <span class="n">nxt</span><span class="p">)</span> <span class="k">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pos</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">data</span><span class="py">.width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pos</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pos</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">-</span> <span class="n">data</span><span class="py">.width</span> <span class="k">as</span> <span class="nb">isize</span><span class="p">),</span>
            <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pos</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">+</span> <span class="n">data</span><span class="py">.width</span> <span class="k">as</span> <span class="nb">isize</span><span class="p">),</span>
        <span class="p">]</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">chk</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">seen</span><span class="p">[</span><span class="n">nxt</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nf">check</span><span class="p">(</span><span class="n">data</span><span class="py">.grid</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="n">data</span><span class="py">.grid</span><span class="p">[</span><span class="n">nxt</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">queue</span><span class="nf">.push_back</span><span class="p">((</span><span class="n">steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nxt</span> <span class="k">as</span> <span class="n">_</span><span class="p">));</span>
                <span class="n">seen</span><span class="p">[</span><span class="n">nxt</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nb">None</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="nf">shortest_path_2</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span>
        <span class="n">data</span><span class="py">.target</span><span class="p">,</span>
        <span class="p">|</span><span class="n">pos</span><span class="p">|</span> <span class="n">data</span><span class="py">.grid</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b'a'</span><span class="p">,</span>
        <span class="p">|</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">|</span> <span class="n">f</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nf">.unwrap</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>shortest_path_2</code> function is generic to also work for part 1, but I did not change it in my code. Here is how to call it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><span class="nf">shortest_path_2</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="py">.start</span><span class="p">,</span> <span class="p">|</span><span class="n">pos</span><span class="p">|</span> <span class="n">pos</span> <span class="o">==</span> <span class="n">data</span><span class="py">.target</span><span class="p">,</span> <span class="p">|</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">|</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">f</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">()</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_13">Tests</h3>
<div class="paragraph">
<p>And the mandatory tests. But be careful, if a test of the type <code>expected == actual</code> fails, there are two possible reasons: <code>actual</code> can be wrong or <code>expected</code> can be wrong.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"Sabqponm
abcryxxl
accszExk
acctuvwj
abdefghi
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">data</span><span class="py">.width</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="py">.start</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="n">data</span><span class="py">.target</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-13">Day 13: Distress Signal</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/13">AoC|2022|13</a>.</p>
</div>
<div class="paragraph">
<p>My initial solution was based on "If the input looks like a tree structure, parse it into a tree structure!"</p>
</div>
<div class="sect2">
<h3 id="_input_13">Input</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre>    <span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
        <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="nn">node</span><span class="p">::</span><span class="n">Node</span><span class="p">;</span>

        <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
            <span class="k">pub</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
                <span class="k">Self</span> <span class="p">{</span>
                    <span class="n">nodes</span><span class="p">:</span> <span class="n">s</span>
                        <span class="nf">.lines</span><span class="p">()</span>
                        <span class="nf">.filter</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="o">!</span><span class="n">l</span><span class="nf">.is_empty</span><span class="p">())</span>
                        <span class="nf">.map</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
                        <span class="nf">.collect</span><span class="p">(),</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_solution_3">Solution</h3>
<div class="paragraph">
<p>The whole work for the solution is in the recursive <code>Node</code> enum modeling the trees represented by the puzzle input with its implementation. Namely recursive parsing in the <code>parse</code> function and comparison in the <code>Ord</code> trait implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre></td><td class="code"><pre>    <span class="k">pub</span> <span class="k">mod</span> <span class="n">node</span> <span class="p">{</span>
        <span class="cd">//! Tree structure for recursive lists from puzzle</span>
        <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">cmp</span><span class="p">::</span><span class="n">Ordering</span><span class="p">;</span>

        <span class="nd">#[derive(Debug,</span> <span class="nd">Eq,</span> <span class="nd">PartialEq,</span> <span class="nd">Clone)]</span>
        <span class="k">pub</span> <span class="k">enum</span> <span class="n">Node</span> <span class="p">{</span>
            <span class="nf">List</span><span class="p">(</span><span class="nb">Box</span><span class="o">&lt;</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span><span class="o">&gt;</span><span class="p">),</span>
            <span class="nf">Value</span><span class="p">(</span><span class="nb">usize</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">impl</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span> <span class="k">for</span> <span class="n">Node</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
                <span class="k">match</span> <span class="k">self</span> <span class="p">{</span>
                    <span class="nn">Node</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="n">list</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                        <span class="sc">'['</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                        <span class="k">for</span> <span class="n">n</span> <span class="k">in</span> <span class="n">list</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.take</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">n</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">for</span> <span class="n">n</span> <span class="k">in</span> <span class="n">list</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                            <span class="sc">','</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                            <span class="n">n</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="sc">']'</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="nn">Node</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">value</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">,</span>
                <span class="p">}</span>

                <span class="nf">Ok</span><span class="p">(())</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Node</span>
        <span class="k">where</span>
            <span class="n">T</span><span class="p">:</span> <span class="nb">AsRef</span><span class="o">&lt;</span><span class="p">[</span><span class="nb">u8</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
                <span class="k">Self</span><span class="p">::</span><span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="nf">.as_ref</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span><span class="na">.0</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span> <span class="nb">Ord</span> <span class="k">for</span> <span class="n">Node</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Ordering</span> <span class="p">{</span>
                <span class="k">match</span> <span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
                    <span class="p">(</span><span class="nn">Node</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="n">lhs</span><span class="p">),</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="n">rhs</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="p">{</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">lhs</span><span class="nf">.len</span><span class="p">()</span><span class="nf">.min</span><span class="p">(</span><span class="n">rhs</span><span class="nf">.len</span><span class="p">())</span> <span class="p">{</span>
                            <span class="k">let</span> <span class="n">o</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="nf">.cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rhs</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
                            <span class="k">if</span> <span class="n">o</span> <span class="o">!=</span> <span class="nn">Ordering</span><span class="p">::</span><span class="n">Equal</span> <span class="p">{</span>
                                <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="n">lhs</span><span class="nf">.len</span><span class="p">()</span><span class="nf">.cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rhs</span><span class="nf">.len</span><span class="p">())</span>
                    <span class="p">}</span>
                    <span class="p">(</span><span class="nn">Node</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">lhs</span><span class="p">),</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">rhs</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="n">lhs</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">rhs</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">rhs</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="k">self</span><span class="nf">.cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="nn">Node</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="nd">vec!</span><span class="p">[</span><span class="nn">Node</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="o">*</span><span class="n">rhs</span><span class="p">)]</span><span class="nf">.into</span><span class="p">())),</span>
                    <span class="p">(</span><span class="nn">Node</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">lhs</span><span class="p">),</span> <span class="n">_</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="nd">vec!</span><span class="p">[</span><span class="nn">Node</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="o">*</span><span class="n">lhs</span><span class="p">)]</span><span class="nf">.into</span><span class="p">())</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">other</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span> <span class="nb">PartialOrd</span> <span class="k">for</span> <span class="n">Node</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">partial_cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Ordering</span><span class="o">&gt;</span> <span class="p">{</span>
                <span class="nf">Some</span><span class="p">(</span><span class="k">self</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span> <span class="n">Node</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">u8</span><span class="p">],</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="k">Self</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b'['</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b']'</span> <span class="p">{</span>
                    <span class="c1">// handle empty list separately</span>
                    <span class="p">(</span><span class="k">Self</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="nd">vec!</span><span class="p">[]</span><span class="nf">.into</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b'['</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="k">mut</span> <span class="n">v</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
                    <span class="k">let</span> <span class="k">mut</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="k">loop</span> <span class="p">{</span>
                        <span class="k">let</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="k">Self</span><span class="p">::</span><span class="nf">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">len</span><span class="p">);</span>
                        <span class="n">v</span><span class="nf">.push</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
                        <span class="n">len</span> <span class="o">+=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b']'</span> <span class="p">{</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="p">(</span><span class="k">Self</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="n">v</span><span class="nf">.into</span><span class="p">()),</span> <span class="n">len</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="k">mut</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">let</span> <span class="k">mut</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">while</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">len</span> <span class="o">&lt;</span> <span class="n">s</span><span class="nf">.len</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="n">len</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="sc">b'0'</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="n">len</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="sc">b'9'</span> <span class="p">{</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="n">len</span><span class="p">]</span> <span class="o">-</span> <span class="sc">b'0'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">;</span>
                        <span class="n">len</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="p">(</span><span class="k">Self</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">len</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_11">Star 1</h3>
<div class="paragraph">
<p>Do the pairwise comparisons.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
        <span class="n">data</span><span class="py">.nodes</span>
            <span class="nf">.iter</span><span class="p">()</span>
            <span class="nf">.step_by</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="nf">.zip</span><span class="p">(</span><span class="n">data</span><span class="py">.nodes</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="nf">.step_by</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="nf">.enumerate</span><span class="p">()</span>
            <span class="nf">.filter</span><span class="p">(|(</span><span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))|</span> <span class="n">a</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">!=</span> <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span><span class="p">)</span>
            <span class="nf">.fold</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">|</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">)|</span> <span class="n">s</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_11">Star 2</h3>
<div class="paragraph">
<p>Find the position of the divider packets after sorting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre>    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="py">.nodes</span><span class="nf">.clone</span><span class="p">();</span>
        <span class="n">v</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Node</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"[[2]]"</span><span class="p">));</span>
        <span class="n">v</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Node</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"[[6]]"</span><span class="p">));</span>
        <span class="n">v</span><span class="nf">.sort_unstable</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="n">v</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="n">n</span><span class="p">|</span> <span class="n">n</span> <span class="o">==</span> <span class="o">&amp;</span><span class="nn">Node</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"[[2]]"</span><span class="p">))</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="n">v</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="n">n</span><span class="p">|</span> <span class="n">n</span> <span class="o">==</span> <span class="o">&amp;</span><span class="nn">Node</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"[[6]]"</span><span class="p">))</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_14">Tests</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td><td class="code"><pre>    <span class="nd">#[cfg(test)]</span>
    <span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
        <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
        <span class="k">use</span> <span class="k">crate</span><span class="p">::</span><span class="nn">tree</span><span class="p">::</span><span class="nn">node</span><span class="p">::</span><span class="n">Node</span><span class="p">;</span>

        <span class="nd">#[test]</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_parse</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="s">"[1,[2,[3,[4,[5,6,7]]]],8,9]"</span><span class="p">;</span>
            <span class="k">let</span> <span class="n">n</span> <span class="o">=</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"{n:?}"</span><span class="p">);</span>
            <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="nf">.to_string</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="nd">#[test]</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_cmp</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">nodes</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="k">crate</span><span class="p">::</span><span class="nn">tests</span><span class="p">::</span><span class="n">CONTENT</span><span class="p">)</span><span class="py">.nodes</span><span class="p">;</span>
            <span class="k">let</span> <span class="n">cmp</span> <span class="o">=</span> <span class="n">nodes</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.step_by</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="nf">.zip</span><span class="p">(</span><span class="n">nodes</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="nf">.step_by</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                <span class="nf">.map</span><span class="p">(|(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)|</span> <span class="n">a</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"{cmp:?}"</span><span class="p">);</span>
            <span class="nd">assert_eq!</span><span class="p">(</span>
                <span class="nd">vec!</span><span class="p">[</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Less</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Less</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Less</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Less</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span>
                <span class="p">],</span>
                <span class="n">cmp</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="nd">#[test]</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
            <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="k">crate</span><span class="p">::</span><span class="nn">tests</span><span class="p">::</span><span class="n">CONTENT</span><span class="p">)))</span>
        <span class="p">}</span>

        <span class="nd">#[test]</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
            <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="k">crate</span><span class="p">::</span><span class="nn">tests</span><span class="p">::</span><span class="n">CONTENT</span><span class="p">)))</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_alternative_without_using_heap">Alternative without using heap</h3>
<div class="paragraph">
<p>Later on, I thought it should be possible to implement a solution that does not require any heap allocations by directly iterating on the input data. I added this in a variant of my solution in <code>mod iter</code>. You can run this variant using <code>cargo run --release --features no-heap</code>. Interestingly it is not really performing any better than the original solution. The advantage for the second part is probably mainly caused by avoiding to sort.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">iter</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">self</span><span class="p">::</span><span class="nn">node</span><span class="p">::</span><span class="n">List</span><span class="p">;</span>
    <span class="k">use</span> <span class="k">self</span><span class="p">::{</span><span class="nn">input</span><span class="p">::</span><span class="n">PuzzleData</span><span class="p">,</span> <span class="nn">node</span><span class="p">::</span><span class="n">Node</span><span class="p">};</span>
    <span class="k">use</span> <span class="nn">mr_kaffee_aoc</span><span class="p">::{</span><span class="n">Puzzle</span><span class="p">,</span> <span class="n">Star</span><span class="p">};</span>
    <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">cmp</span><span class="p">::</span><span class="n">Ordering</span><span class="p">;</span>

    <span class="cd">/// the puzzle</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">puzzle</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Puzzle</span><span class="o">&lt;</span><span class="k">'static</span><span class="p">,</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="k">'static</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="n">Puzzle</span> <span class="p">{</span>
            <span class="n">year</span><span class="p">:</span> <span class="mi">2022</span><span class="p">,</span>
            <span class="n">day</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="n">input</span><span class="p">:</span> <span class="nd">include_str!</span><span class="p">(</span><span class="s">"../input.txt"</span><span class="p">),</span>
            <span class="n">star1</span><span class="p">:</span> <span class="nf">Some</span><span class="p">(</span><span class="n">Star</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">:</span> <span class="s">"Star 1"</span><span class="p">,</span>
                <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">star_1</span><span class="p">,</span>
                <span class="n">exp</span><span class="p">:</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">5_675</span><span class="p">),</span>
            <span class="p">}),</span>
            <span class="n">star2</span><span class="p">:</span> <span class="nf">Some</span><span class="p">(</span><span class="n">Star</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">:</span> <span class="s">"Star 2"</span><span class="p">,</span>
                <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">star_2</span><span class="p">,</span>
                <span class="n">exp</span><span class="p">:</span> <span class="nf">Some</span><span class="p">(</span><span class="mi">20_383</span><span class="p">),</span>
            <span class="p">}),</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">pub</span> <span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
                <span class="k">Self</span> <span class="p">{</span> <span class="n">input</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">mod</span> <span class="n">node</span> <span class="p">{</span>
        <span class="k">use</span> <span class="nn">std</span><span class="p">::{</span><span class="nn">cmp</span><span class="p">::</span><span class="n">Ordering</span><span class="p">,</span> <span class="nn">iter</span><span class="p">::</span><span class="n">once</span><span class="p">};</span>

        <span class="nd">#[derive(Debug,</span> <span class="nd">Clone)]</span>
        <span class="k">pub</span> <span class="k">struct</span> <span class="n">List</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
            <span class="n">pos</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="nd">#[derive(Debug,</span> <span class="nd">Clone)]</span>
        <span class="k">pub</span> <span class="k">enum</span> <span class="n">Node</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="nf">List</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">),</span>
            <span class="nf">Value</span><span class="p">(</span><span class="nb">usize</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span> <span class="k">for</span> <span class="n">Node</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
                <span class="k">match</span> <span class="k">self</span> <span class="p">{</span>
                    <span class="nn">Node</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="n">list</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">list</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
                    <span class="nn">Node</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">value</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Node</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">s</span><span class="nf">.starts_with</span><span class="p">(</span><span class="sc">'['</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">Self</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="nn">List</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">Self</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">s</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">())</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span> <span class="k">for</span> <span class="n">List</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
                <span class="k">let</span> <span class="k">mut</span> <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="sc">'['</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                <span class="k">for</span> <span class="o">&amp;</span><span class="n">b</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="k">self</span><span class="py">.pos</span><span class="o">..</span><span class="p">]</span> <span class="p">{</span>
                    <span class="n">level</span> <span class="o">=</span> <span class="k">match</span> <span class="n">b</span> <span class="p">{</span>
                        <span class="sc">b'['</span> <span class="k">=&gt;</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="sc">b']'</span> <span class="k">=&gt;</span> <span class="n">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">_</span> <span class="k">=&gt;</span> <span class="n">level</span><span class="p">,</span>
                    <span class="p">};</span>
                    <span class="p">(</span><span class="n">b</span> <span class="k">as</span> <span class="nb">char</span><span class="p">)</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="nf">Ok</span><span class="p">(())</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">List</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
                <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.as_ref</span><span class="p">();</span>
                <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b'['</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
                <span class="k">Self</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">pos</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">List</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
                <span class="k">Self</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="nf">.as_bytes</span><span class="p">())</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">Iterator</span> <span class="k">for</span> <span class="n">List</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">type</span> <span class="n">Item</span> <span class="o">=</span> <span class="n">Node</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">;</span>

            <span class="k">fn</span> <span class="nf">next</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="k">Self</span><span class="p">::</span><span class="n">Item</span><span class="o">&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">self</span><span class="py">.pos</span> <span class="o">&gt;=</span> <span class="k">self</span><span class="py">.data</span><span class="nf">.len</span><span class="p">()</span> <span class="p">||</span> <span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="k">self</span><span class="py">.pos</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b']'</span> <span class="p">{</span>
                    <span class="c1">// exhausted</span>
                    <span class="nb">None</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="k">self</span><span class="py">.pos</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b'['</span> <span class="p">{</span>
                    <span class="c1">// parse list</span>
                    <span class="k">let</span> <span class="n">nxt</span> <span class="o">=</span> <span class="k">Self</span><span class="p">::</span><span class="nn">Item</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="nn">List</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="k">self</span><span class="py">.pos</span><span class="o">..</span><span class="p">]));</span>

                    <span class="c1">// advance pos to after list</span>
                    <span class="k">self</span><span class="py">.pos</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">+</span> <span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="k">self</span><span class="py">.pos</span> <span class="o">+</span> <span class="mi">1</span><span class="o">..</span><span class="p">]</span>
                        <span class="nf">.iter</span><span class="p">()</span>
                        <span class="nf">.scan</span><span class="p">(</span><span class="mi">1usize</span><span class="p">,</span> <span class="p">|</span><span class="n">level</span><span class="p">,</span> <span class="n">b</span><span class="p">|</span> <span class="p">{</span>
                            <span class="k">match</span> <span class="n">b</span> <span class="p">{</span>
                                <span class="sc">b'['</span> <span class="k">=&gt;</span> <span class="o">*</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="sc">b']'</span> <span class="k">=&gt;</span> <span class="o">*</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">_</span> <span class="k">=&gt;</span> <span class="p">(),</span>
                            <span class="p">};</span>
                            <span class="nf">Some</span><span class="p">(</span><span class="o">*</span><span class="n">level</span><span class="p">)</span>
                        <span class="p">})</span>
                        <span class="nf">.position</span><span class="p">(|</span><span class="n">level</span><span class="p">|</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="nf">.unwrap</span><span class="p">();</span>

                    <span class="c1">// skip ',' if applicable</span>
                    <span class="k">if</span> <span class="k">self</span><span class="py">.pos</span> <span class="o">&lt;</span> <span class="k">self</span><span class="py">.data</span><span class="nf">.len</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="k">self</span><span class="py">.pos</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b','</span> <span class="p">{</span>
                        <span class="k">self</span><span class="py">.pos</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="c1">// return list</span>
                    <span class="nf">Some</span><span class="p">(</span><span class="n">nxt</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// parse value</span>
                    <span class="k">let</span> <span class="k">mut</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">while</span> <span class="p">(</span><span class="sc">b'0'</span><span class="o">..=</span><span class="sc">b'9'</span><span class="p">)</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="k">self</span><span class="py">.pos</span><span class="p">])</span> <span class="p">{</span>
                        <span class="c1">// parse digit</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">v</span> <span class="o">+</span> <span class="p">(</span><span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="k">self</span><span class="py">.pos</span><span class="p">]</span> <span class="o">-</span> <span class="sc">b'0'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">;</span>
                        <span class="k">self</span><span class="py">.pos</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="c1">// skip ',' if applicable</span>
                    <span class="k">if</span> <span class="k">self</span><span class="py">.pos</span> <span class="o">&lt;</span> <span class="k">self</span><span class="py">.data</span><span class="nf">.len</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="k">self</span><span class="py">.pos</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b','</span> <span class="p">{</span>
                        <span class="k">self</span><span class="py">.pos</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="c1">// return value</span>
                    <span class="nf">Some</span><span class="p">(</span><span class="k">Self</span><span class="p">::</span><span class="nn">Item</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">Ord</span> <span class="k">for</span> <span class="n">Node</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">cmp</span><span class="p">::</span><span class="n">Ordering</span> <span class="p">{</span>
                <span class="k">match</span> <span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
                    <span class="p">(</span><span class="nn">Node</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">lhs</span><span class="p">),</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">Value</span><span class="p">(</span><span class="n">rhs</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="n">lhs</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">rhs</span><span class="p">),</span>
                    <span class="p">(</span><span class="nn">Node</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="n">lhs</span><span class="p">),</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="n">rhs</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="n">lhs</span><span class="nf">.clone</span><span class="p">()</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">rhs</span><span class="nf">.clone</span><span class="p">()),</span>
                    <span class="p">(</span><span class="nn">Node</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="n">lhs</span><span class="p">),</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">lhs</span><span class="nf">.clone</span><span class="p">()</span><span class="nf">.cmp</span><span class="p">(</span><span class="nf">once</span><span class="p">(</span><span class="n">rhs</span><span class="nf">.clone</span><span class="p">())),</span>
                    <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">List</span><span class="p">(</span><span class="n">rhs</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="nf">once</span><span class="p">(</span><span class="n">lhs</span><span class="nf">.clone</span><span class="p">())</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">rhs</span><span class="nf">.clone</span><span class="p">()),</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">PartialOrd</span> <span class="k">for</span> <span class="n">Node</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">partial_cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="nn">std</span><span class="p">::</span><span class="nn">cmp</span><span class="p">::</span><span class="n">Ordering</span><span class="o">&gt;</span> <span class="p">{</span>
                <span class="nf">Some</span><span class="p">(</span><span class="k">self</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">PartialEq</span> <span class="k">for</span> <span class="n">Node</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
                <span class="k">self</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="nn">Ordering</span><span class="p">::</span><span class="n">Equal</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">Eq</span> <span class="k">for</span> <span class="n">Node</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{}</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="py">.input</span><span class="nf">.lines</span><span class="p">()</span><span class="nf">.filter</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="o">!</span><span class="n">l</span><span class="nf">.is_empty</span><span class="p">());</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="k">let</span> <span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span><span class="n">lines</span><span class="nf">.next</span><span class="p">(),</span> <span class="n">lines</span><span class="nf">.next</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span> <span class="nn">Node</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="nf">.cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="nn">Node</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">!=</span> <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span> <span class="p">{</span>
                <span class="n">result</span> <span class="o">+=</span> <span class="n">idx</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">result</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">n_1</span> <span class="o">=</span> <span class="nn">List</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"[[2]]"</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">n_2</span> <span class="o">=</span> <span class="nn">List</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"[[6]]"</span><span class="p">);</span>

        <span class="k">let</span> <span class="p">(</span><span class="n">cnt_1</span><span class="p">,</span> <span class="n">cnt_2</span><span class="p">)</span> <span class="o">=</span>
            <span class="n">data</span><span class="py">.input</span>
                <span class="nf">.lines</span><span class="p">()</span>
                <span class="nf">.filter</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="o">!</span><span class="n">l</span><span class="nf">.is_empty</span><span class="p">())</span>
                <span class="nf">.fold</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">|(</span><span class="n">cnt_1</span><span class="p">,</span> <span class="n">cnt_2</span><span class="p">),</span> <span class="n">l</span><span class="p">|</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="n">n_1</span><span class="nf">.clone</span><span class="p">()</span><span class="nf">.cmp</span><span class="p">(</span><span class="nn">List</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">l</span><span class="p">))</span> <span class="o">==</span> <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span> <span class="p">{</span>
                        <span class="p">(</span><span class="n">cnt_1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cnt_2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">n_2</span><span class="nf">.clone</span><span class="p">()</span><span class="nf">.cmp</span><span class="p">(</span><span class="nn">List</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">l</span><span class="p">))</span> <span class="o">==</span> <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span> <span class="p">{</span>
                        <span class="p">(</span><span class="n">cnt_1</span><span class="p">,</span> <span class="n">cnt_2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="p">(</span><span class="n">cnt_1</span><span class="p">,</span> <span class="n">cnt_2</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">});</span>

        <span class="n">cnt_1</span> <span class="o">*</span> <span class="n">cnt_2</span>
    <span class="p">}</span>

    <span class="nd">#[cfg(test)]</span>
    <span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
        <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
        <span class="k">use</span> <span class="k">crate</span><span class="p">::</span><span class="nn">iter</span><span class="p">::</span><span class="nn">node</span><span class="p">::{</span><span class="n">List</span><span class="p">,</span> <span class="n">Node</span><span class="p">};</span>

        <span class="nd">#[test]</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_next</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">list</span> <span class="o">=</span> <span class="nn">List</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"[10,[[9,10,0],2]]"</span><span class="p">);</span>
            <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="s">"10"</span><span class="nf">.into</span><span class="p">()),</span> <span class="n">list</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">n</span><span class="p">|</span> <span class="n">n</span><span class="nf">.to_string</span><span class="p">()));</span>
            <span class="nd">assert_eq!</span><span class="p">(</span>
                <span class="nf">Some</span><span class="p">(</span><span class="s">"[[9,10,0],2]"</span><span class="nf">.into</span><span class="p">()),</span>
                <span class="n">list</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">n</span><span class="p">|</span> <span class="n">n</span><span class="nf">.to_string</span><span class="p">())</span>
            <span class="p">);</span>
            <span class="nd">assert!</span><span class="p">(</span><span class="n">list</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.is_none</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="nd">#[test]</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_cmp</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">nodes</span> <span class="o">=</span> <span class="k">crate</span><span class="p">::</span><span class="nn">tests</span><span class="p">::</span><span class="n">CONTENT</span>
                <span class="nf">.lines</span><span class="p">()</span>
                <span class="nf">.filter</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="o">!</span><span class="n">l</span><span class="nf">.is_empty</span><span class="p">())</span>
                <span class="nf">.map</span><span class="p">(</span><span class="nn">List</span><span class="p">::</span><span class="n">from</span><span class="p">)</span>
                <span class="nf">.map</span><span class="p">(</span><span class="nn">Node</span><span class="p">::</span><span class="n">List</span><span class="p">)</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>

            <span class="k">let</span> <span class="n">cmp</span> <span class="o">=</span> <span class="n">nodes</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.step_by</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="nf">.zip</span><span class="p">(</span><span class="n">nodes</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="nf">.step_by</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                <span class="nf">.map</span><span class="p">(|(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)|</span> <span class="n">a</span><span class="nf">.cmp</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"{cmp:?}"</span><span class="p">);</span>
            <span class="nd">assert_eq!</span><span class="p">(</span>
                <span class="nd">vec!</span><span class="p">[</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Less</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Less</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Less</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Less</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span><span class="p">,</span>
                    <span class="nn">Ordering</span><span class="p">::</span><span class="n">Greater</span>
                <span class="p">],</span>
                <span class="n">cmp</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="nd">#[test]</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
            <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="k">crate</span><span class="p">::</span><span class="nn">tests</span><span class="p">::</span><span class="n">CONTENT</span><span class="p">)))</span>
        <span class="p">}</span>

        <span class="nd">#[test]</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
            <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="k">crate</span><span class="p">::</span><span class="nn">tests</span><span class="p">::</span><span class="n">CONTENT</span><span class="p">)))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-14">Day 14: Regolith Reservoir</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/14">AoC|2022|14</a>.</p>
</div>
<div class="paragraph">
<p>I was remembered of <a href="https://adventofcode.com/2018/day/17">AoC|2018|17</a> even without the hint in the puzzle.</p>
</div>
<div class="paragraph">
<p>I don&#8217;t think my solution is very elegant, but at the moment, I do not have an idea how to create a nice one &#8230;&#8203;</p>
</div>
<div class="sect2">
<h3 id="_input_14">Input</h3>
<div class="paragraph">
<p>I parse the input in a vec of paths, where each path is vec of points. The structure <code>PuzzleData</code> has methods to compute the bounding box for all points (<code>bbox</code>) and build a 2D grid using the paths specified (<code>grid</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="n">paths</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">paths</span><span class="p">:</span> <span class="n">s</span>
                    <span class="nf">.lines</span><span class="p">()</span>
                    <span class="nf">.map</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="p">{</span>
                        <span class="n">l</span><span class="nf">.split</span><span class="p">(</span><span class="s">" -&gt; "</span><span class="p">)</span>
                            <span class="nf">.map</span><span class="p">(|</span><span class="n">c</span><span class="p">|</span> <span class="n">c</span><span class="nf">.split_once</span><span class="p">(</span><span class="sc">','</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">())</span>
                            <span class="nf">.map</span><span class="p">(|(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)|</span> <span class="p">(</span><span class="n">x</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">(),</span> <span class="n">y</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()))</span>
                            <span class="nf">.collect</span><span class="p">()</span>
                    <span class="p">})</span>
                    <span class="nf">.collect</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">bbox</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="py">.paths</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.fold</span><span class="p">((</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">501</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">|</span><span class="n">bbox</span><span class="p">,</span> <span class="n">v</span><span class="p">|</span> <span class="p">{</span>
                <span class="n">v</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.fold</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="p">|(</span><span class="n">x_mn</span><span class="p">,</span> <span class="n">y_mn</span><span class="p">,</span> <span class="n">x_mx</span><span class="p">,</span> <span class="n">y_mx</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)|</span> <span class="p">{</span>
                    <span class="p">(</span><span class="n">x_mn</span><span class="nf">.min</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="n">y_mn</span><span class="nf">.min</span><span class="p">(</span><span class="o">*</span><span class="n">y</span><span class="p">),</span> <span class="n">x_mx</span><span class="nf">.max</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y_mx</span><span class="nf">.max</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="p">})</span>
            <span class="p">})</span>
        <span class="p">}</span>

        <span class="cd">/// get a grid as flat list of chars, the width of the grid, and the point of sand inflow</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">grid</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">char</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">let</span> <span class="p">(</span><span class="n">x_mn</span><span class="p">,</span> <span class="n">y_mn</span><span class="p">,</span> <span class="n">x_mx</span><span class="p">,</span> <span class="n">y_mx</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.bbox</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_mx</span> <span class="o">-</span> <span class="n">x_mn</span><span class="p">)</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">;</span>
            <span class="k">let</span> <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_mx</span> <span class="o">-</span> <span class="n">y_mn</span><span class="p">)</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">;</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">grid</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="sc">'.'</span><span class="p">;</span> <span class="n">width</span> <span class="o">*</span> <span class="n">height</span><span class="p">];</span>

            <span class="k">for</span> <span class="n">path</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.paths</span> <span class="p">{</span>
                <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">path</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">len</span><span class="p">)</span> <span class="o">=</span> <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.0</span> <span class="o">&gt;</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.0</span> <span class="p">{</span>
                        <span class="nd">assert!</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.1</span><span class="p">);</span>
                        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.0</span> <span class="o">-</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.0</span><span class="p">)</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.0</span> <span class="o">&lt;</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.0</span> <span class="p">{</span>
                        <span class="nd">assert!</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.1</span><span class="p">);</span>
                        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.0</span> <span class="o">-</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.0</span><span class="p">)</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span> <span class="o">&gt;</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.1</span> <span class="p">{</span>
                        <span class="nd">assert!</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.0</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.0</span><span class="p">);</span>
                        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span> <span class="o">-</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.1</span><span class="p">)</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span> <span class="o">&lt;</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.1</span> <span class="p">{</span>
                        <span class="nd">assert!</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.0</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.0</span><span class="p">);</span>
                        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.1</span> <span class="o">-</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span><span class="p">)</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nd">unreachable!</span><span class="p">()</span>
                    <span class="p">};</span>

                    <span class="k">let</span> <span class="n">x0</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.0</span> <span class="o">-</span> <span class="n">x_mn</span><span class="p">;</span>
                    <span class="k">let</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="na">.1</span> <span class="o">-</span> <span class="n">y_mn</span><span class="p">;</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">{</span>
                        <span class="n">grid</span><span class="p">[(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span> <span class="k">as</span> <span class="nb">usize</span> <span class="o">+</span> <span class="p">(</span><span class="n">y0</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span> <span class="k">as</span> <span class="nb">usize</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'#'</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="p">((</span><span class="mi">500</span> <span class="o">-</span> <span class="n">x_mn</span><span class="p">)</span> <span class="k">as</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="n">y_mn</span><span class="p">)</span> <span class="k">as</span> <span class="n">_</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_12">Star 1</h3>
<div class="paragraph">
<p>Just let the sand flow in the grid until sand starts flowing off to the big void.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="p">(</span><span class="k">mut</span> <span class="n">grid</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">))</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.grid</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">height</span> <span class="o">=</span> <span class="n">grid</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">width</span><span class="p">;</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">'inflow</span><span class="p">:</span> <span class="k">loop</span> <span class="p">{</span>
        <span class="c1">// first candidate is spot directly on top of something solid</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x_0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">y</span> <span class="o">=</span> <span class="k">match</span> <span class="p">(</span><span class="n">y_0</span><span class="o">..</span><span class="n">height</span><span class="p">)</span><span class="nf">.find</span><span class="p">(|</span><span class="n">y</span><span class="p">|</span> <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'.'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">Some</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(</span><span class="s">"Nothing solid found to start with"</span><span class="p">),</span>
        <span class="p">};</span>

        <span class="k">loop</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="c1">// go to void below</span>
                <span class="k">break</span> <span class="nv">'inflow</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'.'</span> <span class="p">{</span>
                <span class="c1">// bubble down</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'.'</span> <span class="p">{</span>
                <span class="c1">// bubble down-left</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'.'</span> <span class="p">{</span>
                <span class="c1">// bubble down-right</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">||</span> <span class="n">x</span> <span class="o">==</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="c1">// go to void left/right</span>
                <span class="k">break</span> <span class="nv">'inflow</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'o'</span><span class="p">;</span>
                <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">cnt</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_12">Star 2</h3>
<div class="paragraph">
<p>Create a grid with an additional line added at the bottom and big enough to make sure nothing flows off to the void anymore. The only thing on top to do is to change the condition for exiting the loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">grid_0</span><span class="p">,</span> <span class="n">width_0</span><span class="p">,</span> <span class="p">(</span><span class="n">x_0_0</span><span class="p">,</span> <span class="n">y_0</span><span class="p">))</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.grid</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">height_0</span> <span class="o">=</span> <span class="n">grid_0</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">width_0</span><span class="p">;</span>

    <span class="c1">// wrap the grid in a bigger grid (append height columns to the left and right and an additional row below)</span>
    <span class="k">let</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width_0</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">height_0</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">height</span> <span class="o">=</span> <span class="n">height_0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">grid</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="sc">'.'</span><span class="p">;</span> <span class="n">width</span> <span class="o">*</span> <span class="n">height</span><span class="p">];</span>
    <span class="k">for</span> <span class="n">y</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">height_0</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">width_0</span> <span class="p">{</span>
            <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">height_0</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_0</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">width_0</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">let</span> <span class="n">x_0</span> <span class="o">=</span> <span class="n">x_0_0</span> <span class="o">+</span> <span class="n">height_0</span><span class="p">;</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">loop</span> <span class="p">{</span>
        <span class="c1">// first candidate is spot directly on top of something solid</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x_0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">y</span> <span class="o">=</span> <span class="k">match</span> <span class="p">(</span><span class="n">y_0</span><span class="o">..</span><span class="n">height</span><span class="p">)</span><span class="nf">.find</span><span class="p">(|</span><span class="n">y</span><span class="p">|</span> <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'.'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">Some</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">y_0</span> <span class="p">{</span>
                    <span class="c1">// No more sand can enter</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">}</span>
            <span class="nb">None</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(</span><span class="s">"Nothing solid found to start with"</span><span class="p">),</span>
        <span class="p">};</span>

        <span class="k">loop</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="c1">// floor reached</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'o'</span><span class="p">;</span>
                <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'.'</span> <span class="p">{</span>
                <span class="c1">// bubble down</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'.'</span> <span class="p">{</span>
                <span class="c1">// bubble down-left</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'.'</span> <span class="p">{</span>
                <span class="c1">// bubble down-right</span>
                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">||</span> <span class="n">x</span> <span class="o">==</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="c1">// the grid should not be too small</span>
                <span class="nd">unreachable!</span><span class="p">(</span><span class="s">"Grid is too small!"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// cannot move any further</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'o'</span><span class="p">;</span>
                <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">cnt</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_15">Tests</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"498,4 -&gt; 498,6 -&gt; 496,6
503,4 -&gt; 502,4 -&gt; 502,9 -&gt; 494,9
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">bbox</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.bbox</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">((</span><span class="mi">494</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">504</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">bbox</span><span class="p">);</span>

        <span class="k">let</span> <span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">))</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.grid</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">width</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">exp</span> <span class="o">=</span> <span class="s">"............................................#...##....#...#...###...#.........#.........#.#########."</span><span class="p">;</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">exp</span><span class="nf">.chars</span><span class="p">()</span><span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">(),</span> <span class="n">grid</span><span class="p">);</span>
        <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">grid</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">width</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">col</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">width</span> <span class="p">{</span>
                <span class="nd">print!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">grid</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="n">width</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="nd">println!</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">93</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-15">Day 15: Beacon Exclusion Zone</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/15">AoC|2022|15</a>.</p>
</div>
<div class="paragraph">
<p>This one was a challenge for me. Part one was initially solved with brute force. My current solution projects ranges on the row to scan.</p>
</div>
<div class="paragraph">
<p>For part 2, brute force was not a real option.</p>
</div>
<div class="sect2">
<h3 id="_input_15">Input</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="n">sensors</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">))</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">row</span><span class="p">:</span> <span class="nb">isize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">width</span><span class="p">:</span> <span class="nb">isize</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">parse_line</span><span class="p">(</span><span class="n">l</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">words</span> <span class="o">=</span> <span class="n">l</span><span class="nf">.split_ascii_whitespace</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// Sensor at</span>

        <span class="k">let</span> <span class="n">x_s</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">x_s</span> <span class="o">=</span> <span class="n">x_s</span><span class="nf">.strip_prefix</span><span class="p">(</span><span class="s">"x="</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.strip_suffix</span><span class="p">(</span><span class="s">","</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">x_s</span> <span class="o">=</span> <span class="n">x_s</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">y_s</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">y_s</span> <span class="o">=</span> <span class="n">y_s</span><span class="nf">.strip_prefix</span><span class="p">(</span><span class="s">"y="</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.strip_suffix</span><span class="p">(</span><span class="s">":"</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">y_s</span> <span class="o">=</span> <span class="n">y_s</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// closest beacon is at</span>

        <span class="k">let</span> <span class="n">x_b</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">x_b</span> <span class="o">=</span> <span class="n">x_b</span><span class="nf">.strip_prefix</span><span class="p">(</span><span class="s">"x="</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.strip_suffix</span><span class="p">(</span><span class="s">","</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">x_b</span> <span class="o">=</span> <span class="n">x_b</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">y_b</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">y_b</span> <span class="o">=</span> <span class="n">y_b</span><span class="nf">.strip_prefix</span><span class="p">(</span><span class="s">"y="</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">y_b</span> <span class="o">=</span> <span class="n">y_b</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="p">((</span><span class="n">x_s</span><span class="p">,</span> <span class="n">y_s</span><span class="p">),</span> <span class="p">(</span><span class="n">x_b</span><span class="p">,</span> <span class="n">y_b</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">sensors</span><span class="p">:</span> <span class="n">s</span><span class="nf">.lines</span><span class="p">()</span><span class="nf">.map</span><span class="p">(</span><span class="n">parse_line</span><span class="p">)</span><span class="nf">.collect</span><span class="p">(),</span>
                <span class="n">row</span><span class="p">:</span> <span class="mi">2_000_000</span><span class="p">,</span>
                <span class="n">width</span><span class="p">:</span> <span class="mi">4_000_000</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">sensors</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="p">[((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">))]</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.sensors</span>
        <span class="p">}</span>

        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">sensors_with_r</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span> <span class="p">{</span>
            <span class="k">self</span><span class="py">.sensors</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x_b</span><span class="p">,</span> <span class="n">y_b</span><span class="p">))|</span> <span class="p">((</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_b</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_b</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()))</span>
                <span class="nf">.collect</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_13">Star 1</h3>
<div class="paragraph">
<p>Project ranges</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="code"><pre><span class="cd">/// determine ranges covered by sensors on given row</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">ranges</span><span class="p">(</span>
    <span class="n">sensors</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">))],</span>
    <span class="n">mn</span><span class="p">:</span> <span class="nb">isize</span><span class="p">,</span>
    <span class="n">mx</span><span class="p">:</span> <span class="nb">isize</span><span class="p">,</span>
    <span class="n">row</span><span class="p">:</span> <span class="nb">isize</span><span class="p">,</span>
<span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">sensors</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x_b</span><span class="p">,</span> <span class="n">y_b</span><span class="p">))|</span> <span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_b</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_b</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">row</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()))</span>
        <span class="nf">.map</span><span class="p">(|(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">)|</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span><span class="nf">.max</span><span class="p">(</span><span class="n">mn</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span><span class="nf">.min</span><span class="p">(</span><span class="n">mx</span><span class="p">)))</span>
        <span class="nf">.filter</span><span class="p">(|(</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">)|</span> <span class="n">mx</span> <span class="o">&gt;=</span> <span class="n">mn</span><span class="p">)</span>
        <span class="nf">.fold</span><span class="p">(</span><span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">(),</span> <span class="p">|</span><span class="k">mut</span> <span class="n">ranges</span><span class="p">,</span> <span class="n">range</span><span class="p">|</span> <span class="p">{</span>
            <span class="n">ranges</span><span class="nf">.push</span><span class="p">(</span><span class="n">range</span><span class="p">);</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">k_2</span> <span class="o">=</span> <span class="n">ranges</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">k_1</span> <span class="k">in</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">ranges</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="nf">.rev</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_1</span><span class="p">]</span><span class="na">.0</span> <span class="o">&lt;=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_2</span><span class="p">]</span><span class="na">.0</span> <span class="o">&amp;&amp;</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_1</span><span class="p">]</span><span class="na">.1</span> <span class="o">&gt;=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_2</span><span class="p">]</span><span class="na">.1</span> <span class="p">{</span>
                    <span class="c1">// k_2 contained in k_1</span>
                    <span class="n">ranges</span><span class="nf">.swap_remove</span><span class="p">(</span><span class="n">k_2</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_2</span><span class="p">]</span><span class="na">.0</span> <span class="o">&lt;=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_1</span><span class="p">]</span><span class="na">.0</span> <span class="o">&amp;&amp;</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_2</span><span class="p">]</span><span class="na">.1</span> <span class="o">&gt;=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_1</span><span class="p">]</span><span class="na">.1</span> <span class="p">{</span>
                    <span class="c1">// k_1 contained in k_2</span>
                    <span class="n">ranges</span><span class="nf">.swap_remove</span><span class="p">(</span><span class="n">k_1</span><span class="p">);</span>
                    <span class="n">k_2</span> <span class="o">=</span> <span class="k">if</span> <span class="n">k_2</span> <span class="o">==</span> <span class="n">ranges</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span> <span class="n">k_1</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">k_2</span> <span class="p">};</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_2</span><span class="p">]</span><span class="na">.0</span> <span class="o">&gt;=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_1</span><span class="p">]</span><span class="na">.0</span> <span class="o">&amp;&amp;</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_2</span><span class="p">]</span><span class="na">.0</span> <span class="o">&lt;=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_1</span><span class="p">]</span><span class="na">.1</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">{</span>
                    <span class="c1">// k_2's min in k_1 or immediately after</span>
                    <span class="n">ranges</span><span class="p">[</span><span class="n">k_1</span><span class="p">]</span><span class="na">.1</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_2</span><span class="p">]</span><span class="na">.1</span><span class="p">;</span>
                    <span class="n">ranges</span><span class="nf">.swap_remove</span><span class="p">(</span><span class="n">k_2</span><span class="p">);</span>
                    <span class="n">k_2</span> <span class="o">=</span> <span class="n">k_1</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_2</span><span class="p">]</span><span class="na">.1</span> <span class="o">&gt;=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_1</span><span class="p">]</span><span class="na">.0</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_2</span><span class="p">]</span><span class="na">.1</span> <span class="o">&lt;=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_1</span><span class="p">]</span><span class="na">.1</span> <span class="p">{</span>
                    <span class="c1">// k_2's max in k_1 or immediately before</span>
                    <span class="n">ranges</span><span class="p">[</span><span class="n">k_1</span><span class="p">]</span><span class="na">.0</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="n">k_2</span><span class="p">]</span><span class="na">.0</span><span class="p">;</span>
                    <span class="n">ranges</span><span class="nf">.swap_remove</span><span class="p">(</span><span class="n">k_2</span><span class="p">);</span>
                    <span class="n">k_2</span> <span class="o">=</span> <span class="n">k_1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">ranges</span>
        <span class="p">})</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">ranges</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nf">ranges</span><span class="p">(</span><span class="n">data</span><span class="nf">.sensors</span><span class="p">(),</span> <span class="nn">isize</span><span class="p">::</span><span class="n">MIN</span><span class="p">,</span> <span class="nn">isize</span><span class="p">::</span><span class="n">MAX</span><span class="p">,</span> <span class="n">data</span><span class="py">.row</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">r</span> <span class="o">=</span> <span class="n">ranges</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|(</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">)|</span> <span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="n">mn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">)</span>
        <span class="py">.sum</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="n">data</span>
        <span class="nf">.sensors</span><span class="p">()</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.filter</span><span class="p">(|(</span><span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">y</span><span class="p">))|</span> <span class="o">*</span><span class="n">y</span> <span class="o">==</span> <span class="n">data</span><span class="py">.row</span><span class="p">)</span>
        <span class="nf">.map</span><span class="p">(|(</span><span class="n">_</span><span class="p">,</span> <span class="n">b</span><span class="p">)|</span> <span class="n">b</span><span class="p">)</span>
        <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
        <span class="nf">.len</span><span class="p">();</span>
    <span class="n">r</span> <span class="o">-</span> <span class="n">s</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_13">Star 2</h3>
<div class="paragraph">
<p>The idea is that the position of the distress beacon must be just outside the range of at least two sensors. Hence, for all pairs of sensors, I find the points that are just outside of both sensor&#8217;s ranges as candidates. Out of these candidates, I search for a point that is also outside of all the other sensor&#8217;s ranges.</p>
</div>
<div class="paragraph">
<p>Well &#8230;&#8203; it works. But coming up with the formulas for the points was a pain and very error prone for me. I am sure there is something more elegant and simple.</p>
</div>
<div class="paragraph">
<p>There is also a flaw in the candidates function. Normally, it should be symmetric, i.e., <code>candidates(s1, s2) == candidates(s2, s1)</code>; it is not in all cases. I guess this is rounding issues &#8230;&#8203; It seems the function returns rather too many candidates than too few, which would not be an issue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">is_distress_beacon</span><span class="p">(</span>
    <span class="n">sensors</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="nb">isize</span><span class="p">)],</span>
    <span class="n">p</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">isize</span><span class="p">,</span>
<span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">0</span><span class="o">..=</span><span class="n">width</span><span class="p">)</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="na">.0</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="mi">0</span><span class="o">..=</span><span class="n">width</span><span class="p">)</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="na">.1</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="n">sensors</span>
            <span class="nf">.iter</span><span class="p">()</span>
            <span class="nf">.all</span><span class="p">(|((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">r</span><span class="p">)|</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">p</span><span class="na">.0</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">p</span><span class="na">.1</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="o">*</span><span class="n">r</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">candidates</span><span class="p">(</span>
    <span class="p">(((</span><span class="n">x_1</span><span class="p">,</span> <span class="n">y_1</span><span class="p">),</span> <span class="n">r_1</span><span class="p">),</span> <span class="p">((</span><span class="n">x_2</span><span class="p">,</span> <span class="n">y_2</span><span class="p">),</span> <span class="n">r_2</span><span class="p">)):</span> <span class="p">(</span><span class="o">&amp;</span><span class="p">((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="nb">isize</span><span class="p">),</span> <span class="o">&amp;</span><span class="p">((</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">),</span> <span class="nb">isize</span><span class="p">)),</span>
<span class="p">)</span> <span class="k">-&gt;</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">x_2</span> <span class="o">-</span> <span class="n">x_1</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">y_2</span> <span class="o">-</span> <span class="n">y_1</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">dr</span> <span class="o">=</span> <span class="n">r_2</span> <span class="o">-</span> <span class="n">r_1</span><span class="p">;</span>

    <span class="p">[</span>
        <span class="c1">// TL - RT</span>
        <span class="c1">// x1+(dx+dy-dr)/2,y1-r1-1+(dx+dy-dr)/2</span>
        <span class="p">(</span>
            <span class="n">x_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">y_1</span> <span class="o">-</span> <span class="n">r_1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="n">x_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_1</span> <span class="o">-</span> <span class="n">r_1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="c1">// LB - BR</span>
        <span class="c1">// x1+(dx+dy+dr)/2,y1+r1+1+(dx+dy+dr)/2</span>
        <span class="p">(</span>
            <span class="n">x_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">y_1</span> <span class="o">+</span> <span class="n">r_1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="n">x_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_1</span> <span class="o">+</span> <span class="n">r_1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="c1">// RT - TL</span>
        <span class="c1">// x1+(dx-dy+dr)/2,y1-r1-1-(dx-dy+dr)/2</span>
        <span class="p">(</span>
            <span class="n">x_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">y_1</span> <span class="o">-</span> <span class="n">r_1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="n">x_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_1</span> <span class="o">-</span> <span class="n">r_1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="c1">// BR - LB</span>
        <span class="c1">// x1+(dx-dy-dr)/2,y1+r1+1-(dx-dy-dr)/2</span>
        <span class="p">(</span>
            <span class="n">x_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">y_1</span> <span class="o">+</span> <span class="n">r_1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="n">x_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_1</span> <span class="o">+</span> <span class="n">r_1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="c1">// LB - TL</span>
        <span class="c1">// x1-r1-1+(dx+dy-dr)/2,y1+(dx+dy-dr)/2</span>
        <span class="p">(</span>
            <span class="n">x_1</span> <span class="o">-</span> <span class="n">r_1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">y_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="n">x_1</span> <span class="o">-</span> <span class="n">r_1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="c1">// BR - RT</span>
        <span class="c1">// x1+r1+1+(dx-dy+dr)/2,y1-(dx-dy+dr)/2</span>
        <span class="p">(</span>
            <span class="n">x_1</span> <span class="o">+</span> <span class="n">r_1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">y_1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="n">x_1</span> <span class="o">+</span> <span class="n">r_1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="c1">// TL - LB</span>
        <span class="c1">// x1-r1-1+(dx-dy-dr)/2,y1-(dx-dy-dr)/2</span>
        <span class="p">(</span>
            <span class="n">x_1</span> <span class="o">-</span> <span class="n">r_1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">y_1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="n">x_1</span> <span class="o">-</span> <span class="n">r_1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_1</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="c1">// RT - BR</span>
        <span class="c1">// x2+r2+1+(dx+dy+dr)/2,y2+(dx+dy+dr)/2</span>
        <span class="p">(</span>
            <span class="n">x_1</span> <span class="o">+</span> <span class="n">r_1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">y_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="p">(</span><span class="n">x_1</span> <span class="o">+</span> <span class="n">r_1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_1</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dr</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="nf">.into_iter</span><span class="p">()</span>
    <span class="nf">.filter</span><span class="p">(|(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)|</span> <span class="p">{</span>
        <span class="p">(</span><span class="mi">1</span><span class="o">..=</span><span class="mi">2</span><span class="p">)</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_1</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_1</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">-</span> <span class="n">r_1</span><span class="p">))</span>
            <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">..=</span><span class="mi">2</span><span class="p">)</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_2</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_2</span><span class="p">)</span><span class="nf">.abs</span><span class="p">()</span> <span class="o">-</span> <span class="n">r_2</span><span class="p">))</span>
    <span class="p">})</span>
    <span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">star_2_geometry</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">sensors</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.sensors_with_r</span><span class="p">();</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">sensors</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.zip</span><span class="p">(</span><span class="n">sensors</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="nf">.map</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
        <span class="nf">.map</span><span class="p">(</span><span class="nn">HashSet</span><span class="p">::</span><span class="n">into_iter</span><span class="p">)</span>
        <span class="nf">.flatten</span><span class="p">()</span>
        <span class="nf">.find</span><span class="p">(|</span><span class="n">p</span><span class="p">|</span> <span class="nf">is_distress_beacon</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sensors</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">data</span><span class="py">.width</span><span class="p">))</span>
        <span class="nf">.unwrap</span><span class="p">();</span>

    <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">4_000_000</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="k">as</span> <span class="n">_</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2scan_lines">Star 2&#8201;&#8212;&#8201;Scan Lines</h3>
<div class="paragraph">
<p>A solution using the functionality from star 1 is as follows. Much simpler code but much longer run-time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2_scan_lines</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ranges</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">data</span><span class="py">.width</span><span class="p">)</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">row</span><span class="p">|</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nf">ranges</span><span class="p">(</span><span class="n">data</span><span class="nf">.sensors</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="py">.width</span><span class="p">,</span> <span class="n">row</span><span class="p">)))</span>
        <span class="nf">.find</span><span class="p">(|(</span><span class="n">_</span><span class="p">,</span> <span class="n">r</span><span class="p">)|</span> <span class="n">r</span><span class="nf">.len</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="nf">.unwrap</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="na">.0</span><span class="nf">.max</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="na">.0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">4_000_000</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="k">as</span> <span class="n">_</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_16">Tests</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"Sensor at x=2, y=18: closest beacon is at x=-2, y=15
Sensor at x=9, y=16: closest beacon is at x=10, y=16
Sensor at x=13, y=2: closest beacon is at x=15, y=3
Sensor at x=12, y=14: closest beacon is at x=10, y=16
Sensor at x=10, y=20: closest beacon is at x=10, y=16
Sensor at x=14, y=17: closest beacon is at x=10, y=16
Sensor at x=8, y=7: closest beacon is at x=2, y=10
Sensor at x=2, y=0: closest beacon is at x=2, y=10
Sensor at x=0, y=11: closest beacon is at x=2, y=10
Sensor at x=20, y=14: closest beacon is at x=25, y=17
Sensor at x=17, y=20: closest beacon is at x=21, y=22
Sensor at x=16, y=7: closest beacon is at x=15, y=3
Sensor at x=14, y=3: closest beacon is at x=15, y=3
Sensor at x=20, y=1: closest beacon is at x=15, y=3
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_is_distress_beacon</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">sensors</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.sensors_with_r</span><span class="p">();</span>
        <span class="nd">assert!</span><span class="p">(</span><span class="nf">is_distress_beacon</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sensors</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="mi">20</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_candidates</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 0...#..%...</span>
        <span class="c1">// 1..#.#%.%..</span>
        <span class="c1">// 2.#.A%#B.%.</span>
        <span class="c1">// 3..#.#%.%..</span>
        <span class="c1">// 4...#..%...</span>
        <span class="c1">//  0123456789</span>
        <span class="k">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">e</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from</span><span class="p">([(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="nf">candidates</span><span class="p">((</span><span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">))</span><span class="nf">.intersection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="nf">.cloned</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
        <span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="nf">candidates</span><span class="p">((</span><span class="o">&amp;</span><span class="n">s2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">))</span><span class="nf">.intersection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="nf">.cloned</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
        <span class="p">);</span>

        <span class="c1">// 0...#...%..</span>
        <span class="c1">// 1..#.#.%.%.</span>
        <span class="c1">// 2.#.A.$.B.%</span>
        <span class="c1">// 3..#.#.%.%.</span>
        <span class="c1">// 4...#...%..</span>
        <span class="c1">//  0123456789</span>
        <span class="c1">//</span>
        <span class="c1">// RT: [x1 + r1 + 1 - k1, y1 - k1];</span>
        <span class="c1">// TL: [x2 - k2, y2 - r2 - 1 + k2];</span>
        <span class="c1">// [x1+(dx+dy-dr)/2,y1-r1-1+(dx+dy-dr)/2];</span>
        <span class="c1">// --- [x1+(dx-dy+dr)/2,y1-r1-1-(dx-dy+dr)/2];</span>
        <span class="c1">//</span>
        <span class="c1">// BR: [x1 + k1, y1 + r1 + 1 - k1];</span>
        <span class="c1">// LB: [x2 - r2 - 1 + k2, y2 + k2];</span>
        <span class="c1">// [x1+(dx-dy-dr)/2,y1+r1+1-(dx-dy-dr)/2];</span>
        <span class="c1">// --- [x1+(dx+dy+dr)/2,y1+r1+1+(dx+dy+dr)/2];</span>
        <span class="k">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">e</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from</span><span class="p">([(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="nf">candidates</span><span class="p">((</span><span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">))</span><span class="nf">.intersection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="nf">.cloned</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
        <span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="nf">candidates</span><span class="p">((</span><span class="o">&amp;</span><span class="n">s2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">))</span><span class="nf">.intersection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="nf">.cloned</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
        <span class="p">);</span>

        <span class="c1">// 0...#....</span>
        <span class="c1">// 1..#.#...</span>
        <span class="c1">// 2.#.A%#..</span>
        <span class="c1">// 3..#%#%..</span>
        <span class="c1">// 4..%#..%.</span>
        <span class="c1">// 5.%..B..%</span>
        <span class="c1">// 6..%...%.</span>
        <span class="c1">// 7...%.%..</span>
        <span class="c1">// 8....%...</span>
        <span class="c1">//  01234567</span>
        <span class="c1">// LB: [x1 - r1 - 1 + k1, y1 + k1];</span>
        <span class="c1">// TL: [x2 - k2, y2 - r2 - 1 + k2];</span>
        <span class="c1">// [x1-r1-1+(dx+dy-dr)/2,y1+(dx+dy-dr)/2]</span>
        <span class="c1">// --- [x1-r1-1+(dx-dy-dr)/2,y1-(dx-dy-dr)/2]</span>
        <span class="k">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">3</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">e</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="nf">candidates</span><span class="p">((</span><span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">))</span><span class="nf">.intersection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="nf">.cloned</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
        <span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="nf">candidates</span><span class="p">((</span><span class="o">&amp;</span><span class="n">s2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">))</span><span class="nf">.intersection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="nf">.cloned</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
        <span class="p">);</span>

        <span class="c1">// 0...#...</span>
        <span class="c1">// 1..#.#..</span>
        <span class="c1">// 2.#.A.#.</span>
        <span class="c1">// 3..#.#..</span>
        <span class="c1">// 4...$...</span>
        <span class="c1">// 5.-%.%..</span>
        <span class="c1">// 6.%.B.%.</span>
        <span class="c1">// 7..%.%..</span>
        <span class="c1">// 8...%...</span>
        <span class="c1">//  0123456</span>
        <span class="k">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">e</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from</span><span class="p">([(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="nf">candidates</span><span class="p">((</span><span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">))</span><span class="nf">.intersection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="nf">.cloned</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
        <span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="nf">candidates</span><span class="p">((</span><span class="o">&amp;</span><span class="n">s2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">))</span><span class="nf">.intersection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="nf">.cloned</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="n">data</span><span class="py">.row</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_solve_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="n">data</span><span class="py">.width</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">56_000_011</span><span class="p">,</span> <span class="nf">star_2_geometry</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">56_000_011</span><span class="p">,</span> <span class="nf">star_2_scan_lines</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">56_000_011</span><span class="p">,</span> <span class="nf">star_2_brute_force</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-16">Day 16: Proboscidea Volcanium</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/16">AoC|2022|16</a>.</p>
</div>
<div class="paragraph">
<p>Today was a tough nut to crack for me.</p>
</div>
<div class="paragraph">
<p>My attempt is to use a path finding algorithm to explore the valve &amp; tunnel system.</p>
</div>
<div class="paragraph">
<p>The current state (node) is modeled by</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>potential</code>, i.e, the max pressure released until the timer is elapsed if all valves were opened in subsequent steps. If all valves are actually open, the potential is equal to the pressure released until the timer elapses (the volcano erupts)</p>
</li>
<li>
<p>the <code>pressure</code> released</p>
</li>
<li>
<p>the <code>flow</code> of all currently opened valves</p>
</li>
<li>
<p>the <code>idx</code> (position) of the agents opening valves (just me for part 1 and me + an elephant for part 2)</p>
<div class="ulist">
<ul>
<li>
<p>Actually, for part two, the two agents exploring the valve &amp; tunnel system are interchangeable, so I transform to an elephant from time to time</p>
</li>
</ul>
</div>
</li>
<li>
<p>the <code>opened</code> valves</p>
</li>
<li>
<p>the <code>timer</code> (counting down to zero)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I use a priority queue which yields the state with the highest <code>potential</code> first. This results in the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a state is expanded, it is guaranteed that all adjacent states have at most the same potential. They will have equal potential if and only if all valves with positive flow are open. In all other cases, they will have lower potential.</p>
</li>
<li>
<p>If a state is popped from the queue, all states popped later on will have at most the same potential.</p>
</li>
<li>
<p>The potential of the first state popped from the queue with all valves open is the max. possible pressure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The key is to figure out how to narrow down the search space without eliding relevant states. I tried several ideas and do not quite understand why those are not working:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is a possibility to open a valve, open it and discard possibilities to move on without opening the valve&#8201;&#8212;&#8201;worked for the real data but not for the examples.</p>
</li>
<li>
<p>If a state is expanded with position and opened valves identical to a state seen previously, skip it&#8201;&#8212;&#8201;worked for the real data but not for the examples.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Eventually, I finished with a variant of the second option: If a state is expanded with position and opened valves identical to a state seen previously, skip it unless it has higher potential than the state seen previously (kind of 'decrease key').</p>
</div>
<div class="sect2">
<h3 id="_input_16">Input</h3>
<div class="paragraph">
<p>I parse the input into a vec of valves. Each valve has its tunnels stored as vec of indices to that list for cheap lookups.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="n">valves</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Valve</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;&gt;</span><span class="p">,</span>
        <span class="n">root</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">parse_line</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="nb">Vec</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="nf">.split_ascii_whitespace</span><span class="p">()</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">name</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span><span class="p">[</span><span class="mi">5</span><span class="o">..</span><span class="n">flow</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">tunnels</span> <span class="o">=</span> <span class="n">words</span>
            <span class="nf">.skip</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="nf">.map</span><span class="p">(|</span><span class="n">word</span><span class="p">|</span> <span class="n">word</span><span class="nf">.trim_end_matches</span><span class="p">(</span><span class="sc">','</span><span class="p">))</span>
            <span class="nf">.collect</span><span class="p">();</span>

        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tunnels</span><span class="p">,</span> <span class="n">flow</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.lines</span><span class="p">()</span><span class="nf">.map</span><span class="p">(</span><span class="n">parse_line</span><span class="p">)</span><span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">valves</span> <span class="o">=</span> <span class="n">lines</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.enumerate</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tunnels</span><span class="p">,</span> <span class="n">flow</span><span class="p">))|</span> <span class="n">Valve</span> <span class="p">{</span>
                    <span class="n">name</span><span class="p">,</span>
                    <span class="n">idx</span><span class="p">,</span>
                    <span class="n">flow</span><span class="p">:</span> <span class="o">*</span><span class="n">flow</span><span class="p">,</span>
                    <span class="n">tunnels</span><span class="p">:</span> <span class="n">tunnels</span>
                        <span class="nf">.iter</span><span class="p">()</span>
                        <span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">tunnel</span><span class="p">|</span> <span class="p">{</span>
                            <span class="n">lines</span>
                                <span class="nf">.iter</span><span class="p">()</span>
                                <span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)|</span> <span class="n">name</span> <span class="o">==</span> <span class="n">tunnel</span><span class="p">)</span>
                                <span class="nf">.unwrap</span><span class="p">()</span>
                        <span class="p">})</span>
                        <span class="nf">.collect</span><span class="p">(),</span>
                <span class="p">})</span>
                <span class="nf">.collect</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="n">lines</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)|</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"AA"</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
            <span class="k">Self</span> <span class="p">{</span> <span class="n">valves</span><span class="p">,</span> <span class="n">root</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">get</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="n">Valve</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.valves</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">root</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="n">Valve</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.valves</span><span class="p">[</span><span class="k">self</span><span class="py">.root</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">valves</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">Valve</span><span class="p">]</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.valves</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">#[derive(Debug,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq,</span> <span class="nd">PartialOrd,</span> <span class="nd">Ord)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">Valve</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">name</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">flow</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">tunnels</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_14">Star 1</h3>
<div class="paragraph">
<p>Solution with a single agent (me).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="c1">// search state</span>
    <span class="c1">// - pressure potential</span>
    <span class="c1">// - pressure</span>
    <span class="c1">// - flow (valves opened so far)</span>
    <span class="c1">// - idx (position)</span>
    <span class="c1">// - opened (valves opened so far)</span>
    <span class="c1">// - timer (time left before eruption)</span>
    <span class="nd">#[derive(Clone,</span> <span class="nd">Copy,</span> <span class="nd">Debug,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq,</span> <span class="nd">PartialOrd,</span> <span class="nd">Ord,</span> <span class="nd">Hash)]</span>
    <span class="k">struct</span> <span class="n">State</span> <span class="p">{</span>
        <span class="n">potential</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="n">pressure</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="n">flow</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="n">idx</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="n">opened</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
        <span class="n">timer</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="n">State</span> <span class="p">{</span>
        <span class="k">fn</span> <span class="nf">create</span><span class="p">(</span>
            <span class="n">pressure</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">flow</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">idx</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">opened</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
            <span class="n">timer</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">,</span>
            <span class="n">max_flow</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">potential</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">;</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">flow_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="n">timer</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="c1">// in next step, pressure will be increased by flow</span>
                <span class="n">flow_</span> <span class="o">+=</span> <span class="n">flow</span><span class="p">;</span>
                <span class="n">potential</span> <span class="o">+=</span> <span class="n">flow_</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">timer</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="p">{</span>
                <span class="c1">// in the 2nd step, pressure will at most be increased by flow</span>
                <span class="c1">// of current valve. If it is not opened in the next step</span>
                <span class="c1">// (agent moves instead), the flow will not change</span>
                <span class="k">if</span> <span class="n">opened</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                    <span class="n">flow_</span> <span class="o">+=</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="py">.flow</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">potential</span> <span class="o">+=</span> <span class="n">flow_</span><span class="p">;</span>

                <span class="c1">// upper bound for subsequent steps: all valves open</span>
                <span class="n">potential</span> <span class="o">+=</span> <span class="p">(</span><span class="n">timer</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_flow</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">potential</span><span class="p">,</span>
                <span class="n">pressure</span><span class="p">,</span>
                <span class="n">flow</span><span class="p">,</span>
                <span class="n">idx</span><span class="p">,</span>
                <span class="n">opened</span><span class="p">,</span>
                <span class="n">timer</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// all valves opened / max flow</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">all_opened</span><span class="p">,</span> <span class="n">max_flow</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span>
        <span class="nf">.valves</span><span class="p">()</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.filter</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="n">v</span><span class="py">.flow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nf">.fold</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">|(</span><span class="n">o</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">v</span><span class="p">|</span> <span class="p">(</span><span class="n">o</span> <span class="p">|</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="py">.idx</span><span class="p">,</span> <span class="n">f</span> <span class="o">+</span> <span class="n">v</span><span class="py">.flow</span><span class="p">));</span>

    <span class="c1">// max time</span>
    <span class="k">let</span> <span class="n">timer</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>

    <span class="c1">// start at root, no valves open</span>
    <span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="nn">State</span><span class="p">::</span><span class="nf">create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="nf">.root</span><span class="p">()</span><span class="py">.idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timer</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">max_flow</span><span class="p">);</span>

    <span class="c1">// the queue for searching</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">queue</span> <span class="o">=</span> <span class="nn">BinaryHeap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="n">queue</span><span class="nf">.push</span><span class="p">(</span><span class="n">start</span><span class="p">);</span>

    <span class="c1">// do not visit the same spot with the same opened valves again</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">seen</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">from</span><span class="p">([((</span><span class="n">start</span><span class="py">.idx</span><span class="p">,</span> <span class="n">start</span><span class="py">.opened</span><span class="p">),</span> <span class="n">max_flow</span> <span class="o">*</span> <span class="n">timer</span><span class="p">)]);</span>

    <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="n">queue</span><span class="nf">.pop</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// do not explore further if timer elapsed or all valves open,</span>
        <span class="c1">// just see if there is something better in the queue</span>
        <span class="k">if</span> <span class="n">s</span><span class="py">.timer</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">||</span> <span class="n">s</span><span class="py">.opened</span> <span class="o">==</span> <span class="n">all_opened</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">s</span><span class="py">.potential</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">s</span><span class="py">.idx</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">can_o</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="py">.opened</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="py">.idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">v</span><span class="py">.flow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span> <span class="k">in</span> <span class="nf">once</span><span class="p">((</span><span class="k">true</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="nf">.chain</span><span class="p">(</span><span class="n">v</span><span class="py">.tunnels</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">idx</span><span class="p">|</span> <span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">idx</span><span class="p">))))</span>
            <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">_</span><span class="p">)|</span> <span class="o">!</span><span class="n">o</span> <span class="p">||</span> <span class="n">can_o</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">let</span> <span class="n">opened</span> <span class="o">=</span> <span class="n">s</span><span class="py">.opened</span> <span class="p">|</span> <span class="k">if</span> <span class="n">o</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">adj</span><span class="py">.idx</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
            <span class="k">let</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">s</span><span class="py">.flow</span> <span class="o">+</span> <span class="k">if</span> <span class="n">o</span> <span class="p">{</span> <span class="n">adj</span><span class="py">.flow</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
            <span class="k">let</span> <span class="n">next</span> <span class="o">=</span> <span class="nn">State</span><span class="p">::</span><span class="nf">create</span><span class="p">(</span>
                <span class="n">s</span><span class="py">.pressure</span> <span class="o">+</span> <span class="n">s</span><span class="py">.flow</span><span class="p">,</span>
                <span class="n">flow</span><span class="p">,</span>
                <span class="n">adj</span><span class="py">.idx</span><span class="p">,</span>
                <span class="n">opened</span><span class="p">,</span>
                <span class="n">s</span><span class="py">.timer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">max_flow</span><span class="p">,</span>
            <span class="p">);</span>
            <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="n">seen</span><span class="nf">.entry</span><span class="p">((</span><span class="n">next</span><span class="py">.idx</span><span class="p">,</span> <span class="n">next</span><span class="py">.opened</span><span class="p">))</span><span class="nf">.or_insert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="n">next</span><span class="py">.potential</span><span class="nf">.gt</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
                <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">next</span><span class="py">.potential</span><span class="p">;</span>
                <span class="n">queue</span><span class="nf">.push</span><span class="p">(</span><span class="n">next</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">unreachable!</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_14">Star 2</h3>
<div class="paragraph">
<p>Same solution with two agents (me + elephant), not really anything new compared to star 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="c1">// search state</span>
    <span class="c1">// - pressure potential</span>
    <span class="c1">// - pressure</span>
    <span class="c1">// - flow (valves opened so far)</span>
    <span class="c1">// - idx (positions, sorted)</span>
    <span class="c1">// - opened (valves opened so far)</span>
    <span class="c1">// - timer (time left before eruption)</span>
    <span class="nd">#[derive(Clone,</span> <span class="nd">Copy,</span> <span class="nd">Debug,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq,</span> <span class="nd">PartialOrd,</span> <span class="nd">Ord,</span> <span class="nd">Hash)]</span>
    <span class="k">struct</span> <span class="n">State</span> <span class="p">{</span>
        <span class="n">potential</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="n">pressure</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="n">flow</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="n">idx</span><span class="p">:</span> <span class="p">[</span><span class="nb">usize</span><span class="p">;</span> <span class="mi">2</span><span class="p">],</span>
        <span class="n">opened</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
        <span class="n">timer</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="n">State</span> <span class="p">{</span>
        <span class="k">fn</span> <span class="nf">create</span><span class="p">(</span>
            <span class="n">pressure</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">flow</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">idx</span><span class="p">:</span> <span class="p">[</span><span class="nb">usize</span><span class="p">;</span> <span class="mi">2</span><span class="p">],</span>
            <span class="n">opened</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
            <span class="n">timer</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">,</span>
            <span class="n">max_flow</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">potential</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">;</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">flow_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="n">timer</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="c1">// in next step, pressure will be increased by flow</span>
                <span class="n">flow_</span> <span class="o">+=</span> <span class="n">flow</span><span class="p">;</span>
                <span class="n">potential</span> <span class="o">+=</span> <span class="n">flow_</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">timer</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="p">{</span>
                <span class="c1">// in the 2nd step, pressure will at most be increased by flow</span>
                <span class="c1">// of current valves. If they are not opened in the next step</span>
                <span class="c1">// (agents move instead), the flow will not change</span>
                <span class="k">for</span> <span class="n">idx_</span> <span class="k">in</span> <span class="n">idx</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="n">opened</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">idx_</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                        <span class="n">flow_</span> <span class="o">+=</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">idx_</span><span class="p">)</span><span class="py">.flow</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="n">potential</span> <span class="o">+=</span> <span class="n">flow_</span><span class="p">;</span>

                <span class="c1">// upper bound for subsequent steps: all valves open</span>
                <span class="n">potential</span> <span class="o">+=</span> <span class="p">(</span><span class="n">timer</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_flow</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">potential</span><span class="p">,</span>
                <span class="n">pressure</span><span class="p">,</span>
                <span class="n">flow</span><span class="p">,</span>
                <span class="n">idx</span><span class="p">,</span>
                <span class="n">opened</span><span class="p">,</span>
                <span class="n">timer</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// all valves opened / max flow</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">all_opened</span><span class="p">,</span> <span class="n">max_flow</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span>
        <span class="nf">.valves</span><span class="p">()</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.filter</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="n">v</span><span class="py">.flow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nf">.fold</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">|(</span><span class="n">o</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">v</span><span class="p">|</span> <span class="p">(</span><span class="n">o</span> <span class="p">|</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="py">.idx</span><span class="p">,</span> <span class="n">f</span> <span class="o">+</span> <span class="n">v</span><span class="py">.flow</span><span class="p">));</span>

    <span class="c1">// max time</span>
    <span class="k">let</span> <span class="n">timer</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span>

    <span class="c1">// start at root, no valves open</span>
    <span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="nn">State</span><span class="p">::</span><span class="nf">create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">data</span><span class="nf">.root</span><span class="p">()</span><span class="py">.idx</span><span class="p">;</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timer</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">max_flow</span><span class="p">);</span>

    <span class="c1">// the queue for searching</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">queue</span> <span class="o">=</span> <span class="nn">BinaryHeap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="n">queue</span><span class="nf">.push</span><span class="p">(</span><span class="n">start</span><span class="p">);</span>

    <span class="c1">// do not visit the same spot with the same opened valves again</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">seen</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">from</span><span class="p">([((</span><span class="n">start</span><span class="py">.idx</span><span class="p">,</span> <span class="n">start</span><span class="py">.opened</span><span class="p">),</span> <span class="n">start</span><span class="py">.potential</span><span class="p">)]);</span>

    <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="n">queue</span><span class="nf">.pop</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// do not explore further if timer elapsed or all valves open,</span>
        <span class="c1">// just see if there is something better in the queue</span>
        <span class="k">if</span> <span class="n">s</span><span class="py">.timer</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">||</span> <span class="n">s</span><span class="py">.opened</span> <span class="o">==</span> <span class="n">all_opened</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">s</span><span class="py">.potential</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="n">v_1</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">s</span><span class="py">.idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">let</span> <span class="n">v_2</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">s</span><span class="py">.idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

        <span class="k">let</span> <span class="n">can_o_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="py">.opened</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">v_1</span><span class="py">.idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">v_1</span><span class="py">.flow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">can_o_2</span> <span class="o">=</span> <span class="n">v_1</span><span class="py">.idx</span> <span class="o">!=</span> <span class="n">v_2</span><span class="py">.idx</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">s</span><span class="py">.opened</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">v_2</span><span class="py">.idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">v_2</span><span class="py">.flow</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">o_1</span><span class="p">,</span> <span class="n">adj_1</span><span class="p">)</span> <span class="k">in</span> <span class="nf">once</span><span class="p">((</span><span class="k">true</span><span class="p">,</span> <span class="n">v_1</span><span class="p">))</span>
            <span class="nf">.chain</span><span class="p">(</span><span class="n">v_1</span><span class="py">.tunnels</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">idx</span><span class="p">|</span> <span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">idx</span><span class="p">))))</span>
            <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">_</span><span class="p">)|</span> <span class="o">!</span><span class="n">o</span> <span class="p">||</span> <span class="n">can_o_1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">o_2</span><span class="p">,</span> <span class="n">adj_2</span><span class="p">)</span> <span class="k">in</span> <span class="nf">once</span><span class="p">((</span><span class="k">true</span><span class="p">,</span> <span class="n">v_2</span><span class="p">))</span>
                <span class="nf">.chain</span><span class="p">(</span><span class="n">v_2</span><span class="py">.tunnels</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">idx</span><span class="p">|</span> <span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">idx</span><span class="p">))))</span>
                <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">_</span><span class="p">)|</span> <span class="o">!</span><span class="n">o</span> <span class="p">||</span> <span class="n">can_o_2</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">let</span> <span class="n">opened</span> <span class="o">=</span> <span class="n">s</span><span class="py">.opened</span>
                    <span class="p">|</span> <span class="k">if</span> <span class="n">o_1</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">adj_1</span><span class="py">.idx</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">}</span>
                    <span class="p">|</span> <span class="k">if</span> <span class="n">o_2</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">adj_2</span><span class="py">.idx</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
                <span class="k">let</span> <span class="n">flow</span> <span class="o">=</span>
                    <span class="n">s</span><span class="py">.flow</span> <span class="o">+</span> <span class="k">if</span> <span class="n">o_1</span> <span class="p">{</span> <span class="n">adj_1</span><span class="py">.flow</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">}</span> <span class="o">+</span> <span class="k">if</span> <span class="n">o_2</span> <span class="p">{</span> <span class="n">adj_2</span><span class="py">.flow</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
                <span class="k">let</span> <span class="n">next</span> <span class="o">=</span> <span class="nn">State</span><span class="p">::</span><span class="nf">create</span><span class="p">(</span>
                    <span class="n">s</span><span class="py">.pressure</span> <span class="o">+</span> <span class="n">s</span><span class="py">.flow</span><span class="p">,</span>
                    <span class="n">flow</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">adj_1</span><span class="py">.idx</span><span class="nf">.min</span><span class="p">(</span><span class="n">adj_2</span><span class="py">.idx</span><span class="p">),</span> <span class="n">adj_1</span><span class="py">.idx</span><span class="nf">.max</span><span class="p">(</span><span class="n">adj_2</span><span class="py">.idx</span><span class="p">)],</span>
                    <span class="n">opened</span><span class="p">,</span>
                    <span class="n">s</span><span class="py">.timer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">data</span><span class="p">,</span>
                    <span class="n">max_flow</span><span class="p">,</span>
                <span class="p">);</span>
                <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="n">seen</span><span class="nf">.entry</span><span class="p">((</span><span class="n">next</span><span class="py">.idx</span><span class="p">,</span> <span class="n">next</span><span class="py">.opened</span><span class="p">))</span><span class="nf">.or_insert</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                <span class="k">if</span> <span class="n">next</span><span class="py">.potential</span><span class="nf">.gt</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
                    <span class="o">*</span><span class="n">v</span> <span class="o">=</span> <span class="n">next</span><span class="py">.potential</span><span class="p">;</span>
                    <span class="n">queue</span><span class="nf">.push</span><span class="p">(</span><span class="n">next</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">unreachable!</span><span class="p">();</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_17">Tests</h3>
<div class="paragraph">
<p>One additional test to see whether my calculations come up with the correct result but following the path defined in the puzzle for part 2. They do ;)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::{</span><span class="n">HashMap</span><span class="p">,</span> <span class="n">HashSet</span><span class="p">};</span>

    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"Valve AA has flow rate=0; tunnels lead to valves DD, II, BB
Valve BB has flow rate=13; tunnels lead to valves CC, AA
Valve CC has flow rate=2; tunnels lead to valves DD, BB
Valve DD has flow rate=20; tunnels lead to valves CC, AA, EE
Valve EE has flow rate=3; tunnels lead to valves FF, DD
Valve FF has flow rate=0; tunnels lead to valves EE, GG
Valve GG has flow rate=0; tunnels lead to valves FF, HH
Valve HH has flow rate=22; tunnel leads to valve GG
Valve II has flow rate=0; tunnels lead to valves AA, JJ
Valve JJ has flow rate=21; tunnel leads to valve II
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">root</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.root</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="s">"AA"</span><span class="p">,</span> <span class="n">root</span><span class="py">.name</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="nd">vec!</span><span class="p">[</span><span class="s">"DD"</span><span class="p">,</span> <span class="s">"II"</span><span class="p">,</span> <span class="s">"BB"</span><span class="p">],</span>
            <span class="n">root</span><span class="py">.tunnels</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">idx</span><span class="p">|</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="py">.name</span><span class="p">)</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
        <span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">1_651</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_example</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">map</span> <span class="o">=</span> <span class="n">data</span>
            <span class="nf">.valves</span><span class="p">()</span>
            <span class="nf">.iter</span><span class="p">()</span>
            <span class="nf">.map</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="p">(</span><span class="n">v</span><span class="py">.name</span><span class="p">,</span> <span class="n">v</span><span class="py">.idx</span><span class="p">))</span>
            <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>

        <span class="k">let</span> <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"DD"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">"DD"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"CC"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"BB"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">"BB"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"AA"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"II"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"JJ"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">"JJ"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"II"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"AA"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"DD"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"EE"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"FF"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"GG"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"HH"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">"HH"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"GG"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"FF"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"EE"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">"EE"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"DD"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="s">"CC"</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="s">"CC"</span><span class="p">),</span>
        <span class="p">];</span>

        <span class="k">let</span> <span class="n">max_flow</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.valves</span><span class="p">()</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="n">v</span><span class="py">.flow</span><span class="p">)</span><span class="nf">.sum</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">timer</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>

        <span class="nd">#[derive(Debug)]</span>
        <span class="k">struct</span> <span class="n">State</span> <span class="p">{</span>
            <span class="n">potential</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">pressure</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">flow</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">idx</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">opened</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
            <span class="n">timer</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="n">State</span> <span class="p">{</span>
            <span class="n">potential</span><span class="p">:</span> <span class="n">timer</span> <span class="o">*</span> <span class="n">max_flow</span><span class="p">,</span>
            <span class="n">pressure</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">flow</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">idx</span><span class="p">:</span> <span class="o">*</span><span class="n">map</span><span class="nf">.get</span><span class="p">(</span><span class="s">"AA"</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">(),</span>
            <span class="n">opened</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">timer</span><span class="p">:</span> <span class="n">timer</span><span class="p">,</span>
        <span class="p">};</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">seen</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        <span class="n">seen</span><span class="nf">.insert</span><span class="p">((</span><span class="n">s</span><span class="py">.idx</span><span class="p">,</span> <span class="n">s</span><span class="py">.opened</span><span class="p">));</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">minute</span><span class="p">,</span> <span class="n">open</span><span class="p">,</span> <span class="n">valve</span><span class="p">)</span> <span class="k">in</span> <span class="n">steps</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">idx</span> <span class="o">=</span> <span class="o">*</span><span class="n">map</span><span class="nf">.get</span><span class="p">(</span><span class="n">valve</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
            <span class="nd">assert!</span><span class="p">(</span><span class="n">idx</span> <span class="o">==</span> <span class="n">s</span><span class="py">.idx</span> <span class="p">||</span> <span class="o">!</span><span class="n">open</span><span class="p">);</span>
            <span class="nd">assert!</span><span class="p">(</span><span class="n">open</span> <span class="p">||</span> <span class="n">data</span><span class="nf">.get</span><span class="p">(</span><span class="n">s</span><span class="py">.idx</span><span class="p">)</span><span class="py">.tunnels</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">idx</span><span class="p">));</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">State</span> <span class="p">{</span>
                <span class="n">potential</span><span class="p">:</span> <span class="n">s</span><span class="py">.pressure</span> <span class="o">+</span> <span class="n">s</span><span class="py">.flow</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span><span class="py">.timer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_flow</span><span class="p">,</span>
                <span class="n">pressure</span><span class="p">:</span> <span class="n">s</span><span class="py">.pressure</span> <span class="o">+</span> <span class="n">s</span><span class="py">.flow</span><span class="p">,</span>
                <span class="n">flow</span><span class="p">:</span> <span class="k">if</span> <span class="n">open</span> <span class="p">{</span> <span class="n">s</span><span class="py">.flow</span> <span class="o">+</span> <span class="n">v</span><span class="py">.flow</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">s</span><span class="py">.flow</span> <span class="p">},</span>
                <span class="n">idx</span><span class="p">:</span> <span class="n">v</span><span class="py">.idx</span><span class="p">,</span>
                <span class="n">opened</span><span class="p">:</span> <span class="k">if</span> <span class="n">open</span> <span class="p">{</span> <span class="n">s</span><span class="py">.opened</span> <span class="p">|</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">idx</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">s</span><span class="py">.opened</span> <span class="p">},</span>
                <span class="n">timer</span><span class="p">:</span> <span class="n">s</span><span class="py">.timer</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">};</span>
            <span class="nd">assert!</span><span class="p">(</span><span class="n">seen</span><span class="nf">.insert</span><span class="p">((</span><span class="n">s</span><span class="py">.idx</span><span class="p">,</span> <span class="n">s</span><span class="py">.opened</span><span class="p">)));</span>
            <span class="nd">println!</span><span class="p">(</span>
                <span class="s">"{minute}, {} {valve}, open valves: {:?} ({s:?})"</span><span class="p">,</span>
                <span class="k">if</span> <span class="n">open</span> <span class="p">{</span> <span class="s">"opened"</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="s">"moved to"</span> <span class="p">},</span>
                <span class="n">data</span><span class="nf">.valves</span><span class="p">()</span>
                    <span class="nf">.iter</span><span class="p">()</span>
                    <span class="nf">.filter</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="p">(</span><span class="n">s</span><span class="py">.opened</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">v</span><span class="py">.idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="nf">.map</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="n">v</span><span class="py">.name</span><span class="p">)</span>
                    <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
            <span class="p">);</span>
        <span class="p">}</span>
        <span class="nd">println!</span><span class="p">(</span>
            <span class="s">"{} + {} * {} = {}, {}"</span><span class="p">,</span>
            <span class="n">s</span><span class="py">.pressure</span><span class="p">,</span>
            <span class="n">s</span><span class="py">.timer</span><span class="p">,</span>
            <span class="n">s</span><span class="py">.flow</span><span class="p">,</span>
            <span class="n">s</span><span class="py">.pressure</span> <span class="o">+</span> <span class="n">s</span><span class="py">.timer</span> <span class="o">*</span> <span class="n">s</span><span class="py">.flow</span><span class="p">,</span>
            <span class="n">s</span><span class="py">.potential</span>
        <span class="p">);</span>

        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">1_651</span><span class="p">,</span> <span class="n">s</span><span class="py">.potential</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">1_707</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-17">Day 17: Pyroclastic Flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/17">AoC|2022|17</a>.</p>
</div>
<div class="paragraph">
<p>So let&#8217;s play <a href="https://de.wikipedia.org/wiki/Tetris">Tetris</a> ;)</p>
</div>
<div class="paragraph">
<p>Because I made stupid bugs, I spent lots of time displaying the chamber and figuring out what I did wrong. My biggest mistake was to overwrite occupied space by empty space when a rock comes to rest and is not filling a full rectangle. Unfortunately, with this bug, I still get the correct result for the example data.</p>
</div>
<div class="paragraph">
<p>Part 2 is about finding a pattern that repeats itself. I do that by looking at the top 30 rows. The number 30 is kind of arbitrarily chosen.</p>
</div>
<div class="sect2">
<h3 id="_input_17">Input</h3>
<div class="paragraph">
<p>I just read the input in a byte array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="n">jets</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">jets</span><span class="p">:</span> <span class="n">s</span><span class="nf">.trim</span><span class="p">()</span><span class="nf">.as_bytes</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">jets</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">]</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.jets</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_general_solution">General solution</h3>
<div class="paragraph">
<p>I have a struct <code>Chamber</code> with a method <code>integrate_rock</code>. This takes a rock and let&#8217;s it move in the chamber until it comes to rest.</p>
</div>
<div class="paragraph">
<p>My first version did not have the <code>.filter(|&amp;k| rock[k] == b'#')</code> part in the update chamber loop at the end of the <code>integrate_rock</code> function. I typed these 29 characters with an average speed of about 12 character / hour.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">Chamber</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">chamber</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">u8</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">jets</span><span class="p">:</span> <span class="n">RingBuffer</span><span class="o">&lt;</span><span class="nv">'a</span><span class="p">,</span> <span class="nb">u8</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">rocks</span><span class="p">:</span> <span class="n">RingBuffer</span><span class="o">&lt;</span><span class="k">'static</span><span class="p">,</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;&gt;</span> <span class="k">for</span> <span class="n">Chamber</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">Self</span> <span class="p">{</span>
            <span class="n">chamber</span><span class="p">:</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">(),</span>
            <span class="n">jets</span><span class="p">:</span> <span class="n">data</span><span class="nf">.jets</span><span class="p">()</span><span class="nf">.into</span><span class="p">(),</span>
            <span class="n">rocks</span><span class="p">:</span> <span class="k">Self</span><span class="p">::</span><span class="n">ROCKS</span><span class="nf">.into</span><span class="p">(),</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Chamber</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">const</span> <span class="n">WIDTH</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">ROCKS</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="p">[(</span><span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">[</span>
        <span class="p">(</span><span class="s">"####"</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="p">(</span><span class="s">".#.###.#."</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">(</span><span class="s">"###..#..#"</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">(</span><span class="s">"####"</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="s">"####"</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">];</span>
    <span class="k">const</span> <span class="n">X0</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">DY0</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">check</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">rock</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">u8</span><span class="p">],</span> <span class="n">x</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">rock</span><span class="nf">.len</span><span class="p">())</span>
            <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">k</span><span class="p">|</span> <span class="n">rock</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b'#'</span><span class="p">)</span>
            <span class="nf">.filter</span><span class="p">(|</span><span class="n">k</span><span class="p">|</span> <span class="n">y</span> <span class="o">+</span> <span class="n">k</span> <span class="o">/</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="k">self</span><span class="nf">.height</span><span class="p">())</span>
            <span class="nf">.all</span><span class="p">(|</span><span class="n">k</span><span class="p">|</span> <span class="k">self</span><span class="py">.chamber</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">k</span> <span class="o">%</span> <span class="n">w</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">k</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="k">Self</span><span class="p">::</span><span class="n">WIDTH</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b'.'</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">height</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.chamber</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="k">Self</span><span class="p">::</span><span class="n">WIDTH</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">top</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">u8</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span>
            <span class="k">self</span><span class="py">.chamber</span><span class="p">[</span><span class="k">self</span><span class="py">.chamber</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="n">rows</span> <span class="o">*</span> <span class="k">Self</span><span class="p">::</span><span class="n">WIDTH</span><span class="o">..</span><span class="p">]</span><span class="nf">.to_vec</span><span class="p">(),</span>
            <span class="k">self</span><span class="py">.rocks</span><span class="nf">.pos</span><span class="p">(),</span>
            <span class="k">self</span><span class="py">.jets</span><span class="nf">.pos</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="n">integrate_rock</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">F</span><span class="p">)</span>
    <span class="k">where</span>
        <span class="n">F</span><span class="p">:</span> <span class="nf">Fn</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="nb">u8</span><span class="p">],</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">u8</span><span class="p">],</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span>
    <span class="p">{</span>
        <span class="k">let</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">rock</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="py">.rocks</span><span class="nf">.next</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">rock</span> <span class="o">=</span> <span class="n">rock</span><span class="nf">.as_bytes</span><span class="p">();</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">x</span> <span class="o">=</span> <span class="k">Self</span><span class="p">::</span><span class="n">X0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">y</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.height</span><span class="p">()</span> <span class="o">+</span> <span class="k">Self</span><span class="p">::</span><span class="n">DY0</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">stop</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="k">while</span> <span class="o">!</span><span class="n">stop</span> <span class="p">{</span>
            <span class="nf">f</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.chamber</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rock</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
            <span class="k">let</span> <span class="o">&amp;</span><span class="n">jet</span> <span class="o">=</span> <span class="k">self</span><span class="py">.jets</span><span class="nf">.next</span><span class="p">();</span>
            <span class="n">x</span> <span class="o">=</span> <span class="k">if</span> <span class="n">jet</span> <span class="o">==</span> <span class="sc">b'&lt;'</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">self</span><span class="nf">.check</span><span class="p">(</span><span class="n">rock</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">jet</span> <span class="o">==</span> <span class="sc">b'&gt;'</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="nn">Chamber</span><span class="p">::</span><span class="n">WIDTH</span> <span class="o">&amp;&amp;</span> <span class="k">self</span><span class="nf">.check</span><span class="p">(</span><span class="n">rock</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">x</span>
            <span class="p">};</span>

            <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="k">self</span><span class="nf">.height</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">self</span><span class="nf">.check</span><span class="p">(</span><span class="n">rock</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">y</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">y</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">stop</span> <span class="p">{</span>
                <span class="c1">// add new lines to chamber</span>
                <span class="k">while</span> <span class="k">self</span><span class="nf">.height</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">y</span> <span class="o">+</span> <span class="n">rock</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">w</span> <span class="p">{</span>
                    <span class="k">self</span><span class="py">.chamber</span><span class="nf">.extend</span><span class="p">([</span><span class="sc">b'.'</span><span class="p">;</span> <span class="k">Self</span><span class="p">::</span><span class="n">WIDTH</span><span class="p">])</span>
                <span class="p">}</span>
                <span class="c1">// update chamber</span>
                <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">rock</span><span class="nf">.len</span><span class="p">())</span><span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">k</span><span class="p">|</span> <span class="n">rock</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b'#'</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">self</span><span class="py">.chamber</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">k</span> <span class="o">%</span> <span class="n">w</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">k</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="k">Self</span><span class="p">::</span><span class="n">WIDTH</span><span class="p">]</span> <span class="o">=</span> <span class="n">rock</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_15">Star 1</h3>
<div class="paragraph">
<p>Just integrate 2022 rocks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">chamber</span> <span class="o">=</span> <span class="nn">Chamber</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

    <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">2022</span> <span class="p">{</span>
        <span class="n">chamber</span><span class="nf">.integrate_rock</span><span class="p">(|</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="p">());</span>
    <span class="p">}</span>

    <span class="n">chamber</span><span class="nf">.height</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_15">Star 2</h3>
<div class="paragraph">
<p>Integrate rocks until a situation as defined by top rows of chamber, current jet position, current rock repeats. Calculate how much hight we gain by repeating this full cycle as often as it fits in the required number of rocks to integrate and simulate the remaining steps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">chamber</span> <span class="o">=</span> <span class="nn">Chamber</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">seen</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">rows</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span> <span class="c1">// this is somehow arbitrary</span>

    <span class="k">let</span> <span class="n">rounds</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">1_000_000_000_000</span><span class="p">;</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="n">chamber</span><span class="nf">.height</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rows</span> <span class="p">{</span>
        <span class="n">chamber</span><span class="nf">.integrate_rock</span><span class="p">(|</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="p">());</span>
        <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">cur</span> <span class="k">in</span> <span class="n">cnt</span><span class="o">..</span><span class="n">rounds</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">((</span><span class="n">prev</span><span class="p">,</span> <span class="n">prev_height</span><span class="p">))</span> <span class="o">=</span> <span class="n">seen</span><span class="nf">.insert</span><span class="p">(</span><span class="n">chamber</span><span class="nf">.top</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">chamber</span><span class="nf">.height</span><span class="p">()))</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">d_round</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="n">prev</span><span class="p">;</span>
            <span class="k">let</span> <span class="n">d_height</span> <span class="o">=</span> <span class="n">chamber</span><span class="nf">.height</span><span class="p">()</span> <span class="o">-</span> <span class="n">prev_height</span><span class="p">;</span>

            <span class="k">let</span> <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">rounds</span> <span class="o">-</span> <span class="n">cur</span><span class="p">)</span> <span class="o">/</span> <span class="n">d_round</span><span class="p">;</span>
            <span class="k">let</span> <span class="n">h</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">d_height</span><span class="p">;</span>

            <span class="k">let</span> <span class="n">rem</span> <span class="o">=</span> <span class="p">(</span><span class="n">rounds</span> <span class="o">-</span> <span class="n">cur</span><span class="p">)</span> <span class="o">%</span> <span class="n">d_round</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">rem</span> <span class="p">{</span>
                <span class="n">chamber</span><span class="nf">.integrate_rock</span><span class="p">(|</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="p">());</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">chamber</span><span class="nf">.height</span><span class="p">()</span> <span class="o">+</span> <span class="n">h</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">chamber</span><span class="nf">.integrate_rock</span><span class="p">(|</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">unreachable!</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_18">Tests</h3>
<div class="paragraph">
<p>Tests did not help a lot today.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"&gt;&gt;&gt;&lt;&lt;&gt;&lt;&gt;&gt;&lt;&lt;&lt;&gt;&gt;&lt;&gt;&gt;&gt;&lt;&lt;&lt;&gt;&gt;&gt;&lt;&lt;&lt;&gt;&lt;&lt;&lt;&gt;&gt;&lt;&gt;&gt;&lt;&lt;&gt;&gt;"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">3_068</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">1_514_285_714_288</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>My testing approach was to print various configurations using <strong>very nice</strong> printing code. Obviously, I removed all the <code>println!</code> and <code>if debug {}</code> statements before I publish my code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">struct</span> <span class="n">RockInChamber</span><span class="o">&lt;</span><span class="nv">'a</span><span class="p">,</span> <span class="nv">'b</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="n">chamber</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
    <span class="k">pub</span> <span class="n">rock</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'b</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
    <span class="k">pub</span> <span class="n">x</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">y</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">w</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">rock_part</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">print_lim</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nb">Default</span> <span class="k">for</span> <span class="n">RockInChamber</span><span class="o">&lt;</span><span class="nv">'_</span><span class="p">,</span> <span class="nv">'_</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">default</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">Self</span> <span class="p">{</span>
            <span class="n">chamber</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[],</span>
            <span class="n">rock</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[],</span>
            <span class="n">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">w</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">rock_part</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="n">print_lim</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span> <span class="k">for</span> <span class="n">RockInChamber</span><span class="o">&lt;</span><span class="nv">'_</span><span class="p">,</span> <span class="nv">'_</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">h</span> <span class="o">=</span> <span class="k">self</span><span class="py">.chamber</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="nn">Chamber</span><span class="p">::</span><span class="n">WIDTH</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">y_mx</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="k">self</span><span class="py">.rock_part</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">y_mn</span> <span class="o">=</span> <span class="mi">0</span><span class="nf">.max</span><span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="k">self</span><span class="py">.print_lim</span><span class="nf">.min</span><span class="p">(</span><span class="n">h</span><span class="p">));</span>
        <span class="k">for</span> <span class="n">y_</span> <span class="k">in</span> <span class="p">(</span><span class="n">y_mn</span><span class="o">..</span><span class="n">y_mx</span><span class="p">)</span><span class="nf">.rev</span><span class="p">()</span> <span class="p">{</span>
            <span class="sc">'|'</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">x_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="nn">Chamber</span><span class="p">::</span><span class="n">WIDTH</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">x_</span> <span class="o">&gt;=</span> <span class="k">self</span><span class="py">.x</span>
                    <span class="o">&amp;&amp;</span> <span class="n">x_</span> <span class="o">&lt;</span> <span class="k">self</span><span class="py">.x</span> <span class="o">+</span> <span class="k">self</span><span class="py">.w</span>
                    <span class="o">&amp;&amp;</span> <span class="n">y_</span> <span class="o">&gt;=</span> <span class="k">self</span><span class="py">.y</span>
                    <span class="o">&amp;&amp;</span> <span class="n">y_</span> <span class="o">&lt;</span> <span class="k">self</span><span class="py">.y</span> <span class="o">+</span> <span class="k">self</span><span class="py">.rock</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="k">self</span><span class="py">.w</span>
                    <span class="o">&amp;&amp;</span> <span class="k">self</span><span class="py">.rock</span><span class="p">[</span><span class="n">x_</span> <span class="o">-</span> <span class="k">self</span><span class="py">.x</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_</span> <span class="o">-</span> <span class="k">self</span><span class="py">.y</span><span class="p">)</span> <span class="o">*</span> <span class="k">self</span><span class="py">.w</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b'#'</span>
                <span class="p">{</span>
                    <span class="sc">'@'</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">y_</span> <span class="o">&lt;</span> <span class="n">h</span> <span class="p">{</span>
                    <span class="p">(</span><span class="k">self</span><span class="py">.chamber</span><span class="p">[</span><span class="n">x_</span> <span class="o">+</span> <span class="n">y_</span> <span class="o">*</span> <span class="nn">Chamber</span><span class="p">::</span><span class="n">WIDTH</span><span class="p">]</span> <span class="k">as</span> <span class="nb">char</span><span class="p">)</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="sc">'.'</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="s">"|</span><span class="se">\n</span><span class="s">"</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">y_mn</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="sc">'+'</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="nn">Chamber</span><span class="p">::</span><span class="n">WIDTH</span> <span class="p">{</span>
                <span class="sc">'-'</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="s">"+"</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="s">"|~y="</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
            <span class="p">(</span><span class="n">y_mn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
            <span class="s">"~"</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nf">Ok</span><span class="p">(())</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span> <span class="k">for</span> <span class="n">Chamber</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
        <span class="n">RockInChamber</span> <span class="p">{</span>
            <span class="n">chamber</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.chamber</span><span class="p">,</span>
            <span class="o">..</span><span class="nn">RockInChamber</span><span class="p">::</span><span class="nf">default</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_animation">Animation</h3>
<div class="paragraph">
<p>Just for fun, I created an example with a little animation (simulates 2022 rocks using the example data). Run with <code>cargo run --release --example animate&#8201;&#8212;&#8201;&lt;ms&gt;</code> where <code>&lt;ms&gt;</code> is the amount of ms to sleep after each animation step, defaults to <code>40</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// accept a single numeric argumnet</span>
    <span class="k">let</span> <span class="n">arg</span> <span class="o">=</span> <span class="nn">env</span><span class="p">::</span><span class="nf">args</span><span class="p">()</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="nf">.next</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">wait</span> <span class="o">=</span> <span class="n">arg</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">arg</span><span class="p">|</span> <span class="n">arg</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.expect</span><span class="p">(</span><span class="s">"a positive amount of ms to pause"</span><span class="p">))</span>
        <span class="nf">.unwrap_or</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">chamber</span> <span class="o">=</span> <span class="nn">Chamber</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONTENT</span><span class="nf">.into</span><span class="p">());</span>
    <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">2022</span> <span class="p">{</span>
        <span class="n">chamber</span><span class="nf">.integrate_rock</span><span class="p">(|</span><span class="n">chamber</span><span class="p">,</span> <span class="n">rock</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">|</span> <span class="p">{</span>
            <span class="nd">print!</span><span class="p">(</span><span class="s">"</span><span class="se">\x1B</span><span class="s">[1;1H</span><span class="se">\x1B</span><span class="s">[J"</span><span class="p">);</span> <span class="c1">// clear console</span>
            <span class="nd">println!</span><span class="p">(</span>
                <span class="s">"{}"</span><span class="p">,</span>
                <span class="n">RockInChamber</span> <span class="p">{</span>
                    <span class="n">chamber</span><span class="p">,</span>
                    <span class="n">rock</span><span class="p">,</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="n">w</span><span class="p">,</span>
                    <span class="o">..</span><span class="nn">RockInChamber</span><span class="p">::</span><span class="nf">default</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">);</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"Rock {}"</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="nn">thread</span><span class="p">::</span><span class="nf">sleep</span><span class="p">(</span><span class="nn">Duration</span><span class="p">::</span><span class="nf">from_millis</span><span class="p">(</span><span class="n">wait</span><span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-18">Day 18: Boiling Boulders</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/18">AoC|2022|18</a>.</p>
</div>
<div class="sect2">
<h3 id="_input_18">Input</h3>
<div class="paragraph">
<p>Parse the input in a vec of 3D coordinates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="n">cubes</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">cubes</span><span class="p">:</span> <span class="n">s</span>
                    <span class="nf">.lines</span><span class="p">()</span>
                    <span class="nf">.map</span><span class="p">(|</span><span class="n">line</span><span class="p">|</span> <span class="n">line</span><span class="nf">.split</span><span class="p">(</span><span class="sc">','</span><span class="p">))</span>
                    <span class="nf">.map</span><span class="p">(|</span><span class="k">mut</span> <span class="n">split</span><span class="p">|</span> <span class="p">{</span>
                        <span class="p">(</span>
                            <span class="n">split</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">(),</span>
                            <span class="n">split</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">(),</span>
                            <span class="n">split</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">(),</span>
                        <span class="p">)</span>
                    <span class="p">})</span>
                    <span class="nf">.collect</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">cubes</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="p">[(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)]</span> <span class="p">{</span>
            <span class="o">&amp;</span><span class="k">self</span><span class="py">.cubes</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_16">Star 1</h3>
<div class="paragraph">
<p>I use bits of bytes to store whether a side of a cube is touching a side of another cube. I start with all bits set to 1 and set them to zero by looking at all pairs of cubes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1_pairwise_comp</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">cubes</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.cubes</span><span class="p">();</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">sides</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="mi">0b111111u8</span><span class="p">;</span> <span class="n">cubes</span><span class="nf">.len</span><span class="p">()];</span>

    <span class="k">for</span> <span class="n">k1</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">cubes</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
        <span class="k">let</span> <span class="p">(</span><span class="n">x_1</span><span class="p">,</span> <span class="n">y_1</span><span class="p">,</span> <span class="n">z_1</span><span class="p">)</span> <span class="o">=</span> <span class="n">cubes</span><span class="p">[</span><span class="n">k1</span><span class="p">];</span>
        <span class="k">for</span> <span class="n">k2</span> <span class="k">in</span> <span class="n">k1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">..</span><span class="n">cubes</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="p">(</span><span class="n">x_2</span><span class="p">,</span> <span class="n">y_2</span><span class="p">,</span> <span class="n">z_2</span><span class="p">)</span> <span class="o">=</span> <span class="n">cubes</span><span class="p">[</span><span class="n">k2</span><span class="p">];</span>
            <span class="k">if</span> <span class="n">x_1</span> <span class="o">==</span> <span class="n">x_2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">y_1</span> <span class="o">==</span> <span class="n">y_2</span> <span class="o">&amp;&amp;</span> <span class="n">z_1</span> <span class="o">==</span> <span class="n">z_2</span> <span class="p">{</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_1</span> <span class="o">==</span> <span class="n">x_2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">y_1</span> <span class="o">==</span> <span class="n">y_2</span> <span class="o">&amp;&amp;</span> <span class="n">z_1</span> <span class="o">==</span> <span class="n">z_2</span> <span class="p">{</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_1</span> <span class="o">==</span> <span class="n">x_2</span> <span class="o">&amp;&amp;</span> <span class="n">y_1</span> <span class="o">==</span> <span class="n">y_2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">z_1</span> <span class="o">==</span> <span class="n">z_2</span> <span class="p">{</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_1</span> <span class="o">==</span> <span class="n">x_2</span> <span class="o">&amp;&amp;</span> <span class="n">y_1</span> <span class="o">==</span> <span class="n">y_2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">z_1</span> <span class="o">==</span> <span class="n">z_2</span> <span class="p">{</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_1</span> <span class="o">==</span> <span class="n">x_2</span> <span class="o">&amp;&amp;</span> <span class="n">y_1</span> <span class="o">==</span> <span class="n">y_2</span> <span class="o">&amp;&amp;</span> <span class="n">z_1</span> <span class="o">==</span> <span class="n">z_2</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_1</span> <span class="o">==</span> <span class="n">x_2</span> <span class="o">&amp;&amp;</span> <span class="n">y_1</span> <span class="o">==</span> <span class="n">y_2</span> <span class="o">&amp;&amp;</span> <span class="n">z_1</span> <span class="o">==</span> <span class="n">z_2</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
                <span class="n">sides</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">sides</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">s</span><span class="p">|</span> <span class="n">s</span><span class="nf">.count_ones</span><span class="p">()</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">)</span><span class="nf">.sum</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_16">Star 2</h3>
<div class="paragraph">
<p>The approach for part 2 is totally different from the approach for part 1.</p>
</div>
<div class="paragraph">
<p>I calculate the bounding box containing all cubes of a droplet and do a breadth first traversal starting from all 8 corners of the bounding box (enlarged by one in each direction) at the same time. The traversal will not exit this enlarged bounding box.</p>
</div>
<div class="paragraph">
<p>Whenever the traversal hits a cube contained in the droplet, there is exactly on side facing outwards to be added to the count.</p>
</div>
<div class="paragraph">
<p>Interestingly, the solution for the second part is calculated faster than the solution for the first part in my case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="p">((</span><span class="n">x_mn</span><span class="p">,</span> <span class="n">y_mn</span><span class="p">,</span> <span class="n">z_mn</span><span class="p">),</span> <span class="p">(</span><span class="n">x_mx</span><span class="p">,</span> <span class="n">y_mx</span><span class="p">,</span> <span class="n">z_mx</span><span class="p">))</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.cubes</span><span class="p">()</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.fold</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="p">(</span><span class="nn">isize</span><span class="p">::</span><span class="n">MAX</span><span class="p">,</span> <span class="nn">isize</span><span class="p">::</span><span class="n">MAX</span><span class="p">,</span> <span class="nn">isize</span><span class="p">::</span><span class="n">MAX</span><span class="p">),</span>
            <span class="p">(</span><span class="nn">isize</span><span class="p">::</span><span class="n">MIN</span><span class="p">,</span> <span class="nn">isize</span><span class="p">::</span><span class="n">MIN</span><span class="p">,</span> <span class="nn">isize</span><span class="p">::</span><span class="n">MIN</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="p">|(</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">),</span> <span class="n">c</span><span class="p">|</span> <span class="p">{</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">mn</span><span class="na">.0</span><span class="nf">.min</span><span class="p">(</span><span class="n">c</span><span class="na">.0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">mn</span><span class="na">.1</span><span class="nf">.min</span><span class="p">(</span><span class="n">c</span><span class="na">.1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">mn</span><span class="na">.2</span><span class="nf">.min</span><span class="p">(</span><span class="n">c</span><span class="na">.2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
                <span class="p">(</span><span class="n">mx</span><span class="na">.0</span><span class="nf">.max</span><span class="p">(</span><span class="n">c</span><span class="na">.0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">mx</span><span class="na">.1</span><span class="nf">.max</span><span class="p">(</span><span class="n">c</span><span class="na">.1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">mx</span><span class="na">.2</span><span class="nf">.max</span><span class="p">(</span><span class="n">c</span><span class="na">.2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="p">)</span>
        <span class="p">},</span>
    <span class="p">);</span>

    <span class="k">let</span> <span class="n">droplet</span><span class="p">:</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from_iter</span><span class="p">(</span><span class="n">data</span><span class="nf">.cubes</span><span class="p">()</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.cloned</span><span class="p">());</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">queue</span> <span class="o">=</span> <span class="nn">VecDeque</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="p">[</span><span class="n">x_mn</span><span class="p">,</span> <span class="n">x_mx</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">y</span> <span class="k">in</span> <span class="p">[</span><span class="n">y_mn</span><span class="p">,</span> <span class="n">y_mx</span><span class="p">]</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">z</span> <span class="k">in</span> <span class="p">[</span><span class="n">z_mn</span><span class="p">,</span> <span class="n">z_mx</span><span class="p">]</span> <span class="p">{</span>
                <span class="n">queue</span><span class="nf">.push_back</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">seen</span><span class="p">:</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from_iter</span><span class="p">(</span><span class="n">queue</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.cloned</span><span class="p">());</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">sides</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span> <span class="o">=</span> <span class="n">queue</span><span class="nf">.pop_front</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span>
            <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="nf">.into_iter</span><span class="p">()</span>
        <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)|</span> <span class="p">{</span>
            <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">x_mn</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="n">y_mn</span> <span class="o">&amp;&amp;</span> <span class="n">z</span> <span class="o">&gt;=</span> <span class="n">z_mn</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">x_mx</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">y_mx</span> <span class="o">&amp;&amp;</span> <span class="n">z</span> <span class="o">&lt;=</span> <span class="n">z_mx</span>
        <span class="p">})</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">droplet</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">sides</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">seen</span><span class="nf">.insert</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">queue</span><span class="nf">.push_back</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">sides</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_variant">Star 1 variant</h3>
<div class="paragraph">
<p>After part 2 was done, I re-created a solution for part 1 based on the same idea.</p>
</div>
<div class="paragraph">
<p>This time, I do a breadth first traversal inside the droplet. Since the droplet is not necessarily connected, I need to wrap everything in an additional loop until all cubes are processed. To do so, I replace the <code>seen</code> set (which is initially empty) by a <code>remain</code> set, which initially contains all cubes, and from which I remove all cubes that are processed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1_traversal</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">droplet</span><span class="p">:</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from_iter</span><span class="p">(</span><span class="n">data</span><span class="nf">.cubes</span><span class="p">()</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.cloned</span><span class="p">());</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">sides</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">let</span> <span class="k">mut</span> <span class="n">queue</span> <span class="o">=</span> <span class="nn">VecDeque</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">remain</span> <span class="o">=</span> <span class="n">droplet</span><span class="nf">.clone</span><span class="p">();</span>
    <span class="k">while</span> <span class="o">!</span><span class="n">remain</span><span class="nf">.is_empty</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="o">&amp;</span><span class="n">start</span> <span class="o">=</span> <span class="n">remain</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="n">remain</span><span class="nf">.remove</span><span class="p">(</span><span class="o">&amp;</span><span class="n">start</span><span class="p">);</span>

        <span class="n">queue</span><span class="nf">.push_back</span><span class="p">(</span><span class="n">start</span><span class="p">);</span>

        <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span> <span class="o">=</span> <span class="n">queue</span><span class="nf">.pop_front</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">a</span> <span class="k">in</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span>
                <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span>
                <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span>
                <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span>
                <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">]</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">remain</span><span class="nf">.remove</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// cube in droplet and not yet seen</span>
                    <span class="n">queue</span><span class="nf">.push_back</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">!</span><span class="n">droplet</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// cube which is direct adjacent is not contained</span>
                    <span class="n">sides</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">sides</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_19">Tests</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"2,2,2
1,2,2
3,2,2
2,1,2
2,3,2
2,2,1
2,2,3
2,2,4
2,2,6
1,2,5
3,2,5
2,1,5
2,3,5
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">data</span><span class="nf">.cubes</span><span class="p">()</span><span class="nf">.len</span><span class="p">());</span>
        <span class="nd">assert_eq!</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">data</span><span class="nf">.cubes</span><span class="p">()[</span><span class="mi">3</span><span class="p">]);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="nf">star_1_pairwise_comp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="nf">star_1_traversal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-19">Day 19: Not Enough Minerals</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/19">AoC|2022|19</a>.</p>
</div>
<div class="paragraph">
<p>I was basically poking in the fog and brute forcing the solution.</p>
</div>
<div class="paragraph">
<p>After I had a working solution, I looked for help in the <a href="https://www.reddit.com/r/adventofcode/comments/zpihwi/2022_day_19_solutions/">reddit solution megathread</a> and re-worked my solution.</p>
</div>
<div class="paragraph">
<p>There are three main elements that lead to acceptable solution time:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Do not simulate every minute but rather decide which robot to build next and simulate as many minutes as required to build that robot at once</p>
</li>
<li>
<p>Understand that only one robot can be made per minute, which implies that there is no point in having more Ore, Clay or Obsidian collecting robots than the maximum Ore, Clay or Obsidian required to produce a single robot of any kind</p>
</li>
<li>
<p>Do a depth first search to have terminal states quickly and discard all branches for which an upper bound can be calculated which is below the current optimum (this is kind of an A* idea)</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_input_19">Input</h3>
<div class="paragraph">
<p>I parse the blueprints into a vec containing the amount of Ore, Clay and Obsidian required to build any of the Ore collecting, Clay collecting, Obsidian collecting or Geode opening robots. This results in many 0&#8217;s but makes the implementation of the search algorithm much easier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">crate</span><span class="p">::{</span><span class="n">CLAY</span><span class="p">,</span> <span class="n">GEODE</span><span class="p">,</span> <span class="n">OBSIDIAN</span><span class="p">,</span> <span class="n">ORE</span><span class="p">};</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">blueprints</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">[</span><span class="nb">usize</span><span class="p">;</span> <span class="mi">12</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">parse_blueprint</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">[</span><span class="nb">usize</span><span class="p">;</span> <span class="mi">12</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">blueprint</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="mi">12</span><span class="p">];</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="nf">.split_ascii_whitespace</span><span class="p">()</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span> <span class="c1">// blueprint &lt;id&gt;: each ore robot costs</span>
        <span class="n">blueprint</span><span class="p">[</span><span class="n">ORE</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">ORE</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span> <span class="c1">// XX: ore for ore robot</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// ore. each clay robot costs</span>
        <span class="n">blueprint</span><span class="p">[</span><span class="n">ORE</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">CLAY</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span> <span class="c1">// XX: ore for clay robot</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// ore. each obsidian robot costs</span>
        <span class="n">blueprint</span><span class="p">[</span><span class="n">ORE</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">OBSIDIAN</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span> <span class="c1">// XX: ore for obsidian robot</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// ore and</span>
        <span class="n">blueprint</span><span class="p">[</span><span class="n">CLAY</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">OBSIDIAN</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span> <span class="c1">// XX: clay for obsidian robot</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// clay. each geode robot costs</span>
        <span class="n">blueprint</span><span class="p">[</span><span class="n">ORE</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">GEODE</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span> <span class="c1">// XX: ore for geode robot</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.skip</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="c1">// ore and</span>
        <span class="n">blueprint</span><span class="p">[</span><span class="n">OBSIDIAN</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">GEODE</span><span class="p">]</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span> <span class="c1">// XX: obsidian for geode robot</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="s">"obsidian."</span><span class="p">),</span> <span class="n">words</span><span class="nf">.next</span><span class="p">());</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="nb">None</span><span class="p">,</span> <span class="n">words</span><span class="nf">.next</span><span class="p">());</span>

        <span class="n">blueprint</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">blueprints</span><span class="p">:</span> <span class="n">s</span><span class="nf">.lines</span><span class="p">()</span><span class="nf">.map</span><span class="p">(</span><span class="n">parse_blueprint</span><span class="p">)</span><span class="nf">.collect</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_17">Star 1</h3>
<div class="paragraph">
<p>My depth-first search implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">max_geodes</span><span class="p">(</span><span class="n">blueprint</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">usize</span><span class="p">],</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="c1">// start with one ore robot, zero material and steps to go</span>
    <span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="p">([</span><span class="mi">1usize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">;</span> <span class="mi">4</span><span class="p">],</span> <span class="n">steps</span><span class="p">);</span>

    <span class="c1">// initialize queue</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">queue</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">from</span><span class="p">([</span><span class="n">start</span><span class="p">]);</span>

    <span class="c1">// maximum required amount of robots per type</span>
    <span class="k">let</span> <span class="n">max_req</span> <span class="o">=</span> <span class="p">(</span><span class="n">ORE</span><span class="o">..=</span><span class="n">OBSIDIAN</span><span class="p">)</span><span class="nf">.fold</span><span class="p">([</span><span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span><span class="p">;</span> <span class="mi">4</span><span class="p">],</span> <span class="p">|</span><span class="k">mut</span> <span class="n">max_req</span><span class="p">,</span> <span class="n">m</span><span class="p">|</span> <span class="p">{</span>
        <span class="n">max_req</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ORE</span><span class="o">..=</span><span class="n">GEODE</span><span class="p">)</span><span class="nf">.map</span><span class="p">(|</span><span class="n">r</span><span class="p">|</span> <span class="n">blueprint</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">r</span><span class="p">])</span><span class="nf">.max</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="n">max_req</span>
    <span class="p">});</span>

    <span class="c1">// optimum</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">opt</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">((</span><span class="n">robots</span><span class="p">,</span> <span class="n">materials</span><span class="p">,</span> <span class="n">steps</span><span class="p">))</span> <span class="o">=</span> <span class="n">queue</span><span class="nf">.pop</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// update optimum, including geodes opened in remaining steps</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">opt</span><span class="nf">.max</span><span class="p">(</span><span class="n">materials</span><span class="p">[</span><span class="n">GEODE</span><span class="p">]</span> <span class="o">+</span> <span class="n">robots</span><span class="p">[</span><span class="n">GEODE</span><span class="p">]</span> <span class="o">*</span> <span class="n">steps</span><span class="p">);</span>

        <span class="c1">// time elapsed</span>
        <span class="k">if</span> <span class="n">steps</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// if geodes opened by making a geode robot in every subsequent step does not lead to</span>
        <span class="c1">// an improvement, stop here</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">steps</span><span class="p">)</span><span class="nf">.fold</span><span class="p">(</span><span class="n">materials</span><span class="p">[</span><span class="n">GEODE</span><span class="p">],</span> <span class="p">|</span><span class="n">bound</span><span class="p">,</span> <span class="n">step</span><span class="p">|</span> <span class="p">{</span>
            <span class="n">bound</span> <span class="o">+</span> <span class="p">(</span><span class="n">robots</span><span class="p">[</span><span class="n">GEODE</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="n">step</span><span class="p">)</span>
        <span class="p">})</span> <span class="o">&lt;</span> <span class="n">opt</span>
        <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">r</span> <span class="k">in</span> <span class="p">(</span><span class="n">ORE</span><span class="o">..=</span><span class="n">GEODE</span><span class="p">)</span><span class="nf">.rev</span><span class="p">()</span><span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">r</span><span class="p">|</span> <span class="n">robots</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_req</span><span class="p">[</span><span class="n">r</span><span class="p">])</span> <span class="p">{</span>
            <span class="c1">// calculate steps required to build robot</span>
            <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">ORE</span><span class="o">..=</span><span class="n">OBSIDIAN</span><span class="p">)</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">m</span><span class="p">|</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="n">materials</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">blueprint</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">r</span><span class="p">]</span> <span class="p">{</span>
                        <span class="nf">Some</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">robots</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                        <span class="nb">None</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nf">Some</span><span class="p">((</span><span class="n">blueprint</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">r</span><span class="p">]</span> <span class="o">-</span> <span class="n">materials</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+</span> <span class="n">robots</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">robots</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                    <span class="p">}</span>
                <span class="p">})</span>
                <span class="nf">.fold</span><span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="p">|</span><span class="n">s_max</span><span class="p">,</span> <span class="n">s</span><span class="p">|</span> <span class="k">match</span> <span class="p">(</span><span class="n">s_max</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
                    <span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="n">s_max</span><span class="p">),</span> <span class="nf">Some</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="nf">Some</span><span class="p">(</span><span class="n">s_max</span><span class="nf">.max</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span>
                    <span class="n">_</span> <span class="k">=&gt;</span> <span class="nb">None</span><span class="p">,</span>
                <span class="p">})</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// can't build robot</span>
                    <span class="k">continue</span>
                <span class="p">};</span>

            <span class="k">if</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">steps</span> <span class="p">{</span>
                <span class="c1">// time elapsed</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// update robots and materials</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">materials</span> <span class="o">=</span> <span class="n">materials</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">m</span> <span class="k">in</span> <span class="n">ORE</span><span class="o">..=</span><span class="n">OBSIDIAN</span> <span class="p">{</span>
                <span class="n">materials</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">robots</span><span class="p">[</span><span class="n">m</span><span class="p">];</span>
                <span class="n">materials</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">-=</span> <span class="n">blueprint</span><span class="p">[</span><span class="n">m</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">r</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="n">materials</span><span class="p">[</span><span class="n">GEODE</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">robots</span><span class="p">[</span><span class="n">GEODE</span><span class="p">];</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">robots</span> <span class="o">=</span> <span class="n">robots</span><span class="p">;</span>
            <span class="n">robots</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

            <span class="c1">// push to queue</span>
            <span class="n">queue</span><span class="nf">.push</span><span class="p">((</span><span class="n">robots</span><span class="p">,</span> <span class="n">materials</span><span class="p">,</span> <span class="n">steps</span> <span class="o">-</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">opt</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is used for part 1 as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">data</span><span class="py">.blueprints</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">blueprint</span><span class="p">|</span> <span class="nf">max_geodes</span><span class="p">(</span><span class="n">blueprint</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
        <span class="nf">.enumerate</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|(</span><span class="n">k</span><span class="p">,</span> <span class="n">opt</span><span class="p">)|</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">opt</span><span class="p">)</span>
        <span class="nf">.sum</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_17">Star 2</h3>
<div class="paragraph">
<p>The same solution works for part 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">data</span><span class="py">.blueprints</span>
        <span class="nf">.iter</span><span class="p">()</span>
        <span class="nf">.take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">blueprint</span><span class="p">|</span> <span class="nf">max_geodes</span><span class="p">(</span><span class="n">blueprint</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
        <span class="nf">.product</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_20">Tests</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"Blueprint 1: Each ore robot costs 4 ore. Each clay robot costs 2 ore. Each obsidian robot costs 3 ore and 14 clay. Each geode robot costs 2 ore and 7 obsidian.
Blueprint 2: Each ore robot costs 2 ore. Each clay robot costs 3 ore. Each obsidian robot costs 3 ore and 8 clay. Each geode robot costs 3 ore and 12 obsidian.
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">56</span> <span class="o">*</span> <span class="mi">62</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_today_i_learned_8">Today I learned</h3>
<div class="paragraph">
<p>Brute force sometimes works but it is no fun, and there is a lot to learn on how to solve these kind of problems &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-20">Day 20: Grove Positioning System</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/20">AoC|2022|20</a>.</p>
</div>
<div class="paragraph">
<p>Looked simple but was more tricky than expected.</p>
</div>
<div class="paragraph">
<p>The example data turned out to be too <em>friendly</em> for me.</p>
</div>
<div class="sect2">
<h3 id="_input_20">Input</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">numbers</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">isize</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">numbers</span><span class="p">:</span> <span class="n">s</span><span class="nf">.trim</span><span class="p">()</span><span class="nf">.lines</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="n">l</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">())</span><span class="nf">.collect</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_general_solution_2">General Solution</h3>
<div class="paragraph">
<p>I decided to store the data in a kind of doubly linked list. I implemented this by creating a list of indices to the predecessor and successor of each number. The numbers themselves are stored in a vec which is unchanged all the time (this is useful since we need to process along the initial order of the numbers)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">mix</span><span class="p">(</span><span class="n">numbers</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">isize</span><span class="p">],</span> <span class="n">times</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">isize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">n</span> <span class="o">=</span> <span class="n">numbers</span><span class="nf">.len</span><span class="p">();</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">n</span><span class="p">)</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">k</span><span class="p">|</span> <span class="p">((</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">))</span>
        <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">k0</span> <span class="o">=</span> <span class="n">numbers</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">v</span><span class="p">|</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

    <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">times</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">n</span> <span class="p">{</span>
            <span class="nf">mix_step</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">indices</span><span class="p">,</span> <span class="n">numbers</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="n">k1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">1000</span><span class="p">)</span><span class="nf">.fold</span><span class="p">(</span><span class="n">k0</span><span class="p">,</span> <span class="p">|</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">k2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">1000</span><span class="p">)</span><span class="nf">.fold</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="p">|</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">k3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">1000</span><span class="p">)</span><span class="nf">.fold</span><span class="p">(</span><span class="n">k2</span><span class="p">,</span> <span class="p">|</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span><span class="p">);</span>

    <span class="n">numbers</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">+</span> <span class="n">numbers</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">+</span> <span class="n">numbers</span><span class="p">[</span><span class="n">k3</span><span class="p">]</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The key is to perform a single mix step correctly. I failed to do so in all possible ways. To be able to test this properly, I put it into a separate function and created my own test cases for it (see below).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">mix_step</span><span class="p">(</span><span class="n">indices</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">numbers</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">isize</span><span class="p">],</span> <span class="n">k</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
    <span class="k">let</span> <span class="n">steps</span> <span class="o">=</span> <span class="n">v</span> <span class="o">%</span> <span class="p">(</span><span class="n">numbers</span><span class="nf">.len</span><span class="p">()</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">// move in direction of lower number of steps</span>
    <span class="k">let</span> <span class="n">steps</span> <span class="o">=</span> <span class="k">if</span> <span class="n">steps</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">numbers</span><span class="nf">.len</span><span class="p">()</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">{</span>
        <span class="n">steps</span> <span class="o">-</span> <span class="p">(</span><span class="n">numbers</span><span class="nf">.len</span><span class="p">()</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">steps</span> <span class="o">&lt;</span> <span class="o">-</span><span class="p">(</span><span class="n">numbers</span><span class="nf">.len</span><span class="p">()</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">{</span>
        <span class="n">steps</span> <span class="o">+</span> <span class="p">(</span><span class="n">numbers</span><span class="nf">.len</span><span class="p">()</span> <span class="k">as</span> <span class="nb">isize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">steps</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="n">steps</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">steps</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="c1">// k_pre k k_post .. idx idx_post =&gt; k_pre k_post .. idx k idx_post</span>
            <span class="k">let</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">steps</span><span class="p">)</span><span class="nf">.fold</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">|</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span><span class="p">);</span>
            <span class="k">let</span> <span class="p">(</span><span class="n">k_pre</span><span class="p">,</span> <span class="n">k_post</span><span class="p">)</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
            <span class="k">let</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">idx_post</span><span class="p">)</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">k_post</span><span class="p">]</span><span class="na">.0</span> <span class="o">=</span> <span class="n">k_pre</span><span class="p">;</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">k_pre</span><span class="p">]</span><span class="na">.1</span> <span class="o">=</span> <span class="n">k_post</span><span class="p">;</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx_post</span><span class="p">);</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="na">.1</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">idx_post</span><span class="p">]</span><span class="na">.0</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// idx_pre idx .. k_pre k k_post =&gt; idx_pre k idx .. k_pre k_post</span>
            <span class="k">let</span> <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">steps</span><span class="o">..</span><span class="mi">0</span><span class="p">)</span><span class="nf">.fold</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">|</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.0</span><span class="p">);</span>
            <span class="k">let</span> <span class="p">(</span><span class="n">k_pre</span><span class="p">,</span> <span class="n">k_post</span><span class="p">)</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
            <span class="k">let</span> <span class="p">(</span><span class="n">idx_pre</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">k_post</span><span class="p">]</span><span class="na">.0</span> <span class="o">=</span> <span class="n">k_pre</span><span class="p">;</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">k_pre</span><span class="p">]</span><span class="na">.1</span> <span class="o">=</span> <span class="n">k_post</span><span class="p">;</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx_pre</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="na">.0</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
            <span class="n">indices</span><span class="p">[</span><span class="n">idx_pre</span><span class="p">]</span><span class="na">.1</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_18">Star 1</h3>
<div class="paragraph">
<p>Just call the mix function with <code>times = 1</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_18">Star 2</h3>
<div class="paragraph">
<p>Call the mix function with numbers multiplied by the decryption key and <code>times = 10</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">isize</span> <span class="p">{</span>
    <span class="nf">mix</span><span class="p">(</span>
        <span class="o">&amp;</span><span class="n">data</span>
            <span class="py">.numbers</span>
            <span class="nf">.iter</span><span class="p">()</span>
            <span class="nf">.map</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="n">v</span> <span class="o">*</span> <span class="mi">811_589_153</span><span class="p">)</span>
            <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">(),</span>
        <span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_21">Tests</h3>
<div class="paragraph">
<p>The most difficult part today: create <code>test_mix_step</code> and make it pass.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashSet</span><span class="p">;</span>

    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"1
2
-3
3
-2
0
4
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_mix_step</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">numbers</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="nb">isize</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">,</span>
            <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">n</span><span class="p">,</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span>
            <span class="o">-</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">-</span><span class="n">n</span><span class="p">,</span>
            <span class="o">-</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span>
            <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">];</span>

        <span class="nd">println!</span><span class="p">(</span>
            <span class="s">"{:?}"</span><span class="p">,</span>
            <span class="n">numbers</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">v</span><span class="nf">.rem_euclid</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span>
        <span class="p">);</span>

        <span class="k">let</span> <span class="n">exp</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>       <span class="c1">// 0</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>        <span class="c1">// -1</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>        <span class="c1">// -2</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">),</span>             <span class="c1">// 1</span>
            <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>             <span class="c1">// 2</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>                 <span class="c1">// n - 2 = 19</span>
            <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>             <span class="c1">// n - 1 = 20</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span> <span class="c1">// n = 21</span>
            <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>         <span class="c1">// 2 n - 4 = 38</span>
            <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span>         <span class="c1">// 2 n - 3 = 39</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="c1">// 2 n - 2 = 40</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>        <span class="c1">// 2 n - 1 = 41</span>
            <span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>           <span class="c1">// 2 n = 42</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="c1">// -n-1 = -22</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>        <span class="c1">// -n = -21</span>
            <span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span>       <span class="c1">// -n+1 = -20</span>
        <span class="p">];</span>
        <span class="k">let</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">;</span>

        <span class="k">let</span> <span class="n">to_vec</span> <span class="o">=</span> <span class="p">|</span><span class="n">indices</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span><span class="o">&gt;</span><span class="p">|</span> <span class="p">{</span>
            <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">n</span><span class="p">)</span>
                <span class="nf">.scan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">|</span><span class="n">k</span><span class="p">,</span> <span class="n">_</span><span class="p">|</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="o">*</span><span class="n">k</span><span class="p">];</span>
                    <span class="o">*</span><span class="n">k</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="o">*</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span><span class="p">;</span>
                    <span class="nf">Some</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="p">})</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">isize</span><span class="o">&gt;&gt;</span><span class="p">()</span>
        <span class="p">};</span>

        <span class="k">let</span> <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">n</span><span class="p">)</span>
            <span class="nf">.map</span><span class="p">(|</span><span class="n">k</span><span class="p">|</span> <span class="p">((</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">))</span>
            <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span> <span class="nf">to_vec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">indices</span><span class="p">));</span>

        <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">n</span> <span class="p">{</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">n</span><span class="p">)</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="n">k</span><span class="p">|</span> <span class="p">((</span><span class="n">k</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">))</span>
                <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>
            <span class="nf">mix_step</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">indices</span><span class="p">,</span> <span class="n">numbers</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"numbers[{k}] = {} =&gt; {:?}"</span><span class="p">,</span> <span class="n">numbers</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="nf">to_vec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">indices</span><span class="p">));</span>

            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">exp</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
                <span class="nd">assert_eq!</span><span class="p">(</span>
                    <span class="n">exp</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                    <span class="p">(</span><span class="n">numbers</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.0</span><span class="p">],</span> <span class="n">numbers</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="na">.1</span><span class="p">]),</span>
                    <span class="s">"at k = {k}"</span>
                <span class="p">);</span>
            <span class="p">}</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">k_fwd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">k_rev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">fwds</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from</span><span class="p">([</span><span class="mi">0</span><span class="p">]);</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">revs</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from</span><span class="p">([</span><span class="mi">0</span><span class="p">]);</span>
            <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">n</span> <span class="p">{</span>
                <span class="n">k_fwd</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">k_fwd</span><span class="p">]</span><span class="na">.1</span><span class="p">;</span>
                <span class="n">k_rev</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">k_rev</span><span class="p">]</span><span class="na">.1</span><span class="p">;</span>
                <span class="n">fwds</span><span class="nf">.insert</span><span class="p">(</span><span class="n">k_fwd</span><span class="p">);</span>
                <span class="n">revs</span><span class="nf">.insert</span><span class="p">(</span><span class="n">k_rev</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// full cycle in both directions</span>
            <span class="nd">assert_eq!</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="n">k_fwd</span><span class="p">,</span>
                <span class="s">"incomplete forward cycle</span><span class="se">\n</span><span class="s">k: {k}</span><span class="se">\n</span><span class="s"> numbers: {numbers:?}</span><span class="se">\n</span><span class="s"> indices: {indices:?}"</span>
            <span class="p">);</span>
            <span class="nd">assert_eq!</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="n">k_rev</span><span class="p">,</span>
                <span class="s">"incomplete backwards cycle</span><span class="se">\n</span><span class="s">k: {k}</span><span class="se">\n</span><span class="s"> numbers: {numbers:?}</span><span class="se">\n</span><span class="s"> indices: {indices:?}"</span>
            <span class="p">);</span>
            <span class="nd">assert_eq!</span><span class="p">(</span>
                <span class="n">n</span><span class="p">,</span>
                <span class="n">fwds</span><span class="nf">.len</span><span class="p">(),</span>
                <span class="s">"items not in forward cycle</span><span class="se">\n</span><span class="s">k: {k}</span><span class="se">\n</span><span class="s"> numbers: {numbers:?}</span><span class="se">\n</span><span class="s"> indices: {indices:?}"</span>
            <span class="p">);</span>
            <span class="nd">assert_eq!</span><span class="p">(</span>
                <span class="n">n</span><span class="p">,</span>
                <span class="n">revs</span><span class="nf">.len</span><span class="p">(),</span>
                <span class="s">"items not in backwards cycle</span><span class="se">\n</span><span class="s">k: {k}</span><span class="se">\n</span><span class="s"> numbers: {numbers:?}</span><span class="se">\n</span><span class="s"> indices: {indices:?}"</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nf">mix</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="py">.numbers</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">1_623_178_306</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-21">Day 21: <em>TODO</em></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/21">AoC|2022|21</a>.</p>
</div>
<div class="paragraph">
<p>Primary school math today&#8230;&#8203;</p>
</div>
<div class="sect2">
<h3 id="_input_21">Input</h3>
<div class="paragraph">
<p>I parse the input into a map with monkey names as keys and <code>Yell</code> enums as values. A <code>Yell</code> is either a <code>Number</code> or an <code>Operation</code> referencing other monkey by name. The <code>Unknown</code> variant is required for star 2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">collections</span><span class="p">::</span><span class="n">HashMap</span><span class="p">;</span>

    <span class="nd">#[derive(Debug,</span> <span class="nd">Clone)]</span>
    <span class="k">pub</span> <span class="k">enum</span> <span class="n">Yell</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="nf">Operation</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">),</span>
        <span class="nf">Number</span><span class="p">(</span><span class="nb">isize</span><span class="p">),</span>
        <span class="n">Unknown</span><span class="p">,</span> <span class="c1">// required for part 2</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="n">parse_yell</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Yell</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="nf">.split_ascii_whitespace</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">name</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">()</span><span class="nf">.trim_end_matches</span><span class="p">(</span><span class="sc">':'</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">word</span> <span class="o">=</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">yell</span> <span class="o">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">word</span><span class="nf">.as_bytes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="nb">char</span><span class="p">)</span><span class="nf">.is_ascii_digit</span><span class="p">()</span> <span class="p">{</span>
            <span class="nn">Yell</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">word</span><span class="nf">.parse</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">())</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nn">Yell</span><span class="p">::</span><span class="nf">Operation</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">(),</span> <span class="n">words</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">())</span>
        <span class="p">};</span>
        <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">yell</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">monkeys</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Yell</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">monkeys</span><span class="p">:</span> <span class="n">s</span><span class="nf">.lines</span><span class="p">()</span><span class="nf">.map</span><span class="p">(</span><span class="n">parse_yell</span><span class="p">)</span><span class="nf">.collect</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_19">Star 1</h3>
<div class="paragraph">
<p>This is a trivial recursive <code>get_result</code> function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">isize</span> <span class="p">{</span>
    <span class="nf">get_result</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="py">.monkeys</span><span class="p">,</span> <span class="s">"root"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_19">Star 2</h3>
<div class="paragraph">
<p>For the second part, I update the map so that the value for key <code>"humn"</code> is <code>Unknown</code> and the operation for key <code>"root"</code> is <code>-</code>, so that I can solve the root value for <code>0</code>.</p>
</div>
<div class="paragraph">
<p>I put the yells in a recursive tree enum <code>YellRec</code> reducing branches of the tree that do not contain <code>Unknown</code> on the fly with a <code>reduce</code> function.</p>
</div>
<div class="paragraph">
<p>Then I solve for the <code>Unknown</code> inverting operations one by one. This works if the <code>Unknown</code> appears in exactly one of the right hand side or left hand side arguments, which is the case for my input (and I guess for every one else&#8217;s input as well) and for the example data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="code"><pre><span class="nd">#[derive(Debug)]</span>
<span class="k">pub</span> <span class="k">enum</span> <span class="n">YellRec</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">Operation</span><span class="p">(</span><span class="nb">Box</span><span class="o">&lt;</span><span class="p">(</span><span class="n">YellRec</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">,</span> <span class="n">YellRec</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span><span class="p">),</span>
    <span class="nf">Number</span><span class="p">(</span><span class="nb">isize</span><span class="p">),</span>
    <span class="n">Unknown</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="n">reduce</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">monkeys</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">HashMap</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">Yell</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="n">monkey</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">YellRec</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">monkeys</span><span class="nf">.get</span><span class="p">(</span><span class="n">monkey</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">Some</span><span class="p">(</span><span class="nn">Yell</span><span class="p">::</span><span class="nf">Operation</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">rhs</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">lhs</span> <span class="o">=</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">monkeys</span><span class="p">,</span> <span class="n">lhs</span><span class="p">);</span>
            <span class="k">let</span> <span class="n">rhs</span> <span class="o">=</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">monkeys</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);</span>
            <span class="k">match</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">(</span><span class="nn">YellRec</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">lhs</span><span class="p">),</span> <span class="nn">YellRec</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">rhs</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="o">*</span><span class="n">op</span> <span class="p">{</span>
                    <span class="s">"+"</span> <span class="k">=&gt;</span> <span class="nn">YellRec</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">lhs</span> <span class="o">+</span> <span class="n">rhs</span><span class="p">),</span>
                    <span class="s">"-"</span> <span class="k">=&gt;</span> <span class="nn">YellRec</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">lhs</span> <span class="o">-</span> <span class="n">rhs</span><span class="p">),</span>
                    <span class="s">"*"</span> <span class="k">=&gt;</span> <span class="nn">YellRec</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">lhs</span> <span class="o">*</span> <span class="n">rhs</span><span class="p">),</span>
                    <span class="s">"/"</span> <span class="k">=&gt;</span> <span class="nn">YellRec</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">lhs</span> <span class="o">/</span> <span class="n">rhs</span><span class="p">),</span>
                    <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"Unknown operation: {op}"</span><span class="p">),</span>
                <span class="p">},</span>
                <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">YellRec</span><span class="p">::</span><span class="nf">Operation</span><span class="p">((</span><span class="n">lhs</span><span class="p">,</span> <span class="o">*</span><span class="n">op</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span><span class="nf">.into</span><span class="p">()),</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nf">Some</span><span class="p">(</span><span class="nn">Yell</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="nn">YellRec</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="o">*</span><span class="n">v</span><span class="p">),</span>
        <span class="nf">Some</span><span class="p">(</span><span class="nn">Yell</span><span class="p">::</span><span class="n">Unknown</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nn">YellRec</span><span class="p">::</span><span class="n">Unknown</span><span class="p">,</span>
        <span class="n">yell</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"Can't get result for monkey {monkey} =&gt; {yell:?}"</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">solve</span><span class="p">(</span><span class="n">yell</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">YellRec</span><span class="p">,</span> <span class="n">tar</span><span class="p">:</span> <span class="nb">isize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">isize</span> <span class="p">{</span>
    <span class="k">match</span> <span class="n">yell</span> <span class="p">{</span>
        <span class="nn">YellRec</span><span class="p">::</span><span class="nf">Operation</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="n">b</span><span class="nf">.as_ref</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="nn">YellRec</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">rhs</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="o">*</span><span class="n">op</span> <span class="p">{</span>
                <span class="s">"+"</span> <span class="k">=&gt;</span> <span class="nf">solve</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">tar</span> <span class="o">-</span> <span class="o">*</span><span class="n">rhs</span><span class="p">),</span> <span class="c1">// lhs + rhs = tar</span>
                <span class="s">"-"</span> <span class="k">=&gt;</span> <span class="nf">solve</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">tar</span> <span class="o">+</span> <span class="o">*</span><span class="n">rhs</span><span class="p">),</span> <span class="c1">// lhs - rhs = tar</span>
                <span class="s">"*"</span> <span class="k">=&gt;</span> <span class="nf">solve</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">tar</span> <span class="o">/</span> <span class="o">*</span><span class="n">rhs</span><span class="p">),</span> <span class="c1">// lhs * rhs = tar</span>
                <span class="s">"/"</span> <span class="k">=&gt;</span> <span class="nf">solve</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">tar</span> <span class="o">*</span> <span class="o">*</span><span class="n">rhs</span><span class="p">),</span> <span class="c1">// lhs / rhs = tar</span>
                <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"Unknown operation: {op}"</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="p">(</span><span class="nn">YellRec</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">lhs</span><span class="p">),</span> <span class="n">op</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="o">*</span><span class="n">op</span> <span class="p">{</span>
                <span class="s">"+"</span> <span class="k">=&gt;</span> <span class="nf">solve</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="n">tar</span> <span class="o">-</span> <span class="o">*</span><span class="n">lhs</span><span class="p">),</span> <span class="c1">// lhs + rhs = tar</span>
                <span class="s">"-"</span> <span class="k">=&gt;</span> <span class="nf">solve</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="o">*</span><span class="n">lhs</span> <span class="o">-</span> <span class="n">tar</span><span class="p">),</span> <span class="c1">// lhs - rhs = tar</span>
                <span class="s">"*"</span> <span class="k">=&gt;</span> <span class="nf">solve</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="n">tar</span> <span class="o">/</span> <span class="o">*</span><span class="n">lhs</span><span class="p">),</span> <span class="c1">// lhs * rhs = tar</span>
                <span class="s">"/"</span> <span class="k">=&gt;</span> <span class="nf">solve</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="o">*</span><span class="n">lhs</span> <span class="o">/</span> <span class="n">tar</span><span class="p">),</span> <span class="c1">// lhs / rhs = tar</span>
                <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"Unknown operation: {op}"</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"solve expects either rhs or lhs to be a number"</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="nn">YellRec</span><span class="p">::</span><span class="n">Unknown</span> <span class="k">=&gt;</span> <span class="n">tar</span><span class="p">,</span>
        <span class="nn">YellRec</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"Can't solve a number"</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">isize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">monkeys</span> <span class="o">=</span> <span class="n">data</span><span class="py">.monkeys</span><span class="nf">.clone</span><span class="p">();</span>

    <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="nn">Yell</span><span class="p">::</span><span class="nf">Operation</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">rhs</span><span class="p">))</span> <span class="o">=</span> <span class="n">monkeys</span><span class="nf">.get</span><span class="p">(</span><span class="s">"root"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span><span class="nd">panic!</span><span class="p">()};</span>
    <span class="n">monkeys</span><span class="nf">.insert</span><span class="p">(</span><span class="s">"root"</span><span class="p">,</span> <span class="nn">Yell</span><span class="p">::</span><span class="nf">Operation</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="s">"-"</span><span class="p">,</span> <span class="n">rhs</span><span class="p">));</span>
    <span class="n">monkeys</span><span class="nf">.insert</span><span class="p">(</span><span class="s">"humn"</span><span class="p">,</span> <span class="nn">Yell</span><span class="p">::</span><span class="n">Unknown</span><span class="p">);</span>

    <span class="nf">solve</span><span class="p">(</span><span class="o">&amp;</span><span class="nf">reduce</span><span class="p">(</span><span class="o">&amp;</span><span class="n">monkeys</span><span class="p">,</span> <span class="s">"root"</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_22">Tests</h3>
<div class="paragraph">
<p>I only created tests today, because my template contains them. I actually did not use them before submitting the result&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"root: pppw + sjmn
dbpl: 5
cczh: sllz + lgvd
zczc: 2
ptdq: humn - dvpt
dvpt: 3
lfqf: 4
humn: 5
ljgn: 2
sjmn: drzm * dbpl
sllz: 4
pppw: cczh / lfqf
lgvd: ljgn * ptdq
drzm: hmdt - zczc
hmdt: 32
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">152</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">301</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_solution_range</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="nd">include_str!</span><span class="p">(</span><span class="s">"../input.txt"</span><span class="p">));</span>

        <span class="k">let</span> <span class="n">sol_a</span> <span class="o">=</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">sol_b</span> <span class="o">=</span> <span class="nf">star_2_bisection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">sol_rg</span> <span class="o">=</span> <span class="n">sol_a</span><span class="nf">.min</span><span class="p">(</span><span class="n">sol_b</span><span class="p">)</span><span class="o">..=</span><span class="n">sol_a</span><span class="nf">.max</span><span class="p">(</span><span class="n">sol_b</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"Solution range: {sol_rg:?}"</span><span class="p">);</span>


        <span class="k">let</span> <span class="k">mut</span> <span class="n">monkeys</span> <span class="o">=</span> <span class="n">data</span><span class="py">.monkeys</span><span class="nf">.clone</span><span class="p">();</span>
        <span class="k">let</span> <span class="nf">Some</span><span class="p">(</span><span class="nn">Yell</span><span class="p">::</span><span class="nf">Operation</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">rhs</span><span class="p">))</span> <span class="o">=</span> <span class="n">monkeys</span><span class="nf">.get</span><span class="p">(</span><span class="s">"root"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span><span class="nd">panic!</span><span class="p">()};</span>
        <span class="n">monkeys</span><span class="nf">.insert</span><span class="p">(</span><span class="s">"root"</span><span class="p">,</span> <span class="nn">Yell</span><span class="p">::</span><span class="nf">Operation</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="s">"-"</span><span class="p">,</span> <span class="n">rhs</span><span class="p">));</span>

        <span class="k">for</span> <span class="n">sol</span> <span class="k">in</span> <span class="n">sol_rg</span> <span class="p">{</span>
            <span class="n">monkeys</span><span class="nf">.insert</span><span class="p">(</span><span class="s">"humn"</span><span class="p">,</span> <span class="nn">Yell</span><span class="p">::</span><span class="nf">Number</span><span class="p">(</span><span class="n">sol</span><span class="p">));</span>
            <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">get_result</span><span class="p">(</span><span class="o">&amp;</span><span class="n">monkeys</span><span class="p">,</span> <span class="s">"root"</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-22">Day 22: Monkey Map</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/22">AoC|2022|22</a>.</p>
</div>
<div class="paragraph">
<p>Geometry! Cube layouts &#8230;&#8203; what looked simple turned out to be very tedious</p>
</div>
<div class="sect2">
<h3 id="_input_22">Input</h3>
<div class="paragraph">
<p>Nothing special here today. I decided to make the lines of the grid equal length (padded with spaced) for easier processing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug,</span> <span class="nd">PartialEq,</span> <span class="nd">Eq)]</span>
    <span class="k">pub</span> <span class="k">enum</span> <span class="n">Step</span> <span class="p">{</span>
        <span class="nf">Fwd</span><span class="p">(</span><span class="nb">usize</span><span class="p">),</span>
        <span class="n">Left</span><span class="p">,</span>
        <span class="n">Right</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">grid</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">u8</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">width</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">steps</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Step</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">let</span> <span class="p">(</span><span class="n">grid_part</span><span class="p">,</span> <span class="n">steps_part</span><span class="p">)</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.split_once</span><span class="p">(</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

            <span class="c1">// store the grid with rows of equal width</span>
            <span class="k">let</span> <span class="n">lines</span> <span class="o">=</span> <span class="n">grid_part</span><span class="nf">.lines</span><span class="p">()</span><span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">width</span> <span class="o">=</span> <span class="n">lines</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.map</span><span class="p">(|</span><span class="n">line</span><span class="p">|</span> <span class="n">line</span><span class="nf">.len</span><span class="p">())</span><span class="nf">.max</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">grid</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span><span class="sc">b' '</span><span class="p">;</span> <span class="n">width</span> <span class="o">*</span> <span class="n">lines</span><span class="nf">.len</span><span class="p">()];</span>
            <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">lines</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="nf">.as_bytes</span><span class="p">()</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.enumerate</span><span class="p">()</span> <span class="p">{</span>
                    <span class="n">grid</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">steps</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
            <span class="k">let</span> <span class="k">mut</span> <span class="n">fwd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">b</span> <span class="k">in</span> <span class="n">steps_part</span><span class="nf">.trim</span><span class="p">()</span><span class="nf">.as_bytes</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="sc">b'0'</span><span class="o">..=</span><span class="sc">b'9'</span><span class="p">)</span><span class="nf">.contains</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">fwd</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">fwd</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="sc">b'0'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="n">fwd</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
                        <span class="n">steps</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Step</span><span class="p">::</span><span class="nf">Fwd</span><span class="p">(</span><span class="n">fwd</span><span class="p">));</span>
                        <span class="n">fwd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="o">*</span><span class="n">b</span> <span class="o">==</span> <span class="sc">b'L'</span> <span class="p">{</span>
                        <span class="n">steps</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Step</span><span class="p">::</span><span class="n">Left</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">*</span><span class="n">b</span> <span class="o">==</span> <span class="sc">b'R'</span> <span class="p">{</span>
                        <span class="n">steps</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Step</span><span class="p">::</span><span class="n">Right</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nd">panic!</span><span class="p">(</span><span class="s">"Unexpected {} in {steps_part}"</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span> <span class="k">as</span> <span class="nb">char</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">fwd</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="n">steps</span><span class="nf">.push</span><span class="p">(</span><span class="nn">Step</span><span class="p">::</span><span class="nf">Fwd</span><span class="p">(</span><span class="n">fwd</span><span class="p">));</span>
            <span class="p">}</span>

            <span class="k">Self</span> <span class="p">{</span> <span class="n">grid</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">steps</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_20">Star 1</h3>
<div class="paragraph">
<p>I used an iterator to move forward. Looks much nicer that for loops ;)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">col</span> <span class="o">=</span> <span class="n">data</span><span class="py">.grid</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'.'</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">d</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">height</span> <span class="o">=</span> <span class="n">data</span><span class="py">.grid</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">data</span><span class="py">.width</span><span class="p">;</span>

    <span class="k">for</span> <span class="n">step</span> <span class="k">in</span> <span class="o">&amp;</span><span class="n">data</span><span class="py">.steps</span> <span class="p">{</span>
        <span class="k">match</span> <span class="n">step</span> <span class="p">{</span>
            <span class="nn">Step</span><span class="p">::</span><span class="nf">Fwd</span><span class="p">(</span><span class="n">fwd</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="k">let</span> <span class="p">(</span><span class="n">d_col</span><span class="p">,</span> <span class="n">d_row</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="k">match</span> <span class="n">d</span> <span class="p">{</span>
                    <span class="mi">0</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="py">.width</span><span class="p">),</span>
                    <span class="mi">1</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span>
                    <span class="mi">2</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="n">data</span><span class="py">.width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="py">.width</span><span class="p">),</span>
                    <span class="mi">3</span> <span class="k">=&gt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span>
                    <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(),</span>
                <span class="p">};</span>
                <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">n</span><span class="p">)</span>
                    <span class="nf">.cycle</span><span class="p">()</span>
                    <span class="nf">.map</span><span class="p">(|</span><span class="n">s</span><span class="p">|</span> <span class="p">((</span><span class="n">col</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="n">d_col</span><span class="p">)</span> <span class="o">%</span> <span class="n">data</span><span class="py">.width</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="n">d_row</span><span class="p">)</span> <span class="o">%</span> <span class="n">height</span><span class="p">))</span>
                    <span class="nf">.filter</span><span class="p">(|(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)|</span> <span class="n">data</span><span class="py">.grid</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="n">data</span><span class="py">.width</span> <span class="o">*</span> <span class="n">row</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">b' '</span><span class="p">)</span>
                    <span class="nf">.take</span><span class="p">(</span><span class="n">fwd</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="nf">.take_while</span><span class="p">(|(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)|</span> <span class="n">data</span><span class="py">.grid</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="n">data</span><span class="py">.width</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">b'#'</span><span class="p">)</span>
                    <span class="nf">.last</span><span class="p">()</span>
                    <span class="nf">.unwrap</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="nn">Step</span><span class="p">::</span><span class="n">Left</span> <span class="k">=&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">,</span>
            <span class="nn">Step</span><span class="p">::</span><span class="n">Right</span> <span class="k">=&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">d</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_20">Star 2</h3>
<div class="paragraph">
<p>I did not see the cubes come when working on part 1.</p>
</div>
<div class="paragraph">
<p>This turned out to be much more complicated than what I first thought.</p>
</div>
<div class="paragraph">
<p>There is quite a bit of repetition in my code which multiplies the opportunities for mistakes. I used a lot of the opportunities and made a lot of them. And I had no efficient way for debugging. Which branch of the code is actually used, depends a lot on the cube layout. Since this is different for the example and the real data, the example was not good enough to fix all the issues.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">const</span> <span class="n">EAST</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// [1 0 0]</span>
<span class="k">pub</span> <span class="k">const</span> <span class="n">NORTH</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// [0 1 0]</span>
<span class="k">pub</span> <span class="k">const</span> <span class="n">UP</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// [0 0 1]</span>
<span class="k">pub</span> <span class="k">const</span> <span class="n">WEST</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// [-1 0 0]</span>
<span class="k">pub</span> <span class="k">const</span> <span class="n">SOUTH</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// [0 -1 0]</span>
<span class="k">pub</span> <span class="k">const</span> <span class="n">DOWN</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// [0 0 -1]</span>

<span class="k">pub</span> <span class="k">const</span> <span class="n">HEAD_RIGHT</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">pub</span> <span class="k">const</span> <span class="n">HEAD_DOWN</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">pub</span> <span class="k">const</span> <span class="n">HEAD_LEFT</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">pub</span> <span class="k">const</span> <span class="n">HEAD_UP</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">,</span> <span class="n">face_width</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">layout_w</span> <span class="o">=</span> <span class="n">data</span><span class="py">.width</span> <span class="o">/</span> <span class="n">face_width</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">layout_h</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="py">.grid</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">data</span><span class="py">.width</span><span class="p">)</span> <span class="o">/</span> <span class="n">face_width</span><span class="p">;</span>
    <span class="nd">assert_eq!</span><span class="p">(</span>
        <span class="n">layout_w</span> <span class="o">*</span> <span class="n">face_width</span> <span class="o">*</span> <span class="n">layout_h</span> <span class="o">*</span> <span class="n">face_width</span><span class="p">,</span>
        <span class="n">data</span><span class="py">.grid</span><span class="nf">.len</span><span class="p">(),</span>
        <span class="s">"Grid len does not match layout"</span>
    <span class="p">);</span>

    <span class="c1">// get the cube layout (each face is represented by a '#')</span>
    <span class="k">let</span> <span class="n">cube_layout</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">data</span><span class="py">.grid</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">face_width</span> <span class="o">*</span> <span class="n">face_width</span><span class="p">))</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">p</span><span class="p">|</span> <span class="p">(</span><span class="n">p</span> <span class="o">%</span> <span class="n">layout_w</span><span class="p">,</span> <span class="n">p</span> <span class="o">/</span> <span class="n">layout_w</span><span class="p">))</span>
        <span class="nf">.map</span><span class="p">(|(</span><span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">)|</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">data</span><span class="py">.grid</span><span class="p">[</span><span class="n">c</span> <span class="o">*</span> <span class="n">face_width</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">face_width</span> <span class="o">*</span> <span class="n">data</span><span class="py">.width</span><span class="p">]</span> <span class="o">==</span> <span class="sc">b' '</span> <span class="p">{</span>
                <span class="sc">' '</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="sc">'#'</span>
            <span class="p">}</span>
        <span class="p">})</span>
        <span class="py">.collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span>

    <span class="c1">// compile a map of cube faces with the normal direction as key and</span>
    <span class="c1">// ((col, row), (n_dir, x_dir, y_dir)) as value where (col, row) is the</span>
    <span class="c1">// position in the grid and (n_dir, x_dir, y_dir) is normal direction</span>
    <span class="c1">// and direction of x- and y- respectively</span>
    <span class="k">let</span> <span class="n">pos</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="n">cube_layout</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">face</span><span class="p">|</span> <span class="n">face</span> <span class="o">==</span> <span class="sc">'#'</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="p">((</span><span class="n">pos</span> <span class="o">%</span> <span class="n">layout_w</span><span class="p">,</span> <span class="n">pos</span> <span class="o">/</span> <span class="n">layout_w</span><span class="p">),</span> <span class="p">(</span><span class="n">UP</span><span class="p">,</span> <span class="n">EAST</span><span class="p">,</span> <span class="n">SOUTH</span><span class="p">));</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">faces</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">from</span><span class="p">([(</span><span class="n">UP</span><span class="p">,</span> <span class="n">start</span><span class="p">)]);</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">queue</span> <span class="o">=</span> <span class="nn">VecDeque</span><span class="p">::</span><span class="nf">from</span><span class="p">([</span><span class="n">start</span><span class="p">]);</span>
    <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">(((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="p">(</span><span class="n">n_dir</span><span class="p">,</span> <span class="n">x_dir</span><span class="p">,</span> <span class="n">y_dir</span><span class="p">)))</span> <span class="o">=</span> <span class="n">queue</span><span class="nf">.pop_front</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">cube_layout</span><span class="p">[</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="n">layout_w</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'#'</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">next</span> <span class="o">=</span> <span class="p">((</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="p">((</span><span class="n">x_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span><span class="p">,</span> <span class="n">n_dir</span><span class="p">,</span> <span class="n">y_dir</span><span class="p">));</span>
            <span class="k">if</span> <span class="o">!</span><span class="n">faces</span><span class="nf">.contains_key</span><span class="p">(</span><span class="o">&amp;</span><span class="n">next</span><span class="na">.1</span> <span class="na">.0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">faces</span><span class="nf">.insert</span><span class="p">(</span><span class="n">next</span><span class="na">.1</span> <span class="na">.0</span><span class="p">,</span> <span class="n">next</span><span class="p">);</span>
                <span class="n">queue</span><span class="nf">.push_back</span><span class="p">(</span><span class="n">next</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="n">layout_w</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">cube_layout</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="n">layout_w</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'#'</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">next</span> <span class="o">=</span> <span class="p">((</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="p">(</span><span class="n">x_dir</span><span class="p">,</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span><span class="p">,</span> <span class="n">y_dir</span><span class="p">));</span>
            <span class="k">if</span> <span class="o">!</span><span class="n">faces</span><span class="nf">.contains_key</span><span class="p">(</span><span class="o">&amp;</span><span class="n">next</span><span class="na">.1</span> <span class="na">.0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">faces</span><span class="nf">.insert</span><span class="p">(</span><span class="n">next</span><span class="na">.1</span> <span class="na">.0</span><span class="p">,</span> <span class="n">next</span><span class="p">);</span>
                <span class="n">queue</span><span class="nf">.push_back</span><span class="p">(</span><span class="n">next</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">cube_layout</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">layout_w</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'#'</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">next</span> <span class="o">=</span> <span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">((</span><span class="n">y_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span><span class="p">,</span> <span class="n">x_dir</span><span class="p">,</span> <span class="n">n_dir</span><span class="p">));</span>
            <span class="k">if</span> <span class="o">!</span><span class="n">faces</span><span class="nf">.contains_key</span><span class="p">(</span><span class="o">&amp;</span><span class="n">next</span><span class="na">.1</span> <span class="na">.0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">faces</span><span class="nf">.insert</span><span class="p">(</span><span class="n">next</span><span class="na">.1</span> <span class="na">.0</span><span class="p">,</span> <span class="n">next</span><span class="p">);</span>
                <span class="n">queue</span><span class="nf">.push_back</span><span class="p">(</span><span class="n">next</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">layout_h</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">cube_layout</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">layout_w</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'#'</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">next</span> <span class="o">=</span> <span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">y_dir</span><span class="p">,</span> <span class="n">x_dir</span><span class="p">,</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span><span class="p">));</span>
            <span class="k">if</span> <span class="o">!</span><span class="n">faces</span><span class="nf">.contains_key</span><span class="p">(</span><span class="o">&amp;</span><span class="n">next</span><span class="na">.1</span> <span class="na">.0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">faces</span><span class="nf">.insert</span><span class="p">(</span><span class="n">next</span><span class="na">.1</span> <span class="na">.0</span><span class="p">,</span> <span class="n">next</span><span class="p">);</span>
                <span class="n">queue</span><span class="nf">.push_back</span><span class="p">(</span><span class="n">next</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// current position is given by (x, y) within face and (col, row) of face</span>
    <span class="c1">// in addition normal direction and x-/y-direction of current face and</span>
    <span class="c1">// the current orientation `d`</span>
    <span class="k">let</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">data</span><span class="py">.grid</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'.'</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">%</span> <span class="n">face_width</span><span class="p">;</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">col</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">/</span> <span class="n">face_width</span><span class="p">;</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="k">mut</span> <span class="n">n_dir</span><span class="p">,</span> <span class="k">mut</span> <span class="n">x_dir</span><span class="p">,</span> <span class="k">mut</span> <span class="n">y_dir</span><span class="p">))</span> <span class="o">=</span> <span class="n">faces</span><span class="nf">.get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">UP</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">d</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nd">#[cfg(feature</span> <span class="nd">=</span> <span class="s">"print-path"</span><span class="nd">)]</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">path</span><span class="p">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nn">HashMap</span><span class="p">::</span><span class="nf">from</span><span class="p">([(</span><span class="n">pos</span><span class="p">,</span> <span class="n">d</span><span class="p">)]);</span>

    <span class="k">for</span> <span class="n">step</span> <span class="k">in</span> <span class="o">&amp;</span><span class="n">data</span><span class="py">.steps</span> <span class="p">{</span>
        <span class="k">match</span> <span class="n">step</span> <span class="p">{</span>
            <span class="nn">Step</span><span class="p">::</span><span class="nf">Fwd</span><span class="p">(</span><span class="n">fwd</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..*</span><span class="n">fwd</span> <span class="p">{</span>
                    <span class="c1">// determine x and y updates (wrapping)</span>
                    <span class="c1">// and normal direction of next face (if wrapping)</span>
                    <span class="k">let</span> <span class="p">(</span><span class="n">x_upd</span><span class="p">,</span> <span class="n">y_upd</span><span class="p">,</span> <span class="n">n_dir_upd</span><span class="p">)</span> <span class="o">=</span> <span class="k">match</span> <span class="n">d</span> <span class="p">{</span>
                        <span class="n">HEAD_RIGHT</span> <span class="k">=&gt;</span> <span class="p">(</span>
                            <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">face_width</span><span class="p">,</span>
                            <span class="n">y</span><span class="p">,</span>
                            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">n_dir</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">x_dir</span> <span class="p">},</span>
                        <span class="p">),</span>
                        <span class="n">HEAD_DOWN</span> <span class="k">=&gt;</span> <span class="p">(</span>
                            <span class="n">x</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">face_width</span><span class="p">,</span>
                            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">n_dir</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">y_dir</span> <span class="p">},</span>
                        <span class="p">),</span>
                        <span class="n">HEAD_LEFT</span> <span class="k">=&gt;</span> <span class="p">(</span>
                            <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">face_width</span><span class="p">,</span>
                            <span class="n">y</span><span class="p">,</span>
                            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span> <span class="n">n_dir</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="p">(</span><span class="n">x_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">},</span>
                        <span class="p">),</span>
                        <span class="n">HEAD_UP</span> <span class="k">=&gt;</span> <span class="p">(</span>
                            <span class="n">x</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">face_width</span><span class="p">,</span>
                            <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span> <span class="n">n_dir</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="p">(</span><span class="n">y_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">},</span>
                        <span class="p">),</span>
                        <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(),</span>
                    <span class="p">};</span>

                    <span class="k">let</span> <span class="p">(</span><span class="n">x_upd</span><span class="p">,</span> <span class="n">y_upd</span><span class="p">,</span> <span class="n">d_upd</span><span class="p">,</span> <span class="n">col_upd</span><span class="p">,</span> <span class="n">row_upd</span><span class="p">,</span> <span class="n">x_dir_upd</span><span class="p">,</span> <span class="n">y_dir_upd</span><span class="p">)</span> <span class="o">=</span> <span class="k">if</span> <span class="n">n_dir_upd</span>
                        <span class="o">!=</span> <span class="n">n_dir</span>
                    <span class="p">{</span>
                        <span class="c1">// calculate update on a new face</span>
                        <span class="c1">// get face</span>
                        <span class="k">let</span> <span class="p">((</span><span class="n">col_upd</span><span class="p">,</span> <span class="n">row_upd</span><span class="p">),</span> <span class="p">(</span><span class="n">n_dir_upd</span><span class="p">,</span> <span class="n">x_dir_upd</span><span class="p">,</span> <span class="n">y_dir_upd</span><span class="p">))</span> <span class="o">=</span>
                            <span class="o">*</span><span class="n">faces</span><span class="nf">.get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">n_dir_upd</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>

                        <span class="c1">// do the transformation</span>
                        <span class="k">let</span> <span class="p">(</span><span class="n">x_upd</span><span class="p">,</span> <span class="n">y_upd</span><span class="p">,</span> <span class="n">d_upd</span><span class="p">)</span> <span class="o">=</span> <span class="k">if</span> <span class="n">n_dir_upd</span> <span class="o">==</span> <span class="n">x_dir</span> <span class="p">{</span>
                            <span class="c1">// move right</span>
                            <span class="k">if</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="n">y_dir</span> <span class="o">&amp;&amp;</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">{</span>
                                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">HEAD_RIGHT</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">y_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="n">n_dir</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="n">HEAD_LEFT</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="n">y_dir</span> <span class="o">&amp;&amp;</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="n">n_dir</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">HEAD_UP</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">y_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HEAD_DOWN</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nd">unreachable!</span><span class="p">(</span>
                                    <span class="s">"right: {}, _{}_, {} --&gt; _{}_, {}, {}"</span><span class="p">,</span>
                                    <span class="n">n_dir</span><span class="p">,</span> <span class="n">x_dir</span><span class="p">,</span> <span class="n">y_dir</span><span class="p">,</span> <span class="n">n_dir_upd</span><span class="p">,</span> <span class="n">x_dir_upd</span><span class="p">,</span> <span class="n">y_dir_upd</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">n_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">x_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">{</span>
                            <span class="c1">// move left</span>
                            <span class="k">if</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="n">y_dir</span> <span class="o">&amp;&amp;</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="n">n_dir</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">HEAD_LEFT</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">y_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">{</span>
                                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="n">HEAD_RIGHT</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="n">y_dir</span> <span class="o">&amp;&amp;</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HEAD_DOWN</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">y_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="n">n_dir</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">HEAD_UP</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nd">unreachable!</span><span class="p">(</span>
                                    <span class="s">"left: {}, _{}_, {} --&gt; _{}_, {}, {}"</span><span class="p">,</span>
                                    <span class="n">n_dir</span><span class="p">,</span> <span class="n">x_dir</span><span class="p">,</span> <span class="n">y_dir</span><span class="p">,</span> <span class="n">n_dir_upd</span><span class="p">,</span> <span class="n">x_dir_upd</span><span class="p">,</span> <span class="n">y_dir_upd</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">n_dir_upd</span> <span class="o">==</span> <span class="n">y_dir</span> <span class="p">{</span>
                            <span class="c1">// move down</span>
                            <span class="k">if</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="n">x_dir</span> <span class="o">&amp;&amp;</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HEAD_DOWN</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">x_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="n">n_dir</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">HEAD_UP</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="n">x_dir</span> <span class="o">&amp;&amp;</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="n">n_dir</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">HEAD_LEFT</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">x_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">{</span>
                                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">HEAD_RIGHT</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nd">unreachable!</span><span class="p">(</span>
                                    <span class="s">"down: {}, {}, _{}_ --&gt; _{}_, {}, {}"</span><span class="p">,</span>
                                    <span class="n">n_dir</span><span class="p">,</span> <span class="n">x_dir</span><span class="p">,</span> <span class="n">y_dir</span><span class="p">,</span> <span class="n">n_dir_upd</span><span class="p">,</span> <span class="n">x_dir_upd</span><span class="p">,</span> <span class="n">y_dir_upd</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">n_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">y_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">{</span>
                            <span class="c1">// move up</span>
                            <span class="k">if</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="n">x_dir</span> <span class="o">&amp;&amp;</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="n">n_dir</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">HEAD_UP</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">x_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HEAD_DOWN</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="n">x_dir</span> <span class="o">&amp;&amp;</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="p">{</span>
                                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">HEAD_RIGHT</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">y_dir_upd</span> <span class="o">==</span> <span class="p">(</span><span class="n">x_dir</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="n">x_dir_upd</span> <span class="o">==</span> <span class="n">n_dir</span> <span class="p">{</span>
                                <span class="p">(</span><span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">face_width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">HEAD_LEFT</span><span class="p">)</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nd">unreachable!</span><span class="p">(</span>
                                    <span class="s">"up: {}, {}, _{}_ --&gt; _{}_, {}, {}"</span><span class="p">,</span>
                                    <span class="n">n_dir</span><span class="p">,</span> <span class="n">x_dir</span><span class="p">,</span> <span class="n">y_dir</span><span class="p">,</span> <span class="n">n_dir_upd</span><span class="p">,</span> <span class="n">x_dir_upd</span><span class="p">,</span> <span class="n">y_dir_upd</span>
                                <span class="p">)</span>
                            <span class="p">}</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nd">unreachable!</span><span class="p">()</span>
                        <span class="p">};</span>

                        <span class="p">(</span><span class="n">x_upd</span><span class="p">,</span> <span class="n">y_upd</span><span class="p">,</span> <span class="n">d_upd</span><span class="p">,</span> <span class="n">col_upd</span><span class="p">,</span> <span class="n">row_upd</span><span class="p">,</span> <span class="n">x_dir_upd</span><span class="p">,</span> <span class="n">y_dir_upd</span><span class="p">)</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// update within a face</span>
                        <span class="p">(</span><span class="n">x_upd</span><span class="p">,</span> <span class="n">y_upd</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">x_dir</span><span class="p">,</span> <span class="n">y_dir</span><span class="p">)</span>
                    <span class="p">};</span>

                    <span class="k">if</span> <span class="n">data</span><span class="py">.grid</span>
                        <span class="p">[</span><span class="n">x_upd</span> <span class="o">+</span> <span class="n">col_upd</span> <span class="o">*</span> <span class="n">face_width</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_upd</span> <span class="o">+</span> <span class="n">row_upd</span> <span class="o">*</span> <span class="n">face_width</span><span class="p">)</span> <span class="o">*</span> <span class="n">data</span><span class="py">.width</span><span class="p">]</span>
                        <span class="o">==</span> <span class="sc">b'#'</span>
                    <span class="p">{</span>
                        <span class="c1">// wall, can't move any further</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="c1">// update</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x_upd</span><span class="p">;</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">y_upd</span><span class="p">;</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d_upd</span><span class="p">;</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">col_upd</span><span class="p">;</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="n">row_upd</span><span class="p">;</span>
                    <span class="n">n_dir</span> <span class="o">=</span> <span class="n">n_dir_upd</span><span class="p">;</span>
                    <span class="n">x_dir</span> <span class="o">=</span> <span class="n">x_dir_upd</span><span class="p">;</span>
                    <span class="n">y_dir</span> <span class="o">=</span> <span class="n">y_dir_upd</span><span class="p">;</span>

                    <span class="nd">#[cfg(feature</span> <span class="nd">=</span> <span class="s">"print-path"</span><span class="nd">)]</span>
                    <span class="n">path</span><span class="nf">.insert</span><span class="p">(</span>
                        <span class="n">x</span> <span class="o">+</span> <span class="n">col</span> <span class="o">*</span> <span class="n">face_width</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="n">face_width</span><span class="p">)</span> <span class="o">*</span> <span class="n">data</span><span class="py">.width</span><span class="p">,</span>
                        <span class="n">d</span><span class="p">,</span>
                    <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nn">Step</span><span class="p">::</span><span class="n">Left</span> <span class="k">=&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">,</span>
            <span class="nn">Step</span><span class="p">::</span><span class="n">Right</span> <span class="k">=&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="nd">#[cfg(feature</span> <span class="nd">=</span> <span class="s">"print-path"</span><span class="nd">)]</span>
        <span class="n">path</span><span class="nf">.insert</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">+</span> <span class="n">col</span> <span class="o">*</span> <span class="n">face_width</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="n">face_width</span><span class="p">)</span> <span class="o">*</span> <span class="n">data</span><span class="py">.width</span><span class="p">,</span>
            <span class="n">d</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[cfg(feature</span> <span class="nd">=</span> <span class="s">"print-path"</span><span class="nd">)]</span>
    <span class="k">for</span> <span class="n">y</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">data</span><span class="py">.grid</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">data</span><span class="py">.width</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">data</span><span class="py">.width</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">p</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">data</span><span class="py">.width</span><span class="p">;</span>
            <span class="k">match</span> <span class="p">(</span><span class="n">path</span><span class="nf">.get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">),</span> <span class="n">data</span><span class="py">.grid</span><span class="p">[</span><span class="n">p</span><span class="p">])</span> <span class="p">{</span>
                <span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="sc">b'.'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="sc">b'.'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"v"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="sc">b'.'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="sc">b'.'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"^"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="p">(</span><span class="nb">None</span><span class="p">,</span> <span class="sc">b'#'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"#"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="p">(</span><span class="nb">None</span><span class="p">,</span> <span class="sc">b'.'</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="p">(</span><span class="nb">None</span><span class="p">,</span> <span class="sc">b' '</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nd">panic!</span><span class="p">(</span><span class="s">"Unexpected {a:?}, {}"</span><span class="p">,</span> <span class="n">b</span> <span class="k">as</span> <span class="nb">char</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nd">println!</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="n">face_width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">col</span> <span class="o">*</span> <span class="n">face_width</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">d</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_23">Tests</h3>
<div class="paragraph">
<p>Tests were very necessary today to come up with a solution. I created several additional simple test cases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"        ...#
        .#..
        #...
        ....
...#.......#
........#...
..#....#....
..........#.
        ...#....
        .....#..
        .#......
        ......#.

10R5L5R10L4R5L5
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">6_032</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">5_031</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>

        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="nd">include_str!</span><span class="p">(</span><span class="s">"../tests_1.txt"</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">1_033</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>

        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="nd">include_str!</span><span class="p">(</span><span class="s">"../tests_2.txt"</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">1_033</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>

        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="nd">include_str!</span><span class="p">(</span><span class="s">"../tests_3.txt"</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">12_013</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>

        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="nd">include_str!</span><span class="p">(</span><span class="s">"../tests_4.txt"</span><span class="p">));</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">3_028</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-23">Day 23: Unstable Diffusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/23">AoC|2022|23</a>.</p>
</div>
<div class="paragraph">
<p>Elves extend in a space, open in all directions.</p>
</div>
<div class="paragraph">
<p>So the usual question: shall I use hash sets / hash maps or a more efficient grid based solution?</p>
</div>
<div class="paragraph">
<p>I decided to go with sets and maps first and I was not happy with that choice. It solved part 1 in about 20ms and part 2 in a bit more than 1s.</p>
</div>
<div class="paragraph">
<p>In a second attempt, I implemented a grid based solution which solves part 1 in less than 2ms and part 2 in about 80ms. There is certainly potential to do even better&#8230;&#8203;</p>
</div>
<div class="sect2">
<h3 id="_input_23">Input</h3>
<div class="paragraph">
<p>The input is directly parsed into a grid.</p>
</div>
<div class="paragraph">
<p>The most important part of the implementation is the <code>increase_to_gap</code> function which is used to grow the grid to make space for the elves moving.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
</pre></td><td class="code"><pre><span class="k">mod</span> <span class="n">grid</span> <span class="p">{</span>
    <span class="nd">#[derive(Clone)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">Grid</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
    <span class="k">where</span>
        <span class="n">T</span><span class="p">:</span> <span class="nb">Clone</span> <span class="o">+</span> <span class="nb">PartialEq</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="n">data</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="n">default</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Grid</span><span class="o">&lt;</span><span class="nb">u16</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">width</span> <span class="o">=</span> <span class="n">value</span><span class="nf">.as_bytes</span><span class="p">()</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'\n'</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">data</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">u16</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">value</span>
                <span class="nf">.as_bytes</span><span class="p">()</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">!=</span> <span class="sc">b'\n'</span><span class="p">)</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="sc">b'#'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">u16</span><span class="p">)</span>
                <span class="nf">.collect</span><span class="p">();</span>
            <span class="nd">assert!</span><span class="p">(</span>
                <span class="p">(</span><span class="n">data</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="n">width</span> <span class="o">==</span> <span class="n">data</span><span class="nf">.len</span><span class="p">(),</span>
                <span class="s">"All lines shall have equal length {width}"</span>
            <span class="p">);</span>
            <span class="k">let</span> <span class="n">bbox</span> <span class="o">=</span> <span class="k">Self</span><span class="p">::</span><span class="nf">get_bbox</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">let</span> <span class="n">default</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">data</span><span class="p">,</span>
                <span class="n">width</span><span class="p">,</span>
                <span class="n">bbox</span><span class="p">,</span>
                <span class="n">default</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span> <span class="k">for</span> <span class="n">Grid</span><span class="o">&lt;</span><span class="nb">u16</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
            <span class="k">let</span> <span class="p">(</span><span class="n">col_min</span><span class="p">,</span> <span class="n">row_min</span><span class="p">,</span> <span class="n">col_max</span><span class="p">,</span> <span class="n">row_max</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="py">.bbox</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="n">row_min</span><span class="o">..</span><span class="n">row_max</span> <span class="p">{</span>
                <span class="k">for</span> <span class="n">col</span> <span class="k">in</span> <span class="n">col_min</span><span class="o">..</span><span class="n">col_max</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="k">self</span><span class="py">.width</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">255</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
                        <span class="sc">'#'</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="sc">'.'</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="sc">'\n'</span><span class="nf">.fmt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nf">Ok</span><span class="p">(())</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Grid</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
    <span class="k">where</span>
        <span class="n">T</span><span class="p">:</span> <span class="nb">Copy</span> <span class="o">+</span> <span class="nb">PartialEq</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="k">fn</span> <span class="nf">get_bbox</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">width</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">data</span><span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.enumerate</span><span class="p">()</span>
                <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">e</span><span class="p">)|</span> <span class="n">e</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">default</span><span class="p">)</span>
                <span class="nf">.map</span><span class="p">(|(</span><span class="n">pos</span><span class="p">,</span> <span class="n">_</span><span class="p">)|</span> <span class="p">(</span><span class="n">pos</span> <span class="o">%</span> <span class="n">width</span><span class="p">,</span> <span class="n">pos</span> <span class="o">/</span> <span class="n">width</span><span class="p">))</span>
                <span class="nf">.fold</span><span class="p">((</span><span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span><span class="p">,</span> <span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="k">Self</span><span class="p">::</span><span class="n">add_to_bbox</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">fn</span> <span class="nf">add_to_bbox</span><span class="p">(</span>
            <span class="p">(</span><span class="n">col_min</span><span class="p">,</span> <span class="n">row_min</span><span class="p">,</span> <span class="n">col_max</span><span class="p">,</span> <span class="n">row_max</span><span class="p">):</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span>
            <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span>
        <span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">(</span>
                <span class="n">col_min</span><span class="nf">.min</span><span class="p">(</span><span class="n">col</span><span class="p">),</span>
                <span class="n">row_min</span><span class="nf">.min</span><span class="p">(</span><span class="n">row</span><span class="p">),</span>
                <span class="n">col_max</span><span class="nf">.max</span><span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">row_max</span><span class="nf">.max</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">}</span>

        <span class="cd">/// make sure there is at least `gap` space between bounding</span>
        <span class="cd">/// box and end of grid</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">increase_to_gap</span><span class="p">(</span>
            <span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span>
            <span class="n">gap_min</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
            <span class="n">gap_max</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">let</span> <span class="p">(</span><span class="n">col_min</span><span class="p">,</span> <span class="n">row_min</span><span class="p">,</span> <span class="n">col_max</span><span class="p">,</span> <span class="n">row_max</span><span class="p">)</span> <span class="o">=</span> <span class="k">self</span><span class="py">.bbox</span><span class="p">;</span>
            <span class="k">let</span> <span class="n">height</span> <span class="o">=</span> <span class="k">self</span><span class="py">.data</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="k">self</span><span class="py">.width</span><span class="p">;</span>

            <span class="k">if</span> <span class="n">col_min</span> <span class="o">&lt;</span> <span class="n">gap_min</span>
                <span class="p">||</span> <span class="n">row_min</span> <span class="o">&lt;</span> <span class="n">gap_min</span>
                <span class="p">||</span> <span class="k">self</span><span class="py">.width</span> <span class="o">-</span> <span class="n">col_max</span> <span class="o">&lt;</span> <span class="n">gap_min</span>
                <span class="p">||</span> <span class="n">height</span> <span class="o">-</span> <span class="n">row_max</span> <span class="o">&lt;</span> <span class="n">gap_min</span>
            <span class="p">{</span>
                <span class="k">let</span> <span class="p">(</span><span class="n">gap_c_l</span><span class="p">,</span> <span class="n">gap_r_t</span><span class="p">,</span> <span class="n">gap_c_r</span><span class="p">,</span> <span class="n">gap_r_b</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">gap_max</span> <span class="o">-</span> <span class="n">col_min</span><span class="nf">.min</span><span class="p">(</span><span class="n">gap_max</span><span class="p">),</span>
                    <span class="n">gap_max</span> <span class="o">-</span> <span class="n">row_min</span><span class="nf">.min</span><span class="p">(</span><span class="n">gap_max</span><span class="p">),</span>
                    <span class="n">gap_max</span> <span class="o">-</span> <span class="p">(</span><span class="k">self</span><span class="py">.width</span> <span class="o">-</span> <span class="n">col_max</span><span class="p">)</span><span class="nf">.min</span><span class="p">(</span><span class="n">gap_max</span><span class="p">),</span>
                    <span class="n">gap_max</span> <span class="o">-</span> <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">row_max</span><span class="p">)</span><span class="nf">.min</span><span class="p">(</span><span class="n">gap_max</span><span class="p">),</span>
                <span class="p">);</span>

                <span class="k">let</span> <span class="k">mut</span> <span class="n">data</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[</span>
                    <span class="k">self</span><span class="py">.default</span><span class="p">;</span>
                    <span class="p">(</span><span class="k">self</span><span class="py">.width</span> <span class="o">+</span> <span class="n">gap_c_l</span> <span class="o">+</span> <span class="n">gap_c_r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="n">gap_r_t</span> <span class="o">+</span> <span class="n">gap_r_b</span><span class="p">)</span>
                <span class="p">];</span>
                <span class="k">for</span> <span class="n">row</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">height</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="n">off</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="n">gap_r_t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="k">self</span><span class="py">.width</span> <span class="o">+</span> <span class="n">gap_c_l</span> <span class="o">+</span> <span class="n">gap_c_r</span><span class="p">)</span> <span class="o">+</span> <span class="n">gap_c_l</span><span class="p">;</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">off</span><span class="o">..</span><span class="n">off</span> <span class="o">+</span> <span class="k">self</span><span class="py">.width</span><span class="p">]</span>
                        <span class="nf">.clone_from_slice</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="n">row</span> <span class="o">*</span> <span class="k">self</span><span class="py">.width</span><span class="o">..</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">self</span><span class="py">.width</span><span class="p">]);</span>
                <span class="p">}</span>

                <span class="k">self</span><span class="py">.data</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
                <span class="k">self</span><span class="py">.width</span> <span class="o">+=</span> <span class="n">gap_c_l</span> <span class="o">+</span> <span class="n">gap_c_r</span><span class="p">;</span>
                <span class="k">self</span><span class="py">.bbox</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="k">self</span><span class="py">.bbox</span><span class="na">.0</span> <span class="o">+</span> <span class="n">gap_c_l</span><span class="p">,</span>
                    <span class="k">self</span><span class="py">.bbox</span><span class="na">.1</span> <span class="o">+</span> <span class="n">gap_r_t</span><span class="p">,</span>
                    <span class="k">self</span><span class="py">.bbox</span><span class="na">.2</span> <span class="o">+</span> <span class="n">gap_c_l</span><span class="p">,</span>
                    <span class="k">self</span><span class="py">.bbox</span><span class="na">.3</span> <span class="o">+</span> <span class="n">gap_r_t</span><span class="p">,</span>
                <span class="p">);</span>

                <span class="p">(</span><span class="n">gap_c_l</span><span class="p">,</span> <span class="n">gap_r_t</span><span class="p">,</span> <span class="n">gap_c_r</span><span class="p">,</span> <span class="n">gap_r_b</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="cd">/// set value and increase bbox if necessary</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">set</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="k">self</span><span class="py">.width</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="k">self</span><span class="py">.default</span> <span class="p">{</span>
                <span class="k">self</span><span class="py">.bbox</span> <span class="o">=</span> <span class="k">Self</span><span class="p">::</span><span class="nf">add_to_bbox</span><span class="p">(</span><span class="k">self</span><span class="py">.bbox</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">get</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">))</span> <span class="k">-&gt;</span> <span class="n">T</span> <span class="p">{</span>
            <span class="k">self</span><span class="py">.data</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="n">row</span> <span class="o">*</span> <span class="k">self</span><span class="py">.width</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="cd">/// get current bbox</span>
        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">bbox</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="py">.bbox</span>
        <span class="p">}</span>

        <span class="k">pub</span> <span class="k">fn</span> <span class="n">list</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="n">F</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span><span class="o">&gt;</span>
        <span class="k">where</span>
            <span class="n">F</span><span class="p">:</span> <span class="nf">Fn</span><span class="p">(</span><span class="o">&amp;</span><span class="n">T</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="k">self</span><span class="py">.data</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.enumerate</span><span class="p">()</span>
                <span class="nf">.filter</span><span class="p">(|(</span><span class="n">_</span><span class="p">,</span> <span class="n">v</span><span class="p">)|</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
                <span class="nf">.map</span><span class="p">(|(</span><span class="n">pos</span><span class="p">,</span> <span class="n">_</span><span class="p">)|</span> <span class="p">(</span><span class="n">pos</span> <span class="o">%</span> <span class="k">self</span><span class="py">.width</span><span class="p">,</span> <span class="n">pos</span> <span class="o">/</span> <span class="k">self</span><span class="py">.width</span><span class="p">))</span>
                <span class="nf">.collect</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">width</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
            <span class="k">self</span><span class="py">.width</span>
        <span class="p">}</span>

        <span class="k">pub</span> <span class="k">fn</span> <span class="nf">len</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
            <span class="k">self</span><span class="py">.data</span><span class="nf">.len</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_21">Star 1</h3>
<div class="paragraph">
<p>The interesting part is in the <code>simulate_round</code> function.</p>
</div>
<div class="paragraph">
<p>In each round, I first iterate over all elves and identify potential targets which are stored in the <code>targets</code> vec. Then I iterate over the targets and move the elves if applicable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
</pre></td><td class="code"><pre><span class="cd">/// helper function to get adjacent in given direction</span>
<span class="k">fn</span> <span class="nf">adjacent</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span> <span class="n">dir</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">d_col</span><span class="p">,</span> <span class="n">d_row</span><span class="p">)</span> <span class="o">=</span> <span class="n">DELTAS</span><span class="p">[</span><span class="n">dir</span><span class="p">];</span>
    <span class="p">(</span>
        <span class="n">col</span><span class="nf">.wrapping_add_signed</span><span class="p">(</span><span class="n">d_col</span><span class="p">),</span>
        <span class="n">row</span><span class="nf">.wrapping_add_signed</span><span class="p">(</span><span class="n">d_row</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">simulate_round</span><span class="p">(</span>
    <span class="n">elves</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">grid</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">Grid</span><span class="o">&lt;</span><span class="nb">u16</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">targets</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">))</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">search_start</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
<span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
    <span class="c1">// make sure grid has enough space, require at least a gap of 1</span>
    <span class="c1">// in every direction, increase to gap of 10 if not satisfied</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">col_off</span><span class="p">,</span> <span class="n">row_off</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">grid</span><span class="nf">.increase_to_gap</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

    <span class="c1">// clear buffer keeping capacity</span>
    <span class="n">targets</span><span class="nf">.truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="c1">// loop over elves</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">elves</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// apply offset</span>
        <span class="n">elves</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="na">.0</span> <span class="o">+=</span> <span class="n">col_off</span><span class="p">;</span>
        <span class="n">elves</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="na">.1</span> <span class="o">+=</span> <span class="n">row_off</span><span class="p">;</span>

        <span class="c1">// get coordinates</span>
        <span class="k">let</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="o">=</span> <span class="n">elves</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>

        <span class="c1">// if elf has no neighbors, don't move</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">DELTAS</span><span class="nf">.len</span><span class="p">())</span><span class="nf">.all</span><span class="p">(|</span><span class="n">dir</span><span class="p">|</span> <span class="n">grid</span><span class="nf">.get</span><span class="p">(</span><span class="nf">adjacent</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">dir</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mi">255</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// find a direction to move to, starting from given search_start</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">((</span><span class="n">tar_col</span><span class="p">,</span> <span class="n">tar_row</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="n">DIRS</span><span class="nf">.len</span><span class="p">())</span>
            <span class="nf">.map</span><span class="p">(|</span><span class="n">pos</span><span class="p">|</span> <span class="n">DIRS</span><span class="p">[(</span><span class="n">pos</span> <span class="o">+</span> <span class="n">search_start</span><span class="p">)</span> <span class="o">%</span> <span class="n">DIRS</span><span class="nf">.len</span><span class="p">()])</span>
            <span class="nf">.find</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">dir</span><span class="p">|</span> <span class="p">{</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="n">dir</span> <span class="o">+</span> <span class="n">DELTAS</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">DELTAS</span><span class="nf">.len</span><span class="p">(),</span>
                    <span class="n">dir</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">dir</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">DELTAS</span><span class="nf">.len</span><span class="p">(),</span>
                <span class="p">]</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.all</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">dir</span><span class="p">|</span> <span class="n">grid</span><span class="nf">.get</span><span class="p">(</span><span class="nf">adjacent</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">dir</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mi">255</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="nf">.map</span><span class="p">(|</span><span class="n">dir</span><span class="p">|</span> <span class="nf">adjacent</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">dir</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// increase 2nd byte by one (counting elves with the same target)</span>
            <span class="k">let</span> <span class="n">tar</span> <span class="o">=</span> <span class="n">grid</span><span class="nf">.get</span><span class="p">((</span><span class="n">tar_col</span><span class="p">,</span> <span class="n">tar_row</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
            <span class="n">grid</span><span class="nf">.set</span><span class="p">((</span><span class="n">tar_col</span><span class="p">,</span> <span class="n">tar_row</span><span class="p">),</span> <span class="n">tar</span><span class="p">);</span>

            <span class="c1">// if first to have this target, push to targets</span>
            <span class="k">if</span> <span class="n">tar</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="n">targets</span><span class="nf">.push</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">tar_col</span><span class="p">,</span> <span class="n">tar_row</span><span class="p">)));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// there are no targets -&gt; no elves move anymore</span>
    <span class="k">if</span> <span class="n">targets</span><span class="nf">.is_empty</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// update elves to targets where applicable</span>
    <span class="k">for</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">col_tar</span><span class="p">,</span> <span class="n">row_tar</span><span class="p">))</span> <span class="k">in</span> <span class="n">targets</span><span class="nf">.iter</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">grid</span><span class="nf">.get</span><span class="p">((</span><span class="n">col_tar</span><span class="p">,</span> <span class="n">row_tar</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="c1">// can move -&gt; move</span>
            <span class="n">grid</span><span class="nf">.set</span><span class="p">(</span><span class="n">elves</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
            <span class="n">grid</span><span class="nf">.set</span><span class="p">((</span><span class="n">col_tar</span><span class="p">,</span> <span class="n">row_tar</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">elves</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">col_tar</span><span class="p">,</span> <span class="n">row_tar</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// cannot move -&gt; reset target count</span>
            <span class="n">grid</span><span class="nf">.set</span><span class="p">((</span><span class="n">col_tar</span><span class="p">,</span> <span class="n">row_tar</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// some elves moved</span>
    <span class="k">true</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">simulate</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">rounds</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// build grid</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">grid</span> <span class="o">=</span> <span class="nn">Grid</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="c1">// build list of elves</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">elves</span> <span class="o">=</span> <span class="n">grid</span><span class="nf">.list</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">v</span><span class="p">|</span> <span class="n">v</span> <span class="o">&amp;</span> <span class="mi">255</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="c1">// buffer to store targets</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">targets</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">with_capacity</span><span class="p">(</span><span class="n">elves</span><span class="nf">.len</span><span class="p">());</span>

    <span class="c1">// loop over rounds</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">round</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="n">round</span> <span class="o">&lt;</span> <span class="n">rounds</span> <span class="p">{</span>
        <span class="k">if</span> <span class="o">!</span><span class="nf">simulate_round</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">elves</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">grid</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">targets</span><span class="p">,</span> <span class="n">round</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// stop if no more elves move</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">round</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">(</span><span class="n">round</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">elves</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">const</span> <span class="n">DELTAS</span><span class="p">:</span> <span class="p">[(</span><span class="nb">isize</span><span class="p">,</span> <span class="nb">isize</span><span class="p">);</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>   <span class="c1">// SOUTH EAST</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>   <span class="c1">// SOUTH</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1">// SOUTH WEST</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1">// WEST</span>
    <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="c1">// NORTH WEST</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>  <span class="c1">// NORTH</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>  <span class="c1">// NORTH EAST</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>   <span class="c1">// EAST</span>
<span class="p">];</span>

<span class="cd">/// NORTH, SOUTH, WEST, EAST</span>
<span class="k">pub</span> <span class="k">const</span> <span class="n">DIRS</span><span class="p">:</span> <span class="p">[</span><span class="nb">usize</span><span class="p">;</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">];</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">elves</span><span class="p">)</span> <span class="o">=</span> <span class="nf">simulate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="k">let</span> <span class="p">(</span><span class="n">col_min</span><span class="p">,</span> <span class="n">row_min</span><span class="p">,</span> <span class="n">col_max</span><span class="p">,</span> <span class="n">row_max</span><span class="p">)</span> <span class="o">=</span> <span class="n">elves</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.fold</span><span class="p">(</span>
        <span class="p">(</span><span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span><span class="p">,</span> <span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">|(</span><span class="n">col_min</span><span class="p">,</span> <span class="n">row_min</span><span class="p">,</span> <span class="n">col_max</span><span class="p">,</span> <span class="n">row_max</span><span class="p">),</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)|</span> <span class="p">{</span>
            <span class="p">(</span>
                <span class="n">col_min</span><span class="nf">.min</span><span class="p">(</span><span class="n">col</span><span class="p">),</span>
                <span class="n">row_min</span><span class="nf">.min</span><span class="p">(</span><span class="n">row</span><span class="p">),</span>
                <span class="n">col_max</span><span class="nf">.max</span><span class="p">(</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">row_max</span><span class="nf">.max</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">},</span>
    <span class="p">);</span>

    <span class="p">(</span><span class="n">col_max</span> <span class="o">-</span> <span class="n">col_min</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">row_max</span> <span class="o">-</span> <span class="n">row_min</span><span class="p">)</span> <span class="o">-</span> <span class="n">elves</span><span class="nf">.len</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_21">Star 2</h3>
<div class="paragraph">
<p>Just simulate rounds until nothing more happens.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="nf">simulate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nn">usize</span><span class="p">::</span><span class="n">MAX</span><span class="p">)</span><span class="na">.0</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_24">Tests</h3>
<div class="paragraph">
<p>Kind of visual tests today for the simple example. Just compared my output to the one on the website manually.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_increase_to_gap</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">grid</span> <span class="o">=</span> <span class="nn">Grid</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="s">"#....</span><span class="se">\n</span><span class="s">.#...</span><span class="se">\n</span><span class="s">..#.."</span><span class="p">);</span>
        <span class="k">let</span> <span class="n">str_a</span> <span class="o">=</span> <span class="n">grid</span><span class="nf">.to_string</span><span class="p">();</span>

        <span class="c1">// check initial conditions</span>
        <span class="nd">assert_eq!</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">grid</span><span class="nf">.bbox</span><span class="p">(),</span> <span class="s">"incorrect bbox"</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">grid</span><span class="nf">.width</span><span class="p">(),</span> <span class="s">"unexpected width"</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">grid</span><span class="nf">.len</span><span class="p">(),</span> <span class="s">"unexpected length"</span><span class="p">);</span>

        <span class="c1">// perform and verify increase</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">grid</span><span class="nf">.increase_to_gap</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s">"unexpected amount of increase"</span>
        <span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">grid</span><span class="nf">.increase_to_gap</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
            <span class="s">"unexpected increase beyond min"</span>
        <span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">grid</span><span class="nf">.bbox</span><span class="p">(),</span> <span class="s">"unexpected bbox after increase"</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">grid</span><span class="nf">.width</span><span class="p">(),</span> <span class="s">"unexpected width after increase"</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">7</span><span class="p">,</span> <span class="n">grid</span><span class="nf">.len</span><span class="p">(),</span> <span class="s">"unexpected length after increase"</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span>
            <span class="n">str_a</span><span class="p">,</span>
            <span class="n">grid</span><span class="nf">.to_string</span><span class="p">(),</span>
            <span class="s">"string representation changed after increase"</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_simulate_round</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">grid</span> <span class="o">=</span> <span class="nn">Grid</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT_SMALL</span><span class="p">);</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">elves</span> <span class="o">=</span> <span class="n">grid</span><span class="nf">.list</span><span class="p">(|</span><span class="n">v</span><span class="p">|</span> <span class="n">v</span> <span class="o">&amp;</span> <span class="mi">255</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">targets</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">with_capacity</span><span class="p">(</span><span class="n">elves</span><span class="nf">.len</span><span class="p">());</span>

        <span class="nd">println!</span><span class="p">(</span><span class="s">"{grid}"</span><span class="p">);</span>
        <span class="nf">simulate_round</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">elves</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">grid</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">targets</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{grid}"</span><span class="p">);</span>
        <span class="nf">simulate_round</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">elves</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">grid</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">targets</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{grid}"</span><span class="p">);</span>
        <span class="nf">simulate_round</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">elves</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">grid</span><span class="p">,</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">targets</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{grid}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"....#..
..###.#
#...#.#
.#...##
#.###..
##.#.##
.#..#..
"#</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT_SMALL</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#".....
..##.
..#..
.....
..##.
.....
"#</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-24">Day 24: Blizzard Basin</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/24">AoC|2022|24</a>.</p>
</div>
<div class="paragraph">
<p>Another day of path finding.</p>
</div>
<div class="sect2">
<h3 id="_input_24">Input</h3>
<div class="paragraph">
<p>I store blizzards separately by direction in a grid (stored as flat vec) which will never change over time. For each direction, there is an row / column offset (modulo width / hight) added depending on when we look at them later on.</p>
</div>
<div class="paragraph">
<p>The blizzards just contain the inner portion of the basin for easier wrapping around.</p>
</div>
<div class="paragraph">
<p>In addition, I store the position of the entry and the exit on the first and last row.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">mod</span> <span class="n">input</span> <span class="p">{</span>
    <span class="nd">#[derive(Debug)]</span>
    <span class="k">pub</span> <span class="k">struct</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="k">pub</span> <span class="n">blizzards_r</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">bool</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">blizzards_u</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">bool</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">blizzards_l</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">bool</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">blizzards_d</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">bool</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">width</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">height</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">entry</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
        <span class="k">pub</span> <span class="n">exit</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">impl</span> <span class="nb">From</span><span class="o">&lt;&amp;</span><span class="nb">str</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">PuzzleData</span> <span class="p">{</span>
        <span class="cd">/// parse the puzzle input</span>
        <span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="nf">.as_bytes</span><span class="p">();</span>

            <span class="k">let</span> <span class="n">width</span> <span class="o">=</span> <span class="n">b</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'\n'</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
            <span class="k">let</span> <span class="n">entry</span> <span class="o">=</span> <span class="n">b</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'.'</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">let</span> <span class="n">exit</span> <span class="o">=</span> <span class="n">width</span>
                <span class="o">-</span> <span class="n">b</span><span class="nf">.iter</span><span class="p">()</span>
                    <span class="nf">.rev</span><span class="p">()</span>
                    <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">!=</span> <span class="sc">b'\n'</span><span class="p">)</span>
                    <span class="nf">.position</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'.'</span><span class="p">)</span>
                    <span class="nf">.unwrap</span><span class="p">();</span>

            <span class="k">let</span> <span class="n">blizzards_r</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">bool</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">b</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.skip</span><span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
                <span class="nf">.take</span><span class="p">(</span><span class="n">b</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span>
                <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">!=</span> <span class="sc">b'\n'</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">!=</span> <span class="sc">b'#'</span><span class="p">)</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'&gt;'</span><span class="p">)</span>
                <span class="nf">.collect</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">blizzards_l</span> <span class="o">=</span> <span class="n">b</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.skip</span><span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
                <span class="nf">.take</span><span class="p">(</span><span class="n">b</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span>
                <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">!=</span> <span class="sc">b'\n'</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">!=</span> <span class="sc">b'#'</span><span class="p">)</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'&lt;'</span><span class="p">)</span>
                <span class="nf">.collect</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">blizzards_u</span> <span class="o">=</span> <span class="n">b</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.skip</span><span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
                <span class="nf">.take</span><span class="p">(</span><span class="n">b</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span>
                <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">!=</span> <span class="sc">b'\n'</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">!=</span> <span class="sc">b'#'</span><span class="p">)</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'^'</span><span class="p">)</span>
                <span class="nf">.collect</span><span class="p">();</span>
            <span class="k">let</span> <span class="n">blizzards_d</span> <span class="o">=</span> <span class="n">b</span>
                <span class="nf">.iter</span><span class="p">()</span>
                <span class="nf">.skip</span><span class="p">(</span><span class="n">width</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
                <span class="nf">.take</span><span class="p">(</span><span class="n">b</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span>
                <span class="nf">.filter</span><span class="p">(|</span><span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">!=</span> <span class="sc">b'\n'</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="o">!=</span> <span class="sc">b'#'</span><span class="p">)</span>
                <span class="nf">.map</span><span class="p">(|</span><span class="o">&amp;</span><span class="n">b</span><span class="p">|</span> <span class="n">b</span> <span class="o">==</span> <span class="sc">b'v'</span><span class="p">)</span>
                <span class="nf">.collect</span><span class="p">();</span>

            <span class="k">let</span> <span class="n">height</span> <span class="o">=</span> <span class="n">blizzards_r</span><span class="nf">.len</span><span class="p">()</span> <span class="o">/</span> <span class="n">width</span><span class="p">;</span>

            <span class="k">Self</span> <span class="p">{</span>
                <span class="n">blizzards_r</span><span class="p">,</span>
                <span class="n">blizzards_l</span><span class="p">,</span>
                <span class="n">blizzards_u</span><span class="p">,</span>
                <span class="n">blizzards_d</span><span class="p">,</span>
                <span class="n">width</span><span class="p">,</span>
                <span class="n">height</span><span class="p">,</span>
                <span class="n">entry</span><span class="p">,</span>
                <span class="n">exit</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_1_22">Star 1</h3>
<div class="paragraph">
<p>I implemented a function <code>is_blizzard</code> which checks whether there is a blizzard at a given position and a given time.</p>
</div>
<div class="paragraph">
<p>With this, I implement a <code>A*</code> style search (since the graph is unweighted, nodes are immediately settled once reached and no decrease key or similar is required)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
</pre></td><td class="code"><pre><span class="k">impl</span> <span class="n">PuzzleData</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">is_blizzard_r</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span> <span class="n">time</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.blizzards_r</span><span class="p">[(</span><span class="n">col</span> <span class="o">+</span> <span class="k">self</span><span class="py">.width</span> <span class="o">-</span> <span class="n">time</span> <span class="o">%</span> <span class="k">self</span><span class="py">.width</span><span class="p">)</span> <span class="o">%</span> <span class="k">self</span><span class="py">.width</span> <span class="o">+</span> <span class="k">self</span><span class="py">.width</span> <span class="o">*</span> <span class="n">row</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">is_blizzard_u</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span> <span class="n">time</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.blizzards_u</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="k">self</span><span class="py">.width</span> <span class="o">*</span> <span class="p">((</span><span class="n">row</span> <span class="o">+</span> <span class="n">time</span><span class="p">)</span> <span class="o">%</span> <span class="k">self</span><span class="py">.height</span><span class="p">)]</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">is_blizzard_l</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span> <span class="n">time</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.blizzards_l</span><span class="p">[(</span><span class="n">col</span> <span class="o">+</span> <span class="n">time</span><span class="p">)</span> <span class="o">%</span> <span class="k">self</span><span class="py">.width</span> <span class="o">+</span> <span class="k">self</span><span class="py">.width</span> <span class="o">*</span> <span class="n">row</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">is_blizzard_d</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span> <span class="n">time</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.blizzards_d</span>
            <span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="k">self</span><span class="py">.width</span> <span class="o">*</span> <span class="p">((</span><span class="n">row</span> <span class="o">+</span> <span class="k">self</span><span class="py">.height</span> <span class="o">-</span> <span class="n">time</span> <span class="o">%</span> <span class="k">self</span><span class="py">.height</span><span class="p">)</span> <span class="o">%</span> <span class="k">self</span><span class="py">.height</span><span class="p">)]</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">is_blizzard</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span> <span class="n">time</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="k">self</span><span class="nf">.is_blizzard_r</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="p">||</span> <span class="k">self</span><span class="nf">.is_blizzard_u</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="p">||</span> <span class="k">self</span><span class="nf">.is_blizzard_l</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
            <span class="p">||</span> <span class="k">self</span><span class="nf">.is_blizzard_d</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">print</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// first row</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"#"</span><span class="p">);</span>
        <span class="k">for</span> <span class="n">col_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="k">self</span><span class="py">.width</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">col_</span> <span class="o">!=</span> <span class="k">self</span><span class="py">.entry</span> <span class="p">{</span>
                <span class="nd">print!</span><span class="p">(</span><span class="s">"#"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">col_</span> <span class="o">==</span> <span class="n">col</span> <span class="o">&amp;&amp;</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="nd">print!</span><span class="p">(</span><span class="s">"E"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nd">print!</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"#"</span><span class="p">);</span>

        <span class="k">for</span> <span class="n">row_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="k">self</span><span class="py">.height</span> <span class="p">{</span>
            <span class="nd">print!</span><span class="p">(</span><span class="s">"#"</span><span class="p">);</span>
            <span class="k">for</span> <span class="n">col_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="k">self</span><span class="py">.width</span> <span class="p">{</span>
                <span class="k">let</span> <span class="n">r</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.is_blizzard_r</span><span class="p">((</span><span class="n">col_</span><span class="p">,</span> <span class="n">row_</span><span class="p">),</span> <span class="n">time</span><span class="p">)</span> <span class="k">as</span> <span class="nb">u8</span><span class="p">;</span>
                <span class="k">let</span> <span class="n">u</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.is_blizzard_u</span><span class="p">((</span><span class="n">col_</span><span class="p">,</span> <span class="n">row_</span><span class="p">),</span> <span class="n">time</span><span class="p">)</span> <span class="k">as</span> <span class="nb">u8</span><span class="p">;</span>
                <span class="k">let</span> <span class="n">l</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.is_blizzard_l</span><span class="p">((</span><span class="n">col_</span><span class="p">,</span> <span class="n">row_</span><span class="p">),</span> <span class="n">time</span><span class="p">)</span> <span class="k">as</span> <span class="nb">u8</span><span class="p">;</span>
                <span class="k">let</span> <span class="n">d</span> <span class="o">=</span> <span class="k">self</span><span class="nf">.is_blizzard_d</span><span class="p">((</span><span class="n">col_</span><span class="p">,</span> <span class="n">row_</span><span class="p">),</span> <span class="n">time</span><span class="p">)</span> <span class="k">as</span> <span class="nb">u8</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">u</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">r</span> <span class="o">+</span> <span class="n">u</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">d</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">u</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"^"</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"v"</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">row_</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">row</span> <span class="o">&amp;&amp;</span> <span class="n">col_</span> <span class="o">==</span> <span class="n">col</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"E"</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nd">print!</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"#"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// last row</span>
        <span class="nd">print!</span><span class="p">(</span><span class="s">"#"</span><span class="p">);</span>
        <span class="k">for</span> <span class="n">col_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="k">self</span><span class="py">.width</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">col_</span> <span class="o">!=</span> <span class="k">self</span><span class="py">.exit</span> <span class="p">{</span>
                <span class="nd">print!</span><span class="p">(</span><span class="s">"#"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">col_</span> <span class="o">==</span> <span class="n">col</span> <span class="o">&amp;&amp;</span> <span class="n">row</span> <span class="o">==</span> <span class="k">self</span><span class="py">.height</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="nd">print!</span><span class="p">(</span><span class="s">"E"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nd">print!</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"#"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">shortest_path</span><span class="p">(</span>
        <span class="o">&amp;</span><span class="k">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span>
        <span class="n">target</span><span class="p">:</span> <span class="p">(</span><span class="nb">usize</span><span class="p">,</span> <span class="nb">usize</span><span class="p">),</span>
        <span class="n">start_time</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">w</span> <span class="o">=</span> <span class="k">self</span><span class="py">.width</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">h</span> <span class="o">=</span> <span class="k">self</span><span class="py">.height</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">queue</span> <span class="o">=</span> <span class="nn">BinaryHeap</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

        <span class="c1">// items on the queue are</span>
        <span class="c1">// - lower bound of time to target (Manhattan distance)</span>
        <span class="c1">// - time used so far</span>
        <span class="c1">// - current position (row, col)</span>
        <span class="n">queue</span><span class="nf">.push</span><span class="p">((</span>
            <span class="o">!</span><span class="p">(</span><span class="k">self</span><span class="py">.entry</span><span class="nf">.max</span><span class="p">(</span><span class="k">self</span><span class="py">.exit</span><span class="p">)</span> <span class="o">-</span> <span class="k">self</span><span class="py">.entry</span><span class="nf">.min</span><span class="p">(</span><span class="k">self</span><span class="py">.exit</span><span class="p">)</span> <span class="o">+</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="o">!</span><span class="n">start_time</span><span class="p">,</span>
            <span class="n">start</span><span class="p">,</span>
        <span class="p">));</span>

        <span class="c1">// do not visit nodes twice</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">seen</span> <span class="o">=</span> <span class="nn">HashSet</span><span class="p">::</span><span class="nf">from</span><span class="p">([(</span><span class="n">start_time</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">h</span><span class="p">),</span> <span class="n">start</span><span class="p">)]);</span>

        <span class="k">while</span> <span class="k">let</span> <span class="nf">Some</span><span class="p">((</span><span class="n">_n_bound</span><span class="p">,</span> <span class="n">n_time</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)))</span> <span class="o">=</span> <span class="n">queue</span><span class="nf">.pop</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="n">time</span> <span class="o">=</span> <span class="o">!</span><span class="n">n_time</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="o">==</span> <span class="n">target</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">time</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">let</span> <span class="n">time_upd</span> <span class="o">=</span> <span class="n">time</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

            <span class="k">let</span> <span class="k">mut</span> <span class="n">enqueue</span> <span class="o">=</span> <span class="p">|(</span><span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="n">t</span><span class="p">|</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">||</span> <span class="n">r</span> <span class="o">==</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">||</span> <span class="o">!</span><span class="k">self</span><span class="nf">.is_blizzard</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">t</span><span class="p">))</span>
                    <span class="o">&amp;&amp;</span> <span class="n">seen</span><span class="nf">.insert</span><span class="p">((</span><span class="n">t</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">)))</span>
                <span class="p">{</span>
                    <span class="k">let</span> <span class="n">bound</span> <span class="o">=</span>
                        <span class="n">target</span><span class="na">.0</span><span class="nf">.max</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">target</span><span class="na">.0</span><span class="nf">.min</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">target</span><span class="na">.1</span><span class="nf">.max</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">target</span><span class="na">.1</span><span class="nf">.min</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">t</span><span class="p">;</span>
                    <span class="n">queue</span><span class="nf">.push</span><span class="p">((</span><span class="o">!</span><span class="n">bound</span><span class="p">,</span> <span class="o">!</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">)))</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="c1">// move to entry</span>
            <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">col</span> <span class="o">==</span> <span class="k">self</span><span class="py">.entry</span> <span class="p">{</span>
                <span class="nf">enqueue</span><span class="p">((</span><span class="k">self</span><span class="py">.entry</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">time_upd</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// move to exit</span>
            <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="n">h</span> <span class="o">&amp;&amp;</span> <span class="n">col</span> <span class="o">==</span> <span class="k">self</span><span class="py">.exit</span> <span class="p">{</span>
                <span class="nf">enqueue</span><span class="p">((</span><span class="k">self</span><span class="py">.exit</span><span class="p">,</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">time_upd</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// don't move at entry or exit or any position where there is no blizzard</span>
            <span class="nf">enqueue</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">time_upd</span><span class="p">);</span>
            <span class="c1">// move left (not in entry / exit rows)</span>
            <span class="k">if</span> <span class="n">row</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">row</span> <span class="o">!=</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">col</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="nf">enqueue</span><span class="p">((</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">time_upd</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// move up (not in entry row and row immediately below)</span>
            <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="nf">enqueue</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">time_upd</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// move right (not in entry / exit rows)</span>
            <span class="k">if</span> <span class="n">row</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">row</span> <span class="o">!=</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="n">w</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
                <span class="nf">enqueue</span><span class="p">((</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span><span class="p">),</span> <span class="n">time_upd</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// move down (not in exit row and row immediately above)</span>
            <span class="k">if</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="n">h</span> <span class="p">{</span>
                <span class="nf">enqueue</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">time_upd</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="nd">panic!</span><span class="p">(</span>
            <span class="s">"I've seen {} nodes but did not find a path from {start:?} at t = {start_time} to {target:?}"</span><span class="p">,</span>
            <span class="n">seen</span><span class="nf">.len</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="n">data</span><span class="nf">.shortest_path</span><span class="p">((</span><span class="n">data</span><span class="py">.entry</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">data</span><span class="py">.exit</span><span class="p">,</span> <span class="n">data</span><span class="py">.height</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_star_2_22">Star 2</h3>
<div class="paragraph">
<p>My initial implementation was not quite generic (I never went back to the entry and actually stopped the search one step before the exit). Making it bi-directional was a simple extension.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_2</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">PuzzleData</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">usize</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="py">.entry</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">target</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="py">.exit</span><span class="p">,</span> <span class="n">data</span><span class="py">.height</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.shortest_path</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">data</span><span class="nf">.shortest_path</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">m1</span><span class="p">);</span>
    <span class="n">data</span><span class="nf">.shortest_path</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_25">Tests</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"#.######
#&gt;&gt;.&lt;^&lt;#
#.&lt;..&lt;&lt;#
#&gt;v.&gt;&lt;&gt;#
#&lt;^v^^&gt;#
######.#
"#</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT_SIMPLE</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"#.#####
#.....#
#&gt;....#
#.....#
#...v.#
#.....#
#####.#
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_from</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">data</span><span class="py">.blizzards_r</span><span class="nf">.len</span><span class="p">());</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">data</span><span class="py">.blizzards_u</span><span class="nf">.len</span><span class="p">());</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">data</span><span class="py">.blizzards_l</span><span class="nf">.len</span><span class="p">());</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">data</span><span class="py">.blizzards_d</span><span class="nf">.len</span><span class="p">());</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">data</span><span class="py">.width</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="py">.entry</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">data</span><span class="py">.exit</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"{data:?}"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_blizzards_move</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT_SIMPLE</span><span class="p">);</span>

        <span class="k">for</span> <span class="n">time</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..=</span><span class="mi">12</span> <span class="p">{</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"t = {time}"</span><span class="p">);</span>
            <span class="n">data</span><span class="nf">.print</span><span class="p">(</span><span class="n">data</span><span class="py">.entry</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_blizzards_is_blizzard</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">println!</span><span class="p">(</span>
            <span class="s">"entry: ({}, 0), exit: ({}, {})"</span><span class="p">,</span>
            <span class="n">data</span><span class="py">.entry</span><span class="p">,</span>
            <span class="n">data</span><span class="py">.exit</span><span class="p">,</span>
            <span class="n">data</span><span class="py">.height</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="p">);</span>

        <span class="k">let</span> <span class="n">steps_col</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">steps_row</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">col</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">row</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">steps_col</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="nf">.wrapping_add_signed</span><span class="p">(</span><span class="n">steps_col</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="nf">.wrapping_add_signed</span><span class="p">(</span><span class="n">steps_row</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
            <span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="nd">println!</span><span class="p">(</span><span class="s">"t = {time}: ({col}, {row})"</span><span class="p">);</span>
            <span class="n">data</span><span class="nf">.print</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">time</span><span class="p">);</span>
            <span class="nd">assert!</span><span class="p">(</span><span class="n">row</span> <span class="o">==</span> <span class="n">data</span><span class="py">.height</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">||</span> <span class="o">!</span><span class="n">data</span><span class="nf">.is_blizzard</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">time</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">data</span> <span class="o">=</span> <span class="nn">PuzzleData</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">CONTENT</span><span class="p">);</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="nf">star_2</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sol-25">Day 25: Full of Hot Air</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://rust-lang.org">Rust</a> solution to <a href="https://adventofcode.com/2022/day/25">AoC|2022|25</a>.</p>
</div>
<div class="paragraph">
<p>A nice, simple last one for Christmas!</p>
</div>
<div class="sect2">
<h3 id="_star_1_23">Star 1</h3>
<div class="paragraph">
<p>There is not much to say. Here is the solution:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="code"><pre><span class="k">pub</span> <span class="k">fn</span> <span class="nf">star_1</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="o">&amp;&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="c1">// convert SNAFU to decimal and sum</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">sum</span><span class="p">:</span> <span class="nb">isize</span> <span class="o">=</span> <span class="n">data</span>
        <span class="nf">.lines</span><span class="p">()</span>
        <span class="nf">.map</span><span class="p">(|</span><span class="n">l</span><span class="p">|</span> <span class="p">{</span>
            <span class="n">l</span><span class="nf">.as_bytes</span><span class="p">()</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.fold</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">|</span><span class="n">value</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">digit</span><span class="p">|</span> <span class="p">{</span>
                <span class="mi">5</span> <span class="o">*</span> <span class="n">value</span>
                    <span class="o">+</span> <span class="k">match</span> <span class="n">digit</span> <span class="p">{</span>
                        <span class="sc">b'2'</span> <span class="k">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="sc">b'1'</span> <span class="k">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="sc">b'0'</span> <span class="k">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="sc">b'-'</span> <span class="k">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                        <span class="sc">b'='</span> <span class="k">=&gt;</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(),</span>
                    <span class="p">}</span>
            <span class="p">})</span>
        <span class="p">})</span>
        <span class="nf">.sum</span><span class="p">();</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"The sum is {sum}"</span><span class="p">);</span>

    <span class="c1">// convert decimal to SNAFU</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">digits</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
    <span class="k">while</span> <span class="n">sum</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">v</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">%</span> <span class="mi">5</span><span class="p">;</span>
        <span class="n">sum</span> <span class="o">/=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">{</span>
            <span class="n">sum</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">digits</span><span class="nf">.push</span><span class="p">(</span><span class="k">match</span> <span class="n">v</span> <span class="p">{</span>
            <span class="mi">3</span> <span class="k">=&gt;</span> <span class="sc">'='</span><span class="p">,</span>
            <span class="mi">4</span> <span class="k">=&gt;</span> <span class="sc">'-'</span><span class="p">,</span>
            <span class="mi">0</span> <span class="k">=&gt;</span> <span class="sc">'0'</span><span class="p">,</span>
            <span class="mi">1</span> <span class="k">=&gt;</span> <span class="sc">'1'</span><span class="p">,</span>
            <span class="mi">2</span> <span class="k">=&gt;</span> <span class="sc">'2'</span><span class="p">,</span>
            <span class="n">_</span> <span class="k">=&gt;</span> <span class="nd">unreachable!</span><span class="p">(),</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="n">digits</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.rev</span><span class="p">()</span><span class="nf">.collect</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tests_26">Tests</h3>
<div class="paragraph">
<p>And the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="rust"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="code"><pre><span class="nd">#[cfg(test)]</span>
<span class="k">mod</span> <span class="n">tests</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">super</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

    <span class="k">const</span> <span class="n">CONTENT</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span> <span class="o">=</span> <span class="s">r#"1=-0-2
12111
2=0=
21
2=01
111
20012
112
1=-1=
1-12
12
1=
122
"#</span><span class="p">;</span>

    <span class="nd">#[test]</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">test_star_1</span><span class="p">()</span> <span class="p">{</span>
        <span class="nd">assert_eq!</span><span class="p">(</span><span class="s">"2=-1=0"</span><span class="p">,</span> <span class="nf">star_1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONTENT</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#top">Top</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-11-17 23:12:30 UTC
</div>
</div>
</body>
</html>